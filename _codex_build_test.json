{
  "CameraStates": [
    {
      "AbsolutePosition": {
        "x": -5,
        "y": 132.7,
        "z": -41
      },
      "Distance": 140,
      "Position": {
        "x": -5,
        "y": -2.5,
        "z": -5
      },
      "Rotation": {
        "x": 75,
        "y": 0,
        "z": 0
      },
      "Zoomed": false
    }
  ],
  "ComponentTags": {
    "labels": [
      {
        "displayed": "HexSpirit",
        "normalized": "hexspirit"
      },
      {
        "displayed": "Playermat",
        "normalized": "playermat"
      },
      {
        "displayed": "NotInteractable",
        "normalized": "notinteractable"
      },
      {
        "displayed": "Status",
        "normalized": "status"
      },
      {
        "displayed": "Rune",
        "normalized": "rune"
      },
      {
        "displayed": "Die",
        "normalized": "die"
      },
      {
        "displayed": "SpiritContainer",
        "normalized": "spiritcontainer"
      },
      {
        "displayed": "Barrier",
        "normalized": "barrier"
      },
      {
        "displayed": "Victory",
        "normalized": "victory"
      },
      {
        "displayed": "Icon",
        "normalized": "icon"
      },
      {
        "displayed": "Tainted",
        "normalized": "tainted"
      },
      {
        "displayed": "Purified",
        "normalized": "purified"
      },
      {
        "displayed": "Corrupt",
        "normalized": "corrupt"
      },
      {
        "displayed": "Fallen",
        "normalized": "fallen"
      },
      {
        "displayed": "OriginDestiny",
        "normalized": "origindestiny"
      },
      {
        "displayed": "SpecialSpirit",
        "normalized": "specialspirit"
      },
      {
        "displayed": "Artifact",
        "normalized": "artifact"
      },
      {
        "displayed": "Monster",
        "normalized": "monster"
      }
    ]
  },
  "CustomUIAssets": [],
  "Date": "Sun Jan  4 12:38:56 PST 2026",
  "DecalPallet": [],
  "Decals": [],
  "EpochTime": 1767559136,
  "GameComplexity": "",
  "GameMode": "Arc Spirits",
  "GameType": "",
  "Gravity": 0.5,
  "Grid": {
    "BothSnapping": false,
    "Color": {
      "b": 0,
      "g": 0,
      "r": 0
    },
    "Lines": false,
    "Offset": false,
    "Opacity": 0.75,
    "PosOffset": {
      "x": 0,
      "y": 1,
      "z": 0
    },
    "Snapping": false,
    "ThickLines": false,
    "Type": 0,
    "xSize": 2.5,
    "ySize": 2.5
  },
  "Hands": {
    "DisableUnused": false,
    "Enable": true,
    "Hiding": 0
  },
  "Lighting": {
    "AmbientEquatorColor": {
      "b": 0.5,
      "g": 0.5,
      "r": 0.5
    },
    "AmbientGroundColor": {
      "b": 0.5,
      "g": 0.5,
      "r": 0.5
    },
    "AmbientIntensity": 1.3,
    "AmbientSkyColor": {
      "b": 0.5,
      "g": 0.5,
      "r": 0.5
    },
    "AmbientType": 0,
    "LightColor": {
      "b": 0.8902,
      "g": 0.9804,
      "r": 1
    },
    "LightIntensity": 0.54,
    "LutContribution": 1,
    "LutIndex": 0,
    "ReflectionIntensity": 1
  },
  "LuaScript": "-- Bundled by luabundle {\"version\":\"1.6.0\"}\nlocal __bundle_require, __bundle_loaded, __bundle_register, __bundle_modules = (function(superRequire)\n\tlocal loadingPlaceholder = {[{}] = true}\n\n\tlocal register\n\tlocal modules = {}\n\n\tlocal require\n\tlocal loaded = {}\n\n\tregister = function(name, body)\n\t\tif not modules[name] then\n\t\t\tmodules[name] = body\n\t\tend\n\tend\n\n\trequire = function(name)\n\t\tlocal loadedModule = loaded[name]\n\n\t\tif loadedModule then\n\t\t\tif loadedModule == loadingPlaceholder then\n\t\t\t\treturn nil\n\t\t\tend\n\t\telse\n\t\t\tif not modules[name] then\n\t\t\t\tif not superRequire then\n\t\t\t\t\tlocal identifier = type(name) == 'string' and '\\\"' .. name .. '\\\"' or tostring(name)\n\t\t\t\t\terror('Tried to require ' .. identifier .. ', but no such module has been registered')\n\t\t\t\telse\n\t\t\t\t\treturn superRequire(name)\n\t\t\t\tend\n\t\t\tend\n\n\t\t\tloaded[name] = loadingPlaceholder\n\t\t\tloadedModule = modules[name](require, loaded, register, modules)\n\t\t\tloaded[name] = loadedModule\n\t\tend\n\n\t\treturn loadedModule\n\tend\n\n\treturn require, loaded, register, modules\nend)(nil)\n__bundle_register(\"Global\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- Global.ttslua - Entry point for Arc Spirits TTS Mod\n-- This file coordinates all modules and handles TTS lifecycle events\n-------------------------------------------------------------------------------\n\nrequire(\"util/TtsLuaAdditions\")\n\n-- Import all modules\nlocal GameState           = require(\"state/GameState\")\nlocal SupabaseLib         = require(\"api/SupabaseLib\")\nlocal SpawnLib            = require(\"util/SpawnLib\")\nlocal UtilLib             = require(\"util/UtilLib\")\nlocal UILib               = require(\"ui/UILib\")\nlocal DiceLib             = require(\"game/DiceLib\")\nlocal TraitLib            = require(\"game/TraitLib\")\nlocal MarketLib           = require(\"game/MarketLib\")\nlocal NavigationLib       = require(\"game/NavigationLib\")\nlocal CharacterSelectLib  = require(\"game/CharacterSelectLib\")\nlocal TravelerLib         = require(\"game/TravelerLib\")\nlocal TableLib            = require(\"util/TableLib\")\nlocal PlayerMatLib        = require(\"game/PlayerMatLib\")\nlocal AssetLoaderLib      = require(\"api/AssetLoaderLib\")\nlocal GlobalUI            = require(\"ui/GlobalUI\")\nlocal ResourceTrackerUI   = require(\"ui/ResourceTrackerUI\")\nlocal ObjectTemplateLib   = require(\"util/ObjectTemplateLib\")\n\n-------------------------------------------------------------------------------\n-- MARK: TTS Lifecycle Events\n-------------------------------------------------------------------------------\n\nfunction onSave()\n  return GameState.serialize()\nend\n\nfunction onLoad(saveData)\n  GameState.debugPrint(\"[Global] onLoad started (gameStarted=\" .. tostring(GameState.gameStarted) .. \")\")\n  GameState.deserialize(saveData)\n  drawPlayAreas()\n\n  -- Ensure spirit bags are the same standard Bag object as other spawned bags\n  -- (Custom_Model_Bag meshes can sometimes fail to render and appear invisible)\n  Wait.frames(function()\n    AssetLoaderLib.ensureStandardSpiritBags()\n  end, 1)\n\n  if GameState.gameStarted then\n    if GameState.hasCachedData() then\n      GameState.debugPrint(\"[Global] Cache detected - using cached data (skipping HTTP)\")\n      onCachedReload()\n    else\n      GameState.debugPrint(\"[Global] No cache found - fetching assets from API\")\n      getAssetData()\n    end\n  else\n    GameState.debugPrint(\"[Global] Lobby mode - fetching assets from API\")\n    initializeLobby()\n  end\nend\n\nfunction initializeLobby()\n  getAssetData()\nend\n\n--- Fast reload path when cached data is available (undo/reload)\n--- Skips HTTP request and redundant data processing\nfunction onCachedReload()\n  GameState.debugPrint(\"[Global] Using cached data for reload (skipping HTTP)\")\n\n  -- Rebuild UI (required - TTS may destroy XML on undo)\n  UILib.createGlobalXml()\n\n  -- Update navigation\n  Wait.frames(function()\n    NavigationLib.updateRealmNavigator()\n  end, 5)\n\n  -- Rebuild game references (mats, buttons, spirits)\n  rebuildGameReferences()\nend\n\nfunction destroyAllGameObjects()\n  local tagsToDestroy = {\n    \"Playermat\", \"PlayerFigurine\", \"HexSpirit\", \"OriginDestiny\",\n    \"ArcaneSpirit\", \"SpecialSpirit\", \"Barrier\", \"Status\", \"Rune\",\n    \"SpiritContainer\", \"Die\", \"Artifact\", \"Monster\", \"Traveler\", \"TravelerQuest\", \"TravelerButton\", \"Icon\",\n    \"ArcaneAdvisor\", \"NotInteractable\", \"TokenBag\", \"GameToken\"\n  }\n  for _, tag in ipairs(tagsToDestroy) do\n    for _, obj in ipairs(getObjectsWithTag(tag)) do\n      obj.destruct()\n    end\n  end\n\n  local bagsToDestroy = {\n    \"Spirit World Bag\", \"Abyss Fallen Spirits\", \"Arcane Spirits\", \"Hex Spirits (Special)\", \"Origin Destiny\",\n    \"Artifacts (Basic)\", \"Artifacts (Guardian)\", \"Artifacts (Other)\",\n    \"Monsters\", \"Travelers\", \"Traveler Quests\", \"Icons\", \"Runes\", \"SpiritWorld\",\n    \"Spirit World Spirits\", \"Hex Spirits\", \"Sealed Spirits\", \"Hex Spirits (Ancient)\"\n  }\n  for _, bagName in ipairs(bagsToDestroy) do\n    local bag = UtilLib.getObjectByName(bagName)\n    if bag then bag.destruct() end\n  end\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Traveler Swap Button (board)\n-------------------------------------------------------------------------------\n\nlocal TRAVELER_SWAP_BUTTON_NAME = \"Traveler Swap\"\nlocal TRAVELER_SWAP_BUTTON_POS = Vector(-18.54, 1.14, 38.78)\nlocal TRAVELER_SWAP_BUTTON_ROT = Vector(357.4, 180, 0)\n\nlocal function setupTravelerSwapButton(obj)\n  if not obj or obj.isDestroyed() then\n    return\n  end\n\n  obj.clearButtons()\n  obj.createButton({\n    label = \"Next\\nTraveler\",\n    click_function = \"swapTravelerCard\",\n    function_owner = self,\n    position = Vector(0, 0.2, 0),\n    width = 850,\n    height = 850,\n    font_size = 120,\n    color = { 0.1, 0.1, 0.1, 0.95 },\n    font_color = { 1, 1, 1, 1 },\n    tooltip = \"Advance the active Traveler card\"\n  })\nend\n\nfunction ensureTravelerSwapButton()\n  if not GameState.gameStarted then\n    return\n  end\n\n  local existing = UtilLib.getObjectByName(TRAVELER_SWAP_BUTTON_NAME)\n  if existing then\n    setupTravelerSwapButton(existing)\n    return\n  end\n\n  local icon = SupabaseLib.getIconByName(\"draw_spirit_bag\")\n  local imageUrl = icon and icon.image_url or \"\"\n\n  local data = ObjectTemplateLib.getTemplate(\"Tile\")\n  data.Nickname = TRAVELER_SWAP_BUTTON_NAME\n  data.Locked = true\n  data.Tags = { \"TravelerButton\" }\n  data.ColorDiffuse = { r = 0, g = 0, b = 0 }\n  data.CustomImage.ImageURL = imageUrl\n  data.CustomImage.CustomTile.Type = 2\n  data.CustomImage.CustomTile.Thickness = 0.2\n\n  data.Transform.posX = TRAVELER_SWAP_BUTTON_POS.x\n  data.Transform.posY = TRAVELER_SWAP_BUTTON_POS.y\n  data.Transform.posZ = TRAVELER_SWAP_BUTTON_POS.z\n  data.Transform.rotX = TRAVELER_SWAP_BUTTON_ROT.x\n  data.Transform.rotY = TRAVELER_SWAP_BUTTON_ROT.y\n  data.Transform.rotZ = TRAVELER_SWAP_BUTTON_ROT.z\n  data.Transform.scaleX = 1.2\n  data.Transform.scaleY = 1\n  data.Transform.scaleZ = 1.2\n\n  spawnObjectData({\n    data = data,\n    callback_function = function(obj)\n      setupTravelerSwapButton(obj)\n    end\n  })\nend\n\nfunction swapTravelerCard(_, playerColor)\n  TravelerLib.advanceTraveler()\n  if playerColor then\n    broadcastToColor(\"Traveler advanced.\", playerColor, \"Green\")\n  end\nend\n\n--- Rebuild game references after loading a saved game\n--- Re-registers existing player mats when gameStarted = true (objects already exist from TTS save)\nfunction rebuildGameReferences()\n  if not GameState.gameStarted then return end\n\n\tWait.frames(function()\n\t  GameState.debugPrint(\"[Global] Rebuilding game references from saved game...\")\n\t  AssetLoaderLib.ensureIconGuideBag(GameState.iconGuideUrl, GameState.iconGuideIcons)\n\t  local registeredCount = 0\n\t  for playerColor, charName in pairs(GameState.selectedCharacters or {}) do\n\t    for _, obj in ipairs(getObjectsWithTag(\"Playermat\")) do\n\t      if obj.getName() == charName then\n          PlayerMatLib.registerPlayerMat(playerColor, obj)\n          registeredCount = registeredCount + 1\n\n          -- Recreate native TTS buttons (destroyed on undo)\n          UILib.setupRuneSlotsOnMat(obj, playerColor)\n\n          -- Rescan spirits on the mat using snap positions\n          PlayerMatLib.rescanSpirits(playerColor)\n          updateOriginDestinyState(playerColor)\n          UILib.updatePlayerUI(playerColor)\n          break\n        end\n      end\n    end\n    GameState.debugPrint(\"[Global] Registered \" .. registeredCount .. \" player mats\")\n    TravelerLib.ensureTravelerOnBoard()\n    ensureTravelerSwapButton()\n  end, 5)\nend\n\nfunction onObjectSpawn(obj)\n  if obj.hasTag(\"SpiritContainer\") then\n    addMarketButton(obj)\n  elseif obj.getName() == \"SpiritWorld\" then\n    addMapTooltips(obj)\n    queueUIRefreshButtonPlacement()\n  elseif obj.hasTag(\"TokenBag\") then\n    queueUIRefreshButtonPlacement()\n  end\nend\n\nfunction onObjectDrop(playerColor, obj)\n  -- Wait for physics to settle and object to snap before checking position\n  Wait.frames(function()\n    if not obj or obj.getGUID() == nil then return end\n\n    local objPos = obj.getPosition()\n    local objRot = obj.getRotation()\n    if GameState.DEBUG_MODE and GameState.DEBUG_DROP_LOGGING then\n      local name = obj.getName() or \"Unknown\"\n      local guid = obj.getGUID() or \"Unknown\"\n      local message = string.format(\n        \"[Drop] %s (%s) pos=%.2f, %.2f, %.2f rot=%.1f, %.1f, %.1f\",\n        name, guid, objPos.x, objPos.y, objPos.z, objRot.x, objRot.y, objRot.z\n      )\n      if playerColor then\n        printToColor(message, playerColor, \"White\")\n      else\n        print(message)\n      end\n    end\n    local matColor = PlayerMatLib.findPlayerColorForPosition(objPos)\n\n    -- Handle spirit tracking with snap-based detection\n    if obj.hasTag(\"HexSpirit\") and matColor then\n      -- Rescan all spirit slots to get accurate state after snap\n      PlayerMatLib.rescanSpirits(matColor)\n      updateOriginDestinyState(matColor)\n    end\n  end, 15)  -- Wait 15 frames for physics to settle and snap\nend\n\nfunction onObjectPickUp(playerColor, obj)\n  local objPos = obj.getPosition()\n  local matColor = PlayerMatLib.findPlayerColorForPosition(objPos)\n\n  -- Handle spirit pickup - rescan after a delay\n  if obj.hasTag(\"HexSpirit\") and matColor then\n    -- Delay rescan until after the object is gone from the slot\n    Wait.frames(function()\n      PlayerMatLib.rescanSpirits(matColor)\n      updateOriginDestinyState(matColor)\n    end, 5)\n  end\nend\n\nfunction onObjectEnterContainer(container, obj)\n  -- Reshuffle spirit bags when a spirit is placed into them\n  local containerName = container.getName()\n  if (containerName == \"Spirit World Bag\" or containerName == \"Abyss Fallen Spirits\") and obj.hasTag(\"HexSpirit\") then\n    -- Small delay to ensure the object is fully in the container before shuffling\n    Wait.frames(function()\n      if container and container.getGUID() then\n        container.shuffle()\n      end\n    end, 5)\n  end\nend\n\nfunction onPlayerConnect(player)\n  -- Re-send UI for late joiners/reconnects (TTS can fail to render UI on some clients)\n  AssetLoaderLib.waitForUIAssetsLoaded(function()\n    UILib.createGlobalXml()\n    NavigationLib.updateRealmNavigator()\n  end)\nend\n\nfunction onPlayerDisconnect(player)\n  -- Update realm navigator when a player leaves\n  NavigationLib.updateRealmNavigator()\nend\n\nfunction onPlayerChangeColor(playerColor)\n  -- Re-send UI when a player re-seats (ensures per-color visibility panels appear)\n  AssetLoaderLib.waitForUIAssetsLoaded(function()\n    UILib.createGlobalXml()\n    NavigationLib.updateRealmNavigator()\n  end)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Asset Loading\n-------------------------------------------------------------------------------\n\nfunction getAssetData()\n  SupabaseLib.setOnLoadComplete(onAssetLoadComplete)\n  SupabaseLib.loadAssets()\nend\n\nfunction onAssetLoadComplete(data)\n  -- Build lookup tables\n  GameState.buildLookups(data.classes, data.customDice, data.runes)\n\n  -- Build character data\n  GameState.availableCharacters, GameState.characterMatData = SupabaseLib.buildCharacterData()\n\n  -- Store TTS menu data (character select background)\n\t  local ttsMenu = SupabaseLib.getTtsMenu()\n\t  GameState.ttsMenu.backgroundUrl = ttsMenu.backgroundUrl\n\t  GameState.iconGuideUrl = data.iconGuideUrl\n\t  GameState.iconGuideIcons = data.iconGuideIcons or {}\n\t  GameState.statusTokens = SupabaseLib.getStatusTokensByLevel()\n\t  local d12Icon = SupabaseLib.getIconByName(\"d12\")\n\t  GameState.d12ImageUrl = d12Icon and d12Icon.image_url or nil\n\n  -- Set resource icons before UI creation\n  AssetLoaderLib.setResourceIcons(data.tokens)\n\n  if not GameState.gameStarted then\n    -- LOBBY FLOW:\n    -- 1) Preload character select UI art first\n    -- 2) Show character select UI\n    -- 3) Preload the rest of the graphics in the background\n    local lobbyImageCount = AssetLoaderLib.preloadCharacterSelectImages(data)\n    broadcastToAll(\"Preloading character select UI (\" .. lobbyImageCount .. \" images)...\", {0.7, 0.85, 1})\n\n    AssetLoaderLib.waitForUIAssetsLoaded(function()\n      -- Mark as no longer fresh\n      GameState.fresh = false\n\n      -- Show UI as soon as lobby art is ready\n      UILib.createGlobalXml()\n\n      -- Initialize navigation\n      Wait.frames(function()\n        NavigationLib.updateRealmNavigator()\n      end, 5)\n\n      -- Start background preload of everything else (keeps character select assets registered)\n      Wait.frames(function()\n        local allImageCount = AssetLoaderLib.preloadAllImages(data)\n        local remaining = allImageCount - lobbyImageCount\n        if remaining \u003c 0 then remaining = allImageCount end\n        broadcastToAll(\"Preloading remaining \" .. remaining .. \" images...\", {0.7, 0.85, 1})\n      end, 1)\n    end)\n\n    return\n  end\n\n  -- STARTED FLOW: Preload ALL images before showing full UI\n  local imageCount = AssetLoaderLib.preloadAllImages(data)\n  broadcastToAll(\"Preloading \" .. imageCount .. \" images...\", {0.7, 0.85, 1})\n\n  -- Wait for UI assets to finish loading, THEN create the UI\n  AssetLoaderLib.waitForUIAssetsLoaded(function()\n    broadcastToAll(\"Images loaded! Displaying UI...\", {0.5, 1, 0.5})\n\n    -- Mark as no longer fresh\n    GameState.fresh = false\n\n    -- Create UI now that ALL images are preloaded\n    UILib.createGlobalXml()\n\n    -- Initialize navigation\n    Wait.frames(function()\n      NavigationLib.updateRealmNavigator()\n    end, 5)\n\n    -- If game already started, rebuild references to existing objects (saved by TTS)\n    if GameState.gameStarted then\n      rebuildGameReferences()\n    end\n  end)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Object Setup (buttons, tooltips)\n-- NOTE: Reserve update functions moved to AssetLoaderLib.ttslua\n-------------------------------------------------------------------------------\n\nfunction addMarketButton(obj)\n  obj.createButton({\n    label          = \"Refill\",\n    click_function = \"refillSpirits\",\n    function_owner = self,\n    position       = Vector(0, 0.1, -1),\n    width          = 300,\n    height         = 100,\n    font_size      = 80\n  })\nend\n\nfunction addMapTooltips(obj)\n  local WORLD_POSITIONS = {\n    { name = \"Astral Zone\",   pos = Vector(-6.7, 0.5, -12.7) },\n    { name = \"Cyber City\",    pos = Vector(-5.1, 0.5, 16.2) },\n    { name = \"Floral Patch\",  pos = Vector(14.2, 0.5, 1.7) },\n    { name = \"Fairy Oasis\",   pos = Vector(-14.8, 0.5, 2.9) },\n    { name = \"Royal Gate\",    pos = Vector(-19.3, 0.5, -9.6) },\n    { name = \"Canyon Light\",  pos = Vector(20.7, 0.5, -7.3) },\n    { name = \"Arcane Abyss\",  pos = Vector(0, 0.5, 2.1) }\n  }\n\n  for idx, location in ipairs(WORLD_POSITIONS) do\n    local localPos = obj.positionToLocal(location.pos)\n    obj.createButton({\n      label          = \"\",\n      click_function = \"none\",\n      function_owner = self,\n      position       = localPos,\n      width          = 0,\n      height         = 0,\n      font_size      = 1,\n      tooltip        = location.name\n    })\n  end\nend\n\nlocal function objectHasButtonClickFunction(obj, clickFunction)\n  local buttons = obj.getButtons()\n  if not buttons then return false end\n\n  for _, button in ipairs(buttons) do\n    if button.click_function == clickFunction then\n      return true\n    end\n  end\n\n  return false\nend\n\nlocal function removeButtonsWithClickFunction(obj, clickFunction)\n  local buttons = obj.getButtons()\n  if not buttons then return end\n\n  -- removeButton uses 0-based indices, so iterate backwards\n  for i = #buttons, 1, -1 do\n    if buttons[i].click_function == clickFunction then\n      obj.removeButton(i - 1)\n    end\n  end\nend\n\nfunction addUIRefreshButton(obj, localPos)\n  if objectHasButtonClickFunction(obj, \"refreshUIForAllPlayers\") then return end\n\n  obj.createButton({\n    label          = \"Refresh UI\",\n    click_function = \"refreshUIForAllPlayers\",\n    function_owner = self,\n    position       = localPos or Vector(0.45, 0.2, 0.45),\n    width          = 600,\n    height         = 140,\n    font_size      = 90,\n    font_color     = { 1, 1, 1, 1 },\n    color          = { 0.15, 0.15, 0.2, 0.9 },\n    hover_color    = { 0.25, 0.25, 0.35, 0.95 },\n    press_color    = { 0.1, 0.1, 0.15, 1 },\n    tooltip        = \"Re-sends the XML UI to all seated players.\"\n  })\nend\n\nlocal UI_REFRESH_TOKENBAG_OFFSET_Y = 0.15\nlocal UI_REFRESH_TOKENBAG_OFFSET_Z = -5\nlocal uiRefreshButtonQueued = false\n\nfunction queueUIRefreshButtonPlacement()\n  if uiRefreshButtonQueued then return end\n  uiRefreshButtonQueued = true\n\n  Wait.frames(function()\n    uiRefreshButtonQueued = false\n\n    local tokenBags = getObjectsWithTag(\"TokenBag\") or {}\n    if #tokenBags == 0 then return end\n\n    -- Remove any legacy refresh buttons from SpiritWorld (older saves) and token bags (avoid duplicates)\n    local spiritWorld = UtilLib.getObjectByName(\"SpiritWorld\")\n    if spiritWorld then\n      removeButtonsWithClickFunction(spiritWorld, \"refreshUIForAllPlayers\")\n    end\n    for _, bag in ipairs(tokenBags) do\n      removeButtonsWithClickFunction(bag, \"refreshUIForAllPlayers\")\n    end\n\n    -- Compute center of token bag row (world-space)\n    local sumX, sumY, sumZ = 0, 0, 0\n    for _, bag in ipairs(tokenBags) do\n      local p = bag.getPosition()\n      sumX = sumX + p.x\n      sumY = sumY + p.y\n      sumZ = sumZ + p.z\n    end\n    local centerPos = Vector(sumX / #tokenBags, sumY / #tokenBags, sumZ / #tokenBags)\n    local desiredWorldPos = Vector(centerPos.x, centerPos.y + UI_REFRESH_TOKENBAG_OFFSET_Y, centerPos.z + UI_REFRESH_TOKENBAG_OFFSET_Z)\n\n    -- Anchor the button to the token bag closest to center so the local coordinate stays small/stable.\n    local anchor = tokenBags[1]\n    local bestDist = math.huge\n    for _, bag in ipairs(tokenBags) do\n      local p = bag.getPosition()\n      local dx = p.x - centerPos.x\n      local dz = p.z - centerPos.z\n      local dist = dx * dx + dz * dz\n      if dist \u003c bestDist then\n        bestDist = dist\n        anchor = bag\n      end\n    end\n\n    addUIRefreshButton(anchor, anchor.positionToLocal(desiredWorldPos))\n  end, 10)\nend\n\nfunction refreshUIForAllPlayers(_, playerColor)\n  -- Allow anyone to press the button, but only seated colors should have UI panels.\n  if playerColor and playerColor ~= \"Grey\" and not Player[playerColor].seated then\n    broadcastToColor(\"Sit in a seat to use Refresh UI.\", playerColor, Color.Orange)\n    return\n  end\n\n  if playerColor and playerColor ~= \"Grey\" then\n    broadcastToColor(\"Refreshing UI for all seated players...\", playerColor, { 0.7, 0.85, 1 })\n  else\n    broadcastToAll(\"Refreshing UI for all seated players...\", { 0.7, 0.85, 1 })\n  end\n\n  AssetLoaderLib.waitForUIAssetsLoaded(function()\n    UILib.createGlobalXml()\n    NavigationLib.updateRealmNavigator()\n    GlobalUI.updateAllNavigatorResources()\n  end)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: XML UI Callbacks (delegated to modules)\n-------------------------------------------------------------------------------\n\n-- Draw/Summon callbacks\nlocal function drawSummonFromBag(player, bagName, bagLabel, drawCount, summonCount)\n  local playerColor = player.color\n\n  local bag = getObjectByName(bagName)\n  if not bag then\n    broadcastToColor(bagLabel .. \" bag not found!\", playerColor, \"Red\")\n    return\n  end\n\n  local bagCount = bag.getQuantity()\n  if bagCount \u003c drawCount then\n    broadcastToColor(\"Not enough spirits in the bag! (Need \" .. drawCount .. \", have \" .. bagCount .. \")\", playerColor, \"Red\")\n    return\n  end\n\n  bag.shuffle()\n\n  -- Draw spirits to player's hand with a slight delay to prevent stacking\n  for i = 1, drawCount do\n    Wait.time(function()\n      local obj = bag.takeObject({})\n      if obj then\n        if obj.hasTag(\"HexSpirit\") then\n          local metadata = UtilLib.getMetadata(obj.getGMNotes())\n          GameState.handDrawsThisNavigation[playerColor] = GameState.handDrawsThisNavigation[playerColor] or {}\n          table.insert(GameState.handDrawsThisNavigation[playerColor], {\n            guid = obj.getGUID(),\n            id = metadata.id,\n            name = obj.getName(),\n            cost = metadata.cost,\n            sourceBag = bagName\n          })\n        end\n\n        Wait.frames(function()\n          obj.deal(1, playerColor)\n        end, 5)\n      end\n    end, (i - 1) * 0.3)\n  end\n\n  local discardCount = math.max(0, drawCount - (summonCount or 0))\n  broadcastToColor(\n    \"Drew \" .. drawCount .. \" spirits from \" .. bagLabel .. \". Summon \" .. summonCount .. \", discard \" .. discardCount .. \" to the Spirit World Bag.\",\n    playerColor,\n    \"Green\"\n  )\nend\n\nfunction xml_draw2Pick1(player)\n  drawSummonFromBag(player, \"Spirit World Bag\", \"Spirit World\", 4, 2)\nend\n\nfunction xml_draw4Pick1Sealed(player)\n  drawSummonFromBag(player, \"Abyss Fallen Spirits\", \"Abyss Fallen\", 3, 1)\nend\n\n-- Return All Spirits to Bag callback\n-- Returns spirits in players' hands to the Spirit World Bag (discard pile)\nfunction xml_returnAllSpirits(player)\n  local playerColor = player.color\n\n  local spiritWorldBag = getObjectByName(\"Spirit World Bag\")\n  if not spiritWorldBag then\n    broadcastToColor(\"Spirit World Bag not found!\", playerColor, \"Red\")\n    return\n  end\n\n  -- Get all objects in the player's hand\n  local handObjects = Player[playerColor].getHandObjects()\n  local returnedCount = 0\n  local returnedAnyHexSpirits = false\n\n  local trackedGuids = nil\n  local tracked = GameState.handDrawsThisNavigation and GameState.handDrawsThisNavigation[playerColor] or nil\n  if tracked and #tracked \u003e 0 then\n    trackedGuids = {}\n    for _, entry in ipairs(tracked) do\n      if entry and entry.guid then\n        trackedGuids[entry.guid] = true\n      end\n    end\n  end\n\n  for _, obj in ipairs(handObjects) do\n    -- Check if object has HexSpirit tag\n    if obj.hasTag(\"HexSpirit\") and not obj.isDestroyed() then\n      returnedAnyHexSpirits = true\n      if not trackedGuids or trackedGuids[obj.getGUID()] then\n        spiritWorldBag.putObject(obj)\n        returnedCount = returnedCount + 1\n      end\n    end\n  end\n\n  -- If we had tracked draws but none matched what's actually in hand, fall back to returning all hex spirits.\n  if returnedCount == 0 and returnedAnyHexSpirits and trackedGuids then\n    for _, obj in ipairs(handObjects) do\n      if obj.hasTag(\"HexSpirit\") and not obj.isDestroyed() then\n        spiritWorldBag.putObject(obj)\n        returnedCount = returnedCount + 1\n      end\n    end\n  end\n\n  if returnedCount \u003e 0 then\n    Wait.frames(function()\n      if spiritWorldBag and spiritWorldBag.getGUID() then\n        spiritWorldBag.shuffle()\n      end\n    end, 5)\n\n    broadcastToColor(\"Discarded \" .. returnedCount .. \" spirit(s) to the Spirit World Bag.\", playerColor, \"Green\")\n  else\n    broadcastToColor(\"No spirits in your hand to discard.\", playerColor, \"Orange\")\n  end\nend\n\n-- Reference callbacks\nfunction xml_showReference(player)\n  UILib.showReference(player)\nend\n\nfunction xml_closeReference(player)\n  UILib.closeReference(player)\nend\n\n-- Tooltip callbacks\nfunction xml_onHover(player, guid, panelId)\n  UILib.onHover(player, guid, panelId)\nend\n\nfunction xml_onExit(player, guid, panelId)\n  UILib.onExit(player, guid, panelId)\nend\n\n-- Character selection callbacks\nfunction xml_selectCharacter(player, value, id)\n  if CharacterSelectLib.selectCharacter(player, value, id) then\n    UILib.createGlobalXml()\n  end\nend\n\nfunction xml_startGame(player)\n  if CharacterSelectLib.startGame(player) then\n    UILib.createGlobalXml()\n    Wait.frames(function()\n      ensureTravelerSwapButton()\n    end, 20)\n  end\nend\n\n-- Debug panel callbacks\nfunction xml_showDebugPanel(player)\n  UILib.showDebugPanel(player)\nend\n\nfunction xml_closeDebugPanel(player)\n  UILib.closeDebugPanel(player)\nend\n\nfunction xml_resetGame(player)\n  broadcastToAll(\"Resetting game...\", Color.Orange)\n  destroyAllGameObjects()\n  GameState.resetToLobby()\n\n  Wait.frames(function()\n    initializeLobby()\n    broadcastToAll(\"Game reset. Select characters to start.\", Color.Green)\n  end, 10)\nend\n\n-- Class Breakpoints panel callbacks\nfunction xml_showClassBreakpoints(player, value, id)\n  -- Extract class name from the id parameter (format: playerColor_class_ClassName)\n  local className = id:match(\"_class_(.+)$\") or id\n  UILib.toggleClassBreakpoints(player, className)\nend\n\nfunction xml_closeClassBreakpoints(player)\n  UILib.closeClassBreakpoints(player)\nend\n\n-- Special Classes toggle callback\n-- Track expanded state per player\nlocal specialClassesExpanded = {}\n\nfunction xml_toggleSpecialClasses(player)\n  local playerColor = player.color\n  specialClassesExpanded[playerColor] = not specialClassesExpanded[playerColor]\n  local isExpanded = specialClassesExpanded[playerColor]\n\n  -- Toggle panel visibility\n  UI.setAttribute(playerColor .. \"_special_classes_panel\", \"active\", isExpanded)\n\n  -- Update button label\n  local label = isExpanded and \"Special Classes ▲\" or \"Special Classes ▼\"\n  UI.setAttribute(playerColor .. \"_special_classes_label\", \"text\", label)\nend\n\n-- Rune Selector callbacks\n-- Called from native TTS button on playermat\nfunction onRuneSlotClick(obj, playerColor, alt_click)\n  local player = Player[playerColor]\n  if not player then return end\n\n  -- For now, open slot 1 - individual slot functions handle specific slots\n  UILib.openRuneSelector(player, 1)\nend\n\n-- Individual slot click handlers\nfunction onRuneSlot1Click(obj, playerColor) UILib.openRuneSelector(Player[playerColor], 1) end\nfunction onRuneSlot2Click(obj, playerColor) UILib.openRuneSelector(Player[playerColor], 2) end\nfunction onRuneSlot3Click(obj, playerColor) UILib.openRuneSelector(Player[playerColor], 3) end\nfunction onRuneSlot4Click(obj, playerColor) UILib.openRuneSelector(Player[playerColor], 4) end\n\n-- XML UI callback (kept for compatibility)\nfunction xml_openRuneSelector(player, value, id)\n  local slotIndex = tonumber(id:match(\"runeslot_(%d+)\"))\n  if slotIndex then\n    UILib.openRuneSelector(player, slotIndex)\n  end\nend\n\nfunction xml_closeRuneSelector(player)\n  UILib.closeRuneSelector(player)\nend\n\nfunction xml_selectRune(player, value, id)\n  -- Extract rune ID from the id parameter (format: playerColor_runeselect_runeId)\n  local runeId = id:match(\"_runeselect_(.+)$\")\n  if runeId then\n    UILib.selectRune(player, runeId)\n  end\nend\n\n-- Dice Spawner callbacks\nfunction xml_showDiceSpawner(player)\n  UILib.showDiceSpawner(player)\nend\n\nfunction xml_closeDiceSpawner(player)\n  UILib.closeDiceSpawner(player)\nend\n\nfunction xml_dicePlus(player, value, id)\n  -- Extract dice ID from the id parameter (format: playerColor_dice_plus_diceId)\n  local diceId = id:match(\"_dice_plus_(.+)$\")\n  if diceId then\n    UILib.adjustDiceCount(player, diceId, 1)\n  end\nend\n\nfunction xml_diceMinus(player, value, id)\n  -- Extract dice ID from the id parameter (format: playerColor_dice_minus_diceId)\n  local diceId = id:match(\"_dice_minus_(.+)$\")\n  if diceId then\n    UILib.adjustDiceCount(player, diceId, -1)\n  end\nend\n\nfunction xml_spawnSelectedDice(player)\n  UILib.spawnSelectedDice(player)\nend\n\n-- Navigation callbacks\nfunction xml_navigateRealm(player)\n  NavigationLib.navigateRealm(player)\nend\n\nfunction xml_selectDestination(player, value, id)\n  local playerColor = player.color\n  -- Extract option index from button id (format: \"playerColor_nav_option_N\")\n  local optionIndex = tonumber(id:match(\"_nav_option_(%d+)$\"))\n  if optionIndex then\n    NavigationLib.selectDestination(playerColor, optionIndex)\n  end\nend\n\n-- XML UI callback for canceling navigation selection\nfunction xml_cancelNavigation(player, value, id)\n  local playerColor = player.color\n  NavigationLib.closeNavigationSelector(playerColor)\nend\n\nfunction navigateRealmCallback(selectedDestination, _, playerColor)\n  NavigationLib.navigateRealmCallback(selectedDestination, _, playerColor)\nend\n\n-- Resource tracker callbacks (Blood, Victory Points, and Barriers)\nfunction xml_adjustResource(player, value, id)\n  local playerColor = player.color\n\n  -- Parse the button ID to determine resource type and action\n  -- Format: \"playerColor_resourceType_action\" (e.g., \"Red_blood_plus\")\n  local parts = {}\n  for part in id:gmatch(\"[^_]+\") do\n    table.insert(parts, part)\n  end\n\n  if #parts \u003e= 3 then\n    local resourceType = parts[2]  -- \"blood\", \"vp\", \"barrier\", or \"status\"\n    local action = parts[3]        -- \"plus\" or \"minus\"\n    local delta = (action == \"plus\") and 1 or -1\n\n    if resourceType == \"blood\" then\n      PlayerMatLib.adjustBlood(playerColor, delta)\n      ResourceTrackerUI.updateCount(playerColor, \"blood\", PlayerMatLib.getBlood(playerColor))\n      GlobalUI.updateNavigatorResources(playerColor)\n    elseif resourceType == \"vp\" then\n      PlayerMatLib.adjustVictoryPoints(playerColor, delta)\n      ResourceTrackerUI.updateCount(playerColor, \"vp\", PlayerMatLib.getVictoryPoints(playerColor))\n      GlobalUI.updateNavigatorResources(playerColor)\n    elseif resourceType == \"barrier\" then\n      PlayerMatLib.adjustBarrier(playerColor, delta)\n      ResourceTrackerUI.updateCount(playerColor, \"barrier\", PlayerMatLib.getBarrier(playerColor))\n    elseif resourceType == \"status\" then\n      PlayerMatLib.adjustStatus(playerColor, delta)\n      ResourceTrackerUI.updateStatus(playerColor)\n      CharacterSelectLib.updateStatusToken(playerColor)\n    end\n  end\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Market Callbacks (delegated to MarketLib)\n-------------------------------------------------------------------------------\n\nfunction refillSpirits(_, playerColor)\n  MarketLib.refillSpirits(_, playerColor)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Play Area Drawing (Debug)\n-------------------------------------------------------------------------------\n\nfunction drawPlayAreas()\n  for _, playerColor in ipairs(Player.getAvailableColors()) do\n    local handData = Player[playerColor].getHandTransform()\n    if handData then\n      local boxCenter = handData.position + handData.forward * 22.7 + handData.right * 12.15\n\n      local size = handData.forward * 13.5 + handData.right * 16\n      GameState.playAreaData[playerColor] = {\n        center = boxCenter:setAt(\"y\", 1),\n        size   = Vector(math.abs(size.x), 10, math.abs(size.z))\n      }\n    end\n  end\nend\n\nfunction drawBox(linesTable, center, forwardVector, rightVector, width, length, color, thickness)\n  -- Calculate the four corners of the box relative to the center\n  local p1 = center + (rightVector * width / 2) + (forwardVector * length / 2)\n  local p2 = center + (rightVector * width / 2) - (forwardVector * length / 2)\n  local p3 = center - (rightVector * width / 2) - (forwardVector * length / 2)\n  local p4 = center - (rightVector * width / 2) + (forwardVector * length / 2)\n\n  -- Insert the lines into the provided table\n  table.insert(linesTable, { points = { p1, p2 }, color = color, thickness = thickness })\n  table.insert(linesTable, { points = { p2, p3 }, color = color, thickness = thickness })\n  table.insert(linesTable, { points = { p3, p4 }, color = color, thickness = thickness })\n  table.insert(linesTable, { points = { p4, p1 }, color = color, thickness = thickness })\nend\n\n-------------------------------------------------------------------------------\n-- MARK: UI Update Callbacks\n-------------------------------------------------------------------------------\n\n-- Callback function for PlayerMatLib to trigger UI updates\nfunction updatePlayerUICallback(playerColor)\n  UILib.updatePlayerUI(playerColor)\nend\n\n--- Update origin destiny activation state for a player\n--- Called whenever spirits or origin destiny tokens change on the mat\nfunction updateOriginDestinyState(playerColor)\n  local destinyState = PlayerMatLib.checkOriginDestinyActivation(playerColor)\n\n  local prevState = GameState.originDestinyActive[playerColor]\n  local wasActivated = prevState and prevState.activated\n  local wasCompleted = prevState and prevState.completed\n  local hadDestiny = prevState ~= nil\n\n  if destinyState then\n    -- Origin destiny is on the mat\n    GameState.originDestinyActive[playerColor] = {\n      activated = destinyState.activated,\n      originName = destinyState.originName,\n      uniqueCount = destinyState.uniqueCount,\n      completed = destinyState.completed\n    }\n\n    -- Check for COMPLETION (6 unique spirits) - trigger Spirit Fusion!\n    if destinyState.completed and not wasCompleted then\n      triggerSpiritFusion(playerColor, destinyState)\n      return -- Spirit Fusion will handle the rest\n    elseif destinyState.activated and not wasActivated then\n      broadcastToColor(\"Origin Destiny ACTIVATED! (\" .. destinyState.originName .. \")\", playerColor, \"Green\")\n    elseif not destinyState.activated and not hadDestiny then\n      broadcastToColor(\"Origin Destiny placed (\" .. destinyState.originName .. \") - Need \" .. (4 - destinyState.uniqueCount) .. \" more unique spirits to activate.\", playerColor, \"Yellow\")\n    elseif wasActivated and not destinyState.activated then\n      broadcastToColor(\"Origin Destiny deactivated - not enough spirits.\", playerColor, \"Orange\")\n    end\n  else\n    -- No origin destiny on mat\n    if hadDestiny then\n      broadcastToColor(\"Origin Destiny removed.\", playerColor, \"White\")\n    end\n    GameState.originDestinyActive[playerColor] = nil\n  end\n\n  -- Update UI to reflect blocked/active traits\n  UILib.updatePlayerUI(playerColor)\nend\n\n-------------------------------------------------------------------------------\n-- Spirit Fusion Animation (Origin Destiny Completion)\n-------------------------------------------------------------------------------\n\n-- Helper: Get player's display name\nlocal function getPlayerDisplayName(playerColor)\n  if Player[playerColor] and Player[playerColor].steam_name then\n    return Player[playerColor].steam_name\n  end\n  return playerColor\nend\n\n-- Particle color palette for Spirit Fusion\nlocal particleColors = {\n  {r=0.4, g=0.1, b=0.6},   -- Dark purple\n  {r=1, g=0.9, b=0.2},     -- Bright yellow\n  {r=0.6, g=0.1, b=0.1},   -- Dark red\n  {r=0.1, g=0.15, b=0.5},  -- Dark blue\n  {r=0.5, g=0.0, b=0.5},   -- Deep magenta\n  {r=0.8, g=0.4, b=0.0},   -- Dark orange\n  {r=0.3, g=0.0, b=0.3},   -- Deep violet\n  {r=1, g=0.6, b=0.0},     -- Golden orange\n  {r=0.2, g=0.0, b=0.4},   -- Indigo\n  {r=0.7, g=0.0, b=0.3},   -- Crimson\n  {r=0.9, g=0.8, b=0.1},   -- Gold\n  {r=0.3, g=0.1, b=0.5},   -- Purple\n}\n\n-- Helper: Spawn energy particle token\nlocal function spawnEnergyParticle(position, targetPos, delay, duration, scale)\n  scale = scale or 0.15\n  local color = particleColors[math.random(#particleColors)]\n  Wait.time(function()\n    spawnObject({\n      type = \"BlockSquare\",\n      position = position + Vector(0, 0.5, 0),\n      scale = Vector(scale, scale, scale),\n      sound = false,\n      callback_function = function(obj)\n        if not obj then return end\n        obj.setColorTint(color)\n        obj.setLock(true)\n        obj.highlightOn({r=1, g=1, b=1})\n        obj.setPositionSmooth(targetPos + Vector(0, 1, 0), false, false)\n        Wait.time(function()\n          if obj and obj.getGUID() then\n            obj.destruct()\n          end\n        end, duration)\n      end\n    })\n  end, delay)\nend\n\n--- Trigger the Spirit Fusion animation when Origin Destiny completes (6 unique spirits)\n--- Enhanced version with erratic flashing, particle effects, and spirit absorption\nfunction triggerSpiritFusion(playerColor, destinyState)\n  local originName = destinyState.originName\n  local destinyObject = destinyState.destinyObject\n  local arcaneSpirit = destinyState.arcaneSpirit\n\n  if not destinyObject or not arcaneSpirit then\n    GameState.debugPrint(\"[Global] Spirit Fusion failed - missing destiny object or arcane spirit data\")\n    return\n  end\n\n  -- Get all spirits of the matching origin for the animation\n  local spiritObjects = PlayerMatLib.getSpiritsOfOrigin(playerColor, originName)\n  local destinyPos = destinyObject.getPosition()\n  local destinyRot = destinyObject.getRotation()  -- Capture original rotation before spinning\n  local playerName = getPlayerDisplayName(playerColor)\n\n  -- Validate positions before proceeding with animation\n  if not destinyPos or not destinyRot then\n    GameState.debugPrint(\"[Global] Spirit Fusion failed - could not get destiny object position/rotation\")\n    return\n  end\n\n  -- Store original positions and colors (with nil safety)\n  local originalPositions = {}\n  local originalColors = {}\n  for i, spirit in ipairs(spiritObjects) do\n    local pos = spirit.getPosition()\n    local color = spirit.getColorTint()\n    originalPositions[i] = pos or destinyPos  -- Fallback to destiny position if nil\n    originalColors[i] = color or {r=1, g=1, b=1}\n  end\n\n  -- ============================================================================\n  -- ANIMATION TIMELINE (~15 seconds total)\n  -- ============================================================================\n\n  -- PHASE 1 (0.0s): Initial Announcement\n  UILib.showGlobalAnnouncementWithSub(\n    playerName .. \" has completed the ORIGIN DESTINY\",\n    \"Cultivating the Arcane Spirit...\",\n    6, {r=1, g=0.84, b=0}, {r=0.8, g=0.8, b=1}\n  )\n\n  -- SWIRLING RING: Continuous ring of particles orbiting around the hex area\n  local ringRadiusStart = 5  -- Starting radius around the hex formation\n  local ringRadiusEnd = 15   -- Grows to 3x bigger (5 -\u003e 15)\n  local ringHeight = 1.5\n  local ringParticlesPerWave = 12\n  local ringWaves = 12  -- Multiple waves throughout the animation\n  for wave = 1, ringWaves do\n    local waveDelay = (wave - 1) * 1.0  -- One wave per second\n    local waveProgress = (wave - 1) / (ringWaves - 1)  -- 0 to 1\n    local waveScale = 0.3 + waveProgress * 0.7  -- Grow from 0.3 to 1.0\n    local waveRadius = ringRadiusStart + waveProgress * (ringRadiusEnd - ringRadiusStart)  -- Grow from 5 to 15\n\n    Wait.time(function()\n      for p = 1, ringParticlesPerWave do\n        local startAngle = (p / ringParticlesPerWave) * math.pi * 2\n        local endAngle = startAngle + math.pi * 1.5  -- Swirl 3/4 around\n\n        -- Start position (at current wave radius)\n        local startPos = destinyPos + Vector(\n          math.cos(startAngle) * waveRadius,\n          ringHeight + math.random() * 0.5,\n          math.sin(startAngle) * waveRadius\n        )\n\n        -- End position (swirled around and slightly inward)\n        local endRadius = waveRadius * 0.6\n        local endPos = destinyPos + Vector(\n          math.cos(endAngle) * endRadius,\n          ringHeight + 1 + math.random() * 0.5,\n          math.sin(endAngle) * endRadius\n        )\n\n        local particleDelay = (p / ringParticlesPerWave) * 0.3  -- Stagger within wave\n        spawnEnergyParticle(startPos, endPos, particleDelay, 2.0, waveScale)\n      end\n    end, waveDelay)\n  end\n\n  -- PHASE 2 (0.5s - 4.5s): Spirits awaken with random pulsing\n  -- Each spirit pulses at random intervals, getting faster\n  for i, spirit in ipairs(spiritObjects) do\n    local baseDelay = 0.5 + math.random() * 0.6  -- Random start 0.5-1.1s\n\n    -- Initial slow pulse\n    Wait.time(function()\n      if spirit and spirit.getGUID() then\n        spirit.setColorTint({r=1, g=0.84, b=0})\n        spirit.highlightOn({r=1, g=0.84, b=0}, 0.5)\n      end\n    end, baseDelay + (i - 1) * 0.5)\n\n    Wait.time(function()\n      if spirit and spirit.getGUID() then\n        spirit.setColorTint(originalColors[i] or {r=1, g=1, b=1})\n        spirit.highlightOff()\n      end\n    end, baseDelay + (i - 1) * 0.5 + 0.4)\n  end\n\n  -- PHASE 3 (4.5s - 9.0s): Erratic flashing - starts slow, gets faster and more chaotic\n  local flashPhaseStart = 4.5\n  local flashPhaseDuration = 4.5\n  local allObjects = {}\n  for _, spirit in ipairs(spiritObjects) do\n    table.insert(allObjects, spirit)\n  end\n  table.insert(allObjects, destinyObject)\n\n  -- Create accelerating flash pattern\n  local flashTimes = {}\n  local currentTime = 0\n  local interval = 0.5  -- Starting interval\n  while currentTime \u003c flashPhaseDuration do\n    table.insert(flashTimes, currentTime)\n    currentTime = currentTime + interval\n    interval = math.max(0.05, interval * 0.75)  -- Accelerate (min 0.05s)\n  end\n\n  -- Schedule the flashes\n  for _, flashTime in ipairs(flashTimes) do\n    Wait.time(function()\n      -- Pick random objects to flash (more objects as time goes on)\n      local progress = flashTime / flashPhaseDuration\n      local numToFlash = math.ceil(#allObjects * (0.3 + progress * 0.7))\n\n      -- Shuffle and pick\n      local shuffled = {}\n      for _, obj in ipairs(allObjects) do\n        table.insert(shuffled, obj)\n      end\n      for i = #shuffled, 2, -1 do\n        local j = math.random(i)\n        shuffled[i], shuffled[j] = shuffled[j], shuffled[i]\n      end\n\n      -- Flash the selected objects\n      for i = 1, numToFlash do\n        local obj = shuffled[i]\n        if obj and obj.getGUID() then\n          -- Random color variation (gold to white)\n          local r = 1\n          local g = 0.7 + math.random() * 0.3\n          local b = math.random() * 0.5\n          obj.setColorTint({r=r, g=g, b=b})\n          obj.highlightOn({r=1, g=1, b=1}, 0.1)\n\n          -- Quick flash off\n          Wait.time(function()\n            if obj and obj.getGUID() then\n              obj.highlightOff()\n              obj.setColorTint({r=1, g=1, b=1})\n            end\n          end, 0.05 + math.random() * 0.05)\n        end\n      end\n    end, flashPhaseStart + flashTime)\n  end\n\n  -- Spawn particle effects during flash phase (small particles - early stage)\n  for i, spirit in ipairs(spiritObjects) do\n    for p = 1, 4 do  -- 4 particles per spirit (more time = more particles)\n      local delay = flashPhaseStart + 0.5 + math.random() * 3.5\n      local particleOffset = Vector(\n        (math.random() - 0.5) * 2,\n        0,\n        (math.random() - 0.5) * 2\n      )\n      spawnEnergyParticle(originalPositions[i] + particleOffset, destinyPos, delay, 2.0, 0.5)  -- Small particles\n    end\n  end\n\n  -- PHASE 4 (9.0s - 11.25s): Convergence - spirits drift toward destiny and shrink\n  local convergeStart = 9.0\n  Wait.time(function()\n    -- All objects glow intensely\n    for _, obj in ipairs(allObjects) do\n      if obj and obj.getGUID() then\n        obj.setColorTint({r=1, g=0.84, b=0})\n        obj.highlightOn({r=1, g=1, b=1}, 2)\n      end\n    end\n\n    -- Origin Destiny rises and spins\n    if destinyObject and destinyObject.getGUID() then\n      local risePos = destinyPos + Vector(0, 2.5, 0)\n      destinyObject.setPositionSmooth(risePos, false, false)\n    end\n\n    -- Spirits move toward destiny\n    for i, spirit in ipairs(spiritObjects) do\n      if spirit and spirit.getGUID() then\n        local targetPos = destinyPos + Vector(\n          (math.random() - 0.5) * 1,\n          1.5 + math.random() * 0.5,\n          (math.random() - 0.5) * 1\n        )\n        spirit.setPositionSmooth(targetPos, false, false)\n      end\n    end\n\n    -- Spawn medium particles converging from across the table toward the merge point\n    local mergePoint = destinyPos + Vector(0, 2.5, 0)\n    local particleCount = 24  -- Particles converging from all directions\n    for p = 1, particleCount do\n      local angle = (p / particleCount) * math.pi * 2\n      local radius = 25 + math.random() * 15  -- Much farther - 25-40 units away\n      local height = 5 + math.random() * 10   -- Higher up\n      local startPos = destinyPos + Vector(\n        math.cos(angle) * radius,\n        height,\n        math.sin(angle) * radius\n      )\n      local delay = math.random() * 1.5  -- Staggered spawns over 1.5 seconds\n      spawnEnergyParticle(startPos, mergePoint, delay, 2.5, 1.0)  -- Medium particles\n    end\n  end, convergeStart)\n\n  -- PHASE 5 (11.25s - 12.75s): Final merge - rapid spinning, spirits absorbed\n  local mergeStart = 11.25\n  Wait.time(function()\n    local mergePoint = destinyPos + Vector(0, 2.5, 0)\n\n    -- Destiny spins rapidly\n    if destinyObject and destinyObject.getGUID() then\n      destinyObject.setRotationSmooth({0, 1440, 0}, false, false)  -- 4 full spins\n    end\n\n    -- Second wave of particles - largest size for final merge\n    local mergeParticleCount = 32\n    for p = 1, mergeParticleCount do\n      local angle = (p / mergeParticleCount) * math.pi * 2 + math.random() * 0.5\n      local radius = 15 + math.random() * 25  -- 15-40 units away\n      local height = 3 + math.random() * 12   -- Varied heights\n      local startPos = destinyPos + Vector(\n        math.cos(angle) * radius,\n        height,\n        math.sin(angle) * radius\n      )\n      local delay = math.random() * 0.8  -- Faster spawns\n      spawnEnergyParticle(startPos, mergePoint, delay, 1.5, 1.5)  -- Large particles for finale\n    end\n\n    -- Spirits shrink and move to exact center\n    for i, spirit in ipairs(spiritObjects) do\n      local destroyDelay = 0.2 + math.random() * 0.8  -- Staggered destruction\n      Wait.time(function()\n        if spirit and spirit.getGUID() then\n          -- Final flash before destruction\n          spirit.highlightOn({r=1, g=1, b=1})\n          spirit.setPositionSmooth(mergePoint, false, false)\n\n          Wait.time(function()\n            if spirit and spirit.getGUID() then\n              spirit.destruct()\n            end\n          end, 0.2)\n        end\n      end, destroyDelay)\n    end\n  end, mergeStart)\n\n  -- PHASE 6 (12.75s - 15s): Transformation - destiny becomes Arcane Spirit\n  local transformStart = 12.75\n  Wait.time(function()\n    if destinyObject and destinyObject.getGUID() then\n      local spawnPos = destinyObject.getPosition()\n\n      -- Final flash on destiny\n      destinyObject.highlightOn({r=1, g=1, b=1})\n\n      Wait.time(function()\n        if destinyObject and destinyObject.getGUID() then\n          local finalPos = destinyPos  -- Original destiny position on mat\n          destinyObject.destruct()\n\n          -- Spawn the Arcane Spirit\n          local spiritData = {\n            Name = \"Custom_Token\",\n            Nickname = arcaneSpirit.name,\n            Transform = {\n              scaleX = 1.58333,\n              scaleY = 1,\n              scaleZ = 1.58333\n            },\n            ColorDiffuse = { r = 1, g = 0.84, b = 0 },\n            Tags = { \"HexSpirit\", \"ArcaneSpirit\" },\n            GMNotes = JSON.encode({\n              id = arcaneSpirit.id,\n              cost = arcaneSpirit.cost,\n              classes = arcaneSpirit.classes,\n              origins = arcaneSpirit.origins\n            }),\n            CustomImage = {\n              ImageURL = arcaneSpirit.imageUrl,\n              ImageScalar = 1,\n              WidthScale = 0,\n              CustomToken = {\n                Thickness = 0.2,\n                MergeDistancePixels = 25,\n                StandUp = false,\n                Stackable = false\n              }\n            }\n          }\n\n          spawnObjectData({\n            data = spiritData,\n            position = spawnPos + Vector(0, 2, 0),\n            rotation = Vector(0, destinyRot.y, 0),\n            callback_function = function(spawned)\n              if not spawned then return end\n              -- Descend with glow\n              spawned.highlightOn({r=1, g=1, b=1}, 1.5)\n              spawned.setPositionSmooth(finalPos, false, false)\n\n              -- Spawn celebration particles around arcane spirit\n              for p = 1, 8 do\n                local angle = (p / 8) * math.pi * 2\n                local particlePos = finalPos + Vector(math.cos(angle) * 2, 0, math.sin(angle) * 2)\n                spawnEnergyParticle(particlePos, finalPos + Vector(0, 1, 0), 0.1 * p, 1)\n              end\n\n              Wait.time(function()\n                if spawned and spawned.getGUID() then\n                  spawned.setColorTint({r=1, g=1, b=1})\n                  spawned.highlightOff()\n                end\n\n                -- Clear the origin destiny state\n                GameState.originDestinyActive[playerColor] = nil\n\n                -- Rescan and update\n                PlayerMatLib.rescanSpirits(playerColor)\n                UILib.updatePlayerUI(playerColor)\n\n                -- Final announcement\n                UILib.showGlobalAnnouncementWithSub(\n                  \"🌟 \" .. arcaneSpirit.name .. \" 🌟\",\n                  \"has been summoned!\",\n                  4, {r=1, g=0.84, b=0}, {r=1, g=1, b=1}\n                )\n              end, 1.5)\n            end\n          })\n        end\n      end, 0.3)\n    end\n  end, transformStart)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: General Helper Functions (exposed globally for callbacks)\n-------------------------------------------------------------------------------\n\nfunction removeContainedAssets()\n  local assetNames = { \"Spirit World Bag\", \"Abyss Fallen Spirits\", \"Arcane Spirits\", \"Hex Spirits (Special)\",\n                       \"Spirit World Spirits\", \"Hex Spirits\", \"Sealed Spirits\", \"Hex Spirits (Ancient)\",\n                       \"Artifacts (Basic)\", \"Artifacts (Guardian)\", \"Artifacts (Other)\",\n                       \"Monsters\", \"Travelers\", \"Traveler Quests\", \"Icons\" }\n  for _, name in ipairs(assetNames) do\n    local bag = UtilLib.getObjectByName(name)\n    if bag then bag.destruct() end\n  end\n  broadcastToAll(\"Removed all contained assets.\", \"Yellow\")\nend\n\n-- Expose getObjectByName globally for TTS callbacks that need it\nfunction getObjectByName(name)\n  return UtilLib.getObjectByName(name)\nend\n\n-- Expose checkForNavigationSelection for callbacks\nfunction checkForNavigationSelection()\n  NavigationLib.checkForNavigationSelection()\nend\nend)\n__bundle_register(\"__root\", function(require, _LOADED, __bundle_register, __bundle_modules)\nrequire(\"Global\")\nend)\n__bundle_register(\"api/AssetLoaderLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- AssetLoaderLib: Centralized asset loading and preloading\n-- Handles all bag creation, asset updates, and texture preloading\n-- Preloads ALL images (spirits, artifacts, monsters, runes, mats, icons, etc.)\n-------------------------------------------------------------------------------\n\nlocal AssetLoaderLib = {}\n\nlocal GameState = require(\"state/GameState\")\nlocal SupabaseLib = require(\"api/SupabaseLib\")\nlocal SpawnLib = require(\"util/SpawnLib\")\nlocal TableLib = require(\"util/TableLib\")\nlocal UtilLib = require(\"util/UtilLib\")\nlocal ObjectTemplateLib = require(\"util/ObjectTemplateLib\")\n\n-------------------------------------------------------------------------------\n-- Configuration\n-------------------------------------------------------------------------------\n\n-- Preload settings\nlocal PRELOAD_CONFIG = {\n  enabled = true,              -- Master switch for preloading\n  textureLoadFrames = 20,      -- Frames to wait for texture to load\n  preloadPosition = Vector(0, -50, 0),  -- Hidden position below table\n  useUIPreload = true          -- Use UI.setCustomAssets for image preloading\n}\n\n-- Bag row layout configuration (organized row at back edge)\nlocal BAG_ROW_CONFIG = {\n  startX = -45,   -- Leftmost bag X position (shifted right from -52)\n  y = 0.61,       -- Consistent height for all bags\n  z = 64,         -- Back edge of table\n  spacing = 7     -- Units between bag centers\n}\n\n-- Token bags row configuration (smaller infinite bags below main row)\nlocal TOKEN_BAG_ROW_CONFIG = {\n  startX = -45,   -- Same start X as main bags\n  y = 0.61,       -- Same height as main bags\n  z = 57,         -- Below main row (Z=64)\n  spacing = 4,    -- Smaller spacing for smaller bags\n  scale = 1       -- Smaller bag scale\n}\n\n--- Calculate bag position from slot number\n---@param slot number The slot index (1-based)\n---@return Vector The world position for the bag\nlocal function getBagPosition(slot)\n  return Vector(\n    BAG_ROW_CONFIG.startX + (slot - 1) * BAG_ROW_CONFIG.spacing,\n    BAG_ROW_CONFIG.y,\n    BAG_ROW_CONFIG.z\n  )\nend\n\n--- Calculate token bag position from slot number\n---@param slot number The slot index (1-based)\n---@return Vector The world position for the token bag\nlocal function getTokenBagPosition(slot)\n  return Vector(\n    TOKEN_BAG_ROW_CONFIG.startX + (slot - 1) * TOKEN_BAG_ROW_CONFIG.spacing,\n    TOKEN_BAG_ROW_CONFIG.y,\n    TOKEN_BAG_ROW_CONFIG.z\n  )\nend\n\n--- Filter spirit objects by cost range using GMNotes metadata\n---@param spirits table Array of spirit object templates\n---@param minCost number Minimum cost (inclusive)\n---@param maxCost number Maximum cost (inclusive)\n---@return table Filtered spirit list\nlocal function filterSpiritsByCost(spirits, minCost, maxCost)\n  local filtered = {}\n  for _, spirit in ipairs(spirits or {}) do\n    local metadata = UtilLib.getMetadata(spirit.GMNotes or \"\")\n    local cost = metadata.cost\n    if cost and cost \u003e= minCost and cost \u003c= maxCost then\n      table.insert(filtered, spirit)\n    end\n  end\n  return filtered\nend\n\n--- Build the Icon Guide bag contents from either a full PNG guide or a list of individual icons.\n---@param iconGuideUrl string|nil Icon guide PNG URL (preferred if present)\n---@param iconGuideIcons table|nil Icon guide icon entries (fallback)\n---@return table objectList\nlocal function buildIconGuideObjects(iconGuideUrl, iconGuideIcons)\n  local sizeMultiplier = 0.8 -- 20% smaller\n\n  if iconGuideUrl and iconGuideUrl ~= \"\" then\n    local card = ObjectTemplateLib.getTemplate(\"Card\")\n    card.Nickname = \"Icon Guide\"\n    card.CustomDeck[\"1\"].FaceURL = iconGuideUrl\n    card.CustomDeck[\"1\"].BackURL = iconGuideUrl\n    card.Transform.scaleX = 3 * sizeMultiplier\n    card.Transform.scaleY = 1\n    card.Transform.scaleZ = 3 * sizeMultiplier\n    card.Tags = { \"IconGuide\" }\n    return { card }\n  end\n\n  if type(iconGuideIcons) ~= \"table\" or #iconGuideIcons == 0 then\n    return {}\n  end\n\n  -- Keep stable ordering for predictable bag contents.\n  local sorted = {}\n  for _, icon in ipairs(iconGuideIcons) do\n    table.insert(sorted, icon)\n  end\n  table.sort(sorted, function(a, b) return (a.position or 0) \u003c (b.position or 0) end)\n\n  local objectList = {}\n  for _, icon in ipairs(sorted) do\n    local url = icon.image_url\n    if url and url ~= \"\" then\n      local card = ObjectTemplateLib.getTemplate(\"Card\")\n      card.Nickname = icon.name or \"Icon\"\n      card.CustomDeck[\"1\"].FaceURL = url\n      card.CustomDeck[\"1\"].BackURL = url\n      card.Transform.scaleX = 1.5 * sizeMultiplier\n      card.Transform.scaleY = 1\n      card.Transform.scaleZ = 1.5 * sizeMultiplier\n      card.Tags = { \"IconGuide\" }\n      card.GMNotes = JSON.encode({\n        id = icon.id,\n        name = icon.name,\n        description = icon.description,\n        position = icon.position\n      })\n      table.insert(objectList, card)\n    end\n  end\n  return objectList\nend\n\n-- Bag configurations - centralized definition of all game bags\n-- Organized by category, left to right: Runes → Icons → Artifacts → Monsters → Spirits → Travelers\nlocal BAG_CONFIGS = {\n  -------------------------------------------------------------------------------\n  -- Category: Runes (Slot 1)\n  -------------------------------------------------------------------------------\n  {\n    name = \"Runes\",\n    dataKey = \"runes\",\n    generator = function(data)\n      return SupabaseLib.generateRuneData(data)\n    end,\n    slot = 1,\n    shuffle = false,\n    preload = true\n  },\n\n  -------------------------------------------------------------------------------\n  -- Category: Guardians (Slot 2)\n  -------------------------------------------------------------------------------\n  {\n    name = \"Icons\",\n    dataKey = \"guardians\",\n    generator = function(data)\n      return SupabaseLib.generateIconData(data)\n    end,\n    slot = 2,\n    shuffle = false,\n    preload = true\n  },\n\n  -------------------------------------------------------------------------------\n  -- Category: Artifacts (Slots 3-5)\n  -------------------------------------------------------------------------------\n  {\n    name = \"Artifacts (Basic)\",\n    dataKey = \"artifacts\",\n    generator = function(data)\n      local lists = SupabaseLib.generateArtifactsData(data)\n      return lists.basic\n    end,\n    slot = 3,\n    shuffle = true,\n    preload = true\n  },\n  {\n    name = \"Artifacts (Guardian)\",\n    dataKey = \"artifacts\",\n    generator = function(data)\n      local lists = SupabaseLib.generateArtifactsData(data)\n      return lists.guardian\n    end,\n    slot = 4,\n    shuffle = true,\n    preload = true\n  },\n  {\n    name = \"Artifacts (Other)\",\n    dataKey = \"artifacts\",\n    generator = function(data)\n      local lists = SupabaseLib.generateArtifactsData(data)\n      return lists.other\n    end,\n    slot = 5,\n    shuffle = true,\n    preload = true\n  },\n\n  -------------------------------------------------------------------------------\n  -- Category: Monsters (Slot 6)\n  -------------------------------------------------------------------------------\n  {\n    name = \"Monsters\",\n    dataKey = \"monsters\",\n    generator = function(data)\n      return SupabaseLib.generateMonsterData(data)\n    end,\n    slot = 6,\n    shuffle = false,  -- Monsters have specific order\n    preload = true\n  },\n\n  -------------------------------------------------------------------------------\n  -- Category: Spirits (Slots 7-11)\n  -------------------------------------------------------------------------------\n  {\n    name = \"Spirit World Bag\",\n    dataKey = \"hexSpirits\",\n    generator = function(data)\n      local regular, _, _ = SupabaseLib.generateSpiritData(data)\n      return filterSpiritsByCost(regular, 1, 5)\n    end,\n    slot = 7,\n    shuffle = true,\n    preload = true\n  },\n  {\n    name = \"Abyss Fallen Spirits\",\n    dataKey = \"hexSpirits\",\n    generator = function(data)\n      local regular, _, _ = SupabaseLib.generateSpiritData(data)\n      return filterSpiritsByCost(regular, 7, 9)\n    end,\n    slot = 8,\n    shuffle = true,\n    preload = true\n  },\n  {\n    name = \"Arcane Spirits\",\n    dataKey = \"hexSpirits\",\n    generator = function(data)\n      local _, arcane, _ = SupabaseLib.generateSpiritData(data)\n      return arcane\n    end,\n    slot = 9,\n    shuffle = true,\n    preload = true\n  },\n  {\n    name = \"Hex Spirits (Special)\",\n    dataKey = \"hexSpirits\",\n    generator = function(data)\n      local _, _, special = SupabaseLib.generateSpiritData(data)\n      return special\n    end,\n    slot = 10,\n    shuffle = true,\n    preload = true\n  },\n  {\n    name = \"Origin Destiny\",\n    generator = function()\n      return SupabaseLib.generateOriginDestinyData()\n    end,\n    slot = 11,\n    shuffle = true,\n    preload = true\n  },\n\n  -------------------------------------------------------------------------------\n  -- Category: Travelers (Slot 12)\n  -------------------------------------------------------------------------------\n  {\n    name = \"Travelers\",\n    dataKey = \"travelers\",\n    generator = function(data)\n      return SupabaseLib.generateTravelerData(data)\n    end,\n    slot = 12,\n    shuffle = false,\n    preload = true\n  },\n\n  -------------------------------------------------------------------------------\n  -- Category: Traveler Quests (Slot 13)\n  -------------------------------------------------------------------------------\n  {\n    name = \"Traveler Quests\",\n    dataKey = \"travelerQuests\",\n    generator = function(data)\n      return SupabaseLib.generateTravelerQuestData(data)\n    end,\n    slot = 13,\n    shuffle = false,\n    preload = true\n  },\n\n  -------------------------------------------------------------------------------\n  -- Category: Reference (Slot 14)\n  -------------------------------------------------------------------------------\n  {\n    name = \"Icon Guide\",\n    dataKey = \"iconGuide\",\n    generator = function(iconGuide)\n      if type(iconGuide) == \"table\" then\n        return buildIconGuideObjects(iconGuide.url, iconGuide.icons)\n      end\n      return buildIconGuideObjects(nil, nil)\n    end,\n    slot = 14,\n    shuffle = false,\n    preload = true\n  }\n}\n\n-- Legacy bag to clean up (migration)\nlocal LEGACY_BAGS = {\n  \"Hex Spirits (Ancient)\",  -- Replaced by Origin Destiny\n  \"Spirit World Spirits\",\n  \"Hex Spirits\",\n  \"Sealed Spirits\"\n}\n\n-------------------------------------------------------------------------------\n-- State tracking\n-------------------------------------------------------------------------------\n\nlocal preloadState = {\n  inProgress = false,   -- Whether preloading is active\n  totalPreloaded = 0    -- Count of preloaded objects\n}\n\n-------------------------------------------------------------------------------\n-- UI-Based Image Preloading (Most Comprehensive)\n-------------------------------------------------------------------------------\n\n--- Preload ONLY character select UI images via UI.setCustomAssets\n--- Keeps lobby responsive by loading the character select art first.\n---@param data table The full API data\n---@return number Count of images queued for preload\nfunction AssetLoaderLib.preloadCharacterSelectImages(data)\n  local imageAssets = {}\n  local imageIndex = 0\n\n  -- Helper to add unique image by asset name\n  local seenNames = {}\n  local function addImage(url, name)\n    if not url or url == \"\" then\n      return\n    end\n\n    local assetName = name or (\"preload_\" .. (imageIndex + 1))\n    if seenNames[assetName] then\n      return\n    end\n\n    seenNames[assetName] = true\n    imageIndex = imageIndex + 1\n    table.insert(imageAssets, {\n      name = assetName,\n      url = url\n    })\n  end\n\n  -- Guardian/Character select images (base + all 6 color variants)\n  if data and data.guardians then\n    for _, guardian in ipairs(data.guardians) do\n      local charName = guardian.name or tostring(guardian.id or imageIndex)\n      addImage(guardian.char_select_url, \"charselect_\" .. charName)\n      addImage(guardian.char_select_red_url, \"charselect_Red_\" .. charName)\n      addImage(guardian.char_select_orange_url, \"charselect_Orange_\" .. charName)\n      addImage(guardian.char_select_yellow_url, \"charselect_Yellow_\" .. charName)\n      addImage(guardian.char_select_green_url, \"charselect_Green_\" .. charName)\n      addImage(guardian.char_select_blue_url, \"charselect_Blue_\" .. charName)\n      addImage(guardian.char_select_purple_url, \"charselect_Purple_\" .. charName)\n    end\n  end\n\n  -- TTS Menu background (if used)\n  if data and data.ttsMenu and data.ttsMenu.backgroundUrl then\n    addImage(data.ttsMenu.backgroundUrl, \"menu_background\")\n  end\n\n  -- Apply to UI system - this triggers TTS to download all images\n  if #imageAssets \u003e 0 then\n    UI.setCustomAssets(imageAssets)\n  end\n\n  return #imageAssets\nend\n\n--- Collect ALL image URLs from API data and preload via UI.setCustomAssets\n--- This forces TTS to download and cache all images upfront\n---@param data table The full API data\n---@return number Count of images queued for preload\nfunction AssetLoaderLib.preloadAllImages(data)\n  local imageAssets = {}\n  local imageIndex = 0\n\n  -- Helper to add unique image by asset name\n  local seenNames = {}\n  local function addImage(url, name)\n    if not url or url == \"\" then\n      return\n    end\n\n    local assetName = name or (\"preload_\" .. (imageIndex + 1))\n    if seenNames[assetName] then\n      return\n    end\n\n    seenNames[assetName] = true\n    imageIndex = imageIndex + 1\n    table.insert(imageAssets, {\n      name = assetName,\n      url = url\n    })\n  end\n\n  -- 1. Hex Spirits images\n  if data.hexSpirits then\n    for _, spirit in ipairs(data.hexSpirits) do\n      addImage(spirit.image_url, \"spirit_\" .. (spirit.id or imageIndex))\n    end\n  end\n\n  -- 2. Artifact images\n  if data.artifacts then\n    for _, artifact in ipairs(data.artifacts) do\n      addImage(artifact.image_path, \"artifact_\" .. (artifact.id or imageIndex))\n    end\n  end\n\n  -- 3. Monster images\n  if data.monsters then\n    for _, monster in ipairs(data.monsters) do\n      addImage(monster.image_url, \"monster_\" .. (monster.id or imageIndex))\n    end\n  end\n\n  -- 4. Traveler images\n  if data.travelers then\n    for _, traveler in ipairs(data.travelers) do\n      addImage(traveler.image_url, \"traveler_\" .. (traveler.id or imageIndex))\n    end\n  end\n\n  -- 4b. Traveler Quest images\n  if data.travelerQuests then\n    for _, quest in ipairs(data.travelerQuests) do\n      addImage(quest.image_url, \"travelerquest_\" .. (quest.id or imageIndex))\n    end\n  end\n\n  -- 5. Guardian/Character images (mats, chibis, icons, character select)\n  if data.guardians then\n    for _, guardian in ipairs(data.guardians) do\n      local charName = guardian.name or tostring(guardian.id or imageIndex)\n      addImage(guardian.mat_image_url, \"mat_\" .. (guardian.id or imageIndex))\n      addImage(guardian.chibi_image_url, \"chibi_\" .. (guardian.id or imageIndex))\n      addImage(guardian.icon_image_url, \"icon_\" .. (guardian.id or imageIndex))\n      -- Character select images\n      addImage(guardian.char_select_url, \"charselect_\" .. charName)\n      addImage(guardian.char_select_red_url, \"charselect_Red_\" .. charName)\n      addImage(guardian.char_select_orange_url, \"charselect_Orange_\" .. charName)\n      addImage(guardian.char_select_yellow_url, \"charselect_Yellow_\" .. charName)\n      addImage(guardian.char_select_green_url, \"charselect_Green_\" .. charName)\n      addImage(guardian.char_select_blue_url, \"charselect_Blue_\" .. charName)\n      addImage(guardian.char_select_purple_url, \"charselect_Purple_\" .. charName)\n    end\n  end\n\n  -- 5b. TTS Menu background\n  if data.ttsMenu and data.ttsMenu.backgroundUrl then\n    addImage(data.ttsMenu.backgroundUrl, \"menu_background\")\n  end\n\n  -- 5c. Icon guide image (UI overlay)\n  if data.iconGuideUrl then\n    addImage(data.iconGuideUrl, \"icon_guide\")\n  elseif data.iconGuideIcons then\n    for _, icon in ipairs(data.iconGuideIcons) do\n      addImage(icon.image_url, \"icon_guide_\" .. (icon.id or icon.name or imageIndex))\n    end\n  end\n\n  -- 6. Rune images\n  if data.runes then\n    for _, rune in ipairs(data.runes) do\n      addImage(rune.icon_url, \"rune_\" .. (rune.id or imageIndex))\n    end\n  end\n\n  -- 7. Origin/Destiny images (orbs and arcane spirits)\n  if data.origins then\n    for _, origin in ipairs(data.origins) do\n      addImage(origin.calling_orb_image_url, \"orb_\" .. (origin.id or imageIndex))\n      if origin.associated_hex_spirit then\n        addImage(origin.associated_hex_spirit.image_url, \"arcane_\" .. (origin.id or imageIndex))\n      end\n    end\n  end\n\n  -- 8. Icon pool assets (boards, status tokens, icons, etc.)\n  if data.iconPool then\n    for _, asset in ipairs(data.iconPool) do\n      addImage(asset.image_url, \"icon_\" .. (asset.name or imageIndex))\n    end\n  end\n\n  -- 9. Dice images (if any)\n  if data.customDice then\n    for _, dice in ipairs(data.customDice) do\n      if dice.image_url then\n        addImage(dice.image_url, \"dice_\" .. (dice.id or imageIndex))\n      end\n    end\n  end\n\n  -- 10. Class images (icons if any)\n  if data.classes then\n    for _, class in ipairs(data.classes) do\n      if class.icon_url then\n        addImage(class.icon_url, \"class_\" .. (class.id or imageIndex))\n      end\n    end\n  end\n\n  -- 11. Token images (Arcane Droplets, Avatar Barrier, etc.)\n  if data.tokens then\n    for _, token in ipairs(data.tokens) do\n      addImage(token.image_url, \"token_\" .. (token.id or imageIndex))\n    end\n  end\n\n  -- Apply to UI system - this triggers TTS to download all images\n  if #imageAssets \u003e 0 then\n    UI.setCustomAssets(imageAssets)\n  end\n\n  return #imageAssets\nend\n\n--- Wait for UI assets to finish loading\n--- Used to delay UI creation until all UI.setCustomAssets downloads complete.\n---@param callback function Called when UI.loading becomes false (or on timeout)\nfunction AssetLoaderLib.waitForUIAssetsLoaded(callback)\n  local checkCount = 0\n  local maxChecks = 300  -- 30 seconds max wait (100ms intervals)\n\n  local function checkLoading()\n    checkCount = checkCount + 1\n\n    if not UI.loading then\n      if callback then callback() end\n    elseif checkCount \u003e= maxChecks then\n      if callback then callback() end\n    else\n      Wait.time(checkLoading, 0.1)\n    end\n  end\n\n  -- Start checking\n  Wait.time(checkLoading, 0.1)\nend\n\n-------------------------------------------------------------------------------\n-- Player Mat Pre-spawning (Warmup Cache)\n-------------------------------------------------------------------------------\n\n--- Pre-spawn all player mats and figurines to warm up texture cache\n--- Spawns them hidden, waits for textures, then destroys them\n---@param guardians table The guardians data from API\n---@param onComplete function|nil Callback when done\nfunction AssetLoaderLib.prespawnPlayerMats(guardians, onComplete)\n  if not guardians or #guardians == 0 then\n    if onComplete then onComplete() end\n    return\n  end\n\n  local playableGuardians = {}\n  for _, g in ipairs(guardians) do\n    if g.mat_image_url then\n      table.insert(playableGuardians, g)\n    end\n  end\n\n  if #playableGuardians == 0 then\n    if onComplete then onComplete() end\n    return\n  end\n\n\n  local spawnedObjects = {}\n  local spawnedCount = 0\n  local totalToSpawn = #playableGuardians * 2  -- Mats + figurines\n\n  local function checkComplete()\n    if spawnedCount \u003e= totalToSpawn then\n      -- Wait for textures to load, then destroy all\n      Wait.frames(function()\n        for _, obj in ipairs(spawnedObjects) do\n          if obj and not obj.isDestroyed() then\n            obj.destruct()\n          end\n        end\n        if onComplete then onComplete() end\n      end, PRELOAD_CONFIG.textureLoadFrames)\n    end\n  end\n\n  -- Spawn each mat and figurine hidden\n  for i, guardian in ipairs(playableGuardians) do\n    Wait.time(function()\n      -- Spawn mat\n      local matData = {\n        Name = \"Custom_Tile\",\n        Transform = {\n          posX = PRELOAD_CONFIG.preloadPosition.x + (i * 2),\n          posY = PRELOAD_CONFIG.preloadPosition.y,\n          posZ = PRELOAD_CONFIG.preloadPosition.z,\n          rotX = 0, rotY = 0, rotZ = 0,\n          scaleX = 9.5, scaleY = 1, scaleZ = 9.5\n        },\n        Nickname = \"_preload_\" .. guardian.name,\n        ColorDiffuse = { r = 0, g = 0, b = 0 },\n        CustomImage = {\n          ImageURL = guardian.mat_image_url,\n          ImageScalar = 1,\n          WidthScale = 0,\n          CustomTile = {\n            Type = 0,\n            Thickness = 0.1,\n            Stackable = false,\n            Stretch = true\n          }\n        }\n      }\n\n      local mat = spawnObjectData({ data = matData })\n      if mat then\n        mat.setInvisibleTo({})\n        table.insert(spawnedObjects, mat)\n      end\n      spawnedCount = spawnedCount + 1\n      checkComplete()\n\n      -- Spawn figurine if has chibi\n      if guardian.chibi_image_url and guardian.chibi_image_url ~= \"\" then\n        local figurineData = {\n          Name = \"Figurine_Custom\",\n          Transform = {\n            posX = PRELOAD_CONFIG.preloadPosition.x + (i * 2) + 1,\n            posY = PRELOAD_CONFIG.preloadPosition.y,\n            posZ = PRELOAD_CONFIG.preloadPosition.z,\n            rotX = 0, rotY = 180, rotZ = 0,\n            scaleX = 1, scaleY = 1, scaleZ = 1\n          },\n          Nickname = \"_preload_figurine_\" .. guardian.name,\n          ColorDiffuse = { r = 1, g = 1, b = 1 },\n          CustomImage = {\n            ImageURL = guardian.chibi_image_url,\n            ImageSecondaryURL = guardian.chibi_image_url,\n            ImageScalar = 2.25\n          }\n        }\n\n        local figurine = spawnObjectData({ data = figurineData })\n        if figurine then\n          figurine.setInvisibleTo({})\n          table.insert(spawnedObjects, figurine)\n        end\n      end\n      spawnedCount = spawnedCount + 1\n      checkComplete()\n\n    end, i * 0.05)  -- Small stagger to avoid overwhelming TTS\n  end\nend\n\n-------------------------------------------------------------------------------\n-- Main API\n-------------------------------------------------------------------------------\n\n--- Load all assets from API data\n--- This is the main entry point called from Global.ttslua\n---@param data table The loaded data from SupabaseLib\n---@param options table|nil Optional settings { preload = true/false, onComplete = function }\nfunction AssetLoaderLib.loadAllAssets(data, options)\n  options = options or {}\n  local shouldPreload = options.preload ~= false and PRELOAD_CONFIG.enabled\n\n  GameState.debugPrint(\"[AssetLoader] Loading assets...\")\n\n  -- STEP 1: Preload ALL images via UI system (fastest method)\n  -- This tells TTS to download all images in parallel\n  if shouldPreload and PRELOAD_CONFIG.useUIPreload then\n    local imageCount = AssetLoaderLib.preloadAllImages(data)\n  end\n\n  -- STEP 2: Pre-spawn player mats to warm up texture cache\n  if shouldPreload and data.guardians then\n    AssetLoaderLib.prespawnPlayerMats(data.guardians)\n  end\n\n  -- Clean up legacy bags\n  for _, legacyName in ipairs(LEGACY_BAGS) do\n    SpawnLib.getSomeDataFromBag(legacyName)  -- Destroys if exists\n  end\n\n  -- Get spirit bag URL for custom bag\n  local spiritBagUrl = SupabaseLib.getSpiritBagUrl()\n\n  -- Track bags for preloading (spawn-and-hide method as backup)\n  local bagsToPreload = {}\n\n  -- Process each bag configuration\n  for _, config in ipairs(BAG_CONFIGS) do\n    -- CHECK IF BAG ALREADY EXISTS\n    local existingBag = UtilLib.getObjectByName(config.name)\n\n    if not existingBag then\n      -- Only spawn if bag doesn't exist\n      local bagData = config.dataKey and data[config.dataKey] or nil\n      local objectList = config.generator(bagData)\n\n      if objectList and #objectList \u003e 0 then\n        -- Get existing bag position or use default\n        local position, rotation, guid = SpawnLib.getSomeDataFromBag(config.name)\n        position = position or getBagPosition(config.slot)\n\n        -- Shuffle if configured\n        if config.shuffle then\n          TableLib.shuffle(objectList)\n        end\n\n        -- Spawn the bag\n        if config.customBag and spiritBagUrl then\n          SpawnLib.spawnCustomSpiritBag(config.name, objectList, position, rotation, nil, guid, spiritBagUrl)\n        else\n          SpawnLib.spawnBag(config.name, objectList, position, rotation, nil, guid)\n        end\n\n        -- Queue for preloading if enabled\n        if shouldPreload and config.preload then\n          table.insert(bagsToPreload, config.name)\n        end\n      end\n    else\n      -- Bag already exists, queue for preloading if enabled\n      if shouldPreload and config.preload then\n        table.insert(bagsToPreload, config.name)\n      end\n    end\n  end\n\n  -- Ensure newer reference bags exist (for games that predate the bag configs).\n  AssetLoaderLib.ensureIconGuideBag(data and data.iconGuideUrl, data and data.iconGuideIcons)\n\n  -- Update boards and other non-bag assets\n  AssetLoaderLib.updateIconPoolAssets(data.iconPool)\n\n  -- Spawn token bags (Arcane Droplets, Avatar Barrier, etc.)\n  AssetLoaderLib.spawnTokenBags(data.tokens)\n\n  -- Set resource icon URLs from tokens (same source as token bags)\n  AssetLoaderLib.setResourceIcons(data.tokens)\n\n  -- Spawn Arcane Advisor on existing player mats\n  AssetLoaderLib.spawnArcaneAdvisorOnMats(data.hexSpirits)\n\n  -- Start preloading if enabled\n  if shouldPreload and #bagsToPreload \u003e 0 then\n    AssetLoaderLib.startPreloading(bagsToPreload, options.onComplete)\n  elseif options.onComplete then\n    options.onComplete()\n  end\nend\n\n-------------------------------------------------------------------------------\n-- Reference Bags\n-------------------------------------------------------------------------------\n\nlocal ICON_GUIDE_BAG_NAME = \"Icon Guide\"\n\n--- Ensure the Icon Guide bag exists (spawns it if missing).\n--- This supports older saves that predate the Icon Guide bag.\n---@param iconGuideUrl string|nil Icon guide image URL from the export\n---@param iconGuideIcons table|nil Icon guide icon entries from the export\nfunction AssetLoaderLib.ensureIconGuideBag(iconGuideUrl, iconGuideIcons)\n  if UtilLib.getObjectByName(ICON_GUIDE_BAG_NAME) then\n    return\n  end\n\n  local objects = buildIconGuideObjects(iconGuideUrl, iconGuideIcons)\n  if objects and #objects \u003e 0 then\n    SpawnLib.spawnBag(ICON_GUIDE_BAG_NAME, objects, getBagPosition(14))\n    return\n  end\n\n  objects = buildIconGuideObjects(GameState.iconGuideUrl, GameState.iconGuideIcons)\n  if objects and #objects \u003e 0 then\n    SpawnLib.spawnBag(ICON_GUIDE_BAG_NAME, objects, getBagPosition(14))\n    return\n  end\n\n  -- Last resort: fetch from API (older saves may not have this cached).\n  SupabaseLib.fetchIconGuideData(function(url, icons)\n    if url and url ~= \"\" then\n      GameState.iconGuideUrl = url\n    end\n    if type(icons) == \"table\" and #icons \u003e 0 then\n      GameState.iconGuideIcons = icons\n    end\n\n    local fetchedObjects = buildIconGuideObjects(url, icons)\n    if fetchedObjects and #fetchedObjects \u003e 0 then\n      SpawnLib.spawnBag(ICON_GUIDE_BAG_NAME, fetchedObjects, getBagPosition(14))\n    end\n  end)\nend\n\n--- Update icon pool asset images (boards, status tokens, etc.)\n---@param iconPool table The icon_pool data from API\nfunction AssetLoaderLib.updateIconPoolAssets(iconPool)\n  if not iconPool then\n    return\n  end\n\n  for _, asset in ipairs(iconPool) do\n    local tags = asset.tags or {}\n\n    -- Spirit World map tile\n    if asset.name == \"SpiritWorld\" or TableLib.contains(tags, \"spirit_world\") then\n      SpawnLib.updateObjectImageByName(\"SpiritWorld\", asset.image_url)\n    end\n\n    -- Board assets (reference_sheet, Origin_destiny)\n    if TableLib.contains(tags, \"board\") then\n      if asset.name == \"reference_sheet\" then\n        GameState.referenceSheetUrl = asset.image_url\n        for _, playerColor in ipairs(Player.getColors()) do\n          UI.setAttribute(playerColor .. \"_reference_image\", \"image\", asset.image_url)\n        end\n      elseif asset.name == \"Origin_destiny\" then\n        local destinyBag = UtilLib.getObjectByName(\"Origin Destiny\")\n        if destinyBag then\n          local destinyData = destinyBag.getData()\n          if destinyData.ContainedObjects and destinyData.ContainedObjects[1] then\n            destinyData.ContainedObjects[1].CustomImage.ImageURL = asset.image_url\n            destinyBag.destruct()\n            spawnObjectData({ data = destinyData })\n          end\n        end\n      end\n    end\n\n    -- Status tokens\n    if TableLib.contains(tags, \"status\") then\n      local statusName = UtilLib.properCase(string.match(asset.name, \".*_(.*)\"))\n      if statusName then\n        SpawnLib.updateObjectImageByTag(statusName, asset.image_url)\n      end\n    end\n  end\nend\n\n--- Spawn token bags in a row (each bag contains one token type)\n---@param tokensData table The tokens data from API\nfunction AssetLoaderLib.spawnTokenBags(tokensData)\n  if not tokensData or #tokensData == 0 then\n    return\n  end\n\n  local tokenBagsData = SupabaseLib.generateTokenBagsData()\n\n  for i, bagData in ipairs(tokenBagsData) do\n    local bagName = bagData.name\n    local existingBag = UtilLib.getObjectByName(bagName)\n\n    if not existingBag then\n      local position = getTokenBagPosition(i)\n\n      -- Create infinite bag with the token inside\n      local infiniteBagData = {\n        Name = \"Infinite_Bag\",\n        Nickname = bagName,\n        Transform = {\n          posX = position.x,\n          posY = position.y,\n          posZ = position.z,\n          rotX = 0,\n          rotY = 180,\n          rotZ = 0,\n          scaleX = TOKEN_BAG_ROW_CONFIG.scale,\n          scaleY = TOKEN_BAG_ROW_CONFIG.scale,\n          scaleZ = TOKEN_BAG_ROW_CONFIG.scale\n        },\n        Locked = true,\n        Tags = { \"TokenBag\" },\n        ColorDiffuse = { r = 0.2, g = 0.5, b = 0.8 },  -- Blue tint for token bags\n        ContainedObjects = { bagData.token }\n      }\n\n      spawnObjectData({ data = infiniteBagData })\n    end\n  end\nend\n\n--- Set resource icon URLs from tokens array (same source as token bags)\n--- Maps token names to GameState.resourceIcons\n---@param tokensData table The tokens array from API\nfunction AssetLoaderLib.setResourceIcons(tokensData)\n  if not tokensData then\n    return\n  end\n\n  for _, tokenData in ipairs(tokensData) do\n    if tokenData.image_url then\n      if tokenData.name == \"Arcane Droplets\" then\n        GameState.resourceIcons.blood = tokenData.image_url\n      elseif tokenData.name == \"vp_raw\" then\n        GameState.resourceIcons.victoryPoint = tokenData.image_url\n      elseif tokenData.name == \"Avatar Barrier\" or tokenData.name == \"arcane_barrier\" then\n        GameState.resourceIcons.barrier = tokenData.image_url\n      end\n    end\n  end\nend\n\n--- Spawn Arcane Advisor on existing player mats\n---@param hexSpiritsData table The hex spirits data\nfunction AssetLoaderLib.spawnArcaneAdvisorOnMats(hexSpiritsData)\n  if not hexSpiritsData then return end\n\n  -- Find Arcane Advisor in special spirits\n  local _, _, specialList = SupabaseLib.generateSpiritData(hexSpiritsData)\n  local advisorData = nil\n\n  for _, spiritData in ipairs(specialList) do\n    local md = UtilLib.getMetadata(spiritData.GMNotes)\n    if md.id == \"871642d5-63b2-4c15-9bfe-621c21388a3b\" then\n      advisorData = spiritData\n      break\n    end\n  end\n\n  if not advisorData then return end\n\n  for _, mat in ipairs(getObjectsWithTag(\"Playermat\")) do\n    local matRot = mat.getRotation()\n    local globalPos = mat.positionToWorld(Vector(1.42, 0.1, 0.308))\n\n    -- Check if an Arcane Advisor already exists on this mat\n    local existingAdvisor = false\n    local objectsNearMat = Physics.cast({\n      origin = globalPos,\n      direction = {0, 1, 0},\n      type = 3,  -- Sphere cast\n      size = {2, 2, 2},  -- Search radius\n      max_distance = 0\n    })\n\n    for _, hit in ipairs(objectsNearMat) do\n      if hit.hit_object and hit.hit_object.hasTag(\"ArcaneAdvisor\") then\n        existingAdvisor = true\n        break\n      end\n    end\n\n    -- Only spawn if advisor doesn't exist\n    if not existingAdvisor then\n      -- Clone the data to avoid modifying original\n      local spawnData = TableLib.copy(advisorData)\n      spawnData.Transform.posX = globalPos.x\n      spawnData.Transform.posY = 1.2\n      spawnData.Transform.posZ = globalPos.z\n      spawnData.Transform.rotX = matRot.x\n      spawnData.Transform.rotY = matRot.y\n      spawnData.Transform.rotZ = matRot.z\n\n      spawnObjectData({ data = spawnData })\n    end\n  end\nend\n\n-------------------------------------------------------------------------------\n-- Preloading System\n-------------------------------------------------------------------------------\n\n--- Start preloading textures for specified bags (all bags in parallel)\n---@param bagNames table Array of bag names to preload\n---@param onComplete function|nil Callback when all preloading is done\nfunction AssetLoaderLib.startPreloading(bagNames, onComplete)\n  preloadState.totalPreloaded = 0\n  preloadState.inProgress = true\n\n  broadcastToAll(\"Preloading assets for faster gameplay...\", {0.5, 0.8, 1})\n\n  -- Find all valid bags\n  local validBags = {}\n  for _, bagName in ipairs(bagNames) do\n    local bag = UtilLib.getObjectByName(bagName)\n    if bag then\n      local bagType = bag.type\n      if bagType == \"Bag\" or bagType == \"Custom_Model_Bag\" or bagType == \"Infinite_Bag\" then\n        table.insert(validBags, { name = bagName, bag = bag })\n      end\n    end\n  end\n\n  if #validBags == 0 then\n    preloadState.inProgress = false\n    broadcastToAll(\"Asset preloading complete!\", {0.5, 1, 0.5})\n    if onComplete then onComplete() end\n    return\n  end\n\n  -- Process all bags in parallel\n  local completedBags = 0\n  local totalBags = #validBags\n\n  for _, bagInfo in ipairs(validBags) do\n    AssetLoaderLib.preloadBagContents(bagInfo.bag, function()\n      completedBags = completedBags + 1\n      if completedBags \u003e= totalBags then\n        preloadState.inProgress = false\n        if onComplete then onComplete() end\n      end\n    end)\n  end\nend\n\n--- Preload all objects in a bag by spawning them hidden, then returning them\n---@param bag object The bag object to preload\n---@param onComplete function Callback when this bag is done\nfunction AssetLoaderLib.preloadBagContents(bag, onComplete)\n  -- Safely get contents with pcall in case the object doesn't support getObjects\n  local success, contents = pcall(function() return bag.getObjects() end)\n  if not success or not contents or #contents == 0 then\n    onComplete()\n    return\n  end\n\n  local totalObjects = #contents\n  local processedCount = 0\n\n  -- Spawn all objects at once\n  for i = 1, totalObjects do\n    bag.takeObject({\n      position = PRELOAD_CONFIG.preloadPosition,\n      index = 0,  -- Always take from top\n      smooth = false,\n      callback_function = function(obj)\n        if obj and not obj.isDestroyed() then\n          obj.setInvisibleTo({})\n\n          -- Wait for texture to load, then put back\n          Wait.frames(function()\n            if obj and not obj.isDestroyed() and bag and not bag.isDestroyed() then\n              bag.putObject(obj)\n              preloadState.totalPreloaded = preloadState.totalPreloaded + 1\n            end\n\n            processedCount = processedCount + 1\n            if processedCount \u003e= totalObjects then\n              onComplete()\n            end\n          end, PRELOAD_CONFIG.textureLoadFrames)\n        else\n          processedCount = processedCount + 1\n          if processedCount \u003e= totalObjects then\n            onComplete()\n          end\n        end\n      end\n    })\n  end\nend\n\n-------------------------------------------------------------------------------\n-- Utility Functions\n-------------------------------------------------------------------------------\n\n--- Check if preloading is currently in progress\n---@return boolean\nfunction AssetLoaderLib.isPreloading()\n  return preloadState.inProgress\nend\n\n--- Get preload progress\n---@return number, number Current count and estimated total\nfunction AssetLoaderLib.getPreloadProgress()\n  return preloadState.totalPreloaded, 0  -- Total unknown until all bags processed\nend\n\n--- Cancel ongoing preloading\nfunction AssetLoaderLib.cancelPreloading()\n  preloadState.inProgress = false\nend\n\n--- Set preload configuration\n---@param config table Partial config to merge\nfunction AssetLoaderLib.setPreloadConfig(config)\n  for k, v in pairs(config) do\n    if PRELOAD_CONFIG[k] ~= nil then\n      PRELOAD_CONFIG[k] = v\n    end\n  end\nend\n\n--- Manually preload a specific bag by name\n---@param bagName string The name of the bag to preload\n---@param onComplete function|nil Callback when done\nfunction AssetLoaderLib.preloadBag(bagName, onComplete)\n  local bag = UtilLib.getObjectByName(bagName)\n  if not bag then\n    GameState.debugPrint(\"[AssetLoader] Bag not found: \" .. bagName)\n    if onComplete then onComplete() end\n    return\n  end\n\n  AssetLoaderLib.preloadBagContents(bag, onComplete or function() end)\nend\n\n-------------------------------------------------------------------------------\n-- Bag Migration Helpers\n-------------------------------------------------------------------------------\n\n--- Ensure a named bag is a standard TTS Bag (not a Custom_Model_Bag), preserving contents.\n---@param bagName string\nfunction AssetLoaderLib.ensureStandardBag(bagName)\n  local bag = UtilLib.getObjectByName(bagName)\n  if not bag or bag.isDestroyed() then\n    return\n  end\n\n  if bag.type ~= \"Custom_Model_Bag\" then\n    return\n  end\n\n  local ok, data = pcall(function() return bag.getData() end)\n  if not ok or not data then\n    return\n  end\n\n  local containedObjects = data.ContainedObjects or {}\n  local position = bag.getPosition()\n  local rotation = bag.getRotation()\n  local guid = bag.getGUID()\n\n  GameState.debugPrint(\"[AssetLoader] Converting \" .. bagName .. \" from Custom_Model_Bag to Bag\")\n  bag.destruct()\n\n  -- Respawn as a normal bag with the same contents (bag model/mesh issues can cause invisibility)\n  SpawnLib.spawnBag(bagName, containedObjects, position, rotation, nil, guid)\nend\n\n--- Ensure spirit bags use the same standard Bag object as other spawned bags.\nfunction AssetLoaderLib.ensureStandardSpiritBags()\n  AssetLoaderLib.ensureStandardBag(\"Spirit World Bag\")\n  AssetLoaderLib.ensureStandardBag(\"Abyss Fallen Spirits\")\nend\n\nreturn AssetLoaderLib\nend)\n__bundle_register(\"api/GameSyncLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- GameSyncLib: Sync game state to Supabase after navigation completion\n-------------------------------------------------------------------------------\n\nlocal GameSyncLib = {}\n\nlocal GameState = require(\"state/GameState\")\nlocal PlayerMatLib = require(\"game/PlayerMatLib\")\nlocal WebRequestLib = require(\"api/WebRequestLib\")\nlocal UtilLib = require(\"util/UtilLib\")\n\n-------------------------------------------------------------------------------\n-- Configuration\n-------------------------------------------------------------------------------\n\nlocal SYNC_ENDPOINT = \"https://gvxfokbptelmvvlxbigh.supabase.co/functions/v1/sync-game-state\"\nlocal SUPABASE_ANON_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd2eGZva2JwdGVsbXZ2bHhiaWdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4NzY4NTAsImV4cCI6MjA2ODQ1Mjg1MH0.QLIyWCf8AGIUDmGlttbqRKrxxBSOBn_B5O-0yuCwlGE\"\n\n-------------------------------------------------------------------------------\n-- Helper Functions\n-------------------------------------------------------------------------------\n\n--- Get current timestamp in ISO-8601 format\n---@return string ISO-8601 timestamp\nlocal function getTimestamp()\n  return os.date(\"!%Y-%m-%dT%H:%M:%SZ\")\nend\n\n--- Get the player's current TTS display name (Steam name)\n---@param playerColor string\n---@return string\nlocal function getPlayerTtsUsername(playerColor)\n  local player = Player[playerColor]\n  if player and player.steam_name and player.steam_name ~= \"\" then\n    return player.steam_name\n  end\n  return playerColor\nend\n\n--- Build spirits data for a player from PlayerMatLib state\n---@param playerColor string The player color\n---@return table Array of spirit data\nlocal function buildPlayerSpirits(playerColor)\n  local spirits = {}\n  local playerState = PlayerMatLib.getState(playerColor)\n\n  if not playerState or not playerState.spirits then\n    return spirits\n  end\n\n  for slotIndex, spirit in pairs(playerState.spirits) do\n    table.insert(spirits, {\n      slotIndex = slotIndex,\n      id = spirit.id,\n      name = spirit.name,\n      cost = spirit.cost,\n      classes = spirit.classes,\n      origins = spirit.origins\n    })\n  end\n\n  return spirits\nend\n\n--- Extract spirit data from a bag's contents\n---@param bag userdata The TTS bag object\n---@return table Array of spirit info { id, name, cost }\nlocal function extractBagContents(bag)\n  if not bag then return {} end\n\n  local contents = {}\n  local objects = bag.getObjects()\n\n  for _, obj in ipairs(objects) do\n    local spiritInfo = {\n      name = obj.name or obj.nickname or \"Unknown\",\n      guid = obj.guid\n    }\n\n    -- Try to parse GM notes for additional metadata\n    if obj.gm_notes and obj.gm_notes ~= \"\" then\n      local success, metadata = pcall(function() return JSON.decode(obj.gm_notes) end)\n      if success and metadata then\n        spiritInfo.id = metadata.id\n        spiritInfo.cost = metadata.cost\n        if metadata.state ~= nil then spiritInfo.state = metadata.state end\n        if metadata.barrier ~= nil then spiritInfo.barrier = metadata.barrier end\n        if metadata.damage ~= nil then spiritInfo.damage = metadata.damage end\n      end\n    end\n\n    table.insert(contents, spiritInfo)\n  end\n\n  return contents\nend\n\n--- Build spirit world bag data\n---@return table Bag info with count and contents\nlocal function buildHexSpiritsBag()\n  local bag = UtilLib.getObjectByName(\"Spirit World Bag\")\n  if not bag then\n    return { count = 0, contents = {} }\n  end\n\n  return {\n    count = bag.getQuantity(),\n    contents = extractBagContents(bag)\n  }\nend\n\n--- Build monsters bag data\n---@return table Bag info with count and contents\nlocal function buildMonstersBag()\n  local bag = UtilLib.getObjectByName(\"Monsters\")\n  if not bag then\n    return { count = 0, contents = {} }\n  end\n\n  local count = 0\n  local ok, qty = pcall(function() return bag.getQuantity() end)\n  if ok and qty then\n    count = qty\n  else\n    count = #(bag.getObjects() or {})\n  end\n\n  return {\n    count = count,\n    contents = extractBagContents(bag)\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Public API\n-------------------------------------------------------------------------------\n\n--- Build the full sync payload for all active players\n---@param destinationsByPlayerColor? table Optional snapshot of destinations (playerColor -\u003e destination)\n---@return table The sync payload\nfunction GameSyncLib.buildSyncPayload(destinationsByPlayerColor)\n  local players = {}\n  local destinations = destinationsByPlayerColor or GameState.destinationPerPlayerColor or {}\n\n  -- Iterate through all players who have selected characters\n  for playerColor, characterName in pairs(GameState.selectedCharacters) do\n    local statusLevel = PlayerMatLib.getStatus(playerColor)\n    local statusToken = GameState.statusTokens and GameState.statusTokens[statusLevel] or nil\n    local playerData = {\n      playerColor = playerColor,\n      ttsUsername = getPlayerTtsUsername(playerColor),\n      navigationDestination = destinations[playerColor],\n      selectedCharacter = characterName,\n      spirits = buildPlayerSpirits(playerColor),\n      runes = PlayerMatLib.getRunes(playerColor),\n      blood = PlayerMatLib.getBlood(playerColor),\n      victoryPoints = PlayerMatLib.getVictoryPoints(playerColor),\n      barrier = PlayerMatLib.getBarrier(playerColor),\n      barrierTokens = PlayerMatLib.getBarrier(playerColor),\n      statusLevel = statusLevel,\n      statusToken = statusToken and statusToken.name or nil,\n      handDraws = (GameState.handDrawsThisNavigation and GameState.handDrawsThisNavigation[playerColor]) or {}\n    }\n    table.insert(players, playerData)\n  end\n\n  return {\n    gameId = GameState.gameId,\n    timestamp = getTimestamp(),\n    navigationCount = GameState.navigationCount,\n    players = players,\n    bags = {\n      hexSpirits = buildHexSpiritsBag(),\n      monsters = buildMonstersBag()\n    }\n  }\nend\n\n--- Sync game state to Supabase after navigation completion\n--- Called automatically when all players complete navigation selection\n---@param destinationsByPlayerColor? table Optional snapshot of destinations (playerColor -\u003e destination)\nfunction GameSyncLib.syncAfterNavigation(destinationsByPlayerColor)\n  -- Increment navigation count\n  GameState.navigationCount = GameState.navigationCount + 1\n\n  if GameState.DEBUG_MODE and destinationsByPlayerColor then\n    GameState.debugPrint(\"[GameSyncLib] Sync destinations snapshot: \" .. JSON.encode(destinationsByPlayerColor))\n  end\n\n  local payload = GameSyncLib.buildSyncPayload(destinationsByPlayerColor)\n\n  local headers = {\n    [\"Authorization\"] = \"Bearer \" .. SUPABASE_ANON_KEY,\n    [\"apikey\"] = SUPABASE_ANON_KEY\n  }\n\n  WebRequestLib.post(\n    SYNC_ENDPOINT,\n    payload,\n    function(response)\n      GameState.debugPrint(\"[GameSyncLib] Sync successful: \" .. (response or \"\"))\n    end,\n    function(errorMessage, responseCode)\n      print(\"[GameSyncLib] Sync failed: \" .. errorMessage)\n    end,\n    headers\n  )\nend\n\n--- Manual sync (can be called from UI or debug)\nfunction GameSyncLib.manualSync()\n  local payload = GameSyncLib.buildSyncPayload()\n\n  local headers = {\n    [\"Authorization\"] = \"Bearer \" .. SUPABASE_ANON_KEY,\n    [\"apikey\"] = SUPABASE_ANON_KEY\n  }\n\n  WebRequestLib.post(\n    SYNC_ENDPOINT,\n    payload,\n    function(response)\n      print(\"[GameSyncLib] Manual sync successful\")\n    end,\n    function(errorMessage, responseCode)\n      print(\"[GameSyncLib] Manual sync failed: \" .. errorMessage)\n    end,\n    headers\n  )\nend\n\nreturn GameSyncLib\nend)\n__bundle_register(\"api/SupabaseLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- SupabaseLib: Centralized Supabase data loading and asset generation\n-------------------------------------------------------------------------------\n\nlocal SupabaseLib = {}\n\nlocal GameState = require(\"state/GameState\")\nlocal ObjectTemplateLib = require(\"util/ObjectTemplateLib\")\nlocal TableLib = require(\"util/TableLib\")\nlocal WebRequestLib = require(\"api/WebRequestLib\")\n\n-------------------------------------------------------------------------------\n-- Configuration\n-------------------------------------------------------------------------------\n\nlocal ASSET_HOST_URL = \"https://gvxfokbptelmvvlxbigh.supabase.co/functions/v1/export-all-tts-json\"\nlocal SUPABASE_ANON_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd2eGZva2JwdGVsbXZ2bHhiaWdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4NzY4NTAsImV4cCI6MjA2ODQ1Mjg1MH0.QLIyWCf8AGIUDmGlttbqRKrxxBSOBn_B5O-0yuCwlGE\"\n\n-------------------------------------------------------------------------------\n-- Callback (set by Global.ttslua)\n-------------------------------------------------------------------------------\n\nlocal onLoadCompleteCallback = nil  -- function(data) called when all data is loaded\n\nfunction SupabaseLib.setOnLoadComplete(callback)\n  onLoadCompleteCallback = callback\nend\n\n-------------------------------------------------------------------------------\n-- Data Storage (accessible after load)\n-------------------------------------------------------------------------------\n\n\tlocal loadedData = {\n\t  exportedAt = nil,\n\t  edition = nil,\n\t  origins = {},\n\t  hexSpirits = {},\n\t  artifacts = {},\n\t  iconPool = {},\n\t  tokens = {},\n\t  monsters = {},\n\t  travelers = {},\n\t  travelerQuests = {},\n\t  guardians = {},\n\t  runes = {},\n\t  customDice = {},\n\t  classes = {},\n\t  iconGuideUrl = nil,\n\t  iconGuideIcons = {},\n\t  iconGuide = {\n\t    url = nil,\n\t    icons = {}\n\t  },\n\t  ttsMenu = {\n\t    backgroundUrl = nil\n\t  }\n\t}\n\nfunction SupabaseLib.getData()\n  return loadedData\nend\n\nfunction SupabaseLib.getGuardians()\n  return loadedData.guardians\nend\n\nfunction SupabaseLib.getPlayableGuardians()\n  local playable = {}\n  for _, g in ipairs(loadedData.guardians) do\n    if g.mat_image_url then\n      table.insert(playable, g)\n    end\n  end\n  return playable\nend\n\nfunction SupabaseLib.getCustomDice()\n  return loadedData.customDice\nend\n\nfunction SupabaseLib.getClasses()\n  return loadedData.classes\nend\n\nfunction SupabaseLib.getRunes()\n  return loadedData.runes\nend\n\nfunction SupabaseLib.getTtsMenu()\n  return loadedData.ttsMenu\nend\n\nfunction SupabaseLib.getIconPool()\n  return loadedData.iconPool\nend\n\n-------------------------------------------------------------------------------\n-- Main Loading Function\n-------------------------------------------------------------------------------\n\nfunction SupabaseLib.loadAssets()\n  broadcastToAll(\"Loading Assets from remote source ...\")\n\n  local headers = {\n    [\"Authorization\"] = \"Bearer \" .. SUPABASE_ANON_KEY,\n    [\"apikey\"] = SUPABASE_ANON_KEY\n  }\n\n  WebRequestLib.get(ASSET_HOST_URL, onAssetRequestSuccess, onAssetRequestError, headers)\nend\n\n--- Fetch the icon guide image URL without rebuilding full asset state.\n--- Useful for older saves that have cached data but are missing newer fields.\n---@param callback fun(url: string|nil) Called with the icon guide URL (or nil on failure)\nfunction SupabaseLib.fetchIconGuideUrl(callback)\n  local headers = {\n    [\"Authorization\"] = \"Bearer \" .. SUPABASE_ANON_KEY,\n    [\"apikey\"] = SUPABASE_ANON_KEY\n  }\n\n  WebRequestLib.get(\n    ASSET_HOST_URL,\n    function(content)\n      local ok, decoded = pcall(function() return JSON.decode(content) end)\n      local url = (ok and decoded and decoded.icon_guide_png_url) or nil\n      if url == \"\" then url = nil end\n      if callback then callback(url) end\n    end,\n    function(_errorMessage, _responseCode)\n      if callback then callback(nil) end\n    end,\n    headers\n  )\nend\n\n--- Fetch Icon Guide data without rebuilding full asset state.\n--- Useful for older saves that have cached data but are missing newer fields.\n---@param callback fun(url: string|nil, icons: table|nil) Called with the icon guide PNG URL and/or icon entries.\nfunction SupabaseLib.fetchIconGuideData(callback)\n  local headers = {\n    [\"Authorization\"] = \"Bearer \" .. SUPABASE_ANON_KEY,\n    [\"apikey\"] = SUPABASE_ANON_KEY\n  }\n\n  WebRequestLib.get(\n    ASSET_HOST_URL,\n    function(content)\n      local ok, decoded = pcall(function() return JSON.decode(content) end)\n      local url = (ok and decoded and decoded.icon_guide_png_url) or nil\n      if url == \"\" then url = nil end\n\n      local icons = (ok and decoded and decoded.icon_guide_icons) or nil\n      if type(icons) ~= \"table\" then\n        icons = nil\n      end\n\n      if callback then callback(url, icons) end\n    end,\n    function(_errorMessage, _responseCode)\n      if callback then callback(nil, nil) end\n    end,\n    headers\n  )\nend\n\nfunction onAssetRequestSuccess(content)\n  local data = JSON.decode(content)\n  GameState.debugPrint(\"[SupabaseLib] Found data with timestamp: \" .. data.exported_at)\n\n  -- Store raw data\n  loadedData.exportedAt = data.exported_at\n  loadedData.edition = data.edition\n  loadedData.origins = data.origins or {}\n  loadedData.hexSpirits = data.hex_spirits or {}\n  loadedData.artifacts = data.artifacts or {}\n  loadedData.monsters = data.monsters or {}\n  loadedData.travelers = data.travelers or {}\n  loadedData.travelerQuests = data.traveler_quests or {}\n  loadedData.guardians = data.guardians or {}\n  loadedData.runes = data.runes or {}\n  loadedData.customDice = SupabaseLib.transformDiceData(data.custom_dice or {})\n  loadedData.classes = data.classes or {}\n\n  -- Parse tts_menu (character select background)\n  local ttsMenu = data.tts_menu or {}\n  loadedData.ttsMenu.backgroundUrl = ttsMenu.background_url\n\n\t  -- Parse icon guide image\n\t  loadedData.iconGuideUrl = data.icon_guide_png_url\n\t  loadedData.iconGuideIcons = data.icon_guide_icons or {}\n\t  loadedData.iconGuide = {\n\t    url = loadedData.iconGuideUrl,\n\t    icons = loadedData.iconGuideIcons\n\t  }\n\n\t  -- Parse icon_pool (misc assets, boards, status tokens, resource icons)\n\t  loadedData.iconPool = data.icon_pool or {}\n\n  -- Build token data from icon pool (Arcane Droplets, Avatar Barrier, vp_raw)\n  loadedData.tokens = SupabaseLib.buildTokenDataFromIconPool(loadedData.iconPool)\n\n  -- Notify load complete\n  if onLoadCompleteCallback then\n    onLoadCompleteCallback(loadedData)\n  end\nend\n\nfunction onAssetRequestError(errorMessage, responseCode)\n  printToAll(\"Could not reach host to update assets.\\n(\" .. ASSET_HOST_URL .. \")\")\n  print(errorMessage)\n  print(responseCode)\nend\n\n-------------------------------------------------------------------------------\n-- Data Transformation Functions\n-------------------------------------------------------------------------------\n\n--- Transform raw custom_dice API response into normalized structure\n--- API fields: id, name, description, icon, color, dice_type, prefab_image_url, faces[]\n--- Normalized: id, name, description, icon, color, diceType, imageUrl, faces[]\n---@param rawDice table Array of dice objects from API\n---@return table Transformed dice array\nfunction SupabaseLib.transformDiceData(rawDice)\n  local result = {}\n  for _, dice in ipairs(rawDice) do\n    table.insert(result, {\n      id = dice.id,\n      name = dice.name,\n      description = dice.description,\n      icon = dice.icon,\n      color = dice.color,\n      diceType = dice.dice_type,  -- \"attack\" or \"special\"\n      imageUrl = dice.prefab_image_url,\n      faces = dice.faces or {}\n    })\n  end\n  return result\nend\n\n-------------------------------------------------------------------------------\n-- Data Generation Functions\n-------------------------------------------------------------------------------\n\nfunction SupabaseLib.generateSpiritData(data)\n  data = data or loadedData.hexSpirits\n\n  local regularList = {}\n  local ancientSpiritList = {}\n  local specialList = {}\n\n  for _, tbl in ipairs(data) do\n    -- parse classes\n    local classes = {}\n    for _, v in ipairs(tbl.traits.classes) do\n      classes[v.name] = (classes[v.name] or 0) + 1\n    end\n\n    -- parse origins\n    local origins = {}\n    for _, v in ipairs(tbl.traits.origins) do\n      origins[v.name] = (origins[v.name] or 0) + 1\n    end\n\n    -- generate spirit data\n    local spirit = ObjectTemplateLib.getTemplate(\"Token\")\n    spirit.Nickname = tbl.name\n    spirit.CustomImage.ImageURL = tbl.image_url\n    spirit.Transform.scaleX = 1.58333\n    spirit.Transform.scaleY = 1\n    spirit.Transform.scaleZ = 1.58333\n    spirit.Tags = { \"HexSpirit\" }\n    spirit.GMNotes = JSON.encode({\n      id = tbl.id,\n      cost = tbl.cost,\n      classes = classes,\n      origins = origins\n    })\n\n    if tbl.cost \u003e 10 and tbl.cost \u003c 14 then\n      table.insert(ancientSpiritList, spirit)\n    elseif tbl.cost \u003e 14 then\n      -- double size\n      spirit.Transform.scaleX = spirit.Transform.scaleX * 2\n      spirit.Transform.scaleZ = spirit.Transform.scaleZ * 2\n      table.insert(spirit.Tags, \"SpecialSpirit\")\n      table.insert(specialList, spirit)\n    else\n      table.insert(regularList, spirit)\n    end\n  end\n\n  return regularList, ancientSpiritList, specialList\nend\n\nfunction SupabaseLib.generateArtifactsData(data)\n  data = data or loadedData.artifacts\n\n  local objectList = {\n    basic = {},\n    guardian = {},\n    other = {}\n  }\n\n  for _, tbl in ipairs(data) do\n    local artifact = ObjectTemplateLib.getTemplate(\"Token\")\n    artifact.Nickname = tbl.name\n    artifact.CustomImage.ImageURL = tbl.image_path\n    artifact.Transform.scaleX = 1.5\n    artifact.Transform.scaleY = 1\n    artifact.Transform.scaleZ = 1.5\n    artifact.Tags = { \"Artifact\" }\n    artifact.GMNotes = JSON.encode({ id = tbl.id })\n\n    local artifactType = SupabaseLib.getArtifactType(tbl.tag_names)\n    if artifactType == \"Guardian\" then\n      artifact.Transform.scaleX = artifact.Transform.scaleX * 1.56\n      artifact.Transform.scaleZ = artifact.Transform.scaleZ * 1.56\n    end\n    if artifactType == \"Basic\" then\n      table.insert(objectList.basic, artifact)\n    elseif artifactType == \"Guardian\" then\n      table.insert(objectList.guardian, artifact)\n    else\n      table.insert(objectList.other, artifact)\n    end\n  end\n\n  return objectList\nend\n\nfunction SupabaseLib.generateMonsterData(data)\n  data = data or loadedData.monsters\n\n  local objectList = {}\n\n  for _, tbl in ipairs(data) do\n    local monster = ObjectTemplateLib.getTemplate(\"Card\")\n    monster.Nickname = tbl.name\n    monster.CustomDeck[\"1\"].FaceURL = tbl.image_url\n    monster.CustomDeck[\"1\"].BackURL = tbl.image_url\n    monster.Transform.scaleX = 2.4\n    monster.Transform.scaleY = 1\n    monster.Transform.scaleZ = 2.4\n    monster.Tags = { \"Monster\" }\n    monster.GMNotes = JSON.encode({\n      id = tbl.id,\n      state = tbl.state,\n      barrier = tbl.barrier,\n      damage = tbl.damage\n    })\n    monster.order = tbl.order_num\n\n    table.insert(objectList, monster)\n  end\n\n  table.sort(objectList, function(a, b) return a.order \u003e b.order end)\n  return objectList\nend\n\nfunction SupabaseLib.generateTravelerData(data)\n  data = data or loadedData.travelers\n\n  local objectList = {}\n\n  for _, tbl in ipairs(data) do\n    local traveler = ObjectTemplateLib.getTemplate(\"Card\")\n    traveler.Nickname = tbl.name\n    traveler.CustomDeck[\"1\"].FaceURL = tbl.image_url\n    traveler.CustomDeck[\"1\"].BackURL = tbl.image_url\n    traveler.Transform.scaleX = 3\n    traveler.Transform.scaleY = 1\n    traveler.Transform.scaleZ = 3\n    traveler.Tags = { \"Traveler\" }\n    traveler.GMNotes = JSON.encode({\n      id = tbl.id,\n      state = tbl.state,\n      order_num = tbl.order_num,\n      traveler_subtext = tbl.traveler_subtext,\n      traveler_description = tbl.traveler_description,\n      trade_rows = tbl.trade_rows,\n      gain_rows = tbl.gain_rows,\n      copy_index = tbl.copy_index,\n      total_copies = tbl.total_copies\n    })\n    traveler.order = tbl.order_num or 999\n    traveler.copy_index = tbl.copy_index or 0\n\n    table.insert(objectList, traveler)\n  end\n\n  table.sort(objectList, function(a, b)\n    if a.order == b.order then\n      return (a.copy_index or 0) \u003c (b.copy_index or 0)\n    end\n    return a.order \u003c b.order\n  end)\n\n  return objectList\nend\n\nfunction SupabaseLib.generateTravelerQuestData(data)\n  data = data or loadedData.travelerQuests\n\n  local objectList = {}\n\n  for _, tbl in ipairs(data) do\n    local quest = ObjectTemplateLib.getTemplate(\"Card\")\n    quest.Nickname = tbl.title or tbl.name or \"Traveler Quest\"\n    quest.CustomDeck[\"1\"].FaceURL = tbl.image_url\n    quest.CustomDeck[\"1\"].BackURL = tbl.image_url\n    quest.Transform.scaleX = 2\n    quest.Transform.scaleY = 1\n    quest.Transform.scaleZ = 2\n    quest.Tags = { \"TravelerQuest\" }\n    quest.GMNotes = JSON.encode({\n      id = tbl.id,\n      title = tbl.title,\n      description = tbl.description,\n      reward_text = tbl.reward_text,\n      reward_icons = tbl.reward_icons or tbl.reward_icon_ids,\n      tags = tbl.tags,\n      order_num = tbl.order_num,\n      copy_index = tbl.copy_index,\n      total_copies = tbl.total_copies\n    })\n    quest.order = tbl.order_num or 999\n    quest.copy_index = tbl.copy_index or 0\n\n    table.insert(objectList, quest)\n  end\n\n  table.sort(objectList, function(a, b)\n    if a.order == b.order then\n      return (a.copy_index or 0) \u003c (b.copy_index or 0)\n    end\n    return a.order \u003c b.order\n  end)\n\n  return objectList\nend\n\nfunction SupabaseLib.generateIconData(data)\n  data = data or loadedData.guardians\n\n  local objectList = {}\n\n  for _, tbl in ipairs(data) do\n    if tbl.icon_image_url then\n      local icon = ObjectTemplateLib.getTemplate(\"Tile\")\n      icon.Nickname = tbl.name\n      icon.CustomImage.ImageURL = tbl.icon_image_url\n      icon.CustomImage.CustomTile.Thickness = 0.1\n      icon.ColorDiffuse = { r = 0, g = 0, b = 0 }\n      icon.Transform.scaleX = 0.5\n      icon.Transform.scaleY = 1\n      icon.Transform.scaleZ = 0.5\n      icon.Tags = { \"Icon\" }\n\n      table.insert(objectList, icon)\n    end\n  end\n\n  return objectList\nend\n\nfunction SupabaseLib.generateRuneData(data)\n  data = data or loadedData.runes\n\n  local objectList = {}\n\n  for _, tbl in ipairs(data) do\n    local rune = ObjectTemplateLib.getTemplate(\"Tile\")\n    rune.Nickname = tbl.name\n    rune.CustomImage.ImageURL = tbl.icon_url\n    rune.CustomImage.CustomTile.Type = 2        -- Circle tile type\n    rune.CustomImage.CustomTile.Thickness = 0.2 -- Match existing runes\n    rune.CustomImage.CustomTile.Stretch = true\n    rune.Transform.scaleX = 1\n    rune.Transform.scaleY = 1\n    rune.Transform.scaleZ = 1\n    rune.ColorDiffuse = { r = 0, g = 0, b = 0 } -- Black (matches working runes)\n    rune.Tags = { \"Rune\" }\n    rune.GMNotes = JSON.encode({\n      id = tbl.id,\n      type = tbl.type,\n      originId = tbl.origin_id,\n      classId = tbl.class_id\n    })\n\n    table.insert(objectList, rune)\n  end\n\n  return objectList\nend\n\nfunction SupabaseLib.generateOriginDestinyData(data)\n  data = data or loadedData.origins\n  local originDestinyList = {}\n\n  for _, origin in ipairs(data) do\n    -- Only include origins with enabled origin destiny (calling_card in DB) AND an associated hex spirit\n    if origin.calling_card\n       and origin.calling_card.enabled\n       and origin.calling_orb_image_url\n       and origin.associated_hex_spirit\n       and origin.associated_hex_spirit.image_url then\n\n      -- Parse classes from associated hex spirit\n      local classes = {}\n      if origin.associated_hex_spirit.traits and origin.associated_hex_spirit.traits.classes then\n        for _, v in ipairs(origin.associated_hex_spirit.traits.classes) do\n          classes[v.name] = (classes[v.name] or 0) + 1\n        end\n      end\n\n      -- Parse origins from associated hex spirit\n      local origins = {}\n      if origin.associated_hex_spirit.traits and origin.associated_hex_spirit.traits.origins then\n        for _, v in ipairs(origin.associated_hex_spirit.traits.origins) do\n          origins[v.name] = (origins[v.name] or 0) + 1\n        end\n      end\n\n      -- Create origin destiny orb token (HexSpirit tag for mat snapping, OriginDestiny for detection)\n      local destinyOrb = ObjectTemplateLib.getTemplate(\"Token\")\n      destinyOrb.Nickname = origin.name .. \" Origin Destiny\"\n      destinyOrb.CustomImage.ImageURL = origin.calling_orb_image_url\n      destinyOrb.Transform.scaleX = 1.58333\n      destinyOrb.Transform.scaleY = 1\n      destinyOrb.Transform.scaleZ = 1.58333\n      destinyOrb.Tags = { \"HexSpirit\", \"OriginDestiny\" }\n      destinyOrb.GMNotes = JSON.encode({\n        id = origin.id,\n        originName = origin.name,\n        type = \"originDestinyOrb\",\n        -- Store Arcane Spirit data for spawning on completion\n        arcaneSpirit = {\n          id = origin.associated_hex_spirit.id,\n          name = origin.associated_hex_spirit.name,\n          imageUrl = origin.associated_hex_spirit.image_url,\n          cost = origin.associated_hex_spirit.cost,\n          classes = classes,\n          origins = origins\n        }\n      })\n      table.insert(originDestinyList, destinyOrb)\n      -- NOTE: Arcane Spirits are NOT added to any bag - they only spawn via Spirit Fusion animation\n    end\n  end\n\n  return originDestinyList\nend\n\n-------------------------------------------------------------------------------\n-- Helper Functions\n-------------------------------------------------------------------------------\n\nfunction SupabaseLib.getArtifactType(list)\n  for _, tag in ipairs(list) do\n    if tag == \"Basic\" or tag == \"Guardian\" then return tag end\n  end\n  return \"Other\"\nend\n\nfunction SupabaseLib.getSpiritBagUrl()\n  local asset = SupabaseLib.getIconByName(\"draw_spirit_bag\")\n  return asset and asset.image_url or nil\nend\n\nfunction SupabaseLib.getSpiritWorldUrl()\n  local spiritWorld = SupabaseLib.getIconByName(\"SpiritWorld\")\n  if spiritWorld and spiritWorld.image_url then\n    return spiritWorld.image_url\n  end\n\n  local byTag = SupabaseLib.getIconsByTag(\"spirit_world\")\n  if byTag[1] then\n    return byTag[1].image_url\n  end\n  return nil\nend\n\nfunction SupabaseLib.getIconByName(name)\n  for _, entry in ipairs(loadedData.iconPool) do\n    if entry.name == name then\n      return entry\n    end\n  end\n  return nil\nend\n\nfunction SupabaseLib.getIconsByTag(tag)\n  local results = {}\n  for _, entry in ipairs(loadedData.iconPool) do\n    local tags = entry.tags or {}\n    for _, entryTag in ipairs(tags) do\n      if entryTag == tag then\n        table.insert(results, entry)\n        break\n      end\n    end\n  end\n  return results\nend\n\nfunction SupabaseLib.getStatusTokens()\n  local statusTokens = {}\n  for _, status in ipairs(SupabaseLib.getIconsByTag(\"status\")) do\n    table.insert(statusTokens, {\n      name = status.name,\n      imageUrl = status.image_url\n    })\n  end\n  -- Sort by name in reverse order (fallen -\u003e corrupt -\u003e tainted -\u003e purified)\n  table.sort(statusTokens, function(a, b) return a.name \u003e b.name end)\n  return statusTokens\nend\n\nfunction SupabaseLib.getStatusTokensByLevel()\n  local statusTokens = {}\n  for _, status in ipairs(SupabaseLib.getIconsByTag(\"status\")) do\n    local level = tonumber(string.match(status.name, \"status_(%d+)_\"))\n    if level then\n      local label = string.match(status.name, \"status_%d+_(%w+)\")\n      if label then\n        label = label:sub(1, 1):upper() .. label:sub(2)\n      else\n        label = \"Status\"\n      end\n      statusTokens[level] = {\n        name = label,\n        imageUrl = status.image_url\n      }\n    end\n  end\n  return statusTokens\nend\n\nfunction SupabaseLib.getFallenAssets()\n  local fallenAssets = {}\n  for _, fallen in ipairs(loadedData.iconPool) do\n    if string.match(fallen.name or \"\", \"^fallen_\") then\n      table.insert(fallenAssets, {\n        name = fallen.name,\n        imageUrl = fallen.image_url\n      })\n    end\n  end\n  -- Sort by name for consistent ordering\n  table.sort(fallenAssets, function(a, b) return a.name \u003c b.name end)\n  return fallenAssets\nend\n\nfunction SupabaseLib.getMiscAssets()\n  return loadedData.iconPool\nend\n\nfunction SupabaseLib.getTokens()\n  return loadedData.tokens\nend\n\n--- Build token data list from icon pool entries\n---@param iconPool table Array of icon pool entries\n---@return table Array of token data entries\nfunction SupabaseLib.buildTokenDataFromIconPool(iconPool)\n  local tokenNames = {\n    [\"Arcane Droplets\"] = true,\n    [\"Avatar Barrier\"] = true,\n    [\"vp_raw\"] = true,\n    [\"1royal\"] = true,\n    [\"3royal\"] = true,\n    [\"arcane_barrier\"] = true\n  }\n\n  local tokens = {}\n  for _, entry in ipairs(iconPool or {}) do\n    if tokenNames[entry.name] and entry.image_url then\n      table.insert(tokens, {\n        id = entry.id,\n        name = entry.name,\n        source_type = entry.source_type,\n        image_url = entry.image_url\n      })\n    end\n  end\n\n  return tokens\nend\n\n--- Generate token bag data for each token in the tokens array\n--- Each token becomes a separate infinite bag containing that token\n--- Uses Custom_Tile format to match playermat tokens\n---@return table Array of { name, token } for each token bag\nfunction SupabaseLib.generateTokenBagsData()\n  local tokenBags = {}\n\n  for _, tokenData in ipairs(loadedData.tokens) do\n    -- Determine tags based on token type\n    -- Avatar Barrier keeps the \"Barrier\" tag for compatibility\n    local tags = { \"GameToken\" }\n    if tokenData.name == \"Avatar Barrier\" or tokenData.name == \"arcane_barrier\" then\n      tags = { \"Barrier\", \"GameToken\" }\n    end\n\n    -- Create the token as a Custom_Tile (matching barrier tokens on mats)\n    local token = {\n      Name = \"Custom_Tile\",\n      Nickname = tokenData.name,\n      Transform = {\n        posX = 0, posY = 0, posZ = 0,\n        rotX = 0, rotY = 180, rotZ = 0,\n        scaleX = 0.8, scaleY = 1, scaleZ = 0.8\n      },\n      Tags = tags,\n      Locked = false,\n      Snap = true,\n      Sticky = true,\n      Grid = true,\n      Autoraise = true,\n      ColorDiffuse = { r = 0, g = 0, b = 0 },\n      CustomImage = {\n        ImageURL = tokenData.image_url,\n        ImageSecondaryURL = \"\",\n        ImageScalar = 1,\n        WidthScale = 0,\n        CustomTile = {\n          Type = 2,\n          Thickness = 0.2,\n          Stackable = false,\n          Stretch = true\n        }\n      },\n      GMNotes = JSON.encode({\n        id = tokenData.id,\n        name = tokenData.name,\n        sourceType = tokenData.source_type\n      })\n    }\n\n    table.insert(tokenBags, {\n      name = tokenData.name,\n      token = token\n    })\n  end\n\n  return tokenBags\nend\n\n--- Get a token by name from the tokens array\n---@param name string The token name to find\n---@return table|nil The token data or nil if not found\nfunction SupabaseLib.getTokenByName(name)\n  for _, token in ipairs(loadedData.tokens) do\n    if token.name == name then\n      return token\n    end\n  end\n  return nil\nend\n\n-------------------------------------------------------------------------------\n-- Character/Guardian Data Helpers\n-------------------------------------------------------------------------------\n\nfunction SupabaseLib.buildCharacterData()\n  local availableCharacters = {}\n  local characterMatData = {}\n\n  for _, tbl in ipairs(loadedData.guardians) do\n    if tbl.name and tbl.mat_image_url then\n      table.insert(availableCharacters, tbl.name)\n      characterMatData[tbl.name] = {\n        imageUrl = tbl.mat_image_url,\n        chibiUrl = tbl.chibi_image_url,\n        iconUrl = tbl.icon_image_url,\n        originName = tbl.origin_name,\n        -- Character select URLs\n        charSelectUrl = tbl.char_select_url,\n        charSelectRedUrl = tbl.char_select_red_url,\n        charSelectOrangeUrl = tbl.char_select_orange_url,\n        charSelectYellowUrl = tbl.char_select_yellow_url,\n        charSelectGreenUrl = tbl.char_select_green_url,\n        charSelectBlueUrl = tbl.char_select_blue_url,\n        charSelectPurpleUrl = tbl.char_select_purple_url\n      }\n    end\n  end\n\n  GameState.debugPrint(\"[SupabaseLib] Loaded \" .. #availableCharacters .. \" playable characters: \" .. table.concat(availableCharacters, \", \"))\n\n  return availableCharacters, characterMatData\nend\n\nreturn SupabaseLib\nend)\n__bundle_register(\"api/WebRequestLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\ndo\n  local WebRequestLib = {}\n\n  -- This function encapsulates the entire request logic, providing distinct\n  -- success and error callbacks that directly receive the processed data or error.\n  ---@param uri table|string The URL for the GET request.\n  ---@param onSuccess fun(content: string) Called when the request is successful.\n  ---@param onError fun(errorMessage: string, responseCode: number|nil) Called when an error occurs (either network or HTTP error).\n  ---@param headers table|nil Optional headers to include in the request.\n  function WebRequestLib.get(uri, onSuccess, onError, headers)\n    -- Format URI if it's a table (e.g., {\"api\", \"data\"} -\u003e \"api/data\")\n    if type(uri) == \"table\" then\n      uri = table.concat(uri, \"/\")\n    end\n\n    -- Use custom request if headers provided, otherwise use simple get\n    local function handleResponse(requestInstance)\n      if requestInstance.is_error then\n        -- Network level error\n        local errorMessage = requestInstance.error or \"Unknown network error\"\n        if onError then\n          onError(errorMessage)\n        end\n      elseif requestInstance.response_code and requestInstance.response_code \u003e= 400 then\n        -- HTTP error (4xx or 5xx status codes)\n        local errorMessage = \"HTTP Error \" ..\n        requestInstance.response_code .. \": \" .. (requestInstance.text or \"No error message provided.\")\n        if onError then\n          onError(errorMessage, requestInstance.response_code)\n        end\n      else\n        -- Successful request (2xx or 3xx status codes)\n        if onSuccess then\n          onSuccess(requestInstance.text)\n        end\n      end\n    end\n\n    if headers then\n      WebRequest.custom(uri, \"GET\", true, \"\", headers, handleResponse)\n    else\n      WebRequest.get(uri, handleResponse)\n    end\n  end\n\n  --- POST request with JSON body\n  ---@param uri table|string The URL for the POST request.\n  ---@param body table|string The request body (table will be JSON-encoded).\n  ---@param onSuccess fun(content: string) Called when the request is successful.\n  ---@param onError fun(errorMessage: string, responseCode: number|nil) Called when an error occurs.\n  ---@param headers table|nil Optional additional headers to include.\n  function WebRequestLib.post(uri, body, onSuccess, onError, headers)\n    -- Format URI if it's a table\n    if type(uri) == \"table\" then\n      uri = table.concat(uri, \"/\")\n    end\n\n    -- JSON-encode body if it's a table\n    local bodyStr = body\n    if type(body) == \"table\" then\n      bodyStr = JSON.encode(body)\n    end\n\n    -- Build headers with Content-Type\n    local requestHeaders = { [\"Content-Type\"] = \"application/json\" }\n    if headers then\n      for k, v in pairs(headers) do\n        requestHeaders[k] = v\n      end\n    end\n\n    local function handleResponse(requestInstance)\n      if requestInstance.is_error then\n        local errorMessage = requestInstance.error or \"Unknown network error\"\n        if onError then\n          onError(errorMessage)\n        end\n      elseif requestInstance.response_code and requestInstance.response_code \u003e= 400 then\n        local errorMessage = \"HTTP Error \" ..\n          requestInstance.response_code .. \": \" .. (requestInstance.text or \"No error message provided.\")\n        if onError then\n          onError(errorMessage, requestInstance.response_code)\n        end\n      else\n        if onSuccess then\n          onSuccess(requestInstance.text)\n        end\n      end\n    end\n\n    WebRequest.custom(uri, \"POST\", true, bodyStr, requestHeaders, handleResponse)\n  end\n\n  return WebRequestLib\nend\nend)\n__bundle_register(\"game/CharacterSelectLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-- CharacterSelectLib.ttslua\n-- Module for character selection and playermat spawning logic\n\nlocal CharacterSelectLib = {}\n\nlocal GameState = require(\"state/GameState\")\nlocal UtilLib = require(\"util/UtilLib\")\nlocal PlayerMatLib = require(\"game/PlayerMatLib\")\nlocal UILib = require(\"ui/UILib\")\nlocal ObjectTemplateLib = require(\"util/ObjectTemplateLib\")\nlocal SupabaseLib = require(\"api/SupabaseLib\")\nlocal AssetLoaderLib = require(\"api/AssetLoaderLib\")\nlocal TravelerLib = require(\"game/TravelerLib\")\n\n-------------------------------------------------------------------------------\n-- MARK: Constants\n-------------------------------------------------------------------------------\n\n-- Token spawn configuration\n-- Snap positions are centralized in PlayerMatLib - use PlayerMatLib.getSnapPositions()\n\n-- Spirit World data (from objects/*.json)\n-- Note: imageUrl is fetched from API via SupabaseLib.getSpiritWorldUrl()\nlocal SPIRIT_WORLD_DATA = {\n  position = { x = 0, y = 0.981, z = 0 },\n  rotation = { x = 0, y = 270, z = 0 },\n  scale = { x = 20.1, y = 1, z = 20.1 },\n  snapPoints = {\n    { pos = { x = 0.302, y = 0.2, z = 0 }, rot = { x = 0, y = 90, z = 0 } },\n    { pos = { x = 0.151, y = 0.2, z = -0.261 }, rot = { x = 0, y = 150, z = 0 } },\n    { pos = { x = -0.151, y = 0.2, z = -0.261 }, rot = { x = 0, y = 210, z = 0 } },\n    { pos = { x = -0.302, y = 0.2, z = 0 }, rot = { x = 0, y = 270, z = 0 } },\n    { pos = { x = -0.151, y = 0.2, z = 0.261 }, rot = { x = 0, y = 330, z = 0 } },\n    { pos = { x = 0.151, y = 0.2, z = 0.261 }, rot = { x = 0, y = 30, z = 0 } }\n  }\n}\n\n-------------------------------------------------------------------------------\n-- MARK: Character Selection Functions\n-------------------------------------------------------------------------------\n\n-- Valid player colors that have mat positions defined\nlocal VALID_PLAYER_COLORS = {\n  Red = true,\n  Orange = true,\n  Yellow = true,\n  Green = true,\n  Blue = true,\n  Purple = true\n}\n\nfunction CharacterSelectLib.selectCharacter(player, value, id)\n  if GameState.gameStarted then\n    broadcastToColor(\"Game has already started!\", player.color, Color.Red)\n    return\n  end\n\n  local playerColor = player.color\n\n  -- Validate player color has a mat position\n  if not VALID_PLAYER_COLORS[playerColor] then\n    broadcastToColor(\"Please sit in a valid seat (Red, Orange, Yellow, Green, Blue, or Purple) to select a character.\", playerColor, Color.Orange)\n    return\n  end\n\n  -- Extract character name from button id (btn_char_Myrtle -\u003e Myrtle)\n  local charName = string.match(id, \"btn_char_(.+)\")\n  if not charName then return end\n\n  -- Check if player is clicking their already selected character (deselect)\n  local currentSelection = GameState.selectedCharacters[playerColor]\n  if currentSelection == charName then\n    GameState.selectedCharacters[playerColor] = nil\n    broadcastToAll(UtilLib.getColoredName(playerColor) .. \" deselected \" .. charName)\n    return true  -- Signal that UI needs refresh\n  end\n\n  -- Check if this character is already taken by another player\n  for otherColor, selectedChar in pairs(GameState.selectedCharacters) do\n    if selectedChar == charName and otherColor ~= playerColor then\n      broadcastToColor(charName .. \" is already selected by \" .. otherColor, playerColor, Color.Orange)\n      return\n    end\n  end\n\n  -- If player already had a different character, note it for the message\n  local previousChar = currentSelection\n\n  -- Assign new character\n  GameState.selectedCharacters[playerColor] = charName\n\n  -- Announce selection\n  if previousChar then\n    broadcastToAll(UtilLib.getColoredName(playerColor) .. \" switched from \" .. previousChar .. \" to \" .. charName)\n  else\n    broadcastToAll(UtilLib.getColoredName(playerColor) .. \" selected \" .. charName)\n  end\n\n  -- Refresh the UI to show updated selections\n  -- Note: This should call a UI refresh function in Global or UILib\n  return true  -- Signal that UI needs refresh\nend\n\nfunction CharacterSelectLib.startGame(player)\n  if GameState.gameStarted then\n    broadcastToColor(\"Game has already started!\", player.color, Color.Red)\n    return\n  end\n\n  -- Check if at least one player has selected a character\n  local selectionCount = 0\n  local selectionList = {}\n  for playerColor, charName in pairs(GameState.selectedCharacters) do\n    selectionCount = selectionCount + 1\n    table.insert(selectionList, playerColor .. \" → \" .. charName)\n  end\n\n  GameState.debugPrint(\"[CharSelect] Starting game with \" .. selectionCount .. \" players\")\n\n  if selectionCount == 0 then\n    broadcastToAll(\"At least one player must select a character!\", Color.Red)\n    return\n  end\n\n  GameState.gameStarted = true\n  GameState.generateGameId()\n\n  -- Announce what's being spawned\n  broadcastToAll(\"Starting game with \" .. selectionCount .. \" players...\", Color.Green)\n  for _, entry in ipairs(selectionList) do\n    broadcastToAll(\"  \" .. entry, Color.White)\n  end\n\n  -- STEP 1: Spawn ALL game bags (spirits, artifacts, monsters, runes, etc.)\n  -- This is the ONLY place that spawns asset bags\n  AssetLoaderLib.loadAllAssets(SupabaseLib.getData(), { preload = false })\n\n  -- STEP 2: Spawn Spirit World map\n  CharacterSelectLib.spawnSpiritWorld()\n\n  -- STEP 2b: Spawn the first traveler card (rotation starts here)\n  Wait.frames(function()\n    TravelerLib.ensureTravelerOnBoard()\n  end, 10)\n\n  -- STEP 3: Spawn playermats for each player who selected a character\n  CharacterSelectLib.spawnSelectedPlayermats()\n\n  -- STEP 4: Spawn status tokens for selected players\n  CharacterSelectLib.spawnTokensForSelectedPlayers()\n\n  broadcastToAll(\"Spawning game board, player mats, and tokens...\", Color.Green)\n\n  return true  -- Signal that game has started and UI needs refresh\nend\n\nfunction CharacterSelectLib.spawnSelectedPlayermats()\n  -- Build a list of mats to spawn with their data\n  local matsToSpawn = {}\n  for playerColor, charName in pairs(GameState.selectedCharacters) do\n    local posData = GameState.PLAYERMAT_POSITIONS[playerColor]\n    if posData then\n      table.insert(matsToSpawn, {\n        playerColor = playerColor,\n        charName = charName,\n        pos = Vector(posData.pos.x, posData.pos.y, posData.pos.z),\n        rot = Vector(posData.rot.x, posData.rot.y, posData.rot.z)\n      })\n    else\n      broadcastToAll(\"Warning: No mat position defined for \" .. playerColor, \"Orange\")\n    end\n  end\n\n  broadcastToAll(\"Spawning \" .. #matsToSpawn .. \" mats...\", \"Green\")\n\n  -- Spawn mats with staggered delays\n  for i, matInfo in ipairs(matsToSpawn) do\n    local delay = (i - 1) * 10\n\n    local capturedColor = matInfo.playerColor\n    local capturedChar = matInfo.charName\n    local capturedPos = matInfo.pos\n    local capturedRot = matInfo.rot\n\n    Wait.frames(function()\n      CharacterSelectLib.spawnPlayermatForCharacter(capturedChar, capturedPos, capturedRot, capturedColor)\n    end, delay)\n  end\nend\n\nfunction CharacterSelectLib.spawnPlayermatForCharacter(charName, position, rotation, playerColor)\n  broadcastToAll(playerColor .. \": Spawning \" .. charName .. \" at (\" .. position.x .. \", \" .. position.y .. \", \" .. position.z .. \")\", \"Yellow\")\n\n  local charData = GameState.characterMatData[charName]\n  local imageUrl = charData and charData.imageUrl or \"\"\n  local chibiUrl = charData and charData.chibiUrl or \"\"\n\n  local matData = {\n    Name = \"Custom_Tile\",\n    Transform = {\n      posX = position.x,\n      posY = position.y,\n      posZ = position.z,\n      rotX = rotation.x,\n      rotY = rotation.y,\n      rotZ = rotation.z,\n      scaleX = 9.5,\n      scaleY = 1,\n      scaleZ = 9.5\n    },\n    Nickname = charName,\n    Locked = true,\n    Tags = { \"Playermat\" },\n    ColorDiffuse = { r = 0, g = 0, b = 0 },\n    CustomImage = {\n      ImageURL = imageUrl,\n      ImageScalar = 1,\n      WidthScale = 0,\n      CustomTile = {\n        Type = 0,\n        Thickness = 0.1,\n        Stackable = false,\n        Stretch = true\n      }\n    },\n    -- Attach snap points from centralized configuration\n    AttachedSnapPoints = PlayerMatLib.generateSnapPointsData()\n  }\n\n  local spawnedObj = spawnObjectData({ data = matData })\n\n  -- Register the mat with PlayerMatLib after it's fully spawned and set up rune slot UI\n  if playerColor and spawnedObj then\n    Wait.frames(function()\n      PlayerMatLib.registerPlayerMat(playerColor, spawnedObj)\n      UILib.setupRuneSlotsOnMat(spawnedObj, playerColor)\n    end, 10)\n  end\n\n  -- Spawn the chibi figurine for this character\n  if chibiUrl and chibiUrl ~= \"\" then\n    CharacterSelectLib.spawnFigurineForMat(charName, chibiUrl, position, rotation, playerColor)\n  end\nend\n\n--- Spawn a chibi figurine for a player mat\n---@param charName string Character name\n---@param chibiUrl string URL for the chibi image\n---@param matPosition Vector Mat position\n---@param matRotation Vector Mat rotation\n---@param playerColor string Player color\nfunction CharacterSelectLib.spawnFigurineForMat(charName, chibiUrl, matPosition, matRotation, playerColor)\n  local figurineData = ObjectTemplateLib.getTemplate(\"Figurine\")\n  figurineData.Nickname = charName .. \" Figurine\"\n  figurineData.Tags = { \"PlayerFigurine\" }\n  figurineData.CustomImage.ImageURL = chibiUrl\n  figurineData.CustomImage.ImageSecondaryURL = chibiUrl  -- Same image for back\n\n  -- Position figurine offset from mat center (in local coordinates, then convert)\n  -- Local position from TTS positionToLocal (already accounts for mat scale of 9.5)\n  local localOffset = Vector(-1.233, 0.351, -0.488)\n  local MAT_SCALE = 9.5\n\n  -- Convert local offset to world offset based on mat rotation and scale\n  -- Negate angle for TTS's clockwise-positive rotation convention\n  local scaledX = localOffset.x * MAT_SCALE\n  local scaledZ = localOffset.z * MAT_SCALE\n  local radY = math.rad(-matRotation.y)\n  local worldOffsetX = scaledX * math.cos(radY) - scaledZ * math.sin(radY)\n  local worldOffsetZ = scaledX * math.sin(radY) + scaledZ * math.cos(radY)\n\n  figurineData.Transform.posX = matPosition.x + worldOffsetX\n  figurineData.Transform.posY = matPosition.y + localOffset.y\n  figurineData.Transform.posZ = matPosition.z + worldOffsetZ\n  figurineData.Transform.rotX = 0\n  figurineData.Transform.rotY = matRotation.y\n  figurineData.Transform.rotZ = 0\n  figurineData.Transform.scaleX = 1.5\n  figurineData.Transform.scaleY = 1.5\n  figurineData.Transform.scaleZ = 1.5\n\n  spawnObjectData({ data = figurineData })\nend\n\n--- Convert local position to world position using mat position and rotation\n--- TTS/Unity uses left-handed coordinates where positive Y rotation is clockwise\nlocal MAT_SCALE = 9.5\nlocal function localToWorld(localPos, matPosition, matRotation)\n  local scaledX = localPos.x * MAT_SCALE\n  local scaledZ = localPos.z * MAT_SCALE\n  -- Negate angle for TTS's clockwise-positive rotation convention\n  local radY = math.rad(-matRotation.y)\n  local worldOffsetX = scaledX * math.cos(radY) - scaledZ * math.sin(radY)\n  local worldOffsetZ = scaledX * math.sin(radY) + scaledZ * math.cos(radY)\n  return Vector(\n    matPosition.x + worldOffsetX,\n    matPosition.y + localPos.y,\n    matPosition.z + worldOffsetZ\n  )\nend\n\nlocal function clearStatusTokensForPlayer(playerColor)\n  for _, obj in ipairs(getObjectsWithTag(\"Status\")) do\n    if PlayerMatLib.findPlayerColorForPosition(obj.getPosition()) == playerColor then\n      obj.destruct()\n    end\n  end\nend\n\n--- Spawn the current status token for a player (single token)\n--- Uses status token data from Supabase (different images for each token)\n--- Uses centralized snap positions from PlayerMatLib\n---@param playerColor string Player color for logging\n---@param matPosition Vector Mat world position\n---@param matRotation Vector Mat rotation\nfunction CharacterSelectLib.spawnStatusTokenForPlayer(playerColor, matPosition, matRotation)\n  local statusLevel = PlayerMatLib.getStatus(playerColor)\n  local statusTokens = GameState.statusTokens\n  if not statusTokens or not statusTokens[statusLevel] then\n    statusTokens = SupabaseLib.getStatusTokensByLevel()\n    GameState.statusTokens = statusTokens\n  end\n\n  local statusToken = statusTokens[statusLevel]\n  if not statusToken or not statusToken.imageUrl then\n    GameState.debugPrint(\"[CharacterSelectLib] Warning: Status token not found for level \" .. tostring(statusLevel))\n    return\n  end\n\n  clearStatusTokensForPlayer(playerColor)\n\n  local statusPositions = PlayerMatLib.getSnapPositions(\"Status\")\n  local basePos = statusPositions[1]  -- Status has only 1 base position\n  local localPos = Vector(basePos.x, basePos.y, basePos.z)\n  local worldPos = localToWorld(localPos, matPosition, matRotation)\n\n  local tags = { \"Status\" }\n  if statusToken.name and statusToken.name ~= \"\" then\n    table.insert(tags, statusToken.name)\n  end\n\n  local tokenData = {\n    Name = \"Custom_Token\",\n    Transform = {\n      posX = worldPos.x,\n      posY = worldPos.y,\n      posZ = worldPos.z,\n      rotX = 0,\n      rotY = matRotation.y,\n      rotZ = 0,\n      scaleX = 2.35,\n      scaleY = 1,\n      scaleZ = 2.35\n    },\n    Nickname = statusToken.name or \"Status\",\n    Tags = tags,\n    Locked = false,\n    ColorDiffuse = { r = 1, g = 1, b = 1 },\n    CustomImage = {\n      ImageURL = statusToken.imageUrl,\n      ImageScalar = 1,\n      WidthScale = 0,\n      CustomToken = {\n        Thickness = 0.2,\n        MergeDistancePixels = 25,\n        StandUp = false,\n        Stackable = false\n      }\n    }\n  }\n\n  spawnObjectData({ data = tokenData })\nend\n\n--- Update the status token for a player (replaces existing token)\n---@param playerColor string Player color for logging\nfunction CharacterSelectLib.updateStatusToken(playerColor)\n  local matObject = PlayerMatLib.getPlayerMatObject(playerColor)\n  if matObject then\n    CharacterSelectLib.spawnStatusTokenForPlayer(playerColor, matObject.getPosition(), matObject.getRotation())\n    return\n  end\n\n  local posData = GameState.PLAYERMAT_POSITIONS[playerColor]\n  if posData then\n    local matPosition = Vector(posData.pos.x, posData.pos.y, posData.pos.z)\n    local matRotation = Vector(posData.rot.x, posData.rot.y, posData.rot.z)\n    CharacterSelectLib.spawnStatusTokenForPlayer(playerColor, matPosition, matRotation)\n  end\nend\n\nfunction CharacterSelectLib.spawnTokensForSelectedPlayers()\n  -- Wait 1 second for mats to be fully spawned\n  Wait.time(function()\n\n    -- Spawn tokens for each selected player using known mat positions\n    local playerIndex = 0\n    for playerColor, _ in pairs(GameState.selectedCharacters) do\n      local posData = GameState.PLAYERMAT_POSITIONS[playerColor]\n\n      if posData then\n        local matPosition = Vector(posData.pos.x, posData.pos.y, posData.pos.z)\n        local matRotation = Vector(posData.rot.x, posData.rot.y, posData.rot.z)\n        playerIndex = playerIndex + 1\n\n        -- Stagger token spawning per player\n        local baseDelay = (playerIndex - 1) * 20\n\n        Wait.frames(function()\n          CharacterSelectLib.spawnStatusTokenForPlayer(playerColor, matPosition, matRotation)\n        end, baseDelay)\n      end\n    end\n\n  end, 1)  -- 1 second delay\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Spirit World Spawning\n-------------------------------------------------------------------------------\n\n--- Spawn the Spirit World map tile at center of table\nfunction CharacterSelectLib.spawnSpiritWorld()\n  local sw = SPIRIT_WORLD_DATA\n\n  -- Get image URL from icon pool\n  local imageUrl = SupabaseLib.getSpiritWorldUrl()\n\n  if not imageUrl or imageUrl == \"\" then\n    GameState.debugPrint(\"[CharacterSelectLib] Warning: SpiritWorld image URL not found in API data\")\n    return\n  end\n\n  GameState.debugPrint(\"[CharacterSelectLib] Spawning SpiritWorld with URL: \" .. imageUrl)\n\n  -- Build snap points array\n  local snapPoints = {}\n  for _, sp in ipairs(sw.snapPoints) do\n    table.insert(snapPoints, {\n      Position = { x = sp.pos.x, y = sp.pos.y, z = sp.pos.z },\n      Rotation = { x = sp.rot.x, y = sp.rot.y, z = sp.rot.z },\n      Tags = { \"HexSpirit\" }\n    })\n  end\n\n  local spiritWorldData = {\n    Name = \"Custom_Tile\",\n    Nickname = \"SpiritWorld\",\n    Transform = {\n      posX = sw.position.x,\n      posY = sw.position.y,\n      posZ = sw.position.z,\n      rotX = sw.rotation.x,\n      rotY = sw.rotation.y,\n      rotZ = sw.rotation.z,\n      scaleX = sw.scale.x,\n      scaleY = sw.scale.y,\n      scaleZ = sw.scale.z\n    },\n    Locked = true,\n    Tags = { \"NotInteractable\" },\n    ColorDiffuse = { r = 0, g = 0, b = 0 },\n    CustomImage = {\n      ImageURL = imageUrl,\n      ImageScalar = 1,\n      WidthScale = 0,\n      CustomTile = {\n        Type = 0,\n        Thickness = 0.2,\n        Stackable = false,\n        Stretch = true\n      }\n    },\n    AttachedSnapPoints = snapPoints\n  }\n\n  spawnObjectData({ data = spiritWorldData })\nend\n\nreturn CharacterSelectLib\nend)\n__bundle_register(\"game/DiceLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- DiceLib: Class breakpoint information\n-- Provides dice data for class breakpoints display only\n-- All automatic dice spawning and rolling has been removed\n-------------------------------------------------------------------------------\n\nlocal GameState = require(\"state/GameState\")\n\nlocal DiceLib = {}\n\n-------------------------------------------------------------------------------\n-- Public API Functions\n-------------------------------------------------------------------------------\n\n--- Gets dice effects for a class at a given trait count\n--- Returns the effects array from the highest breakpoint where count \u003c= traitCount\n--- Used for displaying class breakpoints in the UI\n---@param className string The class name\n---@param traitCount number The trait count\n---@return table effects array or empty table\nfunction DiceLib.getDiceForClass(className, traitCount)\n  local classData = GameState.classesByName[className]\n  if not classData or not classData.effect_schema then\n    return {}\n  end\n\n  -- Find the highest breakpoint where count \u003c= traitCount\n  local bestBreakpoint = nil\n  for _, breakpoint in ipairs(classData.effect_schema) do\n    if breakpoint.count \u003c= traitCount then\n      if not bestBreakpoint or breakpoint.count \u003e bestBreakpoint.count then\n        bestBreakpoint = breakpoint\n      end\n    end\n  end\n\n  return bestBreakpoint and bestBreakpoint.effects or {}\nend\n\n--- Gets dice name by ID from the API data\n--- Used for displaying breakpoint effects\n---@param diceId string The dice ID from API\n---@return string|nil diceName The dice name or nil if not found\nfunction DiceLib.getDiceNameById(diceId)\n  local diceData = GameState.diceById[diceId]\n  return diceData and diceData.name or nil\nend\n\nreturn DiceLib\nend)\n__bundle_register(\"game/MarketLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- MARK: MarketLib\n-- Spirit market logic\n-------------------------------------------------------------------------------\n\nlocal MarketLib = {}\n\n-- Dependencies\nlocal GameState = require(\"state/GameState\")\nlocal SearchLib = require(\"util/SearchLib\")\n\n-------------------------------------------------------------------------------\n-- MARK: Helper Functions\n-------------------------------------------------------------------------------\n\n-- Helper function to get object by name\nlocal function getObjectByName(name)\n  for _, obj in ipairs(getObjects()) do\n    if obj.getName() == name then\n      return obj\n    end\n  end\n  return nil\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Market Functions\n-------------------------------------------------------------------------------\n\n-- Refills the market of Spirit World spirits, skipping full spots\nfunction MarketLib.refillSpirits(_, playerColor)\n  local bag = getObjectByName(\"Spirit World Bag\")\n  if not bag then\n    printToAll(\"Spirit World Bag not found!\", \"Red\")\n    return\n  end\n\n  local neededRefill = false\n  local shuffled = false\n\n  for i, pos in ipairs(GameState.MARKET_SPIRIT_POSITIONS) do\n    local searchResult = SearchLib.atPosition(pos, \"isHexSpirit\")\n    if #searchResult == 0 then\n      if not shuffled then\n        bag.shuffle()\n        shuffled = true\n      end\n      bag.takeObject({ position = pos, rotation = Vector(0, (i - 1) * 60, 0) })\n      neededRefill = true\n    end\n  end\n\n  if not neededRefill and playerColor then\n    broadcastToColor(\"There are already 6 spirits placed.\", playerColor, \"Orange\")\n  end\nend\n\nreturn MarketLib\nend)\n__bundle_register(\"game/NavigationLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-- NavigationLib: Realm Navigation Logic\n-- Handles player realm navigation selections and UI updates\n\nlocal GameState = require(\"state/GameState\")\nlocal GameSyncLib = require(\"api/GameSyncLib\")\nlocal UtilLib = require(\"util/UtilLib\")\nlocal UITheme = require(\"ui/UITheme\")\n\nlocal NavigationLib = {}\n\n-- Constants for UI layout\nlocal PLAYER_ROW_HEIGHT = 28\nlocal BASE_PANEL_HEIGHT = 70  -- Button + header\n\nlocal function isValidPlayerColor(playerColor)\n  for _, validColor in ipairs(UITheme.validPlayerColors) do\n    if playerColor == validColor then\n      return true\n    end\n  end\n  return false\nend\n\n-------------------------------------------------------------------------------\n-- Navigation Functions\n-------------------------------------------------------------------------------\n\n-- Opens navigation selector for a player to choose their realm destination\n-- Uses XML UI panel instead of showOptionsDialog for multiplayer support\nfunction NavigationLib.navigateRealm(player)\n  local playerColor = player.color\n  if not isValidPlayerColor(playerColor) then return end\n\n  -- Update the navigator UI when opening selector\n  NavigationLib.updateRealmNavigator()\n\n  -- Show the XML navigation selector panel for this player\n  UI.setAttribute(playerColor .. \"_nav_selector\", \"active\", \"true\")\nend\n\n-- Close the navigation selector panel for a player\nfunction NavigationLib.closeNavigationSelector(playerColor)\n  UI.setAttribute(playerColor .. \"_nav_selector\", \"active\", \"false\")\nend\n\n-- Handle destination selection from XML UI button\n-- Called from Global.ttslua xml_selectDestination callback\nfunction NavigationLib.selectDestination(playerColor, optionIndex)\n  if not isValidPlayerColor(playerColor) then return end\n  local destination = GameState.NAVIGATE_OPTIONS[optionIndex]\n  if not destination then return end\n\n  -- Close the selector panel\n  NavigationLib.closeNavigationSelector(playerColor)\n\n  -- Store the selection\n  GameState.destinationPerPlayerColor[playerColor] = destination\n  printToColor(\"You selected: \" .. destination, playerColor)\n\n  -- Update the navigator UI to reflect the new selection\n  NavigationLib.updateRealmNavigator()\n\n  -- Check if all players have now selected\n  NavigationLib.checkForNavigationSelection()\nend\n\n-- Callback when a player confirms their navigation selection\nfunction NavigationLib.navigateRealmCallback(selectedDestination, _, playerColor)\n  if not isValidPlayerColor(playerColor) then return end\n  GameState.destinationPerPlayerColor[playerColor] = selectedDestination\n  printToColor(\"You selected: \" .. selectedDestination, playerColor)\n\n  -- Update the navigator UI to reflect the new selection\n  NavigationLib.updateRealmNavigator()\n\n  -- Check if all players have now selected\n  NavigationLib.checkForNavigationSelection()\nend\n\n-- Checks if all players have chosen a destination\n-- Broadcasts when complete and resets the selection state\nfunction NavigationLib.checkForNavigationSelection()\n  if not next(GameState.destinationPerPlayerColor) then return end\n\n  -- Check if all active players have made a selection\n  for _, player in ipairs(Player.getPlayers()) do\n    local playerColor = player.color\n    if isValidPlayerColor(playerColor) and GameState.destinationPerPlayerColor[playerColor] == nil then return end\n  end\n\n  -- All players have chosen - broadcast results\n  broadcastToAll(\"Every player has chosen a destination for this round!\", \"Green\")\n  for playerColor, destination in pairs(GameState.destinationPerPlayerColor) do\n    printToAll(UtilLib.getColoredName(playerColor) .. \" = \" .. destination)\n  end\n\n  -- Sync game state to Supabase\n  local destinationsSnapshot = {}\n  for playerColor, destination in pairs(GameState.destinationPerPlayerColor) do\n    destinationsSnapshot[playerColor] = destination\n  end\n  GameSyncLib.syncAfterNavigation(destinationsSnapshot)\n\n  -- Reset per-navigation tracking (hand draws, etc.)\n  GameState.handDrawsThisNavigation = {}\n\n  -- Reset destination tracking\n  GameState.destinationPerPlayerColor = {}\n\n  -- Update UI to show all players as \"not selected\" (Red)\n  NavigationLib.updateRealmNavigator()\n\n  -- Store rewind state after navigation reset is complete\n  -- block_further_stores = true prevents auto-saves until next storeRewindState or 60s\n  storeRewindState(function(success, didSave)\n    if success then\n      if didSave then\n        GameState.debugPrint(\"[NavigationLib] Rewind state saved after navigation (auto-save blocked)\")\n      else\n        GameState.debugPrint(\"[NavigationLib] Rewind state already up to date\")\n      end\n    else\n      GameState.debugPrint(\"[NavigationLib] WARNING: Failed to store rewind state\")\n    end\n  end, true)\nend\n\n-- Updates the Realm Navigator UI to show active players and their selection status\nfunction NavigationLib.updateRealmNavigator()\n  local activePlayers = 0\n\n  for _, playerColor in ipairs(UITheme.validPlayerColors) do\n    if Player[playerColor].seated then\n      activePlayers = activePlayers + 1\n      UI.setAttribute(playerColor .. \"_navTracker_panel\", \"active\", \"true\")\n\n      -- Update player name\n      local steamName = Player[playerColor].steam_name or playerColor\n      UI.setAttribute(playerColor .. \"_navTracker_text\", \"text\", steamName)\n\n      -- Update color based on selection status\n      local hasSelected = GameState.destinationPerPlayerColor[playerColor] ~= nil\n      UI.setAttribute(playerColor .. \"_navTracker_panel\", \"color\", hasSelected and \"Green\" or \"Red\")\n    else\n      UI.setAttribute(playerColor .. \"_navTracker_panel\", \"active\", \"false\")\n    end\n  end\n\n  -- Make sure the navigator panel is visible\n  UI.setAttribute(\"vl_RealmNavigator\", \"active\", \"true\")\n\n  -- Update navigator height based on number of active players\n  local height = BASE_PANEL_HEIGHT + (PLAYER_ROW_HEIGHT * math.max(1, activePlayers))\n  UI.setAttribute(\"vl_RealmNavigator\", \"height\", tostring(height))\nend\n\nreturn NavigationLib\nend)\n__bundle_register(\"game/PlayerMatLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- PlayerMatLib: Central player mat state management\n-- Tracks spirits, tokens, and aggregated class/origin counts per player\n-------------------------------------------------------------------------------\n\nlocal GameState = require(\"state/GameState\")\nlocal SearchLib = require(\"util/SearchLib\")\n\nlocal PlayerMatLib = {}\n\n-- Per-player state\nlocal state = {}\n\n-------------------------------------------------------------------------------\n-- Snap Point Positions (local coordinates on playermat)\n-------------------------------------------------------------------------------\n\n-- HexSpirit snap positions (7 slots)\nlocal SPIRIT_SNAP_POSITIONS = {\n  Vector(1.156, 0.1, -0.607),\n  Vector(1.683, 0.1, -0.301),\n  Vector(1.682, 0.1, 0.309),\n  Vector(1.151, 0.1, 0.005),\n  Vector(1.154, 0.1, 0.61),\n  Vector(0.628, 0.1, 0.31),\n  Vector(0.627, 0.1, -0.302)\n}\n\n-- Rune snap positions (4 slots)\nlocal RUNE_SNAP_POSITIONS = {\n  Vector(0.176, 0.1, -0.034),\n  Vector(0.013, 0.1, -0.279),\n  Vector(-0.141, 0.1, -0.515),\n  Vector(-0.284, 0.1, -0.764)\n}\n\n-- Status token snap position (tokens stack here)\nlocal STATUS_SNAP_POSITION = Vector(0.378, 0.1, -0.644)\n\n-- Barrier snap positions (10 slots from left to right)\nlocal BARRIER_SNAP_POSITIONS = {}\nlocal BARRIER_LEFT_X = -1.868\nlocal BARRIER_RIGHT_X = -0.114\nlocal BARRIER_Y = 0.1\nlocal BARRIER_Z = 0.857\nlocal TOTAL_BARRIER_SLOTS = 10\n\nfor i = 1, TOTAL_BARRIER_SLOTS do\n  local t = (i - 1) / (TOTAL_BARRIER_SLOTS - 1)\n  local x = BARRIER_LEFT_X + t * (BARRIER_RIGHT_X - BARRIER_LEFT_X)\n  table.insert(BARRIER_SNAP_POSITIONS, Vector(x, BARRIER_Y, BARRIER_Z))\nend\n\n-- Special Spirit snap positions (6 slots - larger 2x2 spirits)\nlocal SPECIAL_SPIRIT_SNAP_POSITIONS = {\n  Vector(1.88, 0.1, -0.607),\n  Vector(1.88, 0.1, 0.005),\n  Vector(1.88, 0.1, 0.61),\n  Vector(1.35, 0.1, -0.607),\n  Vector(1.35, 0.1, 0.005),\n  Vector(1.35, 0.1, 0.61)\n}\n\n-- Tolerance for snap detection (in local units)\nlocal SNAP_TOLERANCE = 0.15\n\n-------------------------------------------------------------------------------\n-- Centralized Snap Point Configuration\n-- Single source of truth for all snap positions used across the codebase\n-------------------------------------------------------------------------------\n\n--- Generate AttachedSnapPoints array for playermat spawning\n--- This ensures dynamically spawned mats have the same snap points as JSON-defined mats\n---@return table AttachedSnapPoints array for use in spawnObjectData\nfunction PlayerMatLib.generateSnapPointsData()\n  local snapPoints = {}\n\n  -- Add HexSpirit snap points (7)\n  for _, pos in ipairs(SPIRIT_SNAP_POSITIONS) do\n    table.insert(snapPoints, {\n      Position = { x = pos.x, y = pos.y, z = pos.z },\n      Rotation = { x = 0, y = 0, z = 0 },\n      Tags = { \"HexSpirit\" }\n    })\n  end\n\n  -- Add Rune snap points (4)\n  for _, pos in ipairs(RUNE_SNAP_POSITIONS) do\n    table.insert(snapPoints, {\n      Position = { x = pos.x, y = pos.y, z = pos.z },\n      Rotation = { x = 0, y = 315, z = 0 },\n      Tags = { \"Rune\" }\n    })\n  end\n\n  -- Add Status snap point (1)\n  table.insert(snapPoints, {\n    Position = { x = STATUS_SNAP_POSITION.x, y = STATUS_SNAP_POSITION.y, z = STATUS_SNAP_POSITION.z },\n    Rotation = { x = 0, y = 0, z = 0 },\n    Tags = { \"Status\" }\n  })\n\n  -- Add Barrier snap points (10)\n  for _, pos in ipairs(BARRIER_SNAP_POSITIONS) do\n    table.insert(snapPoints, {\n      Position = { x = pos.x, y = pos.y, z = pos.z },\n      Rotation = { x = 0, y = 0, z = 0 },\n      Tags = { \"Barrier\" }\n    })\n  end\n\n  -- Add SpecialSpirit snap points (6)\n  for _, pos in ipairs(SPECIAL_SPIRIT_SNAP_POSITIONS) do\n    table.insert(snapPoints, {\n      Position = { x = pos.x, y = pos.y, z = pos.z },\n      Rotation = { x = 0, y = 0, z = 0 },\n      Tags = { \"SpecialSpirit\" }\n    })\n  end\n\n  return snapPoints\nend\n\n--- Get all snap positions for a specific type\n---@param snapType string One of: \"HexSpirit\", \"Rune\", \"Status\", \"Barrier\", \"SpecialSpirit\"\n---@return table Array of Vector positions\nfunction PlayerMatLib.getSnapPositions(snapType)\n  if snapType == \"HexSpirit\" then\n    return SPIRIT_SNAP_POSITIONS\n  elseif snapType == \"Rune\" then\n    return RUNE_SNAP_POSITIONS\n  elseif snapType == \"Status\" then\n    return { STATUS_SNAP_POSITION }\n  elseif snapType == \"Barrier\" then\n    return BARRIER_SNAP_POSITIONS\n  elseif snapType == \"SpecialSpirit\" then\n    return SPECIAL_SPIRIT_SNAP_POSITIONS\n  end\n  return {}\nend\n\n--- Get the total number of barrier slots\n---@return number\nfunction PlayerMatLib.getTotalBarrierSlots()\n  return TOTAL_BARRIER_SLOTS\nend\n\n-------------------------------------------------------------------------------\n-- State Structure (per player)\n-------------------------------------------------------------------------------\n-- state[playerColor] = {\n--   matGUID = \"...\",\n--   matObject = nil,\n--   spirits = { [slotIndex] = { guid, id, name, cost, classes, origins } },\n--   totals = { classes = {}, origins = {} }\n-- }\n-- NOTE: blood and victoryPoints are now stored in GameState.playerResources\n-- for persistence across saves/undo\n\n-------------------------------------------------------------------------------\n-- Public API\n-------------------------------------------------------------------------------\n\nfunction PlayerMatLib.registerPlayerMat(playerColor, matObject)\n  state[playerColor] = {\n    matGUID = matObject.getGUID(),\n    matObject = matObject,\n    spirits = {},\n    totals = { classes = {}, origins = {} }\n  }\n  -- Initialize player resources in GameState if not already present\n  GameState.initPlayerResources(playerColor)\n\n  -- Ensure barrier tokens match the current resource count once the mat exists\n  PlayerMatLib.syncBarrierTokens(playerColor)\nend\n\nfunction PlayerMatLib.getState(playerColor)\n  return state[playerColor]\nend\n\nfunction PlayerMatLib.getPlayerMatObject(playerColor)\n  if state[playerColor] then\n    return state[playerColor].matObject\n  end\n  return nil\nend\n\nfunction PlayerMatLib.getTotals(playerColor)\n  if state[playerColor] then\n    return state[playerColor].totals\n  end\n  return { classes = {}, origins = {} }\nend\n\n-------------------------------------------------------------------------------\n-- Resource Tracking (Blood \u0026 Victory Points)\n-------------------------------------------------------------------------------\n\n--- Get player's Arcane Blood count\n---@param playerColor string The player color\n---@return number Blood count\nfunction PlayerMatLib.getBlood(playerColor)\n  return GameState.getPlayerResource(playerColor, \"blood\")\nend\n\n--- Set player's Arcane Blood count\n---@param playerColor string The player color\n---@param amount number The new blood amount\nfunction PlayerMatLib.setBlood(playerColor, amount)\n  GameState.setPlayerResource(playerColor, \"blood\", math.max(0, amount))\n  PlayerMatLib.notifyUIUpdate(playerColor)\nend\n\n--- Adjust player's Arcane Blood count\n---@param playerColor string The player color\n---@param delta number Amount to add (negative to subtract)\nfunction PlayerMatLib.adjustBlood(playerColor, delta)\n  local current = GameState.getPlayerResource(playerColor, \"blood\")\n  GameState.setPlayerResource(playerColor, \"blood\", math.max(0, current + delta))\n  PlayerMatLib.notifyUIUpdate(playerColor)\nend\n\n--- Get player's Victory Points count\n---@param playerColor string The player color\n---@return number Victory points count\nfunction PlayerMatLib.getVictoryPoints(playerColor)\n  return GameState.getPlayerResource(playerColor, \"victoryPoints\")\nend\n\n--- Set player's Victory Points count\n---@param playerColor string The player color\n---@param amount number The new VP amount\nfunction PlayerMatLib.setVictoryPoints(playerColor, amount)\n  GameState.setPlayerResource(playerColor, \"victoryPoints\", math.max(0, amount))\n  PlayerMatLib.notifyUIUpdate(playerColor)\nend\n\n--- Adjust player's Victory Points count\n---@param playerColor string The player color\n---@param delta number Amount to add (negative to subtract)\nfunction PlayerMatLib.adjustVictoryPoints(playerColor, delta)\n  local current = GameState.getPlayerResource(playerColor, \"victoryPoints\")\n  GameState.setPlayerResource(playerColor, \"victoryPoints\", math.max(0, current + delta))\n  PlayerMatLib.notifyUIUpdate(playerColor)\nend\n\n--- Get player's Barrier count\n---@param playerColor string The player color\n---@return number Barrier count\nfunction PlayerMatLib.getBarrier(playerColor)\n  return GameState.getPlayerResource(playerColor, \"barrier\")\nend\n\n--- Set player's Barrier count\n---@param playerColor string The player color\n---@param amount number The new barrier amount\nfunction PlayerMatLib.setBarrier(playerColor, amount)\n  GameState.setPlayerResource(playerColor, \"barrier\", math.max(0, amount))\n  PlayerMatLib.notifyUIUpdate(playerColor)\n  PlayerMatLib.syncBarrierTokens(playerColor)\nend\n\n--- Adjust player's Barrier count\n---@param playerColor string The player color\n---@param delta number Amount to add (negative to subtract)\nfunction PlayerMatLib.adjustBarrier(playerColor, delta)\n  local current = GameState.getPlayerResource(playerColor, \"barrier\")\n  GameState.setPlayerResource(playerColor, \"barrier\", math.max(0, current + delta))\n  PlayerMatLib.notifyUIUpdate(playerColor)\n  PlayerMatLib.syncBarrierTokens(playerColor)\nend\n\n--- Get player's Status level (1-4)\n---@param playerColor string The player color\n---@return number Status level\nfunction PlayerMatLib.getStatus(playerColor)\n  return GameState.getPlayerResource(playerColor, \"status\")\nend\n\n--- Set player's Status level (clamped 1-4)\n---@param playerColor string The player color\n---@param level number The new status level\nfunction PlayerMatLib.setStatus(playerColor, level)\n  local clamped = math.max(1, math.min(4, level))\n  GameState.setPlayerResource(playerColor, \"status\", clamped)\n  PlayerMatLib.notifyUIUpdate(playerColor)\nend\n\n--- Adjust player's Status level (clamped 1-4)\n---@param playerColor string The player color\n---@param delta number Amount to add (negative to subtract)\nfunction PlayerMatLib.adjustStatus(playerColor, delta)\n  local current = GameState.getPlayerResource(playerColor, \"status\")\n  PlayerMatLib.setStatus(playerColor, current + delta)\nend\n\n-------------------------------------------------------------------------------\n-- Barrier Token Sync (UI-controlled)\n-------------------------------------------------------------------------------\n\n--- Ensure the number of barrier tokens on a player's mat matches their barrier count.\n--- Tokens are spawned/removed on Barrier snap positions and locked to prevent manual movement.\n---@param playerColor string The player color\nfunction PlayerMatLib.syncBarrierTokens(playerColor)\n  local playerState = state[playerColor]\n  if not playerState or not playerState.matObject then\n    return\n  end\n\n  local matObject = playerState.matObject\n  local matRotation = matObject.getRotation()\n  local barrierUrl = GameState.resourceIcons and GameState.resourceIcons.barrier or nil\n  if not barrierUrl or barrierUrl == \"\" then\n    return\n  end\n\n  local desired = PlayerMatLib.getBarrier(playerColor)\n  local positions = PlayerMatLib.getSnapPositions(\"Barrier\")\n  local maxSlots = #positions\n  if maxSlots == 0 then\n    return\n  end\n\n  desired = math.max(0, math.min(desired, maxSlots))\n\n  -- Remove extra barrier tokens (right to left)\n  for slotIndex = maxSlots, desired + 1, -1 do\n    local worldPos = matObject.positionToWorld(positions[slotIndex])\n    local hits = SearchLib.atPosition(worldPos, \"isBarrier\")\n    for _, obj in ipairs(hits) do\n      if obj and obj.getGUID() then\n        obj.destruct()\n      end\n    end\n  end\n\n  -- Ensure required barrier tokens exist and are locked (left to right)\n  for slotIndex = 1, desired do\n    local worldPos = matObject.positionToWorld(positions[slotIndex])\n    local hits = SearchLib.atPosition(worldPos, \"isBarrier\")\n\n    if #hits == 0 then\n      local tokenData = {\n        Name = \"Custom_Tile\",\n        Transform = {\n          posX = worldPos.x,\n          posY = worldPos.y,\n          posZ = worldPos.z,\n          rotX = 0,\n          rotY = matRotation.y,\n          rotZ = 0,\n          scaleX = 1,\n          scaleY = 1,\n          scaleZ = 1\n        },\n        Nickname = \"\",\n        Tags = { \"Barrier\" },\n        Locked = true,\n        Snap = true,\n        Sticky = true,\n        Grid = true,\n        Autoraise = true,\n        ColorDiffuse = { r = 0, g = 0, b = 0 },\n        CustomImage = {\n          ImageURL = barrierUrl,\n          ImageSecondaryURL = \"\",\n          ImageScalar = 1,\n          WidthScale = 0,\n          CustomTile = {\n            Type = 2,\n            Thickness = 0.2,\n            Stackable = false,\n            Stretch = true\n          }\n        }\n      }\n\n      local spawned = spawnObjectData({ data = tokenData })\n      if spawned and spawned.getGUID() then\n        spawned.setLock(true)\n      end\n    else\n      -- Lock one token, remove any duplicates in the same slot\n      local keep = hits[1]\n      if keep and keep.getGUID() then\n        keep.setRotation({ 0, matRotation.y, 0 })\n        keep.setLock(true)\n      end\n\n      if #hits \u003e 1 then\n        for i = 2, #hits do\n          local extra = hits[i]\n          if extra and extra.getGUID() then\n            extra.destruct()\n          end\n        end\n      end\n    end\n  end\nend\n\n--- Get effective trait totals (base from spirits only, no modifiers)\n--- If Origin Destiny is activated, returns only Defender: 2\n---@param playerColor string The player color\n---@return table Effective class totals\nfunction PlayerMatLib.getEffectiveTraits(playerColor)\n  -- Check if origin destiny is activated - if so, block all class traits\n  local originDestinyState = nil\n  if GameState and GameState.originDestinyActive then\n    originDestinyState = GameState.originDestinyActive[playerColor]\n  end\n\n  if originDestinyState and originDestinyState.activated then\n    -- Return ONLY Defender: 2, no other class traits\n    return { Defender = 2 }\n  end\n\n  -- Return base totals directly (no modifiers)\n  local baseTotals = PlayerMatLib.getTotals(playerColor)\n  local effectiveClasses = {}\n\n  for className, count in pairs(baseTotals.classes or {}) do\n    if count \u003e 0 then\n      effectiveClasses[className] = count\n    end\n  end\n\n  return effectiveClasses\nend\n\n\n-------------------------------------------------------------------------------\n-- Snap Position Helpers\n-------------------------------------------------------------------------------\n\n--- Check if a world position is at a specific snap point on a mat\n---@param matObject object The player mat object\n---@param worldPos Vector The world position to check\n---@param localSnapPos Vector The local snap position on the mat\n---@return boolean True if position matches the snap point\nlocal function isAtSnapPosition(matObject, worldPos, localSnapPos)\n  local snapWorldPos = matObject.positionToWorld(localSnapPos)\n  local dx = math.abs(worldPos.x - snapWorldPos.x)\n  local dz = math.abs(worldPos.z - snapWorldPos.z)\n  return dx \u003c SNAP_TOLERANCE and dz \u003c SNAP_TOLERANCE\nend\n\n--- Find which spirit slot an object is in (if any)\n---@param matObject object The player mat object\n---@param worldPos Vector The world position to check\n---@return number|nil Slot index (1-7) or nil if not in a slot\nlocal function findSpiritSlot(matObject, worldPos)\n  for i, snapPos in ipairs(SPIRIT_SNAP_POSITIONS) do\n    if isAtSnapPosition(matObject, worldPos, snapPos) then\n      return i\n    end\n  end\n  return nil\nend\n\n--- Find which rune slot an object is in (if any)\n---@param matObject object The player mat object\n---@param worldPos Vector The world position to check\n---@return number|nil Slot index (1-4) or nil if not in a slot\nlocal function findRuneSlot(matObject, worldPos)\n  for i, snapPos in ipairs(RUNE_SNAP_POSITIONS) do\n    if isAtSnapPosition(matObject, worldPos, snapPos) then\n      return i\n    end\n  end\n  return nil\nend\n\n-------------------------------------------------------------------------------\n-- Spirit Tracking Functions (Snap-Based)\n-------------------------------------------------------------------------------\n\n--- Rescan all spirit slots on a player's mat and update state\n---@param playerColor string The player color\nfunction PlayerMatLib.rescanSpirits(playerColor)\n  local playerState = state[playerColor]\n  if not playerState or not playerState.matObject then return end\n\n  local matObject = playerState.matObject\n  playerState.spirits = {}\n\n  -- Check each spirit snap position\n  for slotIndex, snapPos in ipairs(SPIRIT_SNAP_POSITIONS) do\n    local worldPos = matObject.positionToWorld(snapPos)\n    local hits = SearchLib.atPosition(worldPos, \"isHexSpirit\")\n\n    if #hits \u003e 0 then\n      local spiritObj = hits[1]\n      local notes = spiritObj.getGMNotes() or \"\"\n      local metadata = {}\n      if notes ~= \"\" then\n        local success, result = pcall(function() return JSON.decode(notes) end)\n        if success and result then\n          metadata = result\n        end\n      end\n\n      playerState.spirits[slotIndex] = {\n        guid = spiritObj.getGUID(),\n        id = metadata.id,\n        name = spiritObj.getName(),\n        cost = metadata.cost,\n        classes = metadata.classes or {},\n        origins = metadata.origins or {}\n      }\n    end\n  end\n\n  PlayerMatLib.recalculateTotals(playerColor)\nend\n\n-------------------------------------------------------------------------------\n-- Rune Tracking Functions (Snap-Based)\n-------------------------------------------------------------------------------\n\n--- Get rune data for the 4 rune slots on a player's mat\n---@param playerColor string The player color\n---@return table Array of rune slot entries (slotIndex + rune metadata if present)\nfunction PlayerMatLib.getRunes(playerColor)\n  local playerState = state[playerColor]\n  if not playerState or not playerState.matObject then return {} end\n\n  local matObject = playerState.matObject\n  local runes = {}\n\n  for slotIndex, snapPos in ipairs(RUNE_SNAP_POSITIONS) do\n    local worldPos = matObject.positionToWorld(snapPos)\n    local hits = SearchLib.atPosition(worldPos, \"isRune\")\n    local runeEntry = { slotIndex = slotIndex, hasRune = false }\n\n    if #hits \u003e 0 then\n      local runeObj = hits[1]\n      local metadata = {}\n      local notes = runeObj.getGMNotes() or \"\"\n      if notes ~= \"\" then\n        local success, result = pcall(function() return JSON.decode(notes) end)\n        if success and result then\n          metadata = result\n        end\n      end\n\n      runeEntry.hasRune = true\n      runeEntry.guid = runeObj.getGUID()\n      runeEntry.id = metadata.id\n      runeEntry.name = runeObj.getName()\n      runeEntry.type = metadata.type\n      runeEntry.originId = metadata.originId\n      runeEntry.classId = metadata.classId\n    end\n\n    table.insert(runes, runeEntry)\n  end\n\n  return runes\nend\n\n--- Add a spirit to a player's tracked state (checks if in valid slot)\n---@param playerColor string The player color\n---@param spiritObj object The spirit object being added\nfunction PlayerMatLib.addSpirit(playerColor, spiritObj)\n  local playerState = state[playerColor]\n  if not playerState or not playerState.matObject then return end\n\n  local worldPos = spiritObj.getPosition()\n  local slotIndex = findSpiritSlot(playerState.matObject, worldPos)\n\n  if not slotIndex then\n    -- Not in a valid snap slot, ignore\n    return\n  end\n\n  local guid = spiritObj.getGUID()\n  local notes = spiritObj.getGMNotes() or \"\"\n\n  local metadata = {}\n  if notes ~= \"\" then\n    local success, result = pcall(function() return JSON.decode(notes) end)\n    if success and result then\n      metadata = result\n    end\n  end\n\n  playerState.spirits[slotIndex] = {\n    guid = guid,\n    id = metadata.id,\n    name = spiritObj.getName(),\n    cost = metadata.cost,\n    classes = metadata.classes or {},\n    origins = metadata.origins or {}\n  }\n\n  PlayerMatLib.recalculateTotals(playerColor)\nend\n\n--- Remove a spirit from a player's tracked state\n---@param playerColor string The player color\n---@param spiritGUID string The GUID of the spirit being removed\nfunction PlayerMatLib.removeSpirit(playerColor, spiritGUID)\n  local playerState = state[playerColor]\n  if not playerState then return end\n\n  -- Find and remove the spirit by GUID\n  for slotIndex, spirit in pairs(playerState.spirits) do\n    if spirit.guid == spiritGUID then\n      playerState.spirits[slotIndex] = nil\n      break\n    end\n  end\n\n  PlayerMatLib.recalculateTotals(playerColor)\nend\n\n--- Recalculate totals for classes and origins from all tracked spirits\n---@param playerColor string The player color\nfunction PlayerMatLib.recalculateTotals(playerColor)\n  local playerState = state[playerColor]\n  if not playerState then return end\n\n  -- Reset totals\n  playerState.totals.classes = {}\n  playerState.totals.origins = {}\n\n  -- Sum all spirits\n  for _, spirit in pairs(playerState.spirits) do\n    for className, count in pairs(spirit.classes or {}) do\n      playerState.totals.classes[className] = (playerState.totals.classes[className] or 0) + count\n    end\n    for originName, count in pairs(spirit.origins or {}) do\n      playerState.totals.origins[originName] = (playerState.totals.origins[originName] or 0) + count\n    end\n  end\n\n  -- Notify UI of changes\n  PlayerMatLib.notifyUIUpdate(playerColor)\nend\n\n--- Notify the UI system to update for a player (internal helper)\n---@param playerColor string The player color\nfunction PlayerMatLib.notifyUIUpdate(playerColor)\n  -- Check if Global.UILib exists and is available\n  if Global and Global.call then\n    local success, err = pcall(function()\n      Global.call(\"updatePlayerUICallback\", playerColor)\n    end)\n    if not success then\n      -- UILib might not be loaded yet, which is fine\n    end\n  end\nend\n\n--- Find which player's mat a position is on\n---@param worldPos Vector The world position to check\n---@return string|nil The player color whose mat contains this position, or nil\nfunction PlayerMatLib.findPlayerColorForPosition(worldPos)\n  local TOLERANCE = 5  -- Increased tolerance for physics variance\n  for playerColor, playerState in pairs(state) do\n    if playerState.matObject then\n      local matPos = playerState.matObject.getPosition()\n      local matBounds = playerState.matObject.getBounds()\n\n      -- Check if position is within mat bounds (with tolerance for physics)\n      local dx = math.abs(worldPos.x - matPos.x)\n      local dz = math.abs(worldPos.z - matPos.z)\n\n      if dx \u003c matBounds.size.x/2 + TOLERANCE and dz \u003c matBounds.size.z/2 + TOLERANCE then\n        return playerColor\n      end\n    end\n  end\n  return nil\nend\n\n\n-------------------------------------------------------------------------------\n-- Origin Destiny Activation (Phase 6)\n-------------------------------------------------------------------------------\n\n--- Check if player has ANY origin destiny on their mat\n---@param playerColor string The player color\n---@return table|nil { originName = string, object = tts__Object, arcaneSpirit = table } if any origin destiny present, nil otherwise\nfunction PlayerMatLib.getOriginDestinyOnMat(playerColor)\n  local playerState = state[playerColor]\n  if not playerState or not playerState.matObject then return nil end\n\n  -- Search for origin destiny tokens on the mat\n  local originDestinyTokens = SearchLib.onObject(playerState.matObject, \"isOriginDestiny\")\n  for _, token in ipairs(originDestinyTokens) do\n    local notes = token.getGMNotes() or \"\"\n    if notes ~= \"\" then\n      local success, metadata = pcall(function() return JSON.decode(notes) end)\n      if success and metadata and metadata.originName then\n        return {\n          originName = metadata.originName,\n          object = token,\n          arcaneSpirit = metadata.arcaneSpirit\n        }\n      end\n    end\n  end\n\n  return nil\nend\n\n--- Check if an origin destiny should be ACTIVATED for a player (grants special dice)\n--- Requires: 4+ unique hex spirits of same origin AND the origin destiny for that origin\n---@param playerColor string The player color\n---@return table|nil { originName = string, activated = true, completed = bool, uniqueCount = number } if activated,\n---                   { originName = string, activated = false, uniqueCount = number } if present but not activated,\n---                   nil if no origin destiny\nfunction PlayerMatLib.checkOriginDestinyActivation(playerColor)\n  local playerState = state[playerColor]\n  if not playerState then return nil end\n\n  -- First check if there's any origin destiny on the mat\n  local originDestiny = PlayerMatLib.getOriginDestinyOnMat(playerColor)\n  if not originDestiny then return nil end\n\n  -- Count unique spirit names per origin\n  local spiritsByOrigin = {}  -- originName -\u003e { spiritName -\u003e true }\n  for _, spirit in pairs(playerState.spirits) do\n    for originName, _ in pairs(spirit.origins or {}) do\n      if not spiritsByOrigin[originName] then\n        spiritsByOrigin[originName] = {}\n      end\n      spiritsByOrigin[originName][spirit.name] = true\n    end\n  end\n\n  -- Check if the origin destiny's origin has 4+ unique spirits\n  local originName = originDestiny.originName\n  local uniqueCount = 0\n  if spiritsByOrigin[originName] then\n    for _ in pairs(spiritsByOrigin[originName]) do\n      uniqueCount = uniqueCount + 1\n    end\n  end\n\n  if uniqueCount \u003e= 6 then\n    -- COMPLETED - 6 unique spirits triggers Arcane Spirit transformation\n    return {\n      originName = originName,\n      activated = true,\n      completed = true,\n      uniqueCount = uniqueCount,\n      destinyObject = originDestiny.object,\n      arcaneSpirit = originDestiny.arcaneSpirit\n    }\n  elseif uniqueCount \u003e= 4 then\n    return { originName = originName, activated = true, completed = false, uniqueCount = uniqueCount }\n  else\n    -- Origin destiny present but not enough spirits to activate\n    return { originName = originName, activated = false, completed = false, uniqueCount = uniqueCount }\n  end\nend\n\n--- Check if player has an origin destiny for a specific origin on their mat\n---@param playerColor string The player color\n---@param originName string The origin to check\n---@return boolean\nfunction PlayerMatLib.hasOriginDestinyForOrigin(playerColor, originName)\n  local playerState = state[playerColor]\n  if not playerState or not playerState.matObject then return false end\n\n  -- Search for origin destiny tokens on the mat\n  local originDestinyTokens = SearchLib.onObject(playerState.matObject, \"isOriginDestiny\")\n  for _, token in ipairs(originDestinyTokens) do\n    local notes = token.getGMNotes() or \"\"\n    if notes ~= \"\" then\n      local success, metadata = pcall(function() return JSON.decode(notes) end)\n      if success and metadata and metadata.originName == originName then\n        return true\n      end\n    end\n  end\n\n  return false\nend\n\n--- Get all spirit objects on the mat that match a specific origin\n---@param playerColor string The player color\n---@param originName string The origin to filter by\n---@return table List of spirit objects matching the origin\nfunction PlayerMatLib.getSpiritsOfOrigin(playerColor, originName)\n  local playerState = state[playerColor]\n  if not playerState then return {} end\n\n  local matchingSpirits = {}\n  for slotIndex, spirit in pairs(playerState.spirits) do\n    if spirit.origins and spirit.origins[originName] then\n      -- Get the actual object from the slot\n      local snapPos = SPIRIT_SNAP_POSITIONS[slotIndex]\n      if snapPos and playerState.matObject then\n        local worldPos = playerState.matObject.positionToWorld(snapPos)\n        local hits = SearchLib.atPosition(worldPos, \"isHexSpirit\")\n        if #hits \u003e 0 then\n          table.insert(matchingSpirits, hits[1])\n        end\n      end\n    end\n  end\n\n  return matchingSpirits\nend\n\nreturn PlayerMatLib\nend)\n__bundle_register(\"game/TraitLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- TraitLib: Trait counting and management\n-- Handles counting traits (Archer, Sorcerer, Swordsman, Defender) from\n-- HexSpirits on player mats and updating UI accordingly\n-- NOTE: Automatic updates removed - use manual refresh button in UI\n-------------------------------------------------------------------------------\n\nlocal GameState = require(\"state/GameState\")\nlocal SearchLib = require(\"util/SearchLib\")\nlocal PlayerMatLib = require(\"game/PlayerMatLib\")\nlocal UtilLib = require(\"util/UtilLib\")\n\nlocal TraitLib = {}\n\n-------------------------------------------------------------------------------\n-- Public API\n-------------------------------------------------------------------------------\n\n--- Updates traits for a single player\n--- Stores trait counts and updates UI (no dice spawning)\n---@param playerColor string The player color\nfunction TraitLib.updateTraitsForPlayer(playerColor)\n  local handData = Player[playerColor].getHandTransform()\n  if not handData then return end\n\n  -- Get effective traits (base from spirits only, no modifiers)\n  local effectiveTraits = PlayerMatLib.getEffectiveTraits(playerColor)\n\n  -- Store counts for UI display\n  GameState.traitSettingsPerPlayer[playerColor] = {}\n  for className, count in pairs(effectiveTraits) do\n    GameState.traitSettingsPerPlayer[playerColor][className] = count\n  end\n\n  -- Update UI only (no dice spawning)\n  if Global and Global.call then\n    pcall(function()\n      Global.call(\"updatePlayerUICallback\", playerColor)\n    end)\n  end\nend\n\n--- Counts traits for a specific player by searching their playermat\n---@param playerColor string The color of the player\n---@return table A table of trait counts (e.g., { Archer = 2, Sorcerer = 1 })\nfunction TraitLib.countTraitsForPlayer(playerColor)\n  -- Try using PlayerMatLib tracked state first (faster and more reliable)\n  local totals = PlayerMatLib.getTotals(playerColor)\n  if totals and totals.classes then\n    local hasClasses = false\n    for _ in pairs(totals.classes) do\n      hasClasses = true\n      break\n    end\n    if hasClasses then\n      return totals.classes\n    end\n  end\n\n  -- Fallback to physics-based counting if PlayerMatLib doesn't have data\n  local playermat = UtilLib.getPlayermat(playerColor)\n  if not playermat then return {} end\n\n  local searchResult = SearchLib.onObject(playermat, \"isHexSpirit\")\n\n  local classes = {}\n  for _, obj in ipairs(searchResult) do\n    local md = UtilLib.getMetadata(obj.getGMNotes())\n    for class, count in pairs(md.classes or {}) do\n      classes[class] = (classes[class] or 0) + count\n    end\n  end\n\n  return classes\nend\n\nreturn TraitLib\nend)\n__bundle_register(\"game/TravelerLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- TravelerLib: Traveler card rotation and board placement\n-------------------------------------------------------------------------------\n\nlocal TravelerLib = {}\n\nlocal GameState = require(\"state/GameState\")\nlocal SupabaseLib = require(\"api/SupabaseLib\")\nlocal UtilLib = require(\"util/UtilLib\")\n\nlocal TRAVELER_BAG_NAME = \"Travelers\"\nlocal TRAVELER_TAG = \"Traveler\"\nlocal TRAVELER_SPAWN_POS = Vector(-8.95, 1.19, -27.27)\nlocal TRAVELER_SPAWN_ROT = Vector(0, 210, 0)\nlocal TRAVELER_DISPLAY_SCALE = Vector(3, 1, 3)\n\nlocal function ensureTravelerScale(obj)\n  if not obj or obj.isDestroyed() then\n    return\n  end\n\n  pcall(function()\n    obj.setScale(TRAVELER_DISPLAY_SCALE)\n  end)\nend\n\nlocal function parseMetadata(notes)\n  if not notes or notes == \"\" then\n    return {}\n  end\n\n  local ok, metadata = pcall(function()\n    return JSON.decode(notes)\n  end)\n\n  if ok and metadata then\n    return metadata\n  end\n\n  return {}\nend\n\nlocal function getTravelerNameSet()\n  local names = {}\n  local data = SupabaseLib.getData()\n  for _, traveler in ipairs((data and data.travelers) or {}) do\n    if traveler and traveler.name then\n      names[traveler.name] = true\n    end\n  end\n  return names\nend\n\nlocal function getTravelerNameById(id)\n  if not id then\n    return nil\n  end\n\n  local data = SupabaseLib.getData()\n  for _, traveler in ipairs((data and data.travelers) or {}) do\n    if traveler and traveler.id == id then\n      return traveler.name\n    end\n  end\n\n  return nil\nend\n\nlocal function isTravelerDeck(obj)\n  if not obj or obj.isDestroyed() then\n    return false\n  end\n\n  if obj.type ~= \"Deck\" then\n    return false\n  end\n\n  local ok, cards = pcall(function() return obj.getObjects() end)\n  if not ok or not cards then\n    return false\n  end\n\n  for _, card in ipairs(cards) do\n    local meta = parseMetadata(card.gm_notes)\n    if meta.id then\n      if meta.trade_rows ~= nil\n        or meta.gain_rows ~= nil\n        or meta.traveler_subtext ~= nil\n        or meta.traveler_description ~= nil\n      then\n        return true\n      end\n    end\n  end\n\n  return false\nend\n\nlocal function isTravelerObject(obj)\n  if not obj or obj.isDestroyed() then\n    return false\n  end\n\n  if obj.type == \"Deck\" then\n    return isTravelerDeck(obj)\n  end\n\n  if obj.type ~= \"Card\" then\n    return false\n  end\n\n  local meta = parseMetadata(obj.getGMNotes())\n  if not meta.id then\n    return false\n  end\n\n  return meta.trade_rows ~= nil\n    or meta.gain_rows ~= nil\n    or meta.traveler_subtext ~= nil\n    or meta.traveler_description ~= nil\nend\n\nlocal function getTravelerBag()\n  return UtilLib.getObjectByName(TRAVELER_BAG_NAME)\nend\n\nlocal function isNotInContainer(obj)\n  local ok, container = pcall(function() return obj.getContainer() end)\n  if ok then\n    return container == nil\n  end\n  -- If getContainer doesn't exist, treat it as not in a container\n  return true\nend\n\nlocal findTravelerObjectNearSpawn\n\nlocal function getBoardTravelerMeta()\n  local near = findTravelerObjectNearSpawn()\n  if near then\n    if near.type == \"Card\" then\n      return parseMetadata(near.getGMNotes())\n    end\n    if near.type == \"Deck\" then\n      local okCards, cards = pcall(function() return near.getObjects() end)\n      if okCards and cards and cards[1] then\n        return parseMetadata(cards[1].gm_notes)\n      end\n    end\n  end\n\n  for _, obj in ipairs(getObjects()) do\n    if obj and not obj.isDestroyed() and obj.type == \"Card\" and isTravelerObject(obj) then\n      local container\n      local ok, result = pcall(function() return obj.getContainer() end)\n      if ok then\n        container = result\n      end\n      if not container then\n        return parseMetadata(obj.getGMNotes())\n      end\n    end\n  end\n\n  for _, obj in ipairs(getObjects()) do\n    if obj and not obj.isDestroyed() and obj.type == \"Deck\" and isTravelerDeck(obj) then\n      local container\n      local ok, result = pcall(function() return obj.getContainer() end)\n      if ok then\n        container = result\n      end\n      if not container then\n        local okCards, cards = pcall(function() return obj.getObjects() end)\n        if okCards and cards and cards[1] then\n          return parseMetadata(cards[1].gm_notes)\n        end\n      end\n    end\n  end\n\n  return nil\nend\n\nfindTravelerObjectNearSpawn = function()\n  local travelerNames = getTravelerNameSet()\n  local nearest = nil\n  local nearestDist = nil\n  for _, obj in ipairs(getObjects()) do\n    if obj and not obj.isDestroyed() and (obj.type == \"Card\" or obj.type == \"Deck\") and isNotInContainer(obj) then\n      local dist = Vector.between(obj.getPosition(), TRAVELER_SPAWN_POS):magnitude()\n      local isCandidate = obj.hasTag(TRAVELER_TAG) or isTravelerObject(obj) or travelerNames[obj.getName()]\n      if isCandidate and dist \u003c= 2 and (nearestDist == nil or dist \u003c nearestDist) then\n        nearest = obj\n        nearestDist = dist\n      end\n    end\n  end\n  return nearest\nend\n\nlocal function getEntriesFromBag(bag)\n  local entries = {}\n  if not bag or bag.isDestroyed() then\n    return entries\n  end\n\n  local ok, contents = pcall(function() return bag.getObjects() end)\n  if not ok or not contents then\n    return entries\n  end\n\n  for _, desc in ipairs(contents) do\n    local meta = parseMetadata(desc.gm_notes)\n    table.insert(entries, {\n      id = meta.id,\n      order_num = meta.order_num,\n      copy_index = meta.copy_index or 0,\n      guid = desc.guid\n    })\n  end\n\n  return entries\nend\n\nlocal function getEntriesFromApi()\n  local entries = {}\n  local data = SupabaseLib.getData()\n  for _, traveler in ipairs(data.travelers or {}) do\n    table.insert(entries, {\n      id = traveler.id,\n      order_num = traveler.order_num,\n      copy_index = traveler.copy_index or 0\n    })\n  end\n  return entries\nend\n\nlocal function dedupeEntries(entries)\n  local seen = {}\n  local result = {}\n  for _, entry in ipairs(entries) do\n    if entry.id then\n      local key = tostring(entry.id) .. \":\" .. tostring(entry.copy_index or 0)\n      if not seen[key] then\n        seen[key] = true\n        table.insert(result, entry)\n      end\n    end\n  end\n  return result\nend\n\nlocal function getTravelerEntries()\n  local entries = getEntriesFromApi()\n  if #entries == 0 then\n    entries = getEntriesFromBag(getTravelerBag())\n  end\n\n  entries = dedupeEntries(entries)\n\n  table.sort(entries, function(a, b)\n    local ao = a.order_num or 999\n    local bo = b.order_num or 999\n    if ao == bo then\n      return (a.copy_index or 0) \u003c (b.copy_index or 0)\n    end\n    return ao \u003c bo\n  end)\n\n  return entries\nend\n\nlocal function findEntryIndex(entries, id, copyIndex)\n  for i, entry in ipairs(entries) do\n    if entry.id == id and (copyIndex == nil or entry.copy_index == copyIndex) then\n      return i\n    end\n  end\n  return nil\nend\n\nlocal function clearBoardTravelers()\n  -- If we previously spawned a traveler object, try to destroy it directly first.\n  if GameState.travelerActiveGuid then\n    local obj = getObjectFromGUID(GameState.travelerActiveGuid)\n    if obj and not obj.isDestroyed() then\n      obj.destruct()\n    end\n    GameState.travelerActiveGuid = nil\n  end\n\n  local travelerNames = getTravelerNameSet()\n  for _, obj in ipairs(getObjects()) do\n    repeat\n      if not obj or obj.isDestroyed() then break end\n      if not isNotInContainer(obj) then break end\n\n      local isCandidate = obj.hasTag(TRAVELER_TAG) or isTravelerObject(obj) or travelerNames[obj.getName()]\n      if not isCandidate then\n        -- Last resort: clear anything card/deck sitting on the spawn position\n        if obj.type == \"Card\" or obj.type == \"Deck\" then\n          local dist = Vector.between(obj.getPosition(), TRAVELER_SPAWN_POS):magnitude()\n          if dist \u003c= 1.5 then\n            isCandidate = true\n          end\n        end\n      end\n\n      if isCandidate then\n        obj.destruct()\n      end\n    until true\n  end\n\n  -- Ensure the spawn area is actually clear (handles deck/stack merges and missing metadata).\n  for _, obj in ipairs(getObjects()) do\n    if obj and not obj.isDestroyed() and (obj.type == \"Card\" or obj.type == \"Deck\") and isNotInContainer(obj) then\n      local dist = Vector.between(obj.getPosition(), TRAVELER_SPAWN_POS):magnitude()\n      if dist \u003c= 2 then\n        obj.destruct()\n      end\n    end\n  end\nend\n\nlocal function spawnTravelerFromTemplate(travelerId, copyIndex)\n  local templates = SupabaseLib.generateTravelerData()\n  for _, template in ipairs(templates) do\n    local meta = parseMetadata(template.GMNotes or \"\")\n    if meta.id == travelerId and (copyIndex == nil or (meta.copy_index or 0) == copyIndex) then\n      template.Transform.posX = TRAVELER_SPAWN_POS.x\n      template.Transform.posY = TRAVELER_SPAWN_POS.y\n      template.Transform.posZ = TRAVELER_SPAWN_POS.z\n      template.Transform.rotX = TRAVELER_SPAWN_ROT.x\n      template.Transform.rotY = TRAVELER_SPAWN_ROT.y\n      template.Transform.rotZ = TRAVELER_SPAWN_ROT.z\n      local spawned = spawnObjectData({ data = template })\n      if spawned then\n        spawned.addTag(TRAVELER_TAG)\n        ensureTravelerScale(spawned)\n        GameState.travelerActiveGuid = spawned.getGUID()\n      end\n      return true\n    end\n  end\n  return false\nend\n\nlocal function spawnTravelerFromEntry(entry)\n  return spawnTravelerFromTemplate(entry.id, entry.copy_index)\nend\n\nfunction TravelerLib.spawnTravelerAtIndex(index)\n  local entries = getTravelerEntries()\n  if #entries == 0 then\n    GameState.debugPrint(\"[TravelerLib] No traveler entries available.\")\n    return\n  end\n\n  if not index or index \u003c 1 or index \u003e #entries then\n    index = 1\n  end\n\n  local entry = entries[index]\n  if not entry or not entry.id then\n    GameState.debugPrint(\"[TravelerLib] Invalid traveler entry at index \" .. tostring(index))\n    return\n  end\n\n  local travelerName = getTravelerNameById(entry.id) or \"Unknown\"\n  GameState.debugPrint(string.format(\"[TravelerLib] Spawning traveler %d/%d: %s\", index, #entries, travelerName))\n\n  GameState.travelerRotationIndex = index\n  GameState.travelerActiveId = entry.id\n\n  clearBoardTravelers()\n  Wait.frames(function()\n    spawnTravelerFromEntry(entry)\n  end, 10)\nend\n\nfunction TravelerLib.advanceTraveler()\n  local entries = getTravelerEntries()\n  if #entries == 0 then\n    return\n  end\n\n  local nextIndex = (GameState.travelerRotationIndex or 0) + 1\n  if nextIndex \u003e #entries then\n    nextIndex = 1\n  end\n\n  TravelerLib.spawnTravelerAtIndex(nextIndex)\nend\n\nfunction TravelerLib.ensureTravelerOnBoard()\n  local entries = getTravelerEntries()\n  if #entries == 0 then\n    return\n  end\n\n  local boardMeta = getBoardTravelerMeta()\n  if boardMeta and boardMeta.id then\n    local index = findEntryIndex(entries, boardMeta.id, boardMeta.copy_index)\n    if index then\n      GameState.travelerRotationIndex = index\n      GameState.travelerActiveId = boardMeta.id\n      local obj = findTravelerObjectNearSpawn()\n      if obj then\n        ensureTravelerScale(obj)\n        GameState.travelerActiveGuid = obj.getGUID()\n      end\n      return\n    end\n  end\n\n  TravelerLib.spawnTravelerAtIndex(GameState.travelerRotationIndex or 1)\nend\n\nreturn TravelerLib\nend)\n__bundle_register(\"state/GameState\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- GameState: Global shared state for all modules\n-- This module holds all game state that needs to be shared across modules\n-------------------------------------------------------------------------------\n\nlocal GameState = {\n  -- Debug mode (always enabled)\n  DEBUG_MODE = true,\n  DEBUG_DROP_LOGGING = false,\n\n  -- Core game state\n  fresh = true,                      -- true if game was never loaded before\n  gameStarted = false,               -- true after \"Start Game\" is clicked\n  gameId = nil,                      -- unique game session ID (generated on start)\n  navigationCount = 0,               -- number of completed navigation rounds\n  travelerRotationIndex = 1,         -- 1-based index for traveler rotation\n  travelerActiveId = nil,            -- active traveler id currently on board\n  travelerActiveGuid = nil,          -- GUID of the active traveler object (Card/Deck) on board\n\n  -- Character selection\n  selectedCharacters = {},           -- playerColor -\u003e characterName\n  availableCharacters = {},          -- list of playable character names (from API)\n  characterMatData = {},             -- charName -\u003e { imageUrl, chibiUrl, iconUrl, originName, charSelectUrl, ... }\n\n  -- TTS Menu (character select screen)\n  ttsMenu = {\n    backgroundUrl = nil              -- Background image URL for character select screen\n  },\n\n  -- Player data\n  playAreaData = {},                 -- playerColor -\u003e { center, size, ... }\n  destinationPerPlayerColor = {},    -- playerColor -\u003e destination\n  traitSettingsPerPlayer = {},       -- playerColor -\u003e { traitType -\u003e count }\n  originDestinyActive = {},          -- playerColor -\u003e { active = bool, originName = string } or nil\n  draw2Pick1Active = {},             -- playerColor -\u003e bool (true when player has drawn 2 and needs to discard)\n  playerResources = {},              -- playerColor -\u003e { blood = num, victoryPoints = num, barrier = num, status = num }\n  handDrawsThisNavigation = {},      -- playerColor -\u003e array of { guid, id, name, cost, sourceBag }\n  DEFAULT_RESOURCES = {              -- default per-player resource values\n    blood = 1,\n    victoryPoints = 0,\n    barrier = 4,\n    status = 1\n  },\n\n  -- Resource icons (loaded from API)\n  resourceIcons = {\n    blood = nil,                     -- URL for arcane blood icon\n    victoryPoint = nil,              -- URL for victory point icon\n    barrier = nil                    -- URL for barrier icon\n  },\n  statusTokens = {},                 -- statusLevel -\u003e { name, imageUrl }\n\n\t  -- UI asset URLs (loaded from API)\n\t  referenceSheetUrl = nil,           -- URL for the reference sheet image\n\t  iconGuideUrl = nil,                -- URL for the icon guide image\n\t  iconGuideIcons = {},               -- List of icon guide icon entries (fallback when PNG not generated)\n\t  d12ImageUrl = nil,                 -- URL for the defense dice image\n\n  -- Dynamic dice data (loaded from API)\n  customDice = {},                   -- list of dice types from API\n\n  -- Classes data (loaded from API)\n  classes = {},                      -- raw array from API\n  classesByName = {},                -- lookup table: className -\u003e classData\n  diceById = {},                     -- lookup table: diceId -\u003e diceData\n\n  -- Runes data (loaded from API)\n  runes = {},                        -- raw array from API\n  runesById = {},                    -- lookup table: runeId -\u003e runeData\n  runesByType = {                    -- lookup table: type -\u003e list of runes\n    class = {},\n    origin = {}\n  },\n\n  -- Constants (can be overridden)\n  PLAYERMAT_POSITIONS = {\n    Red    = { pos = Vector(-30, 0.981, 17.5),  rot = Vector(0, 270, 0) },  -- top left\n    Blue   = { pos = Vector(-30, 0.981, -22.3), rot = Vector(0, 270, 0) },  -- bottom left\n    Orange = { pos = Vector(0, 0.981, -47.299), rot = Vector(0, 180, 0) },  -- bottom center\n    Green  = { pos = Vector(30, 0.981, -22.3),  rot = Vector(0, 90, 0) },   -- bottom right\n    Purple = { pos = Vector(30, 0.981, 17.5),   rot = Vector(0, 90, 0) },   -- top right\n    Yellow = { pos = Vector(0, 0.981, 42.5),    rot = Vector(0, 0, 0) }     -- top center\n  },\n\n  NAVIGATE_OPTIONS = {\n    \"Astral Zone\",\n    \"Cyber City\",\n    \"Floral Patch\",\n    \"Fairy Oasis\",\n    \"Royal Gate\",\n    \"Canyon Light\",\n    \"Stay\",\n    \"Arcane Abyss\",\n    \"Depths of the Abyss\"\n  },\n\n  MARKET_SPIRIT_POSITIONS = {\n    Vector(0, 1.28, 6.06),\n    Vector(5.25, 1.28, 3.03),\n    Vector(5.25, 1.28, -3.03),\n    Vector(0, 1.28, -6.06),\n    Vector(-5.25, 1.28, -3.03),\n    Vector(-5.25, 1.28, 3.03)\n  },\n\n  -- UI Constants\n  SIDE_BUTTON_HEIGHT = 200,\n  SIDE_BUTTON_WIDTH = 900,\n  SIDE_BUTTON_FONTSIZE = 100,\n  SIDE_BUTTON_SPACING = 25,\n\n  -- Dice configuration (DEPRECATED - now loaded from API)\n  -- DICE_OPTIONS = {\n  --   Archer = {\n  --     [\"0\"] = \"0x Basic Attack\",\n  --     [\"1\"] = \"0x Basic Attack\",\n  --     [\"2\"] = \"1x Basic Attack\",\n  --     [\"3\"] = \"1x Basic Attack\",\n  --     [\"4\"] = \"2x Basic Attack\",\n  --     [\"5\"] = \"2x Basic Attack\",\n  --     [\"6\"] = \"3x Basic Attack\",\n  --     [\"7\"] = \"3x Basic Attack\",\n  --     [\"8\"] = \"4x Basic Attack\",\n  --     [\"9\"] = \"4x Basic Attack\"\n  --   },\n  --   Sorcerer = {\n  --     [\"0\"] = \"0x Arcane Attack\",\n  --     [\"1\"] = \"0x Arcane Attack\",\n  --     [\"2\"] = \"1x Arcane Attack\",\n  --     [\"3\"] = \"1x Arcane Attack\",\n  --     [\"4\"] = \"2x Arcane Attack\",\n  --     [\"5\"] = \"2x Arcane Attack\",\n  --     [\"6\"] = \"3x Arcane Attack\",\n  --     [\"7\"] = \"3x Arcane Attack\",\n  --     [\"8\"] = \"4x Arcane Attack\",\n  --     [\"9\"] = \"4x Arcane Attack\"\n  --   },\n  --   Swordsman = {\n  --     [\"0\"] = \"0x Critical Attack\",\n  --     [\"1\"] = \"0x Critical Attack\",\n  --     [\"2\"] = \"1x Critical Attack\",\n  --     [\"3\"] = \"1x Critical Attack\",\n  --     [\"4\"] = \"2x Critical Attack\",\n  --     [\"5\"] = \"2x Critical Attack\",\n  --     [\"6\"] = \"3x Critical Attack\",\n  --     [\"7\"] = \"3x Critical Attack\",\n  --     [\"8\"] = \"4x Critical Attack\",\n  --     [\"9\"] = \"4x Critical Attack\"\n  --   }\n  -- }\n}\n\n-------------------------------------------------------------------------------\n-- Lookup Table Building\n-------------------------------------------------------------------------------\n\n-- Build lookup tables from loaded API data\nfunction GameState.buildLookups(classes, customDice, runes)\n  GameState.classes = classes or {}\n  GameState.customDice = customDice or {}\n  GameState.runes = runes or {}\n\n  -- Build classesByName lookup\n  GameState.classesByName = {}\n  for _, classData in ipairs(GameState.classes) do\n    GameState.classesByName[classData.name] = classData\n  end\n\n  -- Build diceById lookup\n  GameState.diceById = {}\n  for _, diceData in ipairs(GameState.customDice) do\n    GameState.diceById[diceData.id] = diceData\n  end\n\n  -- Build rune lookups\n  GameState.runesById = {}\n  GameState.runesByType = { class = {}, origin = {} }\n  for _, runeData in ipairs(GameState.runes) do\n    GameState.runesById[runeData.id] = runeData\n    local runeType = runeData.type or \"class\"\n    if not GameState.runesByType[runeType] then\n      GameState.runesByType[runeType] = {}\n    end\n    table.insert(GameState.runesByType[runeType], runeData)\n  end\n\n  if GameState.DEBUG_MODE then\n    print(\"[GameState] Built lookups: \" .. #GameState.classes .. \" classes, \" .. #GameState.customDice .. \" dice types, \" .. #GameState.runes .. \" runes\")\n  end\nend\n\n-------------------------------------------------------------------------------\n-- Debug Logging\n-------------------------------------------------------------------------------\n\n--- Print a debug message (only if DEBUG_MODE is enabled)\n---@param message string The message to print\nfunction GameState.debugPrint(message)\n  if GameState.DEBUG_MODE then\n    print(message)\n  end\nend\n\n-------------------------------------------------------------------------------\n-- State Management Functions\n-------------------------------------------------------------------------------\n\n-- Save state to JSON for TTS save system\n\tfunction GameState.serialize()\n\t  return JSON.encode({\n    fresh = GameState.fresh,\n    gameStarted = GameState.gameStarted,\n    gameId = GameState.gameId,\n    navigationCount = GameState.navigationCount,\n    travelerRotationIndex = GameState.travelerRotationIndex,\n    travelerActiveId = GameState.travelerActiveId,\n    travelerActiveGuid = GameState.travelerActiveGuid,\n    selectedCharacters = GameState.selectedCharacters,\n    originDestinyActive = GameState.originDestinyActive,\n    -- Player-specific state (survives undo)\n    destinationPerPlayerColor = GameState.destinationPerPlayerColor,\n    traitSettingsPerPlayer = GameState.traitSettingsPerPlayer,\n    draw2Pick1Active = GameState.draw2Pick1Active,\n    playerResources = GameState.playerResources,\n    handDrawsThisNavigation = GameState.handDrawsThisNavigation,\n    -- Persist API lookup data to avoid re-fetching on reload\n    classes = GameState.classes,\n    customDice = GameState.customDice,\n    runes = GameState.runes,\n    characterMatData = GameState.characterMatData,\n    availableCharacters = GameState.availableCharacters,\n\t    referenceSheetUrl = GameState.referenceSheetUrl,\n\t    iconGuideUrl = GameState.iconGuideUrl,\n\t    iconGuideIcons = GameState.iconGuideIcons,\n\t    d12ImageUrl = GameState.d12ImageUrl,\n\t    resourceIcons = GameState.resourceIcons,\n\t    statusTokens = GameState.statusTokens,\n\t    ttsMenu = GameState.ttsMenu\n\t  })\n\tend\n\n-- Load state from JSON\nfunction GameState.deserialize(saveData)\n  if saveData and saveData ~= \"\" then\n    local loadedData = JSON.decode(saveData)\n    GameState.fresh = loadedData.fresh\n    GameState.gameStarted = loadedData.gameStarted or false\n    GameState.gameId = loadedData.gameId\n    GameState.navigationCount = loadedData.navigationCount or 0\n    GameState.travelerRotationIndex = loadedData.travelerRotationIndex or 1\n    GameState.travelerActiveId = loadedData.travelerActiveId\n    GameState.travelerActiveGuid = loadedData.travelerActiveGuid\n    GameState.selectedCharacters = loadedData.selectedCharacters or {}\n    GameState.originDestinyActive = loadedData.originDestinyActive or {}\n    -- Restore player-specific state\n    GameState.destinationPerPlayerColor = loadedData.destinationPerPlayerColor or {}\n    GameState.traitSettingsPerPlayer = loadedData.traitSettingsPerPlayer or {}\n    GameState.draw2Pick1Active = loadedData.draw2Pick1Active or {}\n    GameState.playerResources = loadedData.playerResources or {}\n    GameState.handDrawsThisNavigation = loadedData.handDrawsThisNavigation or {}\n    for playerColor, _ in pairs(GameState.playerResources) do\n      ensurePlayerResourceDefaults(playerColor)\n    end\n\n    -- Restore API lookup data if saved\n    if loadedData.classes then\n      GameState.classes = loadedData.classes\n      GameState.customDice = loadedData.customDice or {}\n      GameState.runes = loadedData.runes or {}\n      GameState.characterMatData = loadedData.characterMatData or {}\n      GameState.availableCharacters = loadedData.availableCharacters or {}\n\t      GameState.referenceSheetUrl = loadedData.referenceSheetUrl\n\t      GameState.iconGuideUrl = loadedData.iconGuideUrl\n\t      GameState.iconGuideIcons = loadedData.iconGuideIcons or {}\n\t      GameState.d12ImageUrl = loadedData.d12ImageUrl\n\t      GameState.resourceIcons = loadedData.resourceIcons or { blood = nil, victoryPoint = nil, barrier = nil }\n\t      GameState.statusTokens = loadedData.statusTokens or {}\n\t      GameState.ttsMenu = loadedData.ttsMenu or { backgroundUrl = nil }\n\n      -- Rebuild lookup tables from saved data\n      GameState.buildLookups(GameState.classes, GameState.customDice, GameState.runes)\n      GameState.debugPrint(\"[GameState] Restored \" .. #GameState.classes .. \" classes, \" ..\n        #GameState.customDice .. \" dice, \" .. #GameState.runes .. \" runes from save\")\n    end\n  end\nend\n\n--- Check if API data has been cached (restored from save)\n--- Used to skip HTTP requests on undo/reload\n---@return boolean True if cached data is available\nfunction GameState.hasCachedData()\n  return GameState.classes and #GameState.classes \u003e 0\nend\n\n--- Generate a unique game ID with current date/time\n--- Format: \"game_YYYYMMDD_HHMMSS_XXXX\" where XXXX is random\n---@return string The generated game ID\nfunction GameState.generateGameId()\n  local timestamp = os.date(\"!%Y%m%d_%H%M%S\")\n  local random = string.format(\"%04x\", math.random(0, 65535))\n  GameState.gameId = \"game_\" .. timestamp .. \"_\" .. random\n  GameState.debugPrint(\"[GameState] Generated gameId: \" .. GameState.gameId)\n  return GameState.gameId\nend\n\n-------------------------------------------------------------------------------\n-- Player Resource Helpers\n-------------------------------------------------------------------------------\n\nlocal function ensurePlayerResourceDefaults(playerColor)\n  if not GameState.playerResources[playerColor] then\n    GameState.playerResources[playerColor] = {}\n  end\n\n  for key, value in pairs(GameState.DEFAULT_RESOURCES or {}) do\n    if GameState.playerResources[playerColor][key] == nil then\n      GameState.playerResources[playerColor][key] = value\n    end\n  end\nend\n\n--- Get a player's resource value\n---@param playerColor string The player color\n---@param key string The resource key (\"blood\", \"victoryPoints\", \"barrier\", or \"status\")\n---@return number The resource value (0 if not set)\nfunction GameState.getPlayerResource(playerColor, key)\n  if GameState.playerResources[playerColor] then\n    local value = GameState.playerResources[playerColor][key]\n    if value ~= nil then\n      return value\n    end\n  end\n  return (GameState.DEFAULT_RESOURCES and GameState.DEFAULT_RESOURCES[key]) or 0\nend\n\n--- Set a player's resource value\n---@param playerColor string The player color\n---@param key string The resource key (\"blood\" or \"victoryPoints\")\n---@param value number The new value\nfunction GameState.setPlayerResource(playerColor, key, value)\n  ensurePlayerResourceDefaults(playerColor)\n  GameState.playerResources[playerColor][key] = value\nend\n\n--- Initialize player resources if not already present\n---@param playerColor string The player color\nfunction GameState.initPlayerResources(playerColor)\n  ensurePlayerResourceDefaults(playerColor)\nend\n\n-- Reset to initial state (clears all state including API data)\nfunction GameState.resetToLobby()\n  GameState.fresh = true\n  GameState.gameStarted = false\n  GameState.gameId = nil\n  GameState.navigationCount = 0\n  GameState.travelerRotationIndex = 1\n  GameState.travelerActiveId = nil\n  GameState.travelerActiveGuid = nil\n  GameState.selectedCharacters = {}\n  GameState.availableCharacters = {}\n  GameState.characterMatData = {}\n  GameState.playAreaData = {}\n  GameState.destinationPerPlayerColor = {}\n  GameState.traitSettingsPerPlayer = {}\n  GameState.originDestinyActive = {}\n  GameState.draw2Pick1Active = {}\n  GameState.playerResources = {}\n  GameState.handDrawsThisNavigation = {}\n  GameState.classes = {}\n  GameState.classesByName = {}\n  GameState.customDice = {}\n  GameState.diceById = {}\n  GameState.runes = {}\n  GameState.runesById = {}\n  GameState.runesByType = { class = {}, origin = {} }\n\t  GameState.referenceSheetUrl = nil\n\t  GameState.iconGuideUrl = nil\n\t  GameState.iconGuideIcons = {}\n\t  GameState.d12ImageUrl = nil\n\t  GameState.resourceIcons = { blood = nil, victoryPoint = nil, barrier = nil }\n\t  GameState.statusTokens = {}\n\tend\n\nreturn GameState\nend)\n__bundle_register(\"ui/DebugPanelUI\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- DebugPanelUI: Debug Information Panel\n-- Displays detailed game state for debugging and development\n-------------------------------------------------------------------------------\n\nlocal UITheme = require(\"ui/UITheme\")\nlocal UIComponents = require(\"ui/UIComponents\")\nlocal GameState = require(\"state/GameState\")\n\nlocal DebugPanelUI = {}\n\n-------------------------------------------------------------------------------\n-- MARK: Constants\n-------------------------------------------------------------------------------\n\nlocal PANEL_WIDTH = 400\nlocal PANEL_HEIGHT = 580\n\n-------------------------------------------------------------------------------\n-- MARK: Card Section Builder\n-------------------------------------------------------------------------------\n\n--- Build a debug info card section\n---@param title string The section title\n---@param contentId string The ID for the content text element\n---@param contentHeight number The preferred height of the content area\n---@return table The card panel XML\nlocal function buildDebugCard(title, contentId, contentHeight)\n  return {\n    tag = \"Panel\",\n    attributes = {\n      color = UITheme.colors.surface,\n      padding = \"10 10 10 10\"\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = { spacing = 4 },\n        children = {\n          {\n            tag = \"Text\",\n            attributes = {\n              text = title,\n              fontSize = UITheme.sizes.fontSize.xs,\n              color = UITheme.colors.muted,\n              alignment = \"UpperLeft\",\n              preferredHeight = 14\n            }\n          },\n          {\n            tag = \"Text\",\n            attributes = {\n              id = contentId,\n              text = \"(none)\",\n              fontSize = UITheme.sizes.fontSize.sm,\n              color = UITheme.colors.text,\n              alignment = \"UpperLeft\",\n              preferredHeight = contentHeight\n            }\n          }\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Main Panel Builder\n-------------------------------------------------------------------------------\n\n--- Build the debug panel window for a player\n---@param playerColor string The player color\n---@return table The debug panel XML\nfunction DebugPanelUI.build(playerColor)\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = playerColor .. \"_debug_window\",\n      width = PANEL_WIDTH,\n      height = PANEL_HEIGHT,\n      color = UITheme.colors.background,\n      rectAlignment = \"MiddleCenter\",\n      visibility = playerColor,\n      active = false,  -- Initially hidden\n      outline = playerColor,\n      outlineSize = \"2\"\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = { spacing = 8, padding = \"12 12 12 12\" },\n        children = {\n          -- Header row with character name and buttons\n          {\n            tag = \"HorizontalLayout\",\n            attributes = { preferredHeight = 32, spacing = 6 },\n            children = {\n              -- Debug title / character name\n              {\n\t                tag = \"Text\",\n\t                attributes = {\n\t                  id = playerColor .. \"_debug_char\",\n\t                  text = \"DEBUG\",\n\t                  fontSize = UITheme.sizes.fontSize.lg,\n\t                  font = \"font_opsilon/opsilon-regular\",\n\t                  color = playerColor,\n\t                  alignment = \"MiddleLeft\",\n\t                  flexibleWidth = 1\n\t                }\n\t              },\n              -- Reset button\n\t              UIComponents.button({\n\t                id = playerColor .. \"_debug_reset\",\n\t                onClick = \"xml_resetGame\",\n\t                text = \"Reset\",\n\t                fontSize = UITheme.sizes.fontSize.xs,\n\t                width = 50,\n\t                height = 28,\n\t                color = UITheme.colors.danger,\n\t                textColor = \"#ff6666\"\n\t              }),\n              -- Close button\n\t              UIComponents.button({\n\t                id = playerColor .. \"_debug_close\",\n\t                onClick = \"xml_closeDebugPanel\",\n\t                text = \"X\",\n\t                fontSize = UITheme.sizes.fontSize.sm,\n\t                width = 32,\n\t                height = 32,\n\t                color = UITheme.colors.surface,\n\t                textColor = UITheme.colors.muted\n\t              })\n            }\n          },\n          -- Status bar (mat GUID)\n          {\n            tag = \"Panel\",\n            attributes = { preferredHeight = 20, color = UITheme.colors.surface },\n            children = {\n              {\n\t                tag = \"Text\",\n\t                attributes = {\n\t                  id = playerColor .. \"_dbg_status\",\n\t                  text = \"Mat: --\",\n\t                  fontSize = UITheme.sizes.fontSize.xs,\n\t                  color = UITheme.colors.muted,\n\t                  alignment = \"MiddleCenter\"\n\t                }\n\t              }\n            }\n          },\n          -- Origin Destiny panel (conditional display)\n          {\n            tag = \"Panel\",\n            attributes = {\n              id = playerColor .. \"_dbg_destiny_panel\",\n              preferredHeight = 28,\n              color = UITheme.colors.surface,\n              active = false\n            },\n            children = {\n              {\n\t                tag = \"Text\",\n\t                attributes = {\n\t                  id = playerColor .. \"_dbg_calling\",\n\t                  text = \"\",\n\t                  fontSize = UITheme.sizes.fontSize.xs,\n\t                  color = UITheme.colors.primary,\n\t                  alignment = \"MiddleCenter\"\n\t                }\n\t              }\n            }\n          },\n          -- Scrollable sections container\n          {\n            tag = \"VerticalScrollView\",\n            attributes = { preferredHeight = 460, scrollSensitivity = 30 },\n            children = {\n              {\n                tag = \"VerticalLayout\",\n                attributes = { spacing = 6, padding = \"0 4 0 0\" },\n                children = {\n                  -- CLASSES card\n                  buildDebugCard(\n                    \"CLASSES\",\n                    playerColor .. \"_dbg_classes\",\n                    90\n                  ),\n                  -- ORIGINS card\n                  buildDebugCard(\n                    \"ORIGINS\",\n                    playerColor .. \"_dbg_origins\",\n                    50\n                  ),\n                  -- DICE POOL card\n                  buildDebugCard(\n                    \"DICE POOL\",\n                    playerColor .. \"_dbg_dice\",\n                    70\n                  ),\n                  -- SPIRITS card\n                  buildDebugCard(\n                    \"SPIRITS ON MAT\",\n                    playerColor .. \"_dbg_spirits\",\n                    120\n                  )\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Update Functions\n-------------------------------------------------------------------------------\n\n--- Update the debug panel content for a player\n---@param playerColor string The player color\n---@param playerState table The player's state from PlayerMatLib\n---@param characterName string The selected character name\nfunction DebugPanelUI.update(playerColor, playerState, characterName)\n  -- Header with character name\n  UI.setAttribute(playerColor .. \"_debug_char\", \"text\", characterName or \"None\")\n\n  if not playerState then\n    UI.setAttribute(playerColor .. \"_dbg_status\", \"text\", \"NO MAT REGISTERED\")\n    UI.setAttribute(playerColor .. \"_dbg_destiny_panel\", \"active\", false)\n    UI.setAttribute(playerColor .. \"_dbg_classes\", \"text\", \"(no mat)\")\n    UI.setAttribute(playerColor .. \"_dbg_origins\", \"text\", \"(no mat)\")\n    UI.setAttribute(playerColor .. \"_dbg_dice\", \"text\", \"(no mat)\")\n    UI.setAttribute(playerColor .. \"_dbg_spirits\", \"text\", \"(no mat)\")\n    return\n  end\n\n  -- Status line (mat GUID)\n  local matGuidShort = playerState.matGUID and playerState.matGUID:sub(1, 8) or \"N/A\"\n  UI.setAttribute(playerColor .. \"_dbg_status\", \"text\", \"Mat GUID: \" .. matGuidShort)\n\n  -- Origin destiny status (show/hide panel)\n  local originDestinyState = GameState.originDestinyActive and GameState.originDestinyActive[playerColor]\n  if originDestinyState then\n    UI.setAttribute(playerColor .. \"_dbg_destiny_panel\", \"active\", true)\n    if originDestinyState.activated then\n      UI.setAttribute(playerColor .. \"_dbg_calling\", \"text\", \"DESTINY ACTIVE: \" .. originDestinyState.originName)\n    else\n      local needed = 4 - (originDestinyState.uniqueCount or 0)\n      UI.setAttribute(playerColor .. \"_dbg_calling\", \"text\",\n        \"DESTINY: \" .. originDestinyState.originName .. \" (need \" .. needed .. \" more)\")\n    end\n  else\n    UI.setAttribute(playerColor .. \"_dbg_destiny_panel\", \"active\", false)\n  end\n\n  -- Update CLASSES section\n  DebugPanelUI.updateClassesSection(playerColor, playerState.totals)\n\n  -- Update ORIGINS section\n  DebugPanelUI.updateOriginsSection(playerColor, playerState.totals)\n\n  -- Update DICE POOL section\n  DebugPanelUI.updateDicePoolSection(playerColor, originDestinyState)\n\n  -- Update SPIRITS section\n  DebugPanelUI.updateSpiritsSection(playerColor, playerState.spirits)\nend\n\n--- Update the CLASSES section content\n---@param playerColor string The player color\n---@param totals table The player's totals { classes = {}, origins = {} }\nfunction DebugPanelUI.updateClassesSection(playerColor, totals)\n  local classLines = {}\n\n  -- Get sorted class names\n  local allClassNames = {}\n  for className, _ in pairs(GameState.classesByName or {}) do\n    table.insert(allClassNames, className)\n  end\n  table.sort(allClassNames)\n\n  for _, className in ipairs(allClassNames) do\n    local count = totals.classes[className] or 0\n    if count \u003e 0 then\n      local bpIndicator = \"\"\n      local classData = GameState.classesByName[className]\n      if classData and classData.effect_schema then\n        for _, bp in ipairs(classData.effect_schema) do\n          if bp.count \u003c= count then\n            -- Color indicator based on breakpoint\n            if bp.color == \"bronze\" then bpIndicator = \" [B]\"\n            elseif bp.color == \"silver\" then bpIndicator = \" [S]\"\n            elseif bp.color == \"gold\" then bpIndicator = \" [G]\"\n            elseif bp.color == \"prismatic\" then bpIndicator = \" [P]\"\n            else bpIndicator = \" [+]\"\n            end\n          end\n        end\n      end\n      table.insert(classLines, string.format(\"%-12s %d%s\", className, count, bpIndicator))\n    end\n  end\n\n  local text = #classLines \u003e 0 and table.concat(classLines, \"\\n\") or \"No classes\"\n  UI.setAttribute(playerColor .. \"_dbg_classes\", \"text\", text)\nend\n\n--- Update the ORIGINS section content\n---@param playerColor string The player color\n---@param totals table The player's totals { classes = {}, origins = {} }\nfunction DebugPanelUI.updateOriginsSection(playerColor, totals)\n  local originLines = {}\n  local sortedOrigins = {}\n\n  if totals.origins and next(totals.origins) then\n    for originName, count in pairs(totals.origins) do\n      table.insert(sortedOrigins, { name = originName, count = count })\n    end\n    table.sort(sortedOrigins, function(a, b) return a.count \u003e b.count end)\n    for _, o in ipairs(sortedOrigins) do\n      table.insert(originLines, string.format(\"%-12s %d\", o.name, o.count))\n    end\n  end\n\n  local text = #originLines \u003e 0 and table.concat(originLines, \"\\n\") or \"No origins\"\n  UI.setAttribute(playerColor .. \"_dbg_origins\", \"text\", text)\nend\n\n--- Update the DICE POOL section content\n---@param playerColor string The player color\n---@param originDestinyState table|nil The origin destiny state if active\nfunction DebugPanelUI.updateDicePoolSection(playerColor, originDestinyState)\n  local diceLines = {}\n\n  if originDestinyState then\n    if originDestinyState.activated then\n      table.insert(diceLines, \"2x Exalted Attack\")\n      table.insert(diceLines, \"1x Defense Dice\")\n    else\n      table.insert(diceLines, \"Destiny pending...\")\n      table.insert(diceLines, \"Need 4 unique \" .. originDestinyState.originName)\n    end\n  else\n    -- Normal dice from traits\n    local traitSettings = GameState.traitSettingsPerPlayer[playerColor]\n    if traitSettings then\n      for className, traitCount in pairs(traitSettings) do\n        if className ~= \"Defender\" then\n          local classData = GameState.classesByName[className]\n          if classData and classData.effect_schema then\n            local bestBp = nil\n            for _, bp in ipairs(classData.effect_schema) do\n              if bp.count \u003c= traitCount then\n                if not bestBp or bp.count \u003e bestBp.count then bestBp = bp end\n              end\n            end\n            if bestBp and bestBp.effects then\n              for _, eff in ipairs(bestBp.effects) do\n                if eff.type == \"dice\" and eff.quantity \u003e 0 then\n                  local diceData = GameState.diceById[eff.dice_id]\n                  local name = diceData and diceData.name or \"Unknown\"\n                  table.insert(diceLines, string.format(\"%dx %s\", eff.quantity, name))\n                end\n              end\n            end\n          end\n        end\n      end\n    end\n    table.insert(diceLines, \"1x Defense Dice (base)\")\n  end\n\n  local text = #diceLines \u003e 0 and table.concat(diceLines, \"\\n\") or \"No dice\"\n  UI.setAttribute(playerColor .. \"_dbg_dice\", \"text\", text)\nend\n\n--- Update the SPIRITS section content\n---@param playerColor string The player color\n---@param spirits table The player's spirits { [slotIndex] = spiritData }\nfunction DebugPanelUI.updateSpiritsSection(playerColor, spirits)\n  local spiritLines = {}\n  local spiritCount = 0\n\n  for _, spirit in pairs(spirits or {}) do\n    spiritCount = spiritCount + 1\n    local traits = {}\n    for cName, cCount in pairs(spirit.classes or {}) do\n      table.insert(traits, cName:sub(1, 3) .. \":\" .. cCount)\n    end\n    local traitStr = #traits \u003e 0 and \"  \" .. table.concat(traits, \" \") or \"\"\n    table.insert(spiritLines, (spirit.name or \"Unknown\") .. traitStr)\n  end\n\n  local text = spiritCount \u003e 0 and table.concat(spiritLines, \"\\n\") or \"No spirits on mat\"\n  UI.setAttribute(playerColor .. \"_dbg_spirits\", \"text\", text)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Show/Hide Functions\n-------------------------------------------------------------------------------\n\n--- Show the debug panel for a player\n---@param playerColor string The player color\nfunction DebugPanelUI.show(playerColor)\n  UI.setAttribute(playerColor .. \"_debug_window\", \"active\", true)\nend\n\n--- Hide the debug panel for a player\n---@param playerColor string The player color\nfunction DebugPanelUI.hide(playerColor)\n  UI.setAttribute(playerColor .. \"_debug_window\", \"active\", false)\nend\n\nreturn DebugPanelUI\nend)\n__bundle_register(\"ui/DiceSpawnerUI\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- DiceSpawnerUI: Dice spawner panel UI builder\n-- Generates XML for the dice spawner window with +/- controls per dice type\n-------------------------------------------------------------------------------\n\nlocal UITheme = require(\"ui/UITheme\")\nlocal UIComponents = require(\"ui/UIComponents\")\nlocal GameState = require(\"state/GameState\")\n\nlocal DiceSpawnerUI = {}\n\n-- Defense Dice data (d12)\nlocal DEFENSE_DICE = {\n  id = \"defense_dice\",\n  name = \"Defense Dice\",\n  imageUrl = \"\"\n}\n\n-------------------------------------------------------------------------------\n-- Build dice cell component (for 2-column grid)\n-------------------------------------------------------------------------------\n\n--- Build a single dice cell with name, minus, count, plus buttons\n---@param playerColor string The player color\n---@param diceData table The dice data { id, name }\n---@param defaultCount number Default count to display\n---@return table XML table for the cell\nlocal function buildDiceCell(playerColor, diceData, defaultCount)\n  return {\n    tag = \"Panel\",\n    attributes = {\n      color = UITheme.colors.surface,\n      padding = \"8 8 8 8\",\n      preferredWidth = 220,\n      preferredHeight = 90\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = {\n          spacing = 6,\n          childAlignment = \"MiddleCenter\"\n        },\n        children = {\n          -- Dice name\n          {\n            tag = \"Text\",\n            attributes = {\n              text = diceData.name or \"Unknown\",\n              fontSize = UITheme.sizes.fontSize.xl,\n              color = UITheme.colors.text,\n              alignment = \"MiddleCenter\",\n              preferredHeight = 28\n            }\n          },\n          -- Controls row: minus, count, plus\n          {\n            tag = \"HorizontalLayout\",\n            attributes = {\n              spacing = 8,\n              childAlignment = \"MiddleCenter\"\n            },\n            children = {\n              -- Minus button\n              {\n                tag = \"Button\",\n                attributes = {\n                  id = playerColor .. \"_dice_minus_\" .. diceData.id,\n                  onClick = \"xml_diceMinus\",\n                  color = UITheme.colors.danger,\n                  preferredWidth = 48,\n                  preferredHeight = 48\n                },\n                children = {\n                  {\n                    tag = \"Text\",\n                    attributes = {\n                      text = \"-\",\n                      fontSize = UITheme.sizes.fontSize.xxl,\n                      color = UITheme.colors.text\n                    }\n                  }\n                }\n              },\n              -- Count display\n              {\n                tag = \"Text\",\n                attributes = {\n                  id = playerColor .. \"_dice_count_\" .. diceData.id,\n                  text = tostring(defaultCount),\n                  fontSize = UITheme.sizes.fontSize.xxl,\n                  color = UITheme.colors.text,\n                  alignment = \"MiddleCenter\",\n                  preferredWidth = 50\n                }\n              },\n              -- Plus button\n              {\n                tag = \"Button\",\n                attributes = {\n                  id = playerColor .. \"_dice_plus_\" .. diceData.id,\n                  onClick = \"xml_dicePlus\",\n                  color = UITheme.colors.success,\n                  preferredWidth = 48,\n                  preferredHeight = 48\n                },\n                children = {\n                  {\n                    tag = \"Text\",\n                    attributes = {\n                      text = \"+\",\n                      fontSize = UITheme.sizes.fontSize.xxl,\n                      color = UITheme.colors.text\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Public API\n-------------------------------------------------------------------------------\n\n--- Build the dice spawner panel for a player (initially hidden)\n---@param playerColor string The player color\n---@return table XML table for the dice spawner panel\nfunction DiceSpawnerUI.build(playerColor)\n  local customDice = GameState.customDice or {}\n\n  -- Build combined dice list with Defense Dice first\n  local allDice = { DEFENSE_DICE }\n  for _, d in ipairs(customDice) do\n    table.insert(allDice, d)\n  end\n\n  -- Build dice cells and organize into 2-column rows\n  local gridRows = {}\n  local currentRow = {}\n\n  for i, diceData in ipairs(allDice) do\n    -- Check if this is defense dice - default to 1\n    local isDefense = diceData.name and string.lower(diceData.name):find(\"defense\")\n    local defaultCount = isDefense and 1 or 0\n\n    table.insert(currentRow, buildDiceCell(playerColor, diceData, defaultCount))\n\n    -- After 2 items or at end, create a row\n    if #currentRow == 2 or i == #allDice then\n      table.insert(gridRows, {\n        tag = \"HorizontalLayout\",\n        attributes = {\n          spacing = 12,\n          childAlignment = \"MiddleCenter\"\n        },\n        children = currentRow\n      })\n      currentRow = {}\n    end\n  end\n\n  -- Dice grid (no scrolling)\n  local diceGrid = {\n    tag = \"VerticalLayout\",\n    attributes = {\n      spacing = 12,\n      padding = \"8 8 8 8\",\n      childAlignment = \"MiddleCenter\"\n    },\n    children = gridRows\n  }\n\n  -- Button row: Spawn and Cancel\n  local buttonRow = {\n    tag = \"HorizontalLayout\",\n    attributes = {\n      spacing = 20,\n      childAlignment = \"MiddleCenter\",\n      preferredHeight = 50\n    },\n    children = {\n      {\n        tag = \"Button\",\n        attributes = {\n          onClick = \"xml_spawnSelectedDice\",\n          color = UITheme.colors.success,\n          preferredWidth = 140,\n          preferredHeight = 50\n        },\n        children = {\n          {\n            tag = \"Text\",\n            attributes = {\n              text = \"Spawn\",\n              fontSize = UITheme.sizes.fontSize.xxl,\n              color = UITheme.colors.text\n            }\n          }\n        }\n      },\n      {\n        tag = \"Button\",\n        attributes = {\n          onClick = \"xml_closeDiceSpawner\",\n          color = UITheme.colors.danger,\n          preferredWidth = 140,\n          preferredHeight = 50\n        },\n        children = {\n          {\n            tag = \"Text\",\n            attributes = {\n              text = \"Cancel\",\n              fontSize = UITheme.sizes.fontSize.xxl,\n              color = UITheme.colors.text\n            }\n          }\n        }\n      }\n    }\n  }\n\n  -- Calculate height based on number of rows (each row is ~100px + spacing)\n  local numRows = math.ceil(#allDice / 2)\n  local gridHeight = numRows * 100 + (numRows - 1) * 12\n  local totalHeight = 60 + gridHeight + 70 + 40  -- header + grid + buttons + padding\n\n  -- Main panel (sized to fit content without scrolling)\n  return UIComponents.panel({\n    id = playerColor .. \"_dicespawner_window\",\n    width = 500,\n    height = totalHeight,\n    color = UITheme.colors.surface,\n    alignment = \"MiddleCenter\",\n    visibility = playerColor,\n    active = false,\n    outline = UITheme.colors.primary,\n    outlineSize = \"2\",\n    padding = UITheme.sizes.padding.lg,\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = {\n          spacing = 12,\n          childAlignment = \"MiddleCenter\"\n        },\n        children = {\n          -- Header\n          {\n            tag = \"Text\",\n            attributes = {\n              text = \"Spawn Dice\",\n              fontSize = UITheme.sizes.fontSize.huge,\n              fontStyle = \"Bold\",\n              color = UITheme.colors.text,\n              alignment = \"MiddleCenter\",\n              preferredHeight = 45\n            }\n          },\n          -- Dice grid\n          diceGrid,\n          -- Buttons\n          buttonRow\n        }\n      }\n    }\n  })\nend\n\n--- Get the list of all dice IDs (for initialization)\n---@return table List of dice IDs\nfunction DiceSpawnerUI.getAllDiceIds()\n  local ids = { DEFENSE_DICE.id }\n  local customDice = GameState.customDice or {}\n  for _, d in ipairs(customDice) do\n    table.insert(ids, d.id)\n  end\n  return ids\nend\n\n--- Get the defense dice data\n---@return table Defense dice data\nfunction DiceSpawnerUI.getDefenseDice()\n  DEFENSE_DICE.imageUrl = GameState.d12ImageUrl or \"\"\n  return DEFENSE_DICE\nend\n\nreturn DiceSpawnerUI\nend)\n__bundle_register(\"ui/GlobalUI\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- GlobalUI: Global UI elements builder\n-- Generates XML for realm navigator, top buttons, and global announcements\n-------------------------------------------------------------------------------\n\nlocal UITheme = require(\"ui/UITheme\")\nlocal UIComponents = require(\"ui/UIComponents\")\nlocal GameState = require(\"state/GameState\")\nlocal PlayerMatLib = require(\"game/PlayerMatLib\")\n\nlocal GlobalUI = {}\n\n-------------------------------------------------------------------------------\n-- Constants\n-------------------------------------------------------------------------------\n\nlocal NAVIGATOR_ROW_HEIGHT = 28\nlocal NAVIGATOR_BASE_HEIGHT = 70\n\n-- Navigation selector positioning\nlocal NAV_SELECTOR_OFFSET_X = -255\nlocal NAV_SELECTOR_HEIGHT = 400\nlocal NAV_SELECTOR_MARGIN_Y = 30\nlocal NAV_SELECTOR_OFFSET_Y = 730 - NAV_SELECTOR_HEIGHT - NAV_SELECTOR_MARGIN_Y\n\n-------------------------------------------------------------------------------\n-- Realm Navigator\n-------------------------------------------------------------------------------\n\n--- Build the realm navigator panel (player status tracker)\n--- Shows player colors and their current status with navigate button\n---@return table XML table for the realm navigator panel\nfunction GlobalUI.buildRealmNavigator()\n  local navChildren = {\n    -- Header text\n    UIComponents.text({\n      text = \"Player Status\",\n      fontSize = UITheme.sizes.fontSize.md,\n      color = UITheme.colors.muted,\n      alignment = \"MiddleCenter\",\n      height = 24\n    })\n  }\n\n  -- Add player status panels for each supported player color\n  for _, playerColor in ipairs(UITheme.validPlayerColors) do\n    local blood = PlayerMatLib.getBlood(playerColor)\n    local vp = PlayerMatLib.getVictoryPoints(playerColor)\n\n    local playerPanel = {\n      tag = \"Panel\",\n      attributes = {\n        id = playerColor .. \"_navTracker_panel\",\n        active = false,\n        color = \"Red\",  -- Will be updated dynamically\n        preferredHeight = NAVIGATOR_ROW_HEIGHT\n      },\n      children = {\n        {\n          tag = \"HorizontalLayout\",\n          attributes = {\n            spacing = 4,\n            childAlignment = \"MiddleCenter\",\n            padding = \"4 4 4 4\"\n          },\n          children = {\n            -- Player name (left side, flexible width)\n            {\n              tag = \"Text\",\n              attributes = {\n                id = playerColor .. \"_navTracker_text\",\n                text = playerColor,\n                fontSize = UITheme.sizes.fontSize.md,\n                color = UITheme.colors.text,\n                alignment = \"MiddleLeft\",\n                flexibleWidth = 1\n              }\n            },\n            -- Resources container (right side, compact)\n            {\n              tag = \"HorizontalLayout\",\n              attributes = {\n                spacing = 2,\n                childAlignment = \"MiddleRight\"\n              },\n              children = {\n                -- Blood icon and count\n                {\n                  tag = \"Image\",\n                  attributes = {\n                    image = GameState.resourceIcons.blood or \"\",\n                    preferredWidth = 14,\n                    preferredHeight = 14,\n                    preserveAspect = \"true\"\n                  }\n                },\n                {\n                  tag = \"Text\",\n                  attributes = {\n                    id = playerColor .. \"_navTracker_blood\",\n                    text = tostring(blood),\n                    fontSize = UITheme.sizes.fontSize.xs,\n                    fontStyle = \"Bold\",\n                    color = \"Black\",\n                    alignment = \"MiddleCenter\",\n                    preferredWidth = 14\n                  }\n                },\n                -- VP icon and count\n                {\n                  tag = \"Image\",\n                  attributes = {\n                    image = GameState.resourceIcons.victoryPoint or \"\",\n                    preferredWidth = 14,\n                    preferredHeight = 14,\n                    preserveAspect = \"true\"\n                  }\n                },\n                {\n                  tag = \"Text\",\n                  attributes = {\n                    id = playerColor .. \"_navTracker_vp\",\n                    text = tostring(vp),\n                    fontSize = UITheme.sizes.fontSize.xs,\n                    fontStyle = \"Bold\",\n                    color = \"Black\",\n                    alignment = \"MiddleCenter\",\n                    preferredWidth = 14\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    table.insert(navChildren, playerPanel)\n  end\n\n  -- Navigate button at bottom\n  table.insert(navChildren, UIComponents.button({\n    onClick = \"xml_navigateRealm\",\n    text = \"Choose Destination\",\n    preset = \"default\",\n    fontSize = UITheme.sizes.fontSize.lg,\n    height = UITheme.sizes.buttonHeight.md\n  }))\n\n  -- Calculate height based on number of players (will resize dynamically)\n  local initialHeight = NAVIGATOR_BASE_HEIGHT + NAVIGATOR_ROW_HEIGHT\n\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = \"vl_RealmNavigator\",\n      width = 240,\n      height = initialHeight,\n      color = UITheme.colors.background,\n      rectAlignment = \"LowerRight\",\n      offsetXY = \"-5 730\",\n      outline = UITheme.colors.muted,\n      outlineSize = \"1\",\n      active = true\n    },\n    children = {\n      UIComponents.vLayout(navChildren, UITheme.sizes.spacing.xs, UITheme.sizes.padding.sm)\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Top Buttons Panel\n-------------------------------------------------------------------------------\n\n--- Build the top buttons panel (Draw/Summon + Discard)\n---@return table XML table for the top buttons panel\nfunction GlobalUI.buildTopButtons()\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = \"top_buttons_panel\",\n      width = 240,\n      height = 130,\n      color = UITheme.colors.background,\n      rectAlignment = \"LowerRight\",\n      offsetXY = \"-5 580\",\n      outline = UITheme.colors.muted,\n      outlineSize = \"1\"\n    },\n    children = {\n      UIComponents.vLayout({\n        UIComponents.button({\n          id = \"btn_draw2pick1\",\n          onClick = \"xml_draw2Pick1\",\n          text = \"Draw 4 Spirits, Summon 2 (Spirit World)\",\n          preset = \"default\",\n          fontSize = UITheme.sizes.fontSize.md,\n          height = UITheme.sizes.buttonHeight.md\n        }),\n        UIComponents.button({\n          id = \"btn_draw4pick1_sealed\",\n          onClick = \"xml_draw4Pick1Sealed\",\n          text = \"Draw 3 Spirits, Summon 1 (Abyss Fallen)\",\n          preset = \"default\",\n          fontSize = UITheme.sizes.fontSize.sm,\n          height = UITheme.sizes.buttonHeight.md\n        }),\n        UIComponents.button({\n          id = \"btn_return_spirits\",\n          onClick = \"xml_returnAllSpirits\",\n          text = \"Discard Hand (Spirit World)\",\n          preset = \"default\",\n          fontSize = UITheme.sizes.fontSize.md,\n          height = UITheme.sizes.buttonHeight.md\n        })\n      }, UITheme.sizes.spacing.xs, UITheme.sizes.padding.sm)\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Global Announcement Panel\n-------------------------------------------------------------------------------\n\n--- Build the global announcement panel (centered, large text, hidden by default)\n---@return table XML table for the announcement panel\nfunction GlobalUI.buildAnnouncement()\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = \"global_announcement\",\n      active = false,\n      width = 1200,\n      height = 300,\n      rectAlignment = \"UpperCenter\",\n      offsetXY = \"0 -150\",\n      color = \"rgba(0,0,0,0)\"  -- Transparent background\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = {\n          childAlignment = \"MiddleCenter\",\n          spacing = 10\n        },\n        children = {\n          -- Main announcement text\n          {\n            tag = \"Text\",\n            attributes = {\n              id = \"global_announcement_text\",\n              text = \"\",\n              fontSize = UITheme.sizes.fontSize.huge,\n              fontStyle = \"Bold\",\n              color = UITheme.colors.primary,\n              alignment = \"MiddleCenter\",\n              outline = \"#000000\",\n              outlineSize = \"3\"\n            }\n          },\n          -- Subtitle text\n          {\n            tag = \"Text\",\n            attributes = {\n              id = \"global_announcement_subtext\",\n              text = \"\",\n              fontSize = UITheme.sizes.fontSize.xxl,\n              fontStyle = \"Bold\",\n              color = UITheme.colors.text,\n              alignment = \"MiddleCenter\",\n              outline = \"#000000\",\n              outlineSize = \"2\"\n            }\n          }\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Navigation Selector Panel (per-player popup)\n-------------------------------------------------------------------------------\n\n--- Build the navigation selector panel for a specific player\n--- This replaces showOptionsDialog with XML UI for multiplayer support\n---@param playerColor string The player color\n---@return table XML table for the navigation selector panel\nfunction GlobalUI.buildNavigationSelector(playerColor)\n  -- Build children array for vertical layout\n  local layoutChildren = {\n    -- Header\n    {\n      tag = \"Text\",\n      attributes = {\n        text = \"Choose Destination\",\n        fontSize = UITheme.sizes.fontSize.lg,\n        fontStyle = \"Bold\",\n        color = UITheme.colors.text,\n        alignment = \"MiddleCenter\",\n        preferredHeight = 30\n      }\n    }\n  }\n\n  -- Create a button for each navigation option\n  for i, option in ipairs(GameState.NAVIGATE_OPTIONS) do\n    table.insert(layoutChildren, UIComponents.button({\n      id = playerColor .. \"_nav_option_\" .. i,\n      onClick = \"xml_selectDestination\",\n      text = option,\n      preset = \"primary\",\n      fontSize = UITheme.sizes.fontSize.md,\n      height = 32\n    }))\n  end\n\n  -- Add cancel button\n  table.insert(layoutChildren, UIComponents.button({\n    id = playerColor .. \"_nav_cancel\",\n    onClick = \"xml_cancelNavigation\",\n    text = \"Cancel\",\n    preset = \"danger\",\n    fontSize = UITheme.sizes.fontSize.md,\n    height = 32,\n    colors = \"#aa3333|#cc4444|#882222|#ffffff\"\n  }))\n\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = playerColor .. \"_nav_selector\",\n      active = false,\n      visibility = playerColor,  -- Only visible to this player\n      width = 220,\n      height = NAV_SELECTOR_HEIGHT,\n      color = UITheme.colors.background,\n      rectAlignment = \"LowerRight\",\n      offsetXY = NAV_SELECTOR_OFFSET_X .. \" \" .. NAV_SELECTOR_OFFSET_Y,\n      outline = UITheme.colors.primary,\n      outlineSize = \"2\"\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = {\n          spacing = UITheme.sizes.spacing.xs,\n          padding = UITheme.sizes.padding.md,\n          childAlignment = \"UpperCenter\"\n        },\n        children = layoutChildren\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Build All Global Elements\n-------------------------------------------------------------------------------\n\n--- Build all global UI elements at once\n---@return table List of XML tables for all global elements\nfunction GlobalUI.buildAll()\n  local elements = {\n    GlobalUI.buildRealmNavigator(),\n    GlobalUI.buildTopButtons(),\n    GlobalUI.buildAnnouncement()\n  }\n\n  -- Add per-player navigation selectors\n  for _, playerColor in ipairs(UITheme.validPlayerColors) do\n    table.insert(elements, GlobalUI.buildNavigationSelector(playerColor))\n  end\n\n  return elements\nend\n\n-------------------------------------------------------------------------------\n-- Helper Functions for Runtime Updates\n-------------------------------------------------------------------------------\n\n--- Get the navigator row height constant\n---@return number The height of each player row in the navigator\nfunction GlobalUI.getNavigatorRowHeight()\n  return NAVIGATOR_ROW_HEIGHT\nend\n\n--- Get the navigator base height constant\n---@return number The base height of the navigator panel\nfunction GlobalUI.getNavigatorBaseHeight()\n  return NAVIGATOR_BASE_HEIGHT\nend\n\n--- Calculate total navigator height based on active player count\n---@param activePlayerCount number Number of active players\n---@return number Total height for the navigator panel\nfunction GlobalUI.calculateNavigatorHeight(activePlayerCount)\n  return NAVIGATOR_BASE_HEIGHT + (NAVIGATOR_ROW_HEIGHT * activePlayerCount)\nend\n\n--- Update blood and VP display in navigator for a player\n---@param playerColor string The player color\nfunction GlobalUI.updateNavigatorResources(playerColor)\n  local blood = PlayerMatLib.getBlood(playerColor)\n  local vp = PlayerMatLib.getVictoryPoints(playerColor)\n  UI.setAttribute(playerColor .. \"_navTracker_blood\", \"text\", tostring(blood))\n  UI.setAttribute(playerColor .. \"_navTracker_vp\", \"text\", tostring(vp))\nend\n\n--- Update blood and VP display in navigator for all players\nfunction GlobalUI.updateAllNavigatorResources()\n  for _, playerColor in ipairs(UITheme.validPlayerColors) do\n    GlobalUI.updateNavigatorResources(playerColor)\n  end\nend\n\nreturn GlobalUI\nend)\n__bundle_register(\"ui/LobbyUI\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- LobbyUI: Character select panel for lobby state\n-- Full-screen character selection with 3x2 grid and asset-based images\n-------------------------------------------------------------------------------\n\nlocal UITheme = require(\"ui/UITheme\")\nlocal GameState = require(\"state/GameState\")\n\nlocal LobbyUI = {}\n\n-------------------------------------------------------------------------------\n-- Constants\n-------------------------------------------------------------------------------\n\nlocal VALID_PLAYER_COLORS = { \"Red\", \"Orange\", \"Yellow\", \"Green\", \"Blue\", \"Purple\" }\n\n-- Layout constants (percentages of panel size)\n-- Background is 3000x1816 (aspect 1.652)\n-- Character cards are 655x700 (aspect 0.936)\nlocal PANEL_WIDTH = 1500\nlocal PANEL_HEIGHT = 1100\n\n-- Grid layout: 3 columns x 2 rows (6 characters)\nlocal GRID_COLS = 3\nlocal GRID_ROWS = 2\nlocal CARD_WIDTH = 312   -- 20% smaller\nlocal CARD_HEIGHT = 334  -- Card height (312 / 0.936 aspect)\nlocal CARD_SPACING_X = 72   -- 20% less spacing\nlocal CARD_SPACING_Y = 61   -- 20% less spacing\n\n-- Calculate grid dimensions\nlocal GRID_WIDTH = (CARD_WIDTH * GRID_COLS) + (CARD_SPACING_X * (GRID_COLS - 1))\nlocal GRID_HEIGHT = (CARD_HEIGHT * GRID_ROWS) + (CARD_SPACING_Y * (GRID_ROWS - 1))\n\n-- Grid offset from center (negative = push toward top)\nlocal GRID_OFFSET_Y = -30\n\n-------------------------------------------------------------------------------\n-- Helper Functions\n-------------------------------------------------------------------------------\n\n--- Get the visibility string for valid player colors\n---@return string Pipe-separated player colors\nlocal function getPlayerVisibility()\n  return table.concat(VALID_PLAYER_COLORS, \"|\")\nend\n\n--- Get the character select ASSET NAME based on selection state\n--- Uses named assets registered via UI.setCustomAssets for proper caching\n---@param charName string Character name\n---@return string baseAsset The base (unselected) asset name\n---@return string|nil selectedAsset The selected variant asset name if selected, nil otherwise\n---@return string|nil selectedBy The player color who selected this character, nil if not selected\nlocal function getCharacterImageAsset(charName)\n  -- Asset names match those registered in AssetLoaderLib.preloadAllImages()\n  local baseAsset = \"charselect_\" .. charName\n\n  -- Check if selected by any player\n  for playerColor, selectedChar in pairs(GameState.selectedCharacters) do\n    if selectedChar == charName then\n      -- Use the color-specific asset based on the player who selected\n      -- Format: charselect_Red_CharName, charselect_Blue_CharName, etc.\n      local selectedAsset = \"charselect_\" .. playerColor .. \"_\" .. charName\n      return baseAsset, selectedAsset, playerColor\n    end\n  end\n\n  -- Not selected\n  return baseAsset, nil, nil\nend\n\n--- Calculate card position in the grid\n---@param index number 1-based index of the character\n---@return number x X offset from center\n---@return number y Y offset from center\nlocal function getCardPosition(index)\n  local col = ((index - 1) % GRID_COLS)  -- 0-4\n  local row = math.floor((index - 1) / GRID_COLS)  -- 0-1\n\n  -- Calculate position relative to grid center\n  local gridCenterX = (GRID_COLS - 1) / 2  -- 2 (middle column)\n  local gridCenterY = (GRID_ROWS - 1) / 2  -- 0.5 (between rows)\n\n  local x = (col - gridCenterX) * (CARD_WIDTH + CARD_SPACING_X)\n  local y = (row - gridCenterY) * (CARD_HEIGHT + CARD_SPACING_Y) + GRID_OFFSET_Y\n\n  return x, y\nend\n\n--- Build a single character card as an image button\n---@param charName string The character name\n---@param index number The 1-based index in the grid\n---@return table XML element for the character card\nlocal function buildCharacterCard(charName, index)\n  local x, y = getCardPosition(index)\n  local baseAsset, selectedAsset, selectedBy = getCharacterImageAsset(charName)\n\n  -- Use selected asset name if selected, otherwise base asset name\n  -- Using asset names (not URLs) enables TTS caching via UI.setCustomAssets\n  local imageAsset = selectedAsset or baseAsset\n\n  -- Selected cards are 20% bigger\n  local isSelected = selectedAsset ~= nil\n  local scale = isSelected and 1.2 or 1.0\n  local cardWidth = CARD_WIDTH * scale\n  local cardHeight = CARD_HEIGHT * scale\n\n  -- Build the card as an image button\n  -- Colors: Normal|Hover|Pressed|Disabled - all white to show image without tint\n  return {\n    tag = \"Button\",\n    attributes = {\n      id = \"btn_char_\" .. charName,\n      onClick = \"xml_selectCharacter\",\n      image = imageAsset,\n      colors = \"#FFFFFF|#FFFFFF|#FFFFFF|#FFFFFF\",\n      width = cardWidth,\n      height = cardHeight,\n      offsetXY = x .. \" \" .. (-y),  -- Negative Y because TTS Y is inverted\n      rectAlignment = \"MiddleCenter\"\n    }\n  }\nend\n\n-- Title removed per user request\n\n--- Build player status indicators\n---@return table XML element for the status bar\nlocal function buildPlayerStatus()\n  local statusParts = {}\n  for _, playerColor in ipairs(VALID_PLAYER_COLORS) do\n    local selectedChar = GameState.selectedCharacters[playerColor]\n    if selectedChar then\n      table.insert(statusParts, \"[\" .. playerColor .. \": \" .. selectedChar .. \"]\")\n    end\n  end\n\n  local statusText = #statusParts \u003e 0 and table.concat(statusParts, \"  \") or \"No players selected\"\n\n  return {\n    tag = \"Text\",\n    attributes = {\n      id = \"lobby_status_text\",\n      text = statusText,\n      fontSize = UITheme.sizes.fontSize.lg,\n      font = UITheme.fonts and UITheme.fonts.primary or \"font_opsilon/opsilon-regular\",\n      color = \"White\",\n      outline = \"Black\",\n      outlineSize = 1,\n      alignment = \"MiddleCenter\",\n      offsetXY = \"0 \" .. (-PANEL_HEIGHT / 2 + 100),\n      rectAlignment = \"MiddleCenter\",\n      width = PANEL_WIDTH,\n      height = 30\n    }\n  }\nend\n\n--- Build the Start Game button\n---@return table XML element for the start button\nlocal function buildStartButton()\n  return {\n    tag = \"Button\",\n    attributes = {\n      id = \"btn_start_game\",\n      onClick = \"xml_startGame\",\n      color = UITheme.colors.success,\n      width = 200,\n      height = 50,\n      offsetXY = \"0 \" .. (-PANEL_HEIGHT / 2 + 130),  -- Moved up to where status text was\n      rectAlignment = \"MiddleCenter\"\n    },\n    children = {\n      {\n        tag = \"Text\",\n        attributes = {\n          text = \"Start Game\",\n          fontSize = UITheme.sizes.fontSize.xxl,\n          font = UITheme.fonts and UITheme.fonts.primary or \"font_opsilon/opsilon-regular\",\n          fontStyle = \"Bold\",\n          color = \"White\",\n          alignment = \"MiddleCenter\",\n          resizeTextForBestFit = true,\n          resizeTextMinSize = UITheme.sizes.fontSize.sm\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Public API\n-------------------------------------------------------------------------------\n\n--- Build a hidden preload panel that forces TTS to download ALL character images\n--- This includes base images and all 6 color variants for each character\n---@return table XML element for the hidden preload panel\nlocal function buildPreloadPanel()\n  return nil\nend\n\n--- Build the complete character select panel XML\n---@return table XML element for the character select panel\nfunction LobbyUI.build()\n  local isActive = not GameState.gameStarted\n\n  -- Build character cards\n  local children = {}\n\n  -- Background overlay removed per user request\n\n  -- Title removed per user request\n\n  -- Add character cards in 3x2 grid\n  local charIndex = 1\n  for _, charName in ipairs(GameState.availableCharacters) do\n    if charIndex \u003c= GRID_COLS * GRID_ROWS then  -- Max 6 characters\n      table.insert(children, buildCharacterCard(charName, charIndex))\n      charIndex = charIndex + 1\n    end\n  end\n\n  -- Player status removed per user request\n\n  -- Add start button\n  table.insert(children, buildStartButton())\n\n  -- Note: Legacy flow preloads images before UI is created, so no hidden preload panel needed here.\n\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = \"character_select_panel\",\n      width = PANEL_WIDTH,\n      height = PANEL_HEIGHT,\n      color = \"rgba(0,0,0,0)\",  -- Transparent so image shows\n      rectAlignment = \"MiddleCenter\",\n      visibility = getPlayerVisibility(),\n      active = isActive and \"true\" or \"false\"\n    },\n    children = children\n  }\nend\n\n--- Update a specific character card's image based on selection state\n---@param charName string The character name to update\nfunction LobbyUI.updateCharacterCard(charName)\n  local baseAsset, selectedAsset, _ = getCharacterImageAsset(charName)\n  local imageAsset = selectedAsset or baseAsset\n  local buttonId = \"btn_char_\" .. charName\n  UI.setAttribute(buttonId, \"image\", imageAsset)\nend\n\n--- Update all character cards (called after selection changes)\nfunction LobbyUI.updateAllCharacterCards()\n  for _, charName in ipairs(GameState.availableCharacters) do\n    LobbyUI.updateCharacterCard(charName)\n  end\nend\n\n--- Update player status text\nfunction LobbyUI.updatePlayerStatus()\n  local statusParts = {}\n  for _, playerColor in ipairs(VALID_PLAYER_COLORS) do\n    local selectedChar = GameState.selectedCharacters[playerColor]\n    if selectedChar then\n      table.insert(statusParts, \"[\" .. playerColor .. \": \" .. selectedChar .. \"]\")\n    end\n  end\n\n  local statusText = #statusParts \u003e 0 and table.concat(statusParts, \"  \") or \"No players selected\"\n  UI.setAttribute(\"lobby_status_text\", \"text\", statusText)\nend\n\n-- Legacy compatibility - redirect to new functions\nfunction LobbyUI.updateCharacterButton(charName)\n  LobbyUI.updateCharacterCard(charName)\nend\n\nfunction LobbyUI.updateAllCharacterButtons()\n  LobbyUI.updateAllCharacterCards()\nend\n\nfunction LobbyUI.updatePlayerIndicators()\n  LobbyUI.updatePlayerStatus()\nend\n\n--- Show the character select panel\nfunction LobbyUI.show()\n  UI.setAttribute(\"character_select_panel\", \"active\", true)\nend\n\n--- Hide the character select panel\nfunction LobbyUI.hide()\n  UI.setAttribute(\"character_select_panel\", \"active\", false)\nend\n\n--- Check if a player color is valid for character selection\n---@param playerColor string The player color to check\n---@return boolean True if the player can select characters\nfunction LobbyUI.isValidPlayerColor(playerColor)\n  for _, validColor in ipairs(VALID_PLAYER_COLORS) do\n    if playerColor == validColor then\n      return true\n    end\n  end\n  return false\nend\n\n--- Get the list of valid player colors\n---@return table Array of valid player color strings\nfunction LobbyUI.getValidPlayerColors()\n  return VALID_PLAYER_COLORS\nend\n\nreturn LobbyUI\nend)\n__bundle_register(\"ui/ResourceTrackerUI\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- ResourceTrackerUI: Arcane Blood, Victory Points, and Barriers tracker\n-- Left-side panel with +/- buttons and icon displays\n-------------------------------------------------------------------------------\n\nlocal UITheme = require(\"ui/UITheme\")\nlocal GameState = require(\"state/GameState\")\nlocal PlayerMatLib = require(\"game/PlayerMatLib\")\n\nlocal ResourceTrackerUI = {}\n\n-------------------------------------------------------------------------------\n-- Constants\n-------------------------------------------------------------------------------\n\nlocal PANEL_WIDTH = 120\nlocal PANEL_HEIGHT = 220\nlocal ICON_SIZE = 32\nlocal BUTTON_SIZE = 28\n\n-------------------------------------------------------------------------------\n-- Helper Functions\n-------------------------------------------------------------------------------\n\n--- Get the blood icon URL\n---@return string Icon URL\nlocal function getBloodIcon()\n  return GameState.resourceIcons.blood or \"\"\nend\n\n--- Get the victory point icon URL\n---@return string Icon URL\nlocal function getVictoryPointIcon()\n  return GameState.resourceIcons.victoryPoint or \"\"\nend\n\n--- Get the barrier icon URL\n---@return string Icon URL\nlocal function getBarrierIcon()\n  return GameState.resourceIcons.barrier or \"\"\nend\n\n--- Get the status icon URL\n---@param level number Status level\n---@return string Icon URL\nlocal function getStatusIcon(level)\n  local statusToken = GameState.statusTokens and GameState.statusTokens[level]\n  return statusToken and statusToken.imageUrl or \"\"\nend\n\n--- Build a resource row with icon, count, and +/- buttons\n---@param playerColor string The player color\n---@param resourceType string \"blood\", \"vp\", or \"barrier\"\n---@param iconUrl string URL for the icon\n---@param count number Current count\n---@return table XML element for the resource row\nlocal function buildResourceRow(playerColor, resourceType, iconUrl, count)\n  local idPrefix = playerColor .. \"_\" .. resourceType\n\n  return {\n    tag = \"HorizontalLayout\",\n    attributes = {\n      spacing = 4,\n      childAlignment = \"MiddleCenter\",\n      preferredHeight = 44\n    },\n    children = {\n      -- Minus button\n      {\n        tag = \"Button\",\n        attributes = {\n          id = idPrefix .. \"_minus\",\n          onClick = \"xml_adjustResource\",\n          color = UITheme.colors.error or \"#CC3333\",\n          preferredWidth = BUTTON_SIZE,\n          preferredHeight = BUTTON_SIZE\n        },\n        children = {\n          {\n            tag = \"Text\",\n            attributes = {\n              text = \"-\",\n              fontSize = UITheme.sizes.fontSize.lg,\n              fontStyle = \"Bold\",\n              color = \"White\",\n              alignment = \"MiddleCenter\"\n            }\n          }\n        }\n      },\n      -- Icon\n      {\n        tag = \"Image\",\n        attributes = {\n          id = idPrefix .. \"_icon\",\n          image = iconUrl,\n          preserveAspect = \"true\",\n          preferredWidth = ICON_SIZE,\n          preferredHeight = ICON_SIZE\n        }\n      },\n      -- Count display\n      {\n        tag = \"Text\",\n        attributes = {\n          id = idPrefix .. \"_count\",\n          text = tostring(count),\n          fontSize = UITheme.sizes.fontSize.xl,\n          fontStyle = \"Bold\",\n          color = \"White\",\n          alignment = \"MiddleCenter\",\n          preferredWidth = 30\n        }\n      },\n      -- Plus button\n      {\n        tag = \"Button\",\n        attributes = {\n          id = idPrefix .. \"_plus\",\n          onClick = \"xml_adjustResource\",\n          color = UITheme.colors.success or \"#33CC33\",\n          preferredWidth = BUTTON_SIZE,\n          preferredHeight = BUTTON_SIZE\n        },\n        children = {\n          {\n            tag = \"Text\",\n            attributes = {\n              text = \"+\",\n              fontSize = UITheme.sizes.fontSize.lg,\n              fontStyle = \"Bold\",\n              color = \"White\",\n              alignment = \"MiddleCenter\"\n            }\n          }\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Public API\n-------------------------------------------------------------------------------\n\n--- Build the resource tracker panel for a player\n---@param playerColor string The player color\n---@return table XML element for the resource tracker panel\nfunction ResourceTrackerUI.build(playerColor)\n  local blood = PlayerMatLib.getBlood(playerColor)\n  local vp = PlayerMatLib.getVictoryPoints(playerColor)\n  local barrier = PlayerMatLib.getBarrier(playerColor)\n  local status = PlayerMatLib.getStatus(playerColor)\n\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = playerColor .. \"_resource_tracker\",\n      width = PANEL_WIDTH,\n      height = PANEL_HEIGHT,\n      color = UITheme.colors.background or \"rgba(0,0,0,0.8)\",\n      rectAlignment = \"MiddleLeft\",\n      offsetXY = \"10 0\",\n      visibility = playerColor,\n      active = \"true\",\n      outline = playerColor,\n      outlineSize = \"2\"\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = {\n          spacing = 8,\n          padding = \"8 8 8 8\",\n          childAlignment = \"MiddleCenter\"\n        },\n        children = {\n          -- Blood row\n          buildResourceRow(playerColor, \"blood\", getBloodIcon(), blood),\n          -- Victory Points row\n          buildResourceRow(playerColor, \"vp\", getVictoryPointIcon(), vp),\n          -- Barrier row\n          buildResourceRow(playerColor, \"barrier\", getBarrierIcon(), barrier),\n          -- Status row\n          buildResourceRow(playerColor, \"status\", getStatusIcon(status), status)\n        }\n      }\n    }\n  }\nend\n\n--- Update the displayed count for a resource\n---@param playerColor string The player color\n---@param resourceType string \"blood\" or \"vp\"\n---@param count number The new count\nfunction ResourceTrackerUI.updateCount(playerColor, resourceType, count)\n  local elementId = playerColor .. \"_\" .. resourceType .. \"_count\"\n  UI.setAttribute(elementId, \"text\", tostring(count))\nend\n\n--- Update both resource counts for a player\n---@param playerColor string The player color\nfunction ResourceTrackerUI.updateAll(playerColor)\n  local blood = PlayerMatLib.getBlood(playerColor)\n  local vp = PlayerMatLib.getVictoryPoints(playerColor)\n  local barrier = PlayerMatLib.getBarrier(playerColor)\n  ResourceTrackerUI.updateCount(playerColor, \"blood\", blood)\n  ResourceTrackerUI.updateCount(playerColor, \"vp\", vp)\n  ResourceTrackerUI.updateCount(playerColor, \"barrier\", barrier)\n  ResourceTrackerUI.updateStatus(playerColor)\nend\n\n--- Update status count and icon for a player\n---@param playerColor string The player color\nfunction ResourceTrackerUI.updateStatus(playerColor)\n  local status = PlayerMatLib.getStatus(playerColor)\n  ResourceTrackerUI.updateCount(playerColor, \"status\", status)\n  local icon = getStatusIcon(status)\n  UI.setAttribute(playerColor .. \"_status_icon\", \"image\", icon)\nend\n\n--- Show the resource tracker for a player\n---@param playerColor string The player color\nfunction ResourceTrackerUI.show(playerColor)\n  UI.setAttribute(playerColor .. \"_resource_tracker\", \"active\", \"true\")\nend\n\n--- Hide the resource tracker for a player\n---@param playerColor string The player color\nfunction ResourceTrackerUI.hide(playerColor)\n  UI.setAttribute(playerColor .. \"_resource_tracker\", \"active\", \"false\")\nend\n\nreturn ResourceTrackerUI\nend)\n__bundle_register(\"ui/RuneSelectorUI\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- RuneSelectorUI: Rune selector panel UI builder\n-- Generates XML for the rune selection window with grid of available runes\n-------------------------------------------------------------------------------\n\nlocal UITheme = require(\"ui/UITheme\")\nlocal UIComponents = require(\"ui/UIComponents\")\nlocal GameState = require(\"state/GameState\")\n\nlocal RuneSelectorUI = {}\n\n-------------------------------------------------------------------------------\n-- Build rune button component\n-------------------------------------------------------------------------------\n\n--- Build a single rune button with icon\n---@param playerColor string The player color\n---@param runeData table The rune data { id, name, icon_url }\n---@return table XML table for the rune button\nlocal function buildRuneButton(playerColor, runeData)\n  return {\n    tag = \"Button\",\n    attributes = {\n      id = playerColor .. \"_runeselect_\" .. runeData.id,\n      onClick = \"xml_selectRune\",\n      color = UITheme.colors.surface,\n      tooltip = runeData.name\n    },\n    children = {\n      {\n        tag = \"Image\",\n        attributes = {\n          image = runeData.icon_url or \"\",\n          preserveAspect = true\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- Public API\n-------------------------------------------------------------------------------\n\n--- Build the rune selector panel for a player (initially hidden)\n---@param playerColor string The player color\n---@return table XML table for the rune selector panel\nfunction RuneSelectorUI.build(playerColor)\n  -- Get origin runes for the grid\n  local originRunes = GameState.runesByType.origin or {}\n\n  -- Build rune buttons\n  local runeButtons = {}\n  for _, runeData in ipairs(originRunes) do\n    table.insert(runeButtons, buildRuneButton(playerColor, runeData))\n  end\n\n  -- Grid layout for runes\n  local runeGrid = {\n    tag = \"GridLayout\",\n    attributes = {\n      id = playerColor .. \"_runeselector_grid\",\n      cellSize = \"50 50\",\n      spacing = \"6 6\",\n      constraint = \"FixedColumnCount\",\n      constraintCount = 4,\n      childAlignment = \"UpperCenter\"\n    },\n    children = runeButtons\n  }\n\n  -- Scrollable grid container\n  local scrollView = {\n    tag = \"VerticalScrollView\",\n    attributes = {\n      preferredHeight = 300,\n      scrollSensitivity = 30\n    },\n    children = { runeGrid }\n  }\n\n  -- Main panel\n  return UIComponents.panel({\n    id = playerColor .. \"_runeselector_window\",\n    width = 300,\n    height = 400,\n    color = UITheme.colors.surface,\n    alignment = \"LowerRight\",\n    offset = \"-260 100\",\n    visibility = playerColor,\n    active = false,\n    outline = UITheme.colors.muted,\n    outlineSize = \"1\",\n    padding = UITheme.sizes.padding.lg,\n    children = {\n      UIComponents.vLayout({\n        -- Header\n        UIComponents.text({\n          id = playerColor .. \"_runeselector_header\",\n          text = \"Select Rune\",\n          fontSize = UITheme.sizes.fontSize.xl,\n          color = UITheme.colors.text,\n          alignment = \"MiddleCenter\",\n          height = 28\n        }),\n        -- Rune grid\n        scrollView,\n        -- Cancel button\n        UIComponents.button({\n          onClick = \"xml_closeRuneSelector\",\n          text = \"Cancel\",\n          preset = \"default\",\n          fontSize = UITheme.sizes.fontSize.md,\n          height = UITheme.sizes.buttonHeight.md\n        })\n      }, UITheme.sizes.spacing.md)\n    }\n  })\nend\n\n--- Build a dynamically populated rune grid (for runtime updates)\n---@param playerColor string The player color\n---@param runeType string The rune type filter (\"origin\", \"class\", or nil for all)\n---@return table List of rune button XML tables\nfunction RuneSelectorUI.buildRuneButtons(playerColor, runeType)\n  local runes = {}\n\n  if runeType then\n    runes = GameState.runesByType[runeType] or {}\n  else\n    -- Get all runes\n    runes = GameState.runes or {}\n  end\n\n  local buttons = {}\n  for _, runeData in ipairs(runes) do\n    table.insert(buttons, buildRuneButton(playerColor, runeData))\n  end\n\n  return buttons\nend\n\n--- Get all rune IDs for a given type\n---@param runeType string The rune type (\"origin\" or \"class\")\n---@return table List of rune IDs\nfunction RuneSelectorUI.getRuneIds(runeType)\n  local runes = GameState.runesByType[runeType] or {}\n  local ids = {}\n  for _, runeData in ipairs(runes) do\n    table.insert(ids, runeData.id)\n  end\n  return ids\nend\n\nreturn RuneSelectorUI\nend)\n__bundle_register(\"ui/SidebarUI\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- SidebarUI: Player Sidebar Panel\n-- Displays class reference list and quick action tools\n-------------------------------------------------------------------------------\n\nlocal UITheme = require(\"ui/UITheme\")\nlocal UIComponents = require(\"ui/UIComponents\")\nlocal GameState = require(\"state/GameState\")\n\nlocal SidebarUI = {}\n\n-------------------------------------------------------------------------------\n-- MARK: Constants\n-------------------------------------------------------------------------------\n\nlocal SIDEBAR_WIDTH = 240\nlocal SIDEBAR_HEIGHT = 560\nlocal SIDEBAR_OFFSET = \"-5 10\"\n\n-------------------------------------------------------------------------------\n-- MARK: Class Reference Section Builder\n-------------------------------------------------------------------------------\n\n--- Helper to create a class button element\n---@param playerColor string The player color\n---@param className string The class name\n---@param classData table The class data from API\n---@return table The button XML element\nlocal function createClassButton(playerColor, className, classData)\n  local iconUrl = classData and classData.icon_url or \"\"\n  return {\n    tag = \"Button\",\n    attributes = {\n      id = playerColor .. \"_class_\" .. className,\n      onClick = \"xml_showClassBreakpoints\",\n      color = UITheme.colors.surface,\n      preferredHeight = 26,\n      padding = \"2 2 2 2\",\n      active = true\n    },\n    children = {\n      {\n        tag = \"HorizontalLayout\",\n        attributes = {\n          spacing = 4,\n          childAlignment = \"MiddleLeft\"\n        },\n        children = {\n          {\n            tag = \"Image\",\n            attributes = {\n              image = iconUrl,\n              preserveAspect = true,\n              preferredWidth = 20,\n              preferredHeight = 20\n            }\n          },\n          {\n            tag = \"Text\",\n            attributes = {\n              text = className,\n              color = UITheme.colors.text,\n              fontSize = UITheme.sizes.fontSize.sm,\n              alignment = \"MiddleLeft\",\n              flexibleWidth = 1\n            }\n          }\n        }\n      }\n    }\n  }\nend\n\n--- Build the class reference section panel showing ALL classes as buttons\n--- Classes are sorted by position, special classes are in a separate expandable section\n---@param playerColor string The player color\n---@return table The class reference section panel XML\nfunction SidebarUI.buildClassReferenceSection(playerColor)\n  -- Separate regular and special classes, sorted by position\n  local regularClasses = {}\n  local specialClasses = {}\n\n  for className, classData in pairs(GameState.classesByName) do\n    local entry = { name = className, data = classData, position = classData.position or 999 }\n    if classData.special and classData.special ~= \"\" then\n      table.insert(specialClasses, entry)\n    else\n      table.insert(regularClasses, entry)\n    end\n  end\n\n  -- Sort by position\n  table.sort(regularClasses, function(a, b) return a.position \u003c b.position end)\n  table.sort(specialClasses, function(a, b) return a.position \u003c b.position end)\n\n  -- Build children array: header + regular class buttons\n  local children = {\n    {\n      tag = \"Text\",\n      attributes = {\n        text = \"CLASSES\",\n        fontSize = UITheme.sizes.fontSize.lg,\n        fontStyle = \"Bold\",\n        color = playerColor,\n        alignment = \"MiddleCenter\",\n        preferredHeight = 24\n      }\n    }\n  }\n\n  -- Add regular class buttons\n  for _, entry in ipairs(regularClasses) do\n    table.insert(children, createClassButton(playerColor, entry.name, entry.data))\n  end\n\n  -- Add Special Classes expandable section if there are special classes\n  if #specialClasses \u003e 0 then\n    -- Special Classes toggle button\n    table.insert(children, {\n      tag = \"Button\",\n      attributes = {\n        id = playerColor .. \"_special_classes_toggle\",\n        onClick = \"xml_toggleSpecialClasses\",\n        color = UITheme.colors.primary,\n        preferredHeight = 26,\n        padding = \"2 2 2 2\"\n      },\n      children = {\n        {\n          tag = \"Text\",\n          attributes = {\n            id = playerColor .. \"_special_classes_label\",\n            text = \"Special Classes ▼\",\n            color = UITheme.colors.text,\n            fontSize = UITheme.sizes.fontSize.sm,\n            alignment = \"MiddleCenter\"\n          }\n        }\n      }\n    })\n\n    -- Special classes container (hidden by default)\n    local specialChildren = {}\n    for _, entry in ipairs(specialClasses) do\n      table.insert(specialChildren, createClassButton(playerColor, entry.name, entry.data))\n    end\n\n    table.insert(children, {\n      tag = \"Panel\",\n      attributes = {\n        id = playerColor .. \"_special_classes_panel\",\n        active = false,\n        color = UITheme.colors.background,\n        padding = \"4 4 4 4\"\n      },\n      children = {\n        {\n          tag = \"VerticalLayout\",\n          attributes = { spacing = 4 },\n          children = specialChildren\n        }\n      }\n    })\n  end\n\n  return {\n    tag = \"Panel\",\n    attributes = {\n      color = UITheme.colors.surface,\n      padding = \"6 6 6 6\"\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = { spacing = 4 },\n        children = children\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Tools Section Builder\n-------------------------------------------------------------------------------\n\n--- Build the dice spawner button section (above classes)\n---@param playerColor string The player color\n---@return table The dice spawner button panel XML\nfunction SidebarUI.buildDiceSpawnerSection(playerColor)\n  return {\n    tag = \"Panel\",\n    attributes = {\n      color = UITheme.colors.surface,\n      padding = \"6 6 6 6\"\n    },\n    children = {\n      UIComponents.button({\n        id = playerColor .. \"_btn_dice\",\n        onClick = \"xml_showDiceSpawner\",\n        text = \"Spawn Dice\",\n        fontSize = UITheme.sizes.fontSize.md,\n        height = 36,\n        color = UITheme.colors.primary\n      })\n    }\n  }\nend\n\n--- Build the tools section with Debug button\n---@param playerColor string The player color\n---@return table The tools section panel XML\nfunction SidebarUI.buildToolsSection(playerColor)\n  return {\n    tag = \"Panel\",\n    attributes = {\n      color = UITheme.colors.surface,\n      padding = \"6 6 6 6\"\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = { spacing = 4 },\n        children = {\n          -- Debug button\n          UIComponents.button({\n            id = playerColor .. \"_btn_debug\",\n            onClick = \"xml_showDebugPanel\",\n            text = \"Debug Info\",\n            fontSize = UITheme.sizes.fontSize.md,\n            height = 32,\n            color = UITheme.colors.surface\n          })\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Main Sidebar Builder\n-------------------------------------------------------------------------------\n\n--- Build the complete sidebar panel for a player\n---@param playerColor string The player color\n---@return table The sidebar panel XML\nfunction SidebarUI.build(playerColor)\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = playerColor .. \"_sidebar\",\n      width = SIDEBAR_WIDTH,\n      height = SIDEBAR_HEIGHT,\n      color = UITheme.colors.background,\n      rectAlignment = \"LowerRight\",\n      offsetXY = SIDEBAR_OFFSET,\n      visibility = playerColor,\n      active = true,\n      outline = playerColor,\n      outlineSize = \"2\"\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = {\n          spacing = 6,\n          padding = \"8 8 8 8\"\n        },\n        children = {\n          -- Dice Spawner Section (above classes)\n          SidebarUI.buildDiceSpawnerSection(playerColor),\n          -- Class Reference Section\n          SidebarUI.buildClassReferenceSection(playerColor),\n          -- Tools Section\n          SidebarUI.buildToolsSection(playerColor)\n        }\n      }\n    }\n  }\nend\n\nreturn SidebarUI\nend)\n__bundle_register(\"ui/UIComponents\", function(require, _LOADED, __bundle_register, __bundle_modules)\nlocal UITheme = require(\"ui/UITheme\")\nlocal UIComponents = {}\n\nfunction UIComponents.panel(config)\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id = config.id,\n      width = config.width or 300,\n      height = config.height or 400,\n      color = config.color or UITheme.colors.surface,\n      rectAlignment = config.alignment or \"MiddleCenter\",\n      offsetXY = config.offset or \"0 0\",\n      visibility = config.visibility,\n      active = config.active ~= false,\n      outline = config.outline or UITheme.colors.muted,\n      outlineSize = config.outlineSize or \"1\",\n      padding = config.padding or UITheme.sizes.padding.md\n    },\n    children = config.children or {}\n  }\nend\n\nfunction UIComponents.button(config)\n  local presets = {\n    default = { color = UITheme.colors.surface, textColor = UITheme.colors.text },\n    primary = { color = UITheme.colors.primary, textColor = UITheme.colors.text },\n    success = { color = UITheme.colors.success, textColor = UITheme.colors.text },\n    danger = { color = UITheme.colors.danger, textColor = UITheme.colors.text }\n  }\n  local preset = presets[config.preset or \"default\"]\n  local labelText = config.text or \"\"\n  local labelColor = config.textColor or preset.textColor\n\n  local children = config.children\n  if children == nil and labelText ~= \"\" then\n    local labelId = config.labelId\n    if labelId == nil and config.id then\n      labelId = config.id .. \"_label\"\n    end\n    children = {\n      {\n        tag = \"Text\",\n        attributes = {\n          id = labelId,\n          text = labelText,\n          fontSize = config.fontSize or UITheme.sizes.fontSize.md,\n          font = config.font or UITheme.fonts.primary,\n          fontStyle = config.fontStyle,\n          color = labelColor,\n          alignment = config.textAlignment or \"MiddleCenter\",\n          resizeTextForBestFit = config.resizeTextForBestFit ~= false,\n          resizeTextMinSize = config.resizeTextMinSize or 10\n        }\n      }\n    }\n  end\n  return {\n    tag = \"Button\",\n    attributes = {\n      id = config.id,\n      onClick = config.onClick,\n      color = config.color or preset.color,\n      preferredHeight = config.height or UITheme.sizes.buttonHeight.md,\n      preferredWidth = config.width,\n      tooltip = config.tooltip,\n      tooltipPosition = config.tooltipPosition,\n      image = config.image,\n      colors = config.colors\n    },\n    children = children\n  }\nend\n\nfunction UIComponents.vLayout(children, spacing, padding)\n  return {\n    tag = \"VerticalLayout\",\n    attributes = {\n      spacing = spacing or UITheme.sizes.spacing.sm,\n      padding = padding or UITheme.sizes.padding.md\n    },\n    children = children\n  }\nend\n\nfunction UIComponents.hLayout(children, spacing, height)\n  return {\n    tag = \"HorizontalLayout\",\n    attributes = {\n      spacing = spacing or UITheme.sizes.spacing.xs,\n      preferredHeight = height or UITheme.sizes.buttonHeight.md,\n      childAlignment = \"MiddleCenter\"\n    },\n    children = children\n  }\nend\n\nfunction UIComponents.text(config)\n  return {\n    tag = \"Text\",\n    attributes = {\n      id = config.id,\n      text = config.text or \"\",\n      fontSize = config.fontSize or UITheme.sizes.fontSize.md,\n      color = config.color or UITheme.colors.text,\n      alignment = config.alignment or \"MiddleLeft\",\n      preferredHeight = config.height or 26\n    }\n  }\nend\n\nfunction UIComponents.debugCard(title, headerColor, contentId, bgColor)\n  return UIComponents.panel({\n    color = bgColor or UITheme.colors.surface,\n    padding = UITheme.sizes.padding.lg,\n    children = {\n      UIComponents.vLayout({\n        UIComponents.text({ text = title, fontSize = UITheme.sizes.fontSize.xs, color = headerColor }),\n        UIComponents.text({ id = contentId, text = \"(none)\", fontSize = UITheme.sizes.fontSize.sm })\n      }, UITheme.sizes.spacing.xs)\n    }\n  })\nend\n\nfunction UIComponents.gridLayout(children, cellSize, spacing)\n  return {\n    tag = \"GridLayout\",\n    attributes = {\n      cellSize = cellSize or \"100 100\",\n      spacing = spacing or \"10 10\",\n      padding = \"10 10 10 10\"\n    },\n    children = children\n  }\nend\n\nreturn UIComponents\nend)\n__bundle_register(\"ui/UILib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- UILib: State-Driven UI Orchestrator for Arc Spirits TTS\n-- Coordinates UI modules and generates XML based on game state (lobby vs started)\n-------------------------------------------------------------------------------\n\nlocal GameState = require(\"state/GameState\")\nlocal PlayerMatLib = require(\"game/PlayerMatLib\")\nlocal ObjectTemplateLib = require(\"util/ObjectTemplateLib\")\nlocal UITheme = require(\"ui/UITheme\")\n\n-------------------------------------------------------------------------------\n-- MARK: UI Module Imports\n-------------------------------------------------------------------------------\n\nlocal LobbyUI = require(\"ui/LobbyUI\")\nlocal SidebarUI = require(\"ui/SidebarUI\")\nlocal DebugPanelUI = require(\"ui/DebugPanelUI\")\nlocal DiceSpawnerUI = require(\"ui/DiceSpawnerUI\")\nlocal RuneSelectorUI = require(\"ui/RuneSelectorUI\")\nlocal ResourceTrackerUI = require(\"ui/ResourceTrackerUI\")\nlocal GlobalUI = require(\"ui/GlobalUI\")\n\nlocal UILib = {}\n\n-------------------------------------------------------------------------------\n-- MARK: Constants and Data\n-------------------------------------------------------------------------------\n\n-- Tooltip data (could be moved to GameState if needed)\nlocal TOOLTIP_DATA = {\n  [\"Cultivate Spirits\"] =\n  \"If you have 3 of the same origin, gain 1 rune of that origin. If you have 4 of that origin, gain 1 rune and 1 origin destiny.\",\n  [\"Absorb Spirits\"] =\n  \"Remove a spirit and gain 1-2 barriers depending on your player status. You may remove as many as you want.\",\n  [\"Summon Mythic\"] =\n  \"Pay the rune cost, then take 1 Mythic (special borders) from the Spirit Row and place it on your Spirit Tableau. You may replace a spirit if you have no space.\",\n  [\"Summon Legendary\"] =\n  \"Pay the rune cost, then take 1 Yellow sprit from the Spirit Row and place it on your Spirit Tableau. You may replace a spirit if you have no space.\",\n  [\"Summon Epic\"] =\n  \"Take 1 Purple sprit from the Spirit Row and place it on your Spirit Tableau. You may replace a spirit if you have no space.\"\n}\n\n\n-- Valid player colors for the game\n-- Keep this in sync with UITheme.validPlayerColors and GameState.PLAYERMAT_POSITIONS\nlocal PLAYER_COLORS = UITheme.validPlayerColors\n\n \n\n-------------------------------------------------------------------------------\n-- MARK: XML Serialization Helper\n-------------------------------------------------------------------------------\n\n--- Convert a Lua table structure to TTS XML string format\n--- Recursively processes nested tables with tag, attributes, and children\n---@param elements table Array of XML element tables\n---@return string The XML string representation\nfunction UILib.toXmlString(elements)\n  local function escapeXml(str)\n    if type(str) ~= \"string\" then return tostring(str) end\n    return str:gsub(\"\u0026\", \"\u0026amp;\")\n              :gsub(\"\u003c\", \"\u0026lt;\")\n              :gsub(\"\u003e\", \"\u0026gt;\")\n              :gsub('\"', \"\u0026quot;\")\n              :gsub(\"'\", \"\u0026apos;\")\n  end\n\n  local function elementToXml(element)\n    if not element or not element.tag then return \"\" end\n\n    local xml = \"\u003c\" .. element.tag\n\n    -- Add attributes\n    if element.attributes then\n      for key, value in pairs(element.attributes) do\n        xml = xml .. ' ' .. key .. '=\"' .. escapeXml(value) .. '\"'\n      end\n    end\n\n    -- Check for children\n    if element.children and #element.children \u003e 0 then\n      xml = xml .. \"\u003e\"\n      for _, child in ipairs(element.children) do\n        xml = xml .. elementToXml(child)\n      end\n      xml = xml .. \"\u003c/\" .. element.tag .. \"\u003e\"\n    else\n      xml = xml .. \"/\u003e\"\n    end\n\n    return xml\n  end\n\n  local result = \"\"\n  for _, element in ipairs(elements) do\n    result = result .. elementToXml(element)\n  end\n  return result\nend\n\n\n-------------------------------------------------------------------------------\n-- MARK: Playermat Rune Slot UI (attached to mat object)\n-------------------------------------------------------------------------------\n\n-- Rune slot positions on playermat (local coordinates) - used for both spawning and UI\n-- These positions form a diamond pattern on the mat\nUILib.RUNE_SLOT_POSITIONS = {\n  { local_pos = Vector(0.176, 0.1, -0.034),   ui_offset = \"105 -20\" },   -- Slot 1\n  { local_pos = Vector(0.013, 0.1, -0.279),   ui_offset = \"8 -168\" },    -- Slot 2\n  { local_pos = Vector(-0.141, 0.1, -0.515),  ui_offset = \"-85 -310\" },  -- Slot 3\n  { local_pos = Vector(-0.284, 0.1, -0.764),  ui_offset = \"-182 -168\" }  -- Slot 4\n}\n\n--- Create and apply rune slot buttons to a playermat object using native TTS buttons\n--- This adds small + buttons at each rune snap point position on the mat\n---@param matObject object The playermat TTS object\n---@param playerColor string The player color who owns this mat\nfunction UILib.setupRuneSlotsOnMat(matObject, playerColor)\n  if not matObject then\n    GameState.debugPrint(\"[UILib] setupRuneSlotsOnMat: matObject is nil!\")\n    return\n  end\n\n  -- Clear any existing buttons first\n  matObject.clearButtons()\n\n  -- Get the snap points from the mat and find ones tagged \"Rune\"\n  local snapPoints = matObject.getSnapPoints()\n  local runeSnapPoints = {}\n\n  if snapPoints then\n    for _, snap in ipairs(snapPoints) do\n      if snap.tags then\n        for _, tag in ipairs(snap.tags) do\n          if tag == \"Rune\" then\n            table.insert(runeSnapPoints, snap.position)\n            break\n          end\n        end\n      end\n    end\n  end\n\n  if #runeSnapPoints == 0 then\n    -- Fallback positions from the Myrtle.json snap points\n    runeSnapPoints = {\n      { x = 0.176, y = 0.1, z = -0.034 },\n      { x = 0.013, y = 0.1, z = -0.279 },\n      { x = -0.141, y = 0.1, z = -0.515 },\n      { x = -0.284, y = 0.1, z = -0.764 }\n    }\n  end\n\n  -- Store playerColor on the mat for the click handler\n  matObject.setVar(\"ownerColor\", playerColor)\n\n  -- Click function names for each slot (defined in Global.ttslua)\n  local clickFunctions = {\n    \"onRuneSlot1Click\",\n    \"onRuneSlot2Click\",\n    \"onRuneSlot3Click\",\n    \"onRuneSlot4Click\"\n  }\n\n  -- Create native TTS buttons at each rune snap point\n  -- Buttons are small, semi-transparent, and don't block snapping\n  -- Reflect across Y axis (flip X) to match mat orientation\n  for i, pos in ipairs(runeSnapPoints) do\n    local clickFunc = clickFunctions[i] or \"onRuneSlot1Click\"\n    matObject.createButton({\n      click_function = clickFunc,\n      function_owner = Global,\n      label = \"+\",\n      position = { -pos.x, pos.y + 0.01, pos.z },  -- Flip X to reflect across Y axis\n      rotation = { 0, 0, 0 },\n      width = 150,\n      height = 150,\n      font_size = 100,\n      font_color = { 1, 1, 1, 0.9 },\n      color = { 0, 0, 0, 0 },           -- Fully transparent background\n      hover_color = { 1, 1, 1, 0.2 },   -- Slight highlight on hover\n      press_color = { 1, 1, 1, 0.3 },\n      tooltip = \"Add Rune (Slot \" .. i .. \")\"\n    })\n  end\nend\n\n--- Clear rune slot buttons from a playermat\n---@param matObject object The playermat TTS object\nfunction UILib.clearRuneSlotsOnMat(matObject)\n  if matObject then\n    matObject.clearButtons()\n  end\nend\n\n-------------------------------------------------------------------------------\n-- MARK: UI Component Builders (for Started State)\n-------------------------------------------------------------------------------\n\n--- Build reference window for a player\n---@param playerColor string The player color\n---@return table The reference window XML element\nfunction UILib.buildReferenceWindow(playerColor)\n  return {\n    tag = \"VerticalLayout\",\n    attributes = {\n      id            = playerColor .. \"_reference_window\",\n      height        = 1200,\n      width         = 942,\n      rectAlignment = \"MiddleCenter\",\n      active        = \"false\",\n      visibility    = playerColor,\n      scale         = \"0.75 0.75 1\"\n    },\n    children = {\n      -- Image Display\n      {\n        tag = \"Image\",\n        attributes = {\n          id              = playerColor .. \"_reference_image\",\n          image           = \"\", -- will be set by the asset request success\n          preferredHeight = 1200,\n          height          = 1200\n        }\n      },\n      -- Close Button\n      {\n        tag = \"Button\",\n        attributes = {\n          onClick              = \"xml_closeReference\",\n          color                = UITheme.colors.muted,\n          preferredHeight      = 75,\n          height               = 75,\n        },\n        children = {\n          {\n            tag = \"Text\",\n            attributes = {\n              text = \"Close\",\n              font = \"font_opsilon/opsilon-italic\",\n              fontSize = UITheme.sizes.fontSize.md,\n              color = UITheme.colors.text,\n              alignment = \"MiddleCenter\",\n              resizeTextForBestFit = true,\n              resizeTextMinSize = 12\n            }\n          }\n        }\n      }\n    }\n  }\nend\n\n--- Build tooltip window for a player\n---@param playerColor string The player color\n---@return table The tooltip window XML element\nfunction UILib.buildTooltipWindow(playerColor)\n  return {\n    tag        = \"Panel\",\n    attributes = {\n      id            = playerColor .. \"_tooltip_window\",\n      scale         = \"0.2 0.2 1\",\n      width         = 2700,\n      height        = 450,\n      padding       = \"30 30 30 30\",\n      color         = UITheme.colors.background,\n      offsetXY      = \"0 -80\",\n      rectAlignment = \"UpperCenter\",\n      visibility    = playerColor,\n      active        = false\n    },\n    children   = {\n      {\n        tag        = \"Text\",\n        attributes = {\n          id                   = playerColor .. \"_tooltip_title\",\n          preferredWidth       = 900,\n          resizeTextForBestFit = true,\n          resizeTextMinSize    = 100,\n          font                 = \"font_opsilon/opsilon-regular\",\n          color                = UITheme.colors.text\n        }\n      },\n      {\n        tag        = \"Text\",\n        attributes = {\n          id                   = playerColor .. \"_tooltip_text\",\n          preferredWidth       = 1800,\n          resizeTextForBestFit = true,\n          resizeTextMinSize    = 80,\n          horizontalOverflow   = \"Wrap\",\n          verticalOverflow     = \"Overflow\",\n          font                 = \"font_opsilon/opsilon-italic\",\n          color                = UITheme.colors.text\n        }\n      }\n    }\n  }\nend\n\n--- Build class breakpoints window for a player\n---@param playerColor string The player color\n---@return table The class breakpoints window XML element\nfunction UILib.buildClassBreakpointsWindow(playerColor)\n  return {\n    tag = \"Panel\",\n    attributes = {\n      id            = playerColor .. \"_classbreakpoints_window\",\n      width         = 350,\n      height        = 580,\n      color         = UITheme.colors.surface,\n      rectAlignment = \"LowerRight\",\n      offsetXY      = \"-260 100\",\n      visibility    = playerColor,\n      active        = false,\n      outline       = UITheme.colors.muted,\n      outlineSize   = \"1\",\n      padding       = \"12 12 12 12\"\n    },\n    children = {\n      {\n        tag = \"VerticalLayout\",\n        attributes = {\n          spacing = 6\n        },\n        children = {\n          -- Header row: icon + name\n          {\n            tag = \"HorizontalLayout\",\n            attributes = {\n              preferredHeight = 40,\n              spacing         = 8\n            },\n            children = {\n              {\n                tag = \"Image\",\n                attributes = {\n                  id              = playerColor .. \"_classbreakpoints_icon\",\n                  image           = \"\",\n                  preserveAspect  = true,\n                  preferredWidth  = 36,\n                  preferredHeight = 36\n                }\n              },\n              {\n                tag = \"Text\",\n                attributes = {\n                  id              = playerColor .. \"_classbreakpoints_header\",\n                  text            = \"\",\n                  fontSize        = UITheme.sizes.fontSize.xl,\n                  fontStyle       = \"Bold\",\n                  color           = UITheme.colors.text,\n                  alignment       = \"MiddleLeft\"\n                }\n              }\n            }\n          },\n          -- Description\n          {\n            tag = \"Text\",\n            attributes = {\n              id                 = playerColor .. \"_classbreakpoints_desc\",\n              text               = \"\",\n              fontSize           = UITheme.sizes.fontSize.md,\n              color              = UITheme.colors.muted,\n              alignment          = \"UpperLeft\",\n              horizontalOverflow = \"Wrap\",\n              preferredHeight    = 55\n            }\n          },\n          -- Tags row (placeholder)\n          {\n            tag = \"Text\",\n            attributes = {\n              id              = playerColor .. \"_classbreakpoints_tags\",\n              text            = \"\",\n              fontSize        = UITheme.sizes.fontSize.xs,\n              color           = UITheme.colors.muted,\n              alignment       = \"UpperLeft\",\n              preferredHeight = 20\n            }\n          },\n          -- Breakpoints content - simple text list\n          {\n            tag = \"Text\",\n            attributes = {\n              id                 = playerColor .. \"_classbreakpoints_content\",\n              text               = \"\",\n              fontSize           = UITheme.sizes.fontSize.lg,\n              color              = UITheme.colors.text,\n              alignment          = \"UpperLeft\",\n              horizontalOverflow = \"Wrap\",\n              verticalOverflow   = \"Overflow\",\n              preferredHeight    = 380\n            }\n          },\n          -- Footer\n          {\n            tag = \"Text\",\n            attributes = {\n              id                 = playerColor .. \"_classbreakpoints_footer\",\n              text               = \"\",\n              fontSize           = UITheme.sizes.fontSize.xs,\n              color              = UITheme.colors.muted,\n              fontStyle          = \"Italic\",\n              alignment          = \"UpperLeft\",\n              horizontalOverflow = \"Wrap\",\n              preferredHeight    = 30\n            }\n          }\n        }\n      }\n    }\n  }\nend\n\n-------------------------------------------------------------------------------\n-- MARK: State-Driven UI Building\n-------------------------------------------------------------------------------\n\n--- Build UI elements for Lobby State (before game starts)\n--- Only shows character selection panel\n---@param xml table The XML array to append elements to\nfunction UILib.buildLobbyStateUI(xml)\n  -- Use LobbyUI module for character select panel\n  local lobbyPanel = LobbyUI.build()\n  if lobbyPanel then\n    table.insert(xml, lobbyPanel)\n  end\n\n  -- Use GlobalUI module for announcement panel (can show announcements even in lobby)\n  local announcement = GlobalUI.buildAnnouncement()\n  if announcement then\n    table.insert(xml, announcement)\n  end\nend\n\n--- Build UI elements for Started State (after game starts)\n--- Shows full game UI with player sidebars, panels, and controls\n---@param xml table The XML array to append elements to\nfunction UILib.buildStartedStateUI(xml)\n  -- Per-player UI elements\n  for _, playerColor in ipairs(PLAYER_COLORS) do\n    -- Use SidebarUI module for sidebar with traits and tools\n    local sidebar = SidebarUI.build(playerColor)\n    if sidebar then\n      table.insert(xml, sidebar)\n    end\n\n    -- Use DebugPanelUI module for debug panel\n    local debugPanel = DebugPanelUI.build(playerColor)\n    if debugPanel then\n      table.insert(xml, debugPanel)\n    end\n\n    -- Use DiceSpawnerUI module for dice spawner\n    local diceSpawner = DiceSpawnerUI.build(playerColor)\n    if diceSpawner then\n      table.insert(xml, diceSpawner)\n    end\n\n    -- Use RuneSelectorUI module for rune selector\n    local runeSelector = RuneSelectorUI.build(playerColor)\n    if runeSelector then\n      table.insert(xml, runeSelector)\n    end\n\n    -- Use ResourceTrackerUI module for blood/VP tracking\n    local resourceTracker = ResourceTrackerUI.build(playerColor)\n    if resourceTracker then\n      table.insert(xml, resourceTracker)\n    end\n\n    -- Keep reference, tooltip, and class breakpoints windows from UILib for now\n    table.insert(xml, UILib.buildReferenceWindow(playerColor))\n    table.insert(xml, UILib.buildTooltipWindow(playerColor))\n    table.insert(xml, UILib.buildClassBreakpointsWindow(playerColor))\n  end\n\n  -- Use GlobalUI module for global UI elements\n  local topButtons = GlobalUI.buildTopButtons()\n  if topButtons then\n    table.insert(xml, topButtons)\n  end\n\n  local realmNav = GlobalUI.buildRealmNavigator()\n  if realmNav then\n    table.insert(xml, realmNav)\n  end\n\n  local announcement = GlobalUI.buildAnnouncement()\n  if announcement then\n    table.insert(xml, announcement)\n  end\n\n  -- Add per-player navigation selectors\n  for _, playerColor in ipairs(PLAYER_COLORS) do\n    local navSelector = GlobalUI.buildNavigationSelector(playerColor)\n    if navSelector then\n      table.insert(xml, navSelector)\n    end\n  end\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Main XML Generation Function (State-Driven)\n-------------------------------------------------------------------------------\n\n--- Create and apply the global UI based on current game state\n--- Checks GameState.gameStarted to determine which UI to show\nfunction UILib.createGlobalXml()\n  local xml = {}\n\n  if GameState.gameStarted then\n    -- STARTED STATE: Full game UI\n    UILib.buildStartedStateUI(xml)\n  else\n    -- LOBBY STATE: Character select only\n    UILib.buildLobbyStateUI(xml)\n  end\n\n  -- Apply the XML to the UI (restricted to valid seated player colors)\n  local root = {\n    tag = \"Panel\",\n    attributes = {\n      id = \"root_player_ui\",\n      visibility = UITheme.getPlayerVisibility(),\n      width = \"100%\",\n      height = \"100%\"\n    },\n    children = xml\n  }\n  UI.setXmlTable({ root })\n\n  -- Re-apply reference sheet URL after UI rebuild (it gets lost when XML is reset)\n  if GameState.gameStarted and GameState.referenceSheetUrl then\n    Wait.frames(function()\n      for _, playerColor in ipairs(PLAYER_COLORS) do\n        UI.setAttribute(playerColor .. \"_reference_image\", \"image\", GameState.referenceSheetUrl)\n      end\n    end, 2)\n  end\n\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Tooltip Functions\n-------------------------------------------------------------------------------\n\nfunction UILib.onHover(player, guid, panelId)\n  local ttName = getObjectFromGUID(guid).UI.getAttribute(panelId, \"ttName\")\n\n  UI.setAttribute(player.color .. \"_tooltip_title\", \"text\", ttName)\n  UI.setAttribute(player.color .. \"_tooltip_text\", \"text\", TOOLTIP_DATA[ttName])\n  UI.setAttribute(player.color .. \"_tooltip_window\", \"active\", true)\nend\n\nfunction UILib.onExit(player, guid, panelId)\n  UI.setAttribute(player.color .. \"_tooltip_window\", \"active\", false)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Reference Window Functions\n-------------------------------------------------------------------------------\n\nfunction UILib.showReference(player)\n  UI.setAttribute(player.color .. \"_reference_window\", \"active\", true)\nend\n\nfunction UILib.closeReference(player)\n  UI.setAttribute(player.color .. \"_reference_window\", \"active\", false)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Dynamic UI Update Functions\n-------------------------------------------------------------------------------\n\n--- Update all UI elements for a specific player\n--- Class reference is now static, so this is a no-op for traits\n---@param playerColor string The player color\nfunction UILib.updatePlayerUI(playerColor)\n  -- Class reference section is static, no updates needed\n  -- Keep this function for backwards compatibility with other modules\nend\n\n--- Force immediate UI update without debouncing\n--- Class reference is now static, so this is a no-op for traits\n---@param playerColor string The player color\nfunction UILib.updatePlayerUIImmediate(playerColor)\n  -- Class reference section is static, no updates needed\n  -- Keep this function for backwards compatibility with other modules\nend\n\n--- Update the Spirit World draw button state (draw vs discard)\n---@param isDiscardMode boolean True if player needs to discard, false for draw mode\nfunction UILib.updateDraw2Pick1Button(isDiscardMode)\n  if isDiscardMode then\n    UI.setAttribute(\"btn_draw2pick1_label\", \"text\", \"Discard Hand (Spirit World)\")\n    UI.setAttribute(\"btn_draw2pick1\", \"color\", UITheme.colors.danger)\n    UI.setAttribute(\"btn_draw2pick1_label\", \"color\", UITheme.colors.text)\n  else\n    UI.setAttribute(\"btn_draw2pick1_label\", \"text\", \"Draw 4 Spirits, Summon 2 (Spirit World)\")\n    UI.setAttribute(\"btn_draw2pick1\", \"color\", UITheme.colors.surface)\n    UI.setAttribute(\"btn_draw2pick1_label\", \"color\", UITheme.colors.text)\n  end\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Debug Panel Functions\n-------------------------------------------------------------------------------\n\n--- Show the debug panel for a player (delegates to DebugPanelUI)\n---@param player object The player object\nfunction UILib.showDebugPanel(player)\n  local playerColor = player.color\n  local charName = GameState.selectedCharacters[playerColor] or \"None\"\n  local playerState = PlayerMatLib.getState(playerColor)\n\n  -- Delegate to DebugPanelUI module for update logic\n  DebugPanelUI.update(playerColor, playerState, charName)\n\n  -- Show the panel\n  DebugPanelUI.show(playerColor)\nend\n\n--- Close the debug panel for a player\n---@param player object The player object\nfunction UILib.closeDebugPanel(player)\n  DebugPanelUI.hide(player.color)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Class Breakpoints Panel Functions\n-------------------------------------------------------------------------------\n\n--- Show the class breakpoints panel for a player\n---@param player object The player object\n---@param className string The class name to display\nfunction UILib.showClassBreakpoints(player, className)\n  local playerColor = player.color\n  local classData = GameState.classesByName[className]\n\n  if not classData then\n    player.broadcast(\"Class data not found for: \" .. className, {1, 0, 0})\n    return\n  end\n\n  -- Set header and icon\n  UI.setAttribute(playerColor .. \"_classbreakpoints_header\", \"text\", className)\n  UI.setAttribute(playerColor .. \"_classbreakpoints_icon\", \"image\", classData.icon_url or \"\")\n\n  -- Set description\n  UI.setAttribute(playerColor .. \"_classbreakpoints_desc\", \"text\", classData.description or \"\")\n\n  -- Set tags if available\n  local tagsText = \"\"\n  if classData.tags and #classData.tags \u003e 0 then\n    tagsText = table.concat(classData.tags, \"  \")\n  end\n  UI.setAttribute(playerColor .. \"_classbreakpoints_tags\", \"text\", tagsText)\n\n  -- Build breakpoints content - simple format like reference image\n  local lines = {}\n  if classData.effect_schema then\n    local sortedBreakpoints = {}\n    for _, bp in ipairs(classData.effect_schema) do\n      table.insert(sortedBreakpoints, bp)\n    end\n    table.sort(sortedBreakpoints, function(a, b) return a.count \u003c b.count end)\n\n    for _, breakpoint in ipairs(sortedBreakpoints) do\n      -- Build line: (count) effect1  effect2\n      local effectParts = {}\n      if breakpoint.effects then\n        for _, effect in ipairs(breakpoint.effects) do\n          if effect.type == \"dice\" then\n            local diceData = GameState.diceById[effect.dice_id]\n            local diceName = diceData and diceData.name or \"?\"\n            table.insert(effectParts, effect.quantity .. \"x \" .. diceName)\n          elseif effect.type == \"benefit\" and effect.description then\n            table.insert(effectParts, effect.description)\n          end\n        end\n      end\n\n      local effectStr = table.concat(effectParts, \"   \")\n      local line = \"(\" .. breakpoint.count .. \")  \" .. effectStr\n      table.insert(lines, line)\n    end\n  end\n\n  local contentText = table.concat(lines, \"\\n\\n\")\n  UI.setAttribute(playerColor .. \"_classbreakpoints_content\", \"text\", contentText)\n\n  -- Set footer\n  local footerText = classData.footer or \"\"\n  UI.setAttribute(playerColor .. \"_classbreakpoints_footer\", \"text\", footerText)\n\n  -- Calculate dynamic panel height based on number of breakpoints\n  local numBreakpoints = classData.effect_schema and #classData.effect_schema or 0\n  local baseHeight = 160  -- Header, description, tags, footer, padding\n  local perBreakpointHeight = 45  -- Height per breakpoint line (with double spacing)\n  local calculatedHeight = baseHeight + (numBreakpoints * perBreakpointHeight)\n\n  -- Set minimum and maximum bounds\n  calculatedHeight = math.max(200, math.min(calculatedHeight, 700))\n\n  UI.setAttribute(playerColor .. \"_classbreakpoints_window\", \"height\", calculatedHeight)\n\n  -- Also adjust content area height\n  local contentHeight = numBreakpoints * perBreakpointHeight\n  UI.setAttribute(playerColor .. \"_classbreakpoints_content\", \"preferredHeight\", contentHeight)\n\n  -- Show the panel\n  UI.setAttribute(playerColor .. \"_classbreakpoints_window\", \"active\", true)\nend\n\n--- Close the class breakpoints panel for a player\n---@param player object The player object\nfunction UILib.closeClassBreakpoints(player)\n  UI.setAttribute(player.color .. \"_classbreakpoints_window\", \"active\", false)\n  UILib.openClassBreakpointsFor[player.color] = nil\nend\n\n-- Track which class panel is open per player\nUILib.openClassBreakpointsFor = {}\n\n--- Toggle the class breakpoints panel - close if same class, open if different\n---@param player object The player object\n---@param className string The class name to display\nfunction UILib.toggleClassBreakpoints(player, className)\n  local playerColor = player.color\n  local currentlyOpen = UILib.openClassBreakpointsFor[playerColor]\n\n  if currentlyOpen == className then\n    -- Same class clicked, close the panel\n    UILib.closeClassBreakpoints(player)\n  else\n    -- Different class or no panel open, show the new one\n    UILib.showClassBreakpoints(player, className)\n    UILib.openClassBreakpointsFor[playerColor] = className\n  end\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Rune Selector Panel Functions\n-------------------------------------------------------------------------------\n\n-- Track which rune slot is being edited per player\nUILib.activeRuneSlot = {}\n\n-- Track dice spawn counts per player (diceId -\u003e count)\nUILib.diceSpawnCounts = {}\n\n--- Open the rune selector panel for a specific slot\n---@param player object The player object\n---@param slotIndex number The rune slot index (1-4)\nfunction UILib.openRuneSelector(player, slotIndex)\n  local playerColor = player.color\n  UILib.activeRuneSlot[playerColor] = slotIndex\n\n  -- Update header to show slot number\n  UI.setAttribute(playerColor .. \"_runeselector_header\", \"text\", \"Select Rune (Slot \" .. slotIndex .. \")\")\n\n  -- Show the panel\n  UI.setAttribute(playerColor .. \"_runeselector_window\", \"active\", true)\nend\n\n--- Close the rune selector panel\n---@param player object The player object\nfunction UILib.closeRuneSelector(player)\n  local playerColor = player.color\n  UILib.activeRuneSlot[playerColor] = nil\n  UI.setAttribute(playerColor .. \"_runeselector_window\", \"active\", false)\nend\n\n--- Handle rune selection - spawn the rune at the appropriate slot position\n---@param player object The player object\n---@param runeId string The selected rune's ID\nfunction UILib.selectRune(player, runeId)\n  local playerColor = player.color\n  local slotIndex = UILib.activeRuneSlot[playerColor]\n\n  if not slotIndex then\n    player.broadcast(\"No rune slot selected\", {1, 0, 0})\n    return\n  end\n\n  local runeData = GameState.runesById[runeId]\n  if not runeData then\n    player.broadcast(\"Rune data not found\", {1, 0, 0})\n    return\n  end\n\n  -- Get the player's mat from PlayerMatLib\n  local PlayerMatLibLocal = require(\"game/PlayerMatLib\")\n  local playermat = PlayerMatLibLocal.getPlayerMatObject(playerColor)\n\n  if not playermat then\n    player.broadcast(\"Player mat not found\", {1, 0, 0})\n    return\n  end\n\n  -- Get world position for this rune slot using RUNE_SLOT_POSITIONS\n  local slotData = UILib.RUNE_SLOT_POSITIONS[slotIndex]\n  if not slotData then\n    player.broadcast(\"Invalid rune slot\", {1, 0, 0})\n    return\n  end\n\n  -- slotData.local_pos is already a Vector, use it directly\n  local worldPos = playermat.positionToWorld(slotData.local_pos)\n  worldPos.y = worldPos.y + 0.5  -- Spawn slightly above\n\n  -- Use ObjectTemplateLib to create the rune object\n  local runeObj = ObjectTemplateLib.getTemplate(\"Tile\")\n  runeObj.Nickname = runeData.name\n  runeObj.CustomImage.ImageURL = runeData.icon_url\n  runeObj.CustomImage.CustomTile.Type = 2         -- Circle tile\n  runeObj.CustomImage.CustomTile.Thickness = 0.2\n  runeObj.CustomImage.CustomTile.Stretch = true\n  runeObj.Transform.scaleX = 1\n  runeObj.Transform.scaleY = 1\n  runeObj.Transform.scaleZ = 1\n  runeObj.ColorDiffuse = { r = 0, g = 0, b = 0 }  -- Black (matches working runes)\n  runeObj.Tags = { \"Rune\" }\n  runeObj.GMNotes = JSON.encode({\n    id = runeData.id,\n    type = runeData.type,\n    originId = runeData.origin_id,\n    classId = runeData.class_id\n  })\n\n  -- Spawn the rune\n  spawnObjectData({\n    data = runeObj,\n    position = worldPos,\n    rotation = playermat.getRotation(),\n    callback_function = function(obj)\n      player.broadcast(\"Spawned \" .. runeData.name .. \" rune\", {0.5, 1, 0.5})\n    end\n  })\n\n  -- Close the selector\n  UILib.closeRuneSelector(player)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Dice Spawner Panel Functions\n-------------------------------------------------------------------------------\n\n--- Open the dice spawner panel for a player\n---@param player object The player object\nfunction UILib.showDiceSpawner(player)\n  local playerColor = player.color\n  local customDice = GameState.customDice or {}\n\n  -- Build combined dice list with Defense Dice first (from DiceSpawnerUI module)\n  local defenseDice = DiceSpawnerUI.getDefenseDice()\n  local allDice = { defenseDice }\n  for _, d in ipairs(customDice) do\n    table.insert(allDice, d)\n  end\n\n  -- Initialize dice counts only if not already set (persistent)\n  if not UILib.diceSpawnCounts[playerColor] then\n    UILib.diceSpawnCounts[playerColor] = {}\n    for _, diceData in ipairs(allDice) do\n      local isDefense = diceData.name and string.lower(diceData.name):find(\"defense\")\n      local defaultCount = isDefense and 1 or 0\n      UILib.diceSpawnCounts[playerColor][diceData.id] = defaultCount\n    end\n  end\n\n  -- Update UI to show current counts\n  for _, diceData in ipairs(allDice) do\n    local count = UILib.diceSpawnCounts[playerColor][diceData.id] or 0\n    UI.setAttribute(playerColor .. \"_dice_count_\" .. diceData.id, \"text\", tostring(count))\n  end\n\n  -- Show the panel\n  UI.setAttribute(playerColor .. \"_dicespawner_window\", \"active\", true)\nend\n\n--- Close the dice spawner panel\n---@param player object The player object\nfunction UILib.closeDiceSpawner(player)\n  local playerColor = player.color\n  -- Don't clear counts - keep them persistent\n  UI.setAttribute(playerColor .. \"_dicespawner_window\", \"active\", false)\nend\n\n--- Adjust the count for a specific dice type\n---@param player object The player object\n---@param diceId string The dice ID\n---@param delta number The amount to adjust (+1 or -1)\nfunction UILib.adjustDiceCount(player, diceId, delta)\n  local playerColor = player.color\n\n  -- Initialize if needed\n  if not UILib.diceSpawnCounts[playerColor] then\n    UILib.diceSpawnCounts[playerColor] = {}\n  end\n\n  local currentCount = UILib.diceSpawnCounts[playerColor][diceId] or 0\n  local newCount = math.max(0, math.min(10, currentCount + delta))  -- Clamp 0-10\n  UILib.diceSpawnCounts[playerColor][diceId] = newCount\n\n  -- Update UI\n  UI.setAttribute(playerColor .. \"_dice_count_\" .. diceId, \"text\", tostring(newCount))\nend\n\n--- Spawn all selected dice on the player's mat\n---@param player object The player object\nfunction UILib.spawnSelectedDice(player)\n  local playerColor = player.color\n  local counts = UILib.diceSpawnCounts[playerColor]\n\n  if not counts then\n    player.broadcast(\"No dice selected\", {1, 0.5, 0.5})\n    return\n  end\n\n  -- Get the player's mat\n  local playermat = PlayerMatLib.getPlayerMatObject(playerColor)\n  if not playermat then\n    player.broadcast(\"Player mat not found\", {1, 0, 0})\n    return\n  end\n\n  -- Clear old spawned dice for this player\n  local diceTag = \"SpawnedDice_\" .. playerColor\n  for _, obj in ipairs(getObjectsWithTag(diceTag)) do\n    obj.destruct()\n  end\n\n  -- Calculate spawn position (center-right of mat, above it)\n  local matRot = playermat.getRotation()\n\n  -- Count total dice to spawn\n  local totalDice = 0\n  for _, count in pairs(counts) do\n    totalDice = totalDice + count\n  end\n\n  if totalDice == 0 then\n    player.broadcast(\"No dice selected to spawn\", {1, 0.5, 0.5})\n    return\n  end\n\n  -- Spawn dice in a 5x5 grid pattern\n  local diceIndex = 0\n  local gridCols = 5\n  local spacingX = 0.25  -- Gap between columns\n  local spacingZ = 0.25  -- Gap between rows\n\n  local defenseDice = DiceSpawnerUI.getDefenseDice()\n  for diceId, count in pairs(counts) do\n    if count \u003e 0 then\n      -- Look up dice data (check for defense dice first via DiceSpawnerUI)\n      local diceData = diceId == \"defense_dice\" and defenseDice or GameState.diceById[diceId]\n      if diceData then\n        -- Get image URL (handle both transformed and raw API data)\n        local imageUrl = diceData.imageUrl or diceData.prefab_image_url\n        if not imageUrl or imageUrl == \"\" then\n          -- Skip this dice type if no image\n        else\n          -- Determine dice configuration (only \"Defense Dice\" is d12, all others are d6)\n          local isD12 = diceData.name and string.lower(diceData.name):find(\"defense\")\n          local customDiceType = isD12 and 4 or 1\n\n          for i = 1, count do\n            -- Calculate grid position (5 columns, rows go upward in Z)\n            local col = diceIndex % gridCols\n            local row = math.floor(diceIndex / gridCols)\n\n            -- Local offset: columns spread along X, rows spread along Z (upward on mat)\n            local localX = -0.5 - (col * spacingX)\n            local localZ = row * spacingZ\n            local spawnPos = playermat.positionToWorld(Vector(localX, 0.5, localZ))\n\n            -- Capture values for closure\n            local capturedImageUrl = imageUrl\n            local capturedType = customDiceType\n            local capturedName = diceData.name\n            local capturedIndex = diceIndex\n            local capturedY = matRot.y\n            local capturedSpawnPos = spawnPos\n            local capturedDiceTag = diceTag\n\n            -- Use spawnObjectData with template (avoids URL prompt)\n            Wait.frames(function()\n              local diceTemplate = ObjectTemplateLib.getTemplate(\"Dice\")\n              diceTemplate.Nickname = capturedName\n              diceTemplate.CustomImage.ImageURL = capturedImageUrl\n              diceTemplate.CustomImage.CustomDice.Type = capturedType\n              diceTemplate.Transform.posX = capturedSpawnPos.x\n              diceTemplate.Transform.posY = capturedSpawnPos.y\n              diceTemplate.Transform.posZ = capturedSpawnPos.z\n              diceTemplate.Transform.rotY = capturedY\n              diceTemplate.Tags = { \"Die\", capturedDiceTag }\n\n              spawnObjectData({ data = diceTemplate })\n            end, capturedIndex * 5)\n\n            diceIndex = diceIndex + 1\n          end\n        end\n      end\n    end\n  end\n\n  player.broadcast(\"Spawning \" .. totalDice .. \" dice...\", {0.5, 1, 0.5})\n\n  -- Close the panel\n  UILib.closeDiceSpawner(player)\nend\n\n-------------------------------------------------------------------------------\n-- MARK: Global Announcement Functions\n-------------------------------------------------------------------------------\n\n--- Show a large centered announcement on all players' screens\n---@param text string The announcement text\n---@param duration number How long to show in seconds (default 3)\n---@param color table Optional color {r, g, b} (default gold)\nfunction UILib.showGlobalAnnouncement(text, duration, color)\n  duration = duration or 3\n  color = color or {r=1, g=0.84, b=0}\n\n  -- Convert color to hex\n  local colorHex = string.format(\"#%02x%02x%02x\",\n    math.floor(color.r * 255),\n    math.floor(color.g * 255),\n    math.floor(color.b * 255))\n\n  -- Update the announcement text and color\n  UI.setAttribute(\"global_announcement_text\", \"text\", text)\n  UI.setAttribute(\"global_announcement_text\", \"color\", colorHex)\n\n  -- Show the announcement\n  UI.setAttribute(\"global_announcement\", \"active\", true)\n\n  -- Hide after duration\n  Wait.time(function()\n    UI.setAttribute(\"global_announcement\", \"active\", false)\n  end, duration)\nend\n\n--- Show a two-line announcement (main text + subtitle)\n---@param mainText string The main announcement text\n---@param subText string The subtitle text\n---@param duration number How long to show in seconds (default 3)\n---@param mainColor table Optional color for main text {r, g, b} (default gold)\n---@param subColor table Optional color for subtitle {r, g, b} (default white)\nfunction UILib.showGlobalAnnouncementWithSub(mainText, subText, duration, mainColor, subColor)\n  duration = duration or 3\n  mainColor = mainColor or {r=1, g=0.84, b=0}\n  subColor = subColor or {r=1, g=1, b=1}\n\n  -- Convert colors to hex\n  local mainColorHex = string.format(\"#%02x%02x%02x\",\n    math.floor(mainColor.r * 255),\n    math.floor(mainColor.g * 255),\n    math.floor(mainColor.b * 255))\n  local subColorHex = string.format(\"#%02x%02x%02x\",\n    math.floor(subColor.r * 255),\n    math.floor(subColor.g * 255),\n    math.floor(subColor.b * 255))\n\n  -- Update the announcement text and color\n  UI.setAttribute(\"global_announcement_text\", \"text\", mainText)\n  UI.setAttribute(\"global_announcement_text\", \"color\", mainColorHex)\n  UI.setAttribute(\"global_announcement_subtext\", \"text\", subText)\n  UI.setAttribute(\"global_announcement_subtext\", \"color\", subColorHex)\n\n  -- Show the announcement\n  UI.setAttribute(\"global_announcement\", \"active\", true)\n\n  -- Hide after duration\n  Wait.time(function()\n    UI.setAttribute(\"global_announcement\", \"active\", false)\n  end, duration)\nend\n\nreturn UILib\nend)\n__bundle_register(\"ui/UITheme\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-------------------------------------------------------------------------------\n-- UITheme: Centralized theme constants for UI styling\n-- Industry-standard 5-color palette inspired by Material Design / Tailwind\n-------------------------------------------------------------------------------\n\nlocal UITheme = {}\n\n-------------------------------------------------------------------------------\n-- Typography\n-------------------------------------------------------------------------------\n\nUITheme.fonts = {\n  primary = \"font_opsilon/opsilon-regular\",\n  italic = \"font_opsilon/opsilon-italic\"\n}\n\n-------------------------------------------------------------------------------\n-- Colors - Simplified 5-Color System\n-------------------------------------------------------------------------------\n\nUITheme.colors = {\n  -- CORE PALETTE (5 colors)\n  background = \"#0a0a12\",    -- Darkest - main background\n  surface = \"#1a1a2e\",       -- Panels, cards, elevated content\n  primary = \"#4a6fa5\",       -- Accent color for actions, highlights\n  text = \"White\",            -- Primary text\n  muted = \"#666666\",         -- Secondary text, borders, disabled states\n\n  -- SEMANTIC VARIANTS (derived from core)\n  success = \"#2d5d2d\",       -- Green - confirm, start game, positive actions\n  danger = \"#5d2d2d\",        -- Red - reset, delete, warnings, destructive actions\n\n  -- BREAKPOINTS (game-specific progression tiers)\n  breakpoints = {\n    bronze = \"#cd7f32\",\n    silver = \"#c0c0c0\",\n    gold = \"#ffd700\",\n    prismatic = \"#ff69b4\"\n  }\n}\n\n-------------------------------------------------------------------------------\n-- Sizes\n-------------------------------------------------------------------------------\n\nUITheme.sizes = {\n  fontSize = { xs = 12, sm = 14, md = 16, lg = 18, xl = 20, xxl = 24, huge = 28 },\n  spacing = { xs = 2, sm = 4, md = 8, lg = 12 },\n  padding = {\n    xs = \"2 2 2 2\",\n    sm = \"4 4 4 4\",\n    md = \"8 8 8 8\",\n    lg = \"12 12 12 12\",\n    xl = \"20 20 20 20\"\n  },\n  buttonHeight = { sm = 28, md = 36, lg = 44 }\n}\n\n-------------------------------------------------------------------------------\n-- Positions\n-------------------------------------------------------------------------------\n\nUITheme.positions = {\n  sidebar = { alignment = \"LowerRight\", offset = \"-5 10\", width = 240, height = 560 },\n  debugPanel = { alignment = \"MiddleCenter\", width = 400, height = 580 },\n  diceSpawner = { alignment = \"MiddleCenter\", width = 400, height = 600 },\n  runeSelector = { alignment = \"LowerRight\", offset = \"-260 100\", width = 300, height = 400 },\n  characterSelect = { alignment = \"MiddleCenter\", width = 800, height = 600 }\n}\n\n-------------------------------------------------------------------------------\n-- Valid Player Colors (TTS-specific)\n-------------------------------------------------------------------------------\n\nUITheme.validPlayerColors = { \"Red\", \"Orange\", \"Yellow\", \"Green\", \"Blue\", \"Purple\" }\n\n-------------------------------------------------------------------------------\n-- Helper Functions\n-------------------------------------------------------------------------------\n\n--- Get the visibility string for all valid player colors\n---@return string Pipe-separated player colors for XML visibility\nfunction UITheme.getPlayerVisibility()\n  return table.concat(UITheme.validPlayerColors, \"|\")\nend\n\nreturn UITheme\nend)\n__bundle_register(\"util/ObjectTemplateLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\ndo\n  local ObjectTemplateLib = {}\n  local TableLib          = require(\"util/TableLib\")\n\n  local TEMPLATES         = {\n    bag = {\n      Name             = \"Bag\",\n      Transform        = {\n        rotY   = 180,\n        scaleX = 1,\n        scaleY = 1,\n        scaleZ = 1\n      },\n      Nickname         = \"Bag\",\n      ColorDiffuse     = { r = 0.7, g = 0.35, b = 0 },\n      Bag              = { Order = 0 },\n      ContainedObjects = {}\n    },\n    customspiritbag = {\n      Name             = \"Custom_Model_Bag\",\n      Transform        = {\n        rotY   = 180,\n        scaleX = 1,\n        scaleY = 1,\n        scaleZ = 1\n      },\n      Nickname         = \"Bag\",\n      ColorDiffuse     = { r = 0.7, g = 0.35, b = 0 },\n      Number           = 0,\n      CustomMesh       = {\n        MeshURL       =\n        \"https://steamusercontent-a.akamaihd.net/ugc/1666858349285421330/85514136CA7CC07D1571B594321C1D3D01DC2B2C/\",\n        DiffuseURL    = \"\",\n        NormalURL     = \"\",\n        ColliderURL   = \"\",\n        Convex        = true,\n        MaterialIndex = 0,\n        TypeIndex     = 6,\n        CastShadows   = true\n      },\n      Bag              = { Order = 0 },\n      ContainedObjects = {},\n      ChildObjects     = {\n        {\n          Name = \"Custom_Token\",\n          Transform = {\n            posX = 0,\n            posY = 0.5,\n            posZ = 0,\n            rotX = 0,\n            rotY = 0,\n            rotZ = 0,\n            scaleX = 0.294,\n            scaleY = 10,\n            scaleZ = 0.321\n          },\n          AltLookAngle = { x = 0, y = 0, z = 0 },\n          ColorDiffuse = { r = 1, g = 1, b = 1 },\n          Locked = true,\n          CustomImage = {\n            ImageURL          = \"\",\n            ImageSecondaryURL = \"\",\n            ImageScalar       = 1,\n            WidthScale        = 0,\n            CustomToken       = {\n              Thickness           = 0.1,\n              MergeDistancePixels = 15,\n              StandUp             = false,\n              Stackable           = false\n            }\n          }\n        }\n      }\n    },\n    tile = {\n      Name = \"Custom_Tile\",\n      Transform = {\n        rotY   = 180,\n        scaleX = 1,\n        scaleY = 1,\n        scaleZ = 1\n      },\n      ColorDiffuse = { r = 1, g = 1, b = 1 },\n      CustomImage = {\n        ImageURL    = \"\",\n        ImageScalar = 1,\n        WidthScale  = 0,\n        CustomTile  = {\n          Type      = 0,\n          Thickness = 0.2,\n          Stackable = false,\n          Stretch   = true\n        }\n      }\n    },\n    origindestinytile = {\n      Name = \"Custom_Tile\",\n      Transform = {\n        rotY   = 180,\n        scaleX = 2.56,\n        scaleY = 1,\n        scaleZ = 2.2\n      },\n      ColorDiffuse = { r = 1, g = 1, b = 1 },\n      CustomImage = {\n        ImageURL          = \"\",\n        ImageSecondaryURL = \"\",\n        ImageScalar       = 1,\n        WidthScale        = 1,\n        CustomTile = {\n          Type      = 1,\n          Thickness = 0.2,\n          Stackable = false,\n          Stretch   = true\n        }\n      }\n    },\n    token = {\n      Name = \"Custom_Token\",\n      Transform = {\n        rotY   = 180,\n        scaleX = 1,\n        scaleY = 1,\n        scaleZ = 1\n      },\n      ColorDiffuse = { r = 1, g = 1, b = 1 },\n      CustomImage = {\n        ImageURL    = \"\",\n        ImageScalar = 1,\n        WidthScale  = 0,\n        CustomToken = {\n          Thickness           = 0.2,\n          MergeDistancePixels = 25,\n          StandUp             = false,\n          Stackable           = false\n        }\n      }\n    },\n    figurine = {\n      Name = \"Figurine_Custom\",\n      Transform = {\n        rotY   = 180,\n        scaleX = 1,\n        scaleY = 1,\n        scaleZ = 1\n      },\n      ColorDiffuse = { r = 1, g = 1, b = 1 },\n      CustomImage = {\n        ImageURL    = \"\",\n        ImageSecondaryURL = \"\",\n        ImageScalar = 2.25\n      }\n    },\n    card = {\n      Name = \"Card\",\n      Transform = {\n        rotY   = 180,\n        scaleX = 1,\n        scaleY = 1,\n        scaleZ = 1\n      },\n      CardID = 100,\n      CustomDeck = {\n        [\"1\"] = {\n          BackIsHidden = true,\n          BackURL      = \"\",\n          FaceURL      = \"\",\n          NumHeight    = 1,\n          NumWidth     = 1,\n          Type         = 0,\n          UniqueBack   = false\n        }\n      }\n    },\n    dice = {\n      Name = \"Custom_Dice\",\n      Transform = {\n        rotY   = 0,\n        scaleX = 2,\n        scaleY = 2,\n        scaleZ = 2\n      },\n      ColorDiffuse = { r = 1, g = 1, b = 1 },\n      CustomImage = {\n        ImageURL          = \"\",\n        ImageSecondaryURL = \"\",\n        CustomDice = {\n          Type = 1  -- 1=d6, 4=d12\n        }\n      }\n    }\n  }\n\n  function ObjectTemplateLib.getTemplate(objectType)\n    local template = TEMPLATES[string.lower(objectType)]\n    if not template then\n      printToAll(\"Did not find an object template for \" .. objectType .. \".\", \"Red\")\n      return\n    end\n    return TableLib.copy(template)\n  end\n\n  return ObjectTemplateLib\nend\nend)\n__bundle_register(\"util/SearchLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\ndo\n  local SearchLib = {}\n  -- GUIDs for token identification (from infinite bags)\n  local ARCANE_DROPLET_BAG_GUID = \"7e57bc\"\n  local VICTORY_POINT_BAG_GUID = \"328e19\"\n\n  local FILTER_FUNCTIONS = {\n    isCard            = function(x) return x.type == \"Card\" end,\n    isDeck            = function(x) return x.type == \"Deck\" end,\n    isCardOrDeck      = function(x) return x.type == \"Card\" or x.type == \"Deck\" end,\n    isInteractable    = function(x) return x.interactable end,\n    isTileOrToken     = function(x) return not x.Book and (x.type == \"Tile\" or x.type == \"Generic\") end,\n    isHexSpirit       = function(x) return x.hasTag(\"HexSpirit\") end,\n    isSpiritContainer = function(x) return x.hasTag(\"SpiritContainer\") end,\n    isRune            = function(x) return x.hasTag(\"Rune\") end,\n    isDie             = function(x) return x.hasTag(\"Die\") end,\n    isBarrier         = function(x) return x.hasTag(\"Barrier\") end,\n    isOriginDestiny   = function(x) return x.hasTag(\"OriginDestiny\") end,\n    isPlayermat       = function(x) return x.hasTag(\"Playermat\") end,\n    isArcaneDroplet   = function(x)\n      local notes = x.getGMNotes() or \"\"\n      return notes:find(ARCANE_DROPLET_BAG_GUID) ~= nil or x.getName() == \"Arcane Droplet\"\n    end,\n    isVictoryPoint    = function(x)\n      local notes = x.getGMNotes() or \"\"\n      return notes:find(VICTORY_POINT_BAG_GUID) ~= nil or x.getName() == \"Victory Point\"\n    end\n  }\n\n  -- performs the actual search and returns a filtered list of object references\n  ---@param pos tts__Vector Global position\n  ---@param rot? tts__Vector Global rotation\n  ---@param size table Size\n  ---@param filter? string Name of the filter function\n  ---@param direction? table Direction (positive is up)\n  ---@param maxDistance? number Distance for the cast\n  ---@param debug? boolean Whether the debug boxes should be shown\n  local function returnSearchResult(pos, rot, size, filter, direction, maxDistance, debug)\n    local filterFunc = filter and FILTER_FUNCTIONS[filter]\n    local searchResult = Physics.cast({\n      origin       = pos,\n      direction    = direction or { 0, 1, 0 },\n      orientation  = rot or { 0, 0, 0 },\n      type         = 3,\n      size         = size,\n      max_distance = maxDistance or 0,\n      debug        = debug or false\n    })\n\n    -- filter the result for matching objects\n    local objList = {}\n    for _, v in ipairs(searchResult) do\n      if (not filter or filterFunc(v.hit_object)) then\n        table.insert(objList, v.hit_object)\n      end\n    end\n    return objList\n  end\n\n  -- searches the specified area\n  function SearchLib.inArea(pos, rot, size, filter, debug)\n    return returnSearchResult(pos, rot, size, filter, nil, nil, debug)\n  end\n\n  -- searches the area on an object\n  function SearchLib.onObject(obj, filter, scale, debug)\n    scale      = scale or 1\n    local pos  = obj.getPosition() + Vector(0, 1, 0) -- offset by half the cast's height\n    local size = obj.getBounds().size:scale(scale):setAt(\"y\", 2)\n    return returnSearchResult(pos, nil, size, filter, nil, nil, debug)\n  end\n\n  -- searches the area directly below an object\n  function SearchLib.belowObject(obj, filter, scale, debug)\n    scale        = scale or 1\n    local objPos = obj.getPosition()\n    local pos    = objPos + Vector(0, -objPos.y / 2, 0) -- offset by half the cast's height\n    local size   = obj.getBounds().size:scale(scale):setAt(\"y\", objPos.y)\n    return returnSearchResult(pos, nil, size, filter, nil, nil, debug)\n  end\n\n  -- searches the specified position (a single point)\n  function SearchLib.atPosition(pos, filter, debug)\n    local size = { 0.1, 2, 0.1 }\n    return returnSearchResult(pos, nil, size, filter, nil, nil, debug)\n  end\n\n  -- searches below the specified position (downwards until y = 0)\n  function SearchLib.belowPosition(pos, filter, debug)\n    local size = { 0.1, 2, 0.1 }\n    local direction = { 0, -1, 0 }\n    local maxDistance = pos.y\n    return returnSearchResult(pos, nil, size, filter, direction, maxDistance, debug)\n  end\n\n  return SearchLib\nend\nend)\n__bundle_register(\"util/SpawnLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-- SpawnLib.ttslua\n-- Object spawning utilities for bags and custom objects\n\nlocal SpawnLib = {}\n\n-- Import required libraries\nlocal ObjectTemplateLib = require(\"util/ObjectTemplateLib\")\nlocal UtilLib = require(\"util/UtilLib\")\nlocal GameState = require(\"state/GameState\")\n\n-- Get position, rotation, and GUID from existing bag before destroying it\n-- @param name: Name of the bag object to retrieve data from\n-- @return position: Vector position of the bag\n-- @return rotation: Vector rotation of the bag\n-- @return guid: GUID of the bag\nfunction SpawnLib.getSomeDataFromBag(name)\n  local position, rotation, guid\n  local bag = UtilLib.getObjectByName(name)\n  if bag then\n    position = bag.getPosition()\n    rotation = bag.getRotation()\n    guid     = bag.getGUID()\n    bag.destruct()\n  end\n  return position, rotation, guid\nend\n\n-- Spawn a standard bag with contained objects\n-- @param name: Name/nickname for the bag\n-- @param objectList: Table of objects to contain in the bag\n-- @param position: Vector position to spawn at\n-- @param rotation: Vector rotation (default: 0, 180, 0)\n-- @param scale: Vector scale (default: 2, 2, 2)\n-- @param guid: Optional GUID for the bag\nfunction SpawnLib.spawnBag(name, objectList, position, rotation, scale, guid)\n  local data            = ObjectTemplateLib.getTemplate(\"Bag\")\n  scale                 = scale or Vector(2, 2, 2)\n  rotation              = rotation or Vector(0, 180, 0)\n\n  data.GUID             = guid\n  data.Nickname         = name\n  data.Locked           = true\n  data.ContainedObjects = objectList\n  data.Transform.posX   = position.x\n  data.Transform.posY   = position.y\n  data.Transform.posZ   = position.z\n  data.Transform.rotX   = rotation.x\n  data.Transform.rotY   = rotation.y\n  data.Transform.rotZ   = rotation.z\n  data.Transform.scaleX = scale.x\n  data.Transform.scaleY = scale.y\n  data.Transform.scaleZ = scale.z\n\n  spawnObjectData({ data = data })\nend\n\n-- Spawn a custom spirit bag with custom image and contained objects\n-- @param name: Name/nickname for the spirit bag\n-- @param objectList: Table of objects to contain in the bag\n-- @param position: Vector position to spawn at\n-- @param rotation: Vector rotation (default: 0, 180, 0)\n-- @param scale: Vector scale (default: 6.8, 0.2, 6.24)\n-- @param guid: Optional GUID for the bag\n-- @param url: Image URL for the custom spirit bag appearance\nfunction SpawnLib.spawnCustomSpiritBag(name, objectList, position, rotation, scale, guid, url)\n  local data                                = ObjectTemplateLib.getTemplate(\"CustomSpiritBag\")\n  scale                                     = scale or Vector(6.8, 0.2, 6.24)\n  rotation                                  = rotation or Vector(0, 180, 0)\n\n  data.GUID                                 = guid\n  data.Nickname                             = name\n  data.Locked                               = true\n  data.ContainedObjects                     = objectList\n  data.Transform.posX                       = position.x\n  data.Transform.posY                       = position.y\n  data.Transform.posZ                       = position.z\n  data.Transform.rotX                       = rotation.x\n  data.Transform.rotY                       = rotation.y\n  data.Transform.rotZ                       = rotation.z\n  data.Transform.scaleX                     = scale.x\n  data.Transform.scaleY                     = scale.y\n  data.Transform.scaleZ                     = scale.z\n\n  data.ChildObjects[1].CustomImage.ImageURL = url\n  spawnObjectData({ data = data })\nend\n\n-- Update the image of an object by its name\n-- @param name: Name of the object to update\n-- @param url: New image URL\nfunction SpawnLib.updateObjectImageByName(name, url)\n  local object = UtilLib.getObjectByName(name)\n  if not object then return end\n\n  object.setCustomObject({ image = url })\n  object.reload()\nend\n\n-- Update the image of all objects with a specific tag\n-- @param tag: Tag to search for\n-- @param url: New image URL\nfunction SpawnLib.updateObjectImageByTag(tag, url)\n  for _, object in ipairs(getObjectsWithTag(tag)) do\n    object.setCustomObject({ image = url })\n    object.reload()\n  end\nend\n\n-- Update the image of a child object by parent object name\n-- @param name: Name of the parent object\n-- @param url: New image URL for the child object\nfunction SpawnLib.updateObjectChildImageByName(name, url)\n  local object = UtilLib.getObjectByName(name)\n  if not object then return end\n\n  local data = object.getData()\n  data.ChildObjects[1].CustomImage.ImageURL = url\n  object.destruct()\n  spawnObjectData({ data = data })\nend\n\nreturn SpawnLib\nend)\n__bundle_register(\"util/TableLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\ndo\n  local TableLib = {}\n\n  -- Checks if a list contains an element\n  ---@param t table\n  ---@param ele any\n  function TableLib.contains(t, ele)\n    if t == nil then return false end\n    for k, v in ipairs(t) do\n      if v == ele then return true end\n    end\n    return false\n  end\n\n  -- Copies a table (or returns the original if not a table)\n  ---@param t table\n  function TableLib.copy(t)\n    if type(t) ~= \"table\" then return t end\n    local copy = {}\n    for tKey, tValue in next, t, nil do\n      copy[TableLib.copy(tKey)] = TableLib.copy(tValue)\n    end\n    setmetatable(copy, TableLib.copy(getmetatable(t)))\n    return copy\n  end\n\n  -- Returns the index of an element\n  ---@param t table\n  ---@param ele any\n  function TableLib.getElementIndex(t, ele)\n    if t == nil then return nil end\n    for k, v in ipairs(t) do\n      if v == ele then return k end\n    end\n    return nil\n  end\n\n  -- Returns the keys of a table as new table\n  ---@param t table\n  ---@param filterValue? any Only keys with this value will be extracted\n  function TableLib.getKeys(t, filterValue)\n    local keys = {}\n    for k, v in pairs(t) do\n      if filterValue == nil or v == filterValue then\n        table.insert(keys, k)\n      end\n    end\n    return keys\n  end\n\n  -- Checks if a table is empty\n  ---@param t table\n  function TableLib.isEmpty(t)\n    return next(t) == nil\n  end\n\n  -- Returns a map from a list (value = true)\n  ---@param t table\n  function TableLib.makeMap(t)\n    local m = {}\n    for _, v in ipairs(t) do\n      m[v] = true\n    end\n    return m\n  end\n\n  -- Returns a random list element\n  ---@param t table\n  function TableLib.pickRandom(t)\n    return t[math.random(#t)]\n  end\n\n  -- Returns a reversed list\n  ---@param t table\n  function TableLib.reverse(t)\n    local r = {}\n    for i = #t, 1, -1 do\n      table.insert(r, t[i])\n    end\n    return r\n  end\n\n  -- Shuffles a list in place (Fisher-Yates-Shuffle)\n  ---@param t table\n  function TableLib.shuffle(t)\n    local n = #t\n    while n \u003e 1 do\n      local k = math.random(n)\n      t[n], t[k] = t[k], t[n]\n      n = n - 1\n    end\n    return t\n  end\n\n  -- Returns a copy of a list without duplicates\n  ---@param t table\n  function TableLib.removeDuplicates(t)\n    local seen = {}\n    local result = {}\n    for _, value in ipairs(t) do\n      if not seen[value] then\n        seen[value] = true\n        table.insert(result, value)\n      end\n    end\n    return result\n  end\n\n  return TableLib\nend\nend)\n__bundle_register(\"util/TtsLuaAdditions\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-- Add division by number to Vector class\n---@param vec tts__Vector\n---@param val number\nfunction Vector.__div(vec, val)\n  return vec:copy():scale(1 / val)\nend\n\n-- Add division by number to Color class (does not change alpha)\n---@param col tts__Color\n---@param val number\nfunction Color.__div(col, val)\n  return Color(col.r / val, col.g / val, col.b / val, col.a)\nend\n\n-- Add multiplication by number to Color class (does not change alpha)\n---@param col tts__Color\n---@param val number\nfunction Color.__mul(col, val)\n  return Color(col.r * val, col.g * val, col.b * val, col.a)\nend\nend)\n__bundle_register(\"util/UtilLib\", function(require, _LOADED, __bundle_register, __bundle_modules)\n-- UtilLib: General utility and helper functions\n-- Extracted from Global.ttslua for better modularity\n\nlocal UtilLib = {}\n\n-------------------------------------------------------------------------------\n-- String Utilities\n-------------------------------------------------------------------------------\n\n-- Capitalizes the first letter of a string\n-- @param str: string to capitalize\n-- @return: string with first letter capitalized\nfunction UtilLib.properCase(str)\n  return string.upper(string.sub(str, 1, 1)) .. string.sub(str, 2, -1)\nend\n\n-------------------------------------------------------------------------------\n-- Object Finding\n-------------------------------------------------------------------------------\n\n-- Finds a TTS object by its nickname\n-- @param name: name of the object to find\n-- @return: object if found, nil otherwise\nfunction UtilLib.getObjectByName(name)\n  for _, obj in ipairs(getObjects()) do\n    if obj.getName() == name then\n      return obj\n    end\n  end\n  return nil\nend\n\n-------------------------------------------------------------------------------\n-- Data Parsing\n-------------------------------------------------------------------------------\n\n-- Parses JSON metadata from GMNotes\n-- @param data: JSON string from object.getGMNotes()\n-- @return: parsed table, or empty table if invalid\nfunction UtilLib.getMetadata(data)\n  return JSON.decode(data) or {}\nend\n\n-------------------------------------------------------------------------------\n-- Player Utilities\n-------------------------------------------------------------------------------\n\n-- Generates a BB-code colored string with player name\n-- @param playerColor: player color (e.g., \"Red\", \"Blue\")\n-- @return: colored string with player name\nfunction UtilLib.getColoredName(playerColor)\n  local displayName = playerColor\n  if playerColor ~= \"Grey\" and Player[playerColor].steam_name then\n    displayName = Player[playerColor].steam_name\n  end\n\n  -- add bb-code\n  return \"[\" .. Color.fromString(playerColor):toHex() .. \"]\" .. displayName .. \"[-]\"\nend\n\n-- Gets the playermat object for a specific player color\n-- Finds the mat closest to the player's hand position\n-- @param playerColor: player color (e.g., \"Red\", \"Blue\")\n-- @return: playermat object if found, nil otherwise\nfunction UtilLib.getPlayermat(playerColor)\n  local handData = Player[playerColor].getHandTransform()\n  if not handData then return end\n\n  local startPos = handData.position\n  local result, smallestDistance\n  for _, mat in ipairs(getObjectsWithTag(\"Playermat\")) do\n    local distance = Vector.between(startPos, mat.getPosition()):magnitude()\n    if smallestDistance == nil or distance \u003c smallestDistance then\n      smallestDistance = distance\n      result = mat\n    end\n  end\n  return result\nend\n\nreturn UtilLib\nend)\nreturn __bundle_require(\"__root\")",
  "LuaScriptState": "{\n  \"availableCharacters\": [\n    \"Prox\",\n    \"Pixia\",\n    \"Lumina\",\n    \"Bubblepop\",\n    \"Embers\",\n    \"Myrtle\"\n  ],\n  \"characterMatData\": {\n    \"Bubblepop\": {\n      \"chibiUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/fd8557f7-1cdc-4dde-9941-42b171992432/guardian_cypher_chibi.png?quality=30\",\n      \"iconUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/fd8557f7-1cdc-4dde-9941-42b171992432/guardian_cypher_icon.png?quality=30\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/fd8557f7-1cdc-4dde-9941-42b171992432/guardian_bubblepop_image_mat.png?quality=30\",\n      \"originName\": \"Cyber City\"\n    },\n    \"Embers\": {\n      \"chibiUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/20112149-c8df-48b6-b508-5e9c39e87fc2/guardian_embers_chibi.png?quality=30\",\n      \"iconUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/20112149-c8df-48b6-b508-5e9c39e87fc2/guardian_embers_icon.png?quality=30\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/20112149-c8df-48b6-b508-5e9c39e87fc2/guardian_embers_image_mat.png?quality=30\",\n      \"originName\": \"Lantern Lights\"\n    },\n    \"Lumina\": {\n      \"chibiUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/20ec3d5d-3fd8-4b5b-b75b-127acb325fff/guardian_lumina_chibi.png?quality=30\",\n      \"iconUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/20ec3d5d-3fd8-4b5b-b75b-127acb325fff/guardian_lumina_icon.png?quality=30\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/20ec3d5d-3fd8-4b5b-b75b-127acb325fff/guardian_lumina_image_mat.png?quality=30\",\n      \"originName\": \"Astral Zone\"\n    },\n    \"Myrtle\": {\n      \"chibiUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/3267074b-4f61-457c-b406-12ccf43d068a/guardian_myrtle_chibi.png?quality=30\",\n      \"iconUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/3267074b-4f61-457c-b406-12ccf43d068a/guardian_myrtle_icon.png?quality=30\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/3267074b-4f61-457c-b406-12ccf43d068a/guardian_myrtle_image_mat.png?quality=30\",\n      \"originName\": \"Floral Patch\"\n    },\n    \"Pixia\": {\n      \"chibiUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/8ce23995-bb31-4be8-8fd6-fda19d1f430a/guardian_pixia_chibi.png?quality=30\",\n      \"iconUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/8ce23995-bb31-4be8-8fd6-fda19d1f430a/guardian_pixia_icon.png?quality=30\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/8ce23995-bb31-4be8-8fd6-fda19d1f430a/guardian_pixia_image_mat.png?quality=30\",\n      \"originName\": \"Twilight Fairies\"\n    },\n    \"Prox\": {\n      \"chibiUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/c17484dc-741b-4e9b-9ece-6581c2095fe1/guardian_prox_chibi.png?quality=30\",\n      \"iconUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/c17484dc-741b-4e9b-9ece-6581c2095fe1/guardian_prox_icon.png?quality=30\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/c17484dc-741b-4e9b-9ece-6581c2095fe1/guardian_prox_image_mat.png?quality=30\",\n      \"originName\": \"Royal Family\"\n    }\n  },\n  \"classes\": [\n    {\n      \"color\": \"#88a1d3\",\n      \"description\": \"A strong way to defend against ALL attacks, but comes with variance.\",\n      \"effect_schema\": [\n        {\n          \"color\": \"bronze\",\n          \"count\": 2,\n          \"effects\": [\n            {\n              \"description\": \"Defend on rolls \\u003c= 2 (25%)\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"silver\",\n          \"count\": 3,\n          \"effects\": [\n            {\n              \"description\": \"Defend on rolls \\u003c= 3 (42%)\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"silver\",\n          \"count\": 4,\n          \"effects\": [\n            {\n              \"description\": \"Defend on rolls \\u003c= 4 (50%)\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 5,\n          \"effects\": [\n            {\n              \"description\": \"Defend on rolls \\u003c= 5 (58%)\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 6,\n          \"effects\": [\n            {\n              \"description\": \"Defend on rolls \\u003c= 6 (66%)\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 7,\n          \"effects\": [\n            {\n              \"description\": \"Defend on rolls \\u003c= 7 (75%)\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"prismatic\",\n          \"count\": 8,\n          \"effects\": [\n            {\n              \"description\": \"Defend on rolls \\u003c= 8 (83%)\",\n              \"type\": \"benefit\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"\",\n      \"icon_emoji\": \"🛡?\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/46cf02f0-a3cd-4211-bde4-cc3c5417bd6f/icon.png?quality=30\",\n      \"id\": \"46cf02f0-a3cd-4211-bde4-cc3c5417bd6f\",\n      \"name\": \"Defender\",\n      \"position\": 1,\n      \"tags\": [\n        \"Defensive\"\n      ]\n    },\n    {\n      \"color\": \"#6b7280\",\n      \"description\": \"A stable way to preserve barriers.\",\n      \"effect_schema\": [\n        {\n          \"count\": 2,\n          \"effects\": [\n            {\n              \"description\": \"Cap all incoming damage at 4.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": 3,\n          \"effects\": [\n            {\n              \"description\": \"Cap all incoming damage at 3.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": 4,\n          \"effects\": [\n            {\n              \"description\": \"Cap all incoming damage at 2.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"\",\n      \"icon_emoji\": \"�?\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/aa90084b-a07a-4b00-9448-9f5dae83bd03/icon.png?quality=30\",\n      \"id\": \"aa90084b-a07a-4b00-9448-9f5dae83bd03\",\n      \"name\": \"Support\",\n      \"position\": 2,\n      \"tags\": [\n        \"Defensive\"\n      ]\n    },\n    {\n      \"color\": \"#059669\",\n      \"description\": \"A standard offensive combat class.\",\n      \"effect_schema\": [\n        {\n          \"color\": \"bronze\",\n          \"count\": 2,\n          \"effects\": [\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"bronze\",\n          \"count\": 3,\n          \"effects\": [\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 2,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"bronze\",\n          \"count\": 4,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"silver\",\n          \"count\": 5,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 4,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"silver\",\n          \"count\": 6,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 2,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 5,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 7,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 5,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 8,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 5,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 4,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"prismatic\",\n          \"count\": 9,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 6,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 2,\n              \"type\": \"dice\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"Expected Roll of Melee Attack Dice: ~1, Low Variance.\",\n      \"icon_emoji\": \"⚔?\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/dd17c072-159c-4b43-831f-1f51bb8b7720/icon.png?quality=30\",\n      \"id\": \"dd17c072-159c-4b43-831f-1f51bb8b7720\",\n      \"name\": \"Swordsman\",\n      \"position\": 3,\n      \"tags\": [\n        \"Combat\"\n      ]\n    },\n    {\n      \"color\": \"#7287b1\",\n      \"description\": \"A standard offensive combat class, with a bit higher variance.\",\n      \"effect_schema\": [\n        {\n          \"color\": \"bronze\",\n          \"count\": 2,\n          \"effects\": [\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"bronze\",\n          \"count\": 3,\n          \"effects\": [\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 2,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"bronze\",\n          \"count\": 4,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"silver\",\n          \"count\": 5,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 4,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"silver\",\n          \"count\": 6,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 2,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 5,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 7,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 5,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 8,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 5,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 4,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"prismatic\",\n          \"count\": 9,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 6,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 2,\n              \"type\": \"dice\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"Expected Roll of Ranged Attack Dice: ~1.5, Medium Variance\",\n      \"icon_emoji\": \"🏹\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/5d1c9e89-e431-41dc-ae67-77dd8ee78170/icon.png?quality=30\",\n      \"id\": \"5d1c9e89-e431-41dc-ae67-77dd8ee78170\",\n      \"name\": \"Archer\",\n      \"position\": 4,\n      \"tags\": [\n        \"Combat\"\n      ]\n    },\n    {\n      \"color\": \"#6b7280\",\n      \"description\": \"A offensive combat class with high potential, depends on your Runes.\",\n      \"effect_schema\": [\n        {\n          \"color\": \"bronze\",\n          \"count\": 2,\n          \"effects\": [\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"bronze\",\n          \"count\": 3,\n          \"effects\": [\n            {\n              \"dice_id\": \"27f704cf-eb90-41bb-8d73-61e20ba4b43a\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"silver\",\n          \"count\": 4,\n          \"effects\": [\n            {\n              \"dice_id\": \"27f704cf-eb90-41bb-8d73-61e20ba4b43a\",\n              \"quantity\": 2,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"silver\",\n          \"count\": 5,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"27f704cf-eb90-41bb-8d73-61e20ba4b43a\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 6,\n          \"effects\": [\n            {\n              \"dice_id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n              \"quantity\": 2,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"prismatic\",\n          \"count\": 7,\n          \"effects\": [\n            {\n              \"dice_id\": \"889cd56b-a356-4f34-9914-8efa69618a55\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        },\n        {\n          \"color\": \"bronze\",\n          \"count\": 8,\n          \"effects\": [\n            {\n              \"dice_id\": \"889cd56b-a356-4f34-9914-8efa69618a55\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            },\n            {\n              \"dice_id\": \"27f704cf-eb90-41bb-8d73-61e20ba4b43a\",\n              \"quantity\": 1,\n              \"type\": \"dice\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"Expected Roll of Magic Attack Dice: 4, High Variance.\",\n      \"icon_emoji\": \"🪄\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/173589ed-9bec-4965-94e6-dadbc6b5310a/icon.png?quality=30\",\n      \"id\": \"173589ed-9bec-4965-94e6-dadbc6b5310a\",\n      \"name\": \"Sorcerer\",\n      \"position\": 5,\n      \"tags\": [\n        \"Combat\"\n      ]\n    },\n    {\n      \"color\": \"#6b7280\",\n      \"description\": \"Unlock strategies you can select before battle.\",\n      \"effect_schema\": [\n        {\n          \"color\": \"bronze\",\n          \"count\": 2,\n          \"effects\": [\n            {\n              \"description\": \"Strategy: Imitate - Gain 1 trait of any class.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": 2,\n          \"effects\": [\n            {\n              \"description\": \"Abyss Strategy: Greed: Double incoming damage, gain double rewards.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 3,\n          \"effects\": [\n            {\n              \"description\": \"Strategy: Imitate - Gain 2 traits of any class.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"gold\",\n          \"count\": 3,\n          \"effects\": [\n            {\n              \"description\": \"Abyss Strategy: Abyssal Tactics - All your dice may become Exalted Attack Dice.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"color\": \"prismatic\",\n          \"count\": 5,\n          \"effects\": [\n            {\n              \"description\": \"(All Unique) Strategy: Combat Mastery: You may gain 4 breakpoints on any class with numerical breakpoints.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"\",\n      \"icon_emoji\": \"📖\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/17e08cde-f3d2-480b-8386-1e3047e2f85a/icon.png?quality=30\",\n      \"id\": \"17e08cde-f3d2-480b-8386-1e3047e2f85a\",\n      \"name\": \"Strategist\",\n      \"position\": 6,\n      \"tags\": [\n        \"Flexible\"\n      ]\n    },\n    {\n      \"color\": \"#6b7280\",\n      \"description\": \"An easy way to gain resources from the Abyss.\",\n      \"effect_schema\": [\n        {\n          \"count\": 1,\n          \"effects\": [\n            {\n              \"description\": \"Gain 1 abyss reward if you lose. Excludes Victory Points\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": 2,\n          \"effects\": [\n            {\n              \"description\": \"Gain 2 abyss rewards if you lose. Excludes Victory Points\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": 3,\n          \"effects\": [\n            {\n              \"description\": \"Gain 3 abyss rewards if you lose. Excludes Victory Points\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": 5,\n          \"effects\": [\n            {\n              \"description\": \"Gain 2 protector traits. Gain the all abyss rewards if you lose. Excludes Victory Points\",\n              \"type\": \"benefit\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"\",\n      \"icon_emoji\": \"😼\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/f5438f3c-2052-4093-b402-893a45cf7046/icon.png?quality=30\",\n      \"id\": \"f5438f3c-2052-4093-b402-893a45cf7046\",\n      \"name\": \"Animal\",\n      \"position\": 8,\n      \"tags\": [\n        \"Resources\"\n      ]\n    },\n    {\n      \"color\": \"#6b7280\",\n      \"description\": \"You may place Hero Party Runes on top of Hero Party Spirits to level them up and increase their strength.\\n\\nHero Party Spirits start at level 0. Hero Party Runes increase a spirit's Hero Level by 1, with a max level of 3.\",\n      \"effect_schema\": [\n        {\n          \"count\": \"Ivyrn\",\n          \"effects\": [\n            {\n              \"description\": \"Gain 1 Exalted dice at level 3.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": \"Kael\",\n          \"effects\": [\n            {\n              \"description\": \"Gain 1 protector trait at Hero Level 3.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": \"Nyra\",\n          \"effects\": [\n            {\n              \"description\": \"Nyra becomes an Arcanist at level 3 and if all 6 hero party are also level 3.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": \"Mintyheart\",\n          \"effects\": [\n            {\n              \"description\": \"Level 2: Regenerate 1 Barrier after combat.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        },\n        {\n          \"count\": \"Zarek\",\n          \"effects\": [\n            {\n              \"description\": \"Gain 1 Exalted dice at Hero Level 3.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"\",\n      \"icon_emoji\": \"🦸\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/aaf8adbe-d24f-4551-aacf-44c037695f63/icon.png?quality=30\",\n      \"id\": \"aaf8adbe-d24f-4551-aacf-44c037695f63\",\n      \"name\": \"Hero Party (Class)\",\n      \"position\": 10,\n      \"tags\": [\n        \"Special\"\n      ]\n    },\n    {\n      \"color\": \"#8b5cf6\",\n      \"description\": \"An extremely powerful class only ever described through myths. Only obtainable through Mythic Spirits.\",\n      \"effect_schema\": [\n        {\n          \"count\": 1,\n          \"effects\": [\n            {\n              \"description\": \"Gain 1 Arcane Attack per Arcane Droplet you have.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"\",\n      \"icon_emoji\": \"🩸\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/91322cba-4201-48a3-86b1-2d6d034fce3f/icon.png?quality=30\",\n      \"id\": \"91322cba-4201-48a3-86b1-2d6d034fce3f\",\n      \"name\": \"Arcanist\",\n      \"position\": 11,\n      \"tags\": [\n        \"Special\"\n      ]\n    },\n    {\n      \"color\": \"#8b5cf6\",\n      \"description\": \"\",\n      \"effect_schema\": [\n        {\n          \"count\": 1,\n          \"effects\": [\n            {\n              \"description\": \"If you loose ANY barrier in combat, loose 1 of your humans.\",\n              \"type\": \"benefit\"\n            }\n          ]\n        }\n      ],\n      \"footer\": \"\",\n      \"icon_emoji\": \"🕵?\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/class_icons/ca7348fc-9f45-4b20-9c7d-65d404c1bd51/icon.png?quality=30\",\n      \"id\": \"ca7348fc-9f45-4b20-9c7d-65d404c1bd51\",\n      \"name\": \"Human Enclave\",\n      \"position\": 12,\n      \"tags\": []\n    }\n  ],\n  \"customDice\": [\n    {\n      \"color\": \"#ffbf52\",\n      \"description\": \"\",\n      \"diceType\": \"attack\",\n      \"faces\": [\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 1\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 2\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 3\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 4\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"2\",\n          \"side_number\": 5\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"2\",\n          \"side_number\": 6\n        }\n      ],\n      \"icon\": \"🎲\",\n      \"id\": \"f027b9ec-62f6-48bf-947e-5a6fd07064dc\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/dice_templates/f027b9ec-62f6-48bf-947e-5a6fd07064dc/prefab_composite.png?quality=30\",\n      \"name\": \"Exalted Attack\"\n    },\n    {\n      \"color\": \"#4a9eff\",\n      \"description\": \"\",\n      \"diceType\": \"special\",\n      \"faces\": [\n        {\n          \"reward_description\": \"Side 1\",\n          \"reward_type\": \"special\",\n          \"reward_value\": \"0\",\n          \"side_number\": 1\n        },\n        {\n          \"reward_description\": \"Side 2\",\n          \"reward_type\": \"special\",\n          \"reward_value\": \"0\",\n          \"side_number\": 2\n        },\n        {\n          \"reward_description\": \"Side 3\",\n          \"reward_type\": \"special\",\n          \"reward_value\": \"1\",\n          \"side_number\": 3\n        },\n        {\n          \"reward_description\": \"Side 4\",\n          \"reward_type\": \"special\",\n          \"reward_value\": \"1\",\n          \"side_number\": 4\n        },\n        {\n          \"reward_description\": \"Side 5\",\n          \"reward_type\": \"special\",\n          \"reward_value\": \"1⧉\",\n          \"side_number\": 5\n        },\n        {\n          \"reward_description\": \"Side 6\",\n          \"reward_type\": \"special\",\n          \"reward_value\": \"1⧉\",\n          \"side_number\": 6\n        }\n      ],\n      \"icon\": \"⚔?\",\n      \"id\": \"4b4b8453-13eb-40e0-bd69-b5e8b7bea4d4\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/dice_templates/4b4b8453-13eb-40e0-bd69-b5e8b7bea4d4/prefab_composite.png?quality=30\",\n      \"name\": \"Cyber Dice\"\n    },\n    {\n      \"color\": \"#ff4d4d\",\n      \"description\": \"\",\n      \"diceType\": \"attack\",\n      \"faces\": [\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"2\",\n          \"side_number\": 1\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"2\",\n          \"side_number\": 2\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"2\",\n          \"side_number\": 3\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"3\",\n          \"side_number\": 4\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"3\",\n          \"side_number\": 5\n        },\n        {\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"3\",\n          \"side_number\": 6\n        }\n      ],\n      \"icon\": \"🎲\",\n      \"id\": \"889cd56b-a356-4f34-9914-8efa69618a55\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/dice_templates/exported_template_arcane_attack.png?quality=30\",\n      \"name\": \"Arcane Attack\"\n    },\n    {\n      \"color\": \"#4a9eff\",\n      \"description\": \"Ranged attack with moderate variance. EV 3.3 SD 3.2\",\n      \"diceType\": \"attack\",\n      \"faces\": [\n        {\n          \"reward_description\": \"0 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"0\",\n          \"side_number\": 1\n        },\n        {\n          \"reward_description\": \"0 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"0\",\n          \"side_number\": 2\n        },\n        {\n          \"reward_description\": \"1 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 3\n        },\n        {\n          \"reward_description\": \"1 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 4\n        },\n        {\n          \"reward_description\": \"2 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 5\n        },\n        {\n          \"reward_description\": \"4 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"2\",\n          \"side_number\": 6\n        }\n      ],\n      \"icon\": \"🎲\",\n      \"id\": \"27f704cf-eb90-41bb-8d73-61e20ba4b43a\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/dice_templates/27f704cf-eb90-41bb-8d73-61e20ba4b43a/prefab_composite.png?quality=30\",\n      \"name\": \"Critical Attack\"\n    },\n    {\n      \"color\": \"#4a9eff\",\n      \"description\": \"Consistent heavy melee damage with low variance\",\n      \"diceType\": \"attack\",\n      \"faces\": [\n        {\n          \"reward_description\": \"0 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"0\",\n          \"side_number\": 1\n        },\n        {\n          \"reward_description\": \"1 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"0\",\n          \"side_number\": 2\n        },\n        {\n          \"reward_description\": \"1 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"0\",\n          \"side_number\": 3\n        },\n        {\n          \"reward_description\": \"1 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 4\n        },\n        {\n          \"reward_description\": \"2 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 5\n        },\n        {\n          \"reward_description\": \"2 Attack\",\n          \"reward_type\": \"attack\",\n          \"reward_value\": \"1\",\n          \"side_number\": 6\n        }\n      ],\n      \"icon\": \"🎲\",\n      \"id\": \"f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9\",\n      \"imageUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/dice_templates/f5e0a3c4-0fe7-4d59-b834-94a39a53bbf9/prefab_composite.png?quality=30\",\n      \"name\": \"Basic Attack\"\n    }\n  ],\n  \"fresh\": false,\n  \"gameStarted\": false,\n  \"originDestinyActive\": [],\n  \"referenceSheetUrl\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/e1f25e0a-96e9-4ee4-9e5e-c8373f81d9c4/Screenshot_2025-12-06_at_9.03.31_PM.png?quality=30\",\n  \"runes\": [\n    {\n      \"class_id\": \"91322cba-4201-48a3-86b1-2d6d034fce3f\",\n      \"class_name\": \"Arcanist\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/87263a0b-1e46-496a-a42d-f4bd928b7752/icon.png?quality=30\",\n      \"id\": \"87263a0b-1e46-496a-a42d-f4bd928b7752\",\n      \"name\": \"Arcanist\",\n      \"type\": \"class\"\n    },\n    {\n      \"class_id\": \"aaf8adbe-d24f-4551-aacf-44c037695f63\",\n      \"class_name\": \"Hero Party (Class)\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/84207e75-e1da-497c-90ae-2fdffecf4607/icon.png?quality=30\",\n      \"id\": \"84207e75-e1da-497c-90ae-2fdffecf4607\",\n      \"name\": \"Hero Party (Class)\",\n      \"type\": \"class\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/b9607847-d00b-4578-906b-7cb0b9b9c9a4/icon.png?quality=30\",\n      \"id\": \"b9607847-d00b-4578-906b-7cb0b9b9c9a4\",\n      \"name\": \"Modern Human\",\n      \"origin_id\": \"48e4acb4-ee9e-42ea-ba82-70165770c368\",\n      \"origin_name\": \"Human Enclave\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/a36f2af9-3c8c-4265-939c-62bd2e12e878/icon.png?quality=30\",\n      \"id\": \"a36f2af9-3c8c-4265-939c-62bd2e12e878\",\n      \"name\": \"Royal Family\",\n      \"origin_id\": \"59d3e23e-c7fd-48f9-911d-b8a306029404\",\n      \"origin_name\": \"Royal Family\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/b0fce6aa-282e-48ed-bc14-39ce250b3dd0/icon.png?quality=30\",\n      \"id\": \"b0fce6aa-282e-48ed-bc14-39ce250b3dd0\",\n      \"name\": \"Fairy Garden\",\n      \"origin_id\": \"b4a04571-548d-4572-a6a8-0b85c39316d3\",\n      \"origin_name\": \"Twilight Fairies\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/356f3ad2-4cac-4b69-a3cc-7559f8891d8e/icon.png?quality=30\",\n      \"id\": \"356f3ad2-4cac-4b69-a3cc-7559f8891d8e\",\n      \"name\": \"Cyber City\",\n      \"origin_id\": \"fa7db249-d99d-4c1d-a37d-9027c9f5a31e\",\n      \"origin_name\": \"Cyber City\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/929fe4e3-ab41-4f7c-8bfd-44635752538c/icon.png?quality=30\",\n      \"id\": \"929fe4e3-ab41-4f7c-8bfd-44635752538c\",\n      \"name\": \"Astral Zone\",\n      \"origin_id\": \"9d4457d3-2a6c-4430-8c1b-1bf1bc20889a\",\n      \"origin_name\": \"Astral Zone\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/34b2a963-f8c6-4fc0-8272-ddc50b0036a8/icon.png?quality=30\",\n      \"id\": \"34b2a963-f8c6-4fc0-8272-ddc50b0036a8\",\n      \"name\": \"Florest\",\n      \"origin_id\": \"ad555f03-9b89-4a71-a47c-464fd67d2c05\",\n      \"origin_name\": \"Floral Patch\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/b395bf12-3e7d-49b7-a5cb-293b25002919/icon.png?quality=30\",\n      \"id\": \"b395bf12-3e7d-49b7-a5cb-293b25002919\",\n      \"name\": \"Void\",\n      \"origin_id\": \"27531555-353f-49be-b05e-e78f35e0a7b3\",\n      \"origin_name\": \"Void\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/7ca279f0-1ca8-484a-a86e-0a87aaa7b312/icon.png?quality=30\",\n      \"id\": \"7ca279f0-1ca8-484a-a86e-0a87aaa7b312\",\n      \"name\": \"Any Rune\",\n      \"origin_id\": \"d459ae53-da95-4323-b348-6720e52643d4\",\n      \"origin_name\": \"Lost\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/480cd5f7-adea-481d-8ea9-aad776599d7b/icon.png?quality=30\",\n      \"id\": \"480cd5f7-adea-481d-8ea9-aad776599d7b\",\n      \"name\": \"Lantern Lights\",\n      \"origin_id\": \"178449e9-cc6b-45ab-8522-5183fe1d9307\",\n      \"origin_name\": \"Lantern Lights\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/5eba8681-16b8-4563-b017-22c80a84b35b/icon.png?quality=30\",\n      \"id\": \"5eba8681-16b8-4563-b017-22c80a84b35b\",\n      \"name\": \"Tidal Tribe\",\n      \"origin_id\": \"294cee31-a7ac-4292-9b61-d4293c05c146\",\n      \"origin_name\": \"Tidal Tribe\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/e9e912c2-98bd-4869-b8b2-5089bc037ac7/icon.png?quality=30\",\n      \"id\": \"e9e912c2-98bd-4869-b8b2-5089bc037ac7\",\n      \"name\": \"Arctic Nest\",\n      \"origin_id\": \"82816408-d2e1-4e2c-9954-d9aea0bad324\",\n      \"origin_name\": \"Arctic Nest\",\n      \"type\": \"origin\"\n    },\n    {\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/f452c328-1650-40ac-8506-4f0e9d7a964e/icon.png?quality=30\",\n      \"id\": \"f452c328-1650-40ac-8506-4f0e9d7a964e\",\n      \"name\": \"Hero Party Leveling\",\n      \"origin_id\": \"d40b9771-29b0-4391-a9aa-41945682cd3a\",\n      \"origin_name\": \"Hero Party\",\n      \"type\": \"origin\"\n    },\n    {\n      \"class_id\": \"173589ed-9bec-4965-94e6-dadbc6b5310a\",\n      \"class_name\": \"Sorcerer\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/d0b484ed-733c-4d55-b549-30e631eec857/icon.png?quality=30\",\n      \"id\": \"d0b484ed-733c-4d55-b549-30e631eec857\",\n      \"name\": \"Sorcerer\",\n      \"type\": \"class\"\n    },\n    {\n      \"class_id\": \"dd17c072-159c-4b43-831f-1f51bb8b7720\",\n      \"class_name\": \"Swordsman\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/efa4b29a-06f0-43af-bd11-d60c180e793e/icon.png?quality=30\",\n      \"id\": \"efa4b29a-06f0-43af-bd11-d60c180e793e\",\n      \"name\": \"Swordsman\",\n      \"type\": \"class\"\n    },\n    {\n      \"class_id\": \"aa90084b-a07a-4b00-9448-9f5dae83bd03\",\n      \"class_name\": \"Support\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/a844c161-3f67-42d7-ba59-d5efd5df5f98/icon.png?quality=30\",\n      \"id\": \"a844c161-3f67-42d7-ba59-d5efd5df5f98\",\n      \"name\": \"Support\",\n      \"type\": \"class\"\n    },\n    {\n      \"class_id\": \"46cf02f0-a3cd-4211-bde4-cc3c5417bd6f\",\n      \"class_name\": \"Defender\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/c79313bf-7598-4e6e-93c6-745c8d777b60/icon.png?quality=30\",\n      \"id\": \"c79313bf-7598-4e6e-93c6-745c8d777b60\",\n      \"name\": \"Defender\",\n      \"type\": \"class\"\n    },\n    {\n      \"class_id\": \"f5438f3c-2052-4093-b402-893a45cf7046\",\n      \"class_name\": \"Animal\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/f1c4f059-61e0-40ad-ad9a-4e25a8531f49/icon.png?quality=30\",\n      \"id\": \"f1c4f059-61e0-40ad-ad9a-4e25a8531f49\",\n      \"name\": \"Animal\",\n      \"type\": \"class\"\n    },\n    {\n      \"class_id\": \"17e08cde-f3d2-480b-8386-1e3047e2f85a\",\n      \"class_name\": \"Strategist\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/33f343e7-6bdb-43cc-8b27-115eaa16826f/icon.png?quality=30\",\n      \"id\": \"33f343e7-6bdb-43cc-8b27-115eaa16826f\",\n      \"name\": \"Strategist\",\n      \"type\": \"class\"\n    },\n    {\n      \"class_id\": \"5d1c9e89-e431-41dc-ae67-77dd8ee78170\",\n      \"class_name\": \"Archer\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/f7139fa6-629e-4daa-a360-33b7f90af513/icon.png?quality=30\",\n      \"id\": \"f7139fa6-629e-4daa-a360-33b7f90af513\",\n      \"name\": \"Archer\",\n      \"type\": \"class\"\n    },\n    {\n      \"class_id\": \"ca7348fc-9f45-4b20-9c7d-65d404c1bd51\",\n      \"class_name\": \"Human Enclave\",\n      \"icon_url\": \"https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/runes/00d980ec-5640-4b62-82d4-14cc390321ae/icon.png?quality=30\",\n      \"id\": \"00d980ec-5640-4b62-82d4-14cc390321ae\",\n      \"name\": \"Human Enclave\",\n      \"type\": \"class\"\n    }\n  ],\n  \"selectedCharacters\": []\n}",
  "MusicPlayer": {},
  "Note": "",
  "ObjectStates": [
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 1,
        "g": 0.53,
        "r": 0.118
      },
      "Description": "",
      "DragSelectable": true,
      "FogColor": "Blue",
      "GMNotes": "",
      "GUID": "6fc458",
      "Grid": false,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "HandTrigger",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -50,
        "posY": 3.348,
        "posZ": -22.3,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 15,
        "scaleY": 12,
        "scaleZ": 3
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.168,
        "g": 0.701,
        "r": 0.192
      },
      "Description": "",
      "DragSelectable": true,
      "FogColor": "Green",
      "GMNotes": "",
      "GUID": "aa3bda",
      "Grid": false,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "HandTrigger",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 50,
        "posY": 3.348,
        "posZ": -22.3,
        "rotX": 0,
        "rotY": 270,
        "rotZ": 0,
        "scaleX": 15,
        "scaleY": 12,
        "scaleZ": 3
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.094,
        "g": 0.1,
        "r": 0.856
      },
      "Description": "",
      "DragSelectable": true,
      "FogColor": "Red",
      "GMNotes": "",
      "GUID": "3ffc54",
      "Grid": false,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "HandTrigger",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -50,
        "posY": 3.348,
        "posZ": 17.5,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 15,
        "scaleY": 12,
        "scaleZ": 3
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.113,
        "g": 0.392,
        "r": 0.956
      },
      "Description": "",
      "DragSelectable": true,
      "FogColor": "Orange",
      "GMNotes": "",
      "GUID": "3ffc55",
      "Grid": false,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "HandTrigger",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 0,
        "posY": 3.348,
        "posZ": -67.3,
        "rotX": 0,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 15,
        "scaleY": 12,
        "scaleZ": 3
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.941,
        "g": 0.125,
        "r": 0.627
      },
      "Description": "",
      "DragSelectable": true,
      "FogColor": "Purple",
      "GMNotes": "",
      "GUID": "3ffc56",
      "Grid": false,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "HandTrigger",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 50,
        "posY": 3.348,
        "posZ": 17.5,
        "rotX": 0,
        "rotY": 270,
        "rotZ": 0,
        "scaleX": 15,
        "scaleY": 12,
        "scaleZ": 3
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomAssetbundle": {
        "AssetbundleSecondaryURL": "",
        "AssetbundleURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978795929/723C50F43FAB3DE3DC12CB8460536E8CB34B60A3/",
        "LoopingEffectIndex": 0,
        "MaterialIndex": 2,
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "afc863",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Assetbundle",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -32.4,
        "posY": -10,
        "posZ": -50.4,
        "rotX": 0,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 1,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomAssetbundle": {
        "AssetbundleSecondaryURL": "",
        "AssetbundleURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978795929/723C50F43FAB3DE3DC12CB8460536E8CB34B60A3/",
        "LoopingEffectIndex": 0,
        "MaterialIndex": 2,
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "c8edca",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Assetbundle",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -32.4,
        "posY": -10,
        "posZ": 50.4,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 1,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomAssetbundle": {
        "AssetbundleSecondaryURL": "",
        "AssetbundleURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978795929/723C50F43FAB3DE3DC12CB8460536E8CB34B60A3/",
        "LoopingEffectIndex": 0,
        "MaterialIndex": 2,
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "393bf7",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Assetbundle",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 32.4,
        "posY": -10,
        "posZ": 50.4,
        "rotX": 0,
        "rotY": 180,
        "rotZ": 0,
        "scaleX": 1,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomAssetbundle": {
        "AssetbundleSecondaryURL": "",
        "AssetbundleURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978795929/723C50F43FAB3DE3DC12CB8460536E8CB34B60A3/",
        "LoopingEffectIndex": 0,
        "MaterialIndex": 2,
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "12c65e",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Assetbundle",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 32.4,
        "posY": -10,
        "posZ": -50.4,
        "rotX": 0,
        "rotY": 270,
        "rotZ": 0,
        "scaleX": 1,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "bd69bd",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "tableHeightOffset = -9.5\n\nfunction onSave()\n    saved_data = JSON.encode({tid=tableImageData, cd=checkData})\n    --saved_data = \"\"\n    return saved_data\nend\n\nfunction onload(saved_data)\n    --Loads the tracking for if the game has started yet\n    if saved_data ~= \"\" then\n         local loaded_data = JSON.decode(saved_data)\n         tableImageData = loaded_data.tid\n         checkData = loaded_data.cd\n    else\n        tableImageData = {}\n        checkData = {move=false, scale=false}\n    end\n\n    --Disables interactable status of objects with GUID in list\n    for _, guid in ipairs(ref_noninteractable) do\n        local obj = getObjectFromGUID(guid)\n        if obj then obj.interactable = false end\n    end\n\n    --Establish references to table parts\n    obj_leg1 = getObjectFromGUID(\"afc863\")\n    obj_leg2 = getObjectFromGUID(\"c8edca\")\n    obj_leg3 = getObjectFromGUID(\"393bf7\")\n    obj_leg4 = getObjectFromGUID(\"12c65e\")\n    obj_surface = getObjectFromGUID(\"4ee1f2\")\n    obj_side_top = getObjectFromGUID(\"35b95f\")\n    obj_side_bot = getObjectFromGUID(\"f938a2\")\n    obj_side_lef = getObjectFromGUID(\"9f95fd\")\n    obj_side_rig = getObjectFromGUID(\"5af8f2\")\n\n    controlActive = false\n    createOpenCloseButton()\nend\n\n\n\n--Activation/deactivation of control panel\n\n\n\n--Activated by clicking on\nfunction click_toggleControl(_, color)\n    if permissionCheck(color) then\n        if not controlActive then\n            --Activate control panel\n            controlActive = true\n            self.clearButtons()\n            createOpenCloseButton()\n            createSurfaceInput()\n            createSurfaceButtons()\n            createScaleInput()\n            createScaleButtons()\n        else\n            --Deactivate control panel\n            controlActive = false\n            self.clearButtons()\n            self.clearInputs()\n            createOpenCloseButton()\n\n        end\n    end\nend\n\n\n\n\n--Table surface control\n\n\n\n--Changes table surface\nfunction click_applySurface(_, color)\n    if permissionCheck(color) then\n        updateSurface()\n        broadcastToAll(\"New Table Image Applied\", {0.2,0.9,0.2})\n    end\nend\n\n--Saves table surface\nfunction click_saveSurface(_, color)\n    if permissionCheck(color) then\n        local nickname = self.getInputs()[1].value\n        local url = self.getInputs()[2].value\n        if nickname == \"\" then\n            --No nickname\n            broadcastToAll(\"Please supply a nickname for this save.\", {0.9,0.2,0.2})\n        else\n            --Nickname exists\n\n            if findInImageDataIndex(url, nickname) == nil then\n                --Save doesn't exist already\n                table.insert(tableImageData, {url=url, name=nickname})\n                broadcastToAll(\"Image URL saved to memory.\", {0.2,0.9,0.2})\n                --Refresh buttons\n                self.clearButtons()\n                createOpenCloseButton()\n                createSurfaceButtons()\n                createScaleButtons()\n            else\n                --Save exists already\n                broadcastToAll(\"Memory already contains a save with this Name or URL. Delete it first.\", {0.9,0.2,0.2})\n            end\n        end\n    end\nend\n\n--Loads table surface\nfunction click_loadMemory(_, color, index)\n    if permissionCheck(color) then\n        self.editInput({index=0, value=tableImageData[index].name})\n        self.editInput({index=1, value=tableImageData[index].url})\n        updateSurface()\n        broadcastToAll(\"Table Image Loaded\", {0.2,0.9,0.2})\n    end\nend\n\n--Deletes table surface\nfunction click_deleteMemory(_, color, index)\n    if permissionCheck(color) then\n        table.remove(tableImageData, index)\n        self.clearButtons()\n        createOpenCloseButton()\n        createSurfaceButtons()\n        createScaleButtons()\n        broadcastToAll(\"Element Removed from Memory\", {0.2,0.9,0.2})\n    end\nend\n\n--Updates surface from the values in the input field\nfunction updateSurface()\n    local customInfo = obj_surface.getCustomObject()\n    customInfo.diffuse = self.getInputs()[2].value\n    obj_surface.setCustomObject(customInfo)\n    obj_surface = obj_surface.reload()\nend\n\n\n\n--Table Scale control\n\n\n\n--Applies Scale to table pieces\nfunction click_applyScale(_, color)\n    if permissionCheck(color) then\n        local newWidth = tonumber(self.getInputs()[3].value)\n        local newDepth = tonumber(self.getInputs()[4].value)\n        if type(newWidth) ~= \"number\" then\n            broadcastToAll(\"Invalid Width\", {0.9,0.2,0.2})\n            return\n        elseif type(newDepth) ~= \"number\" then\n            broadcastToAll(\"Invalid Depth\", {0.9,0.2,0.2})\n            return\n        elseif newWidth\u003c0.1 or newDepth\u003c0.1 then\n            broadcastToAll(\"Scale cannot go below 0.1\", {0.9,0.2,0.2})\n            return\n        elseif newWidth\u003e12 or newDepth\u003e12 then\n            broadcastToAll(\"Scale should not go over 12 (world size limitation)\", {0.9,0.2,0.2})\n            return\n        else\n            changeTableScale(math.abs(newWidth), math.abs(newDepth))\n            broadcastToAll(\"Scale applied.\", {0.2,0.9,0.2})\n        end\n    end\nend\n\n--Checks/unchecks move box for hands\nfunction click_checkMove(_, color)\n    if permissionCheck(color) then\n        local find_func = function(o) return o.click_function==\"click_checkMove\" end\n        if checkData.move == true then\n            checkData.move = false\n            local buttonEntry = findButton(self, find_func)\n            self.editButton({index=buttonEntry.index, label=\"\"})\n        else\n            checkData.move = true\n            local buttonEntry = findButton(self, find_func)\n            self.editButton({index=buttonEntry.index, label=string.char(10008)})\n        end\n    end\nend\n\n--Checks/unchecks scale box for hands\n--This button was disabled for technical reasons\n--[[\nfunction click_checkScale(_, color)\n    if permissionCheck(color) then\n        local find_func = function(o) return o.click_function==\"click_checkScale\" end\n        if checkData.scale == true then\n            checkData.scale = false\n            local buttonEntry = findButton(self, find_func)\n            self.editButton({index=buttonEntry.index, label=\"\"})\n        else\n            checkData.scale = true\n            local buttonEntry = findButton(self, find_func)\n            self.editButton({index=buttonEntry.index, label=string.char(10008)})\n        end\n    end\nend\n]]\n\n--Alters scale of elements and moves them\nfunction changeTableScale(width, depth)\n    --Scaling factors used to translate scale to position offset\n    local width2pos = (width-1) * 18\n    local depth2pos = (depth-1) * 18\n\n    --Hand zone movement\n    if checkData.move == true then\n        for _, pc in ipairs(ref_playerColor) do\n            if Player[pc].getHandCount() \u003e 0 then\n                moveHandZone(Player[pc], width2pos, depth2pos)\n            end\n        end\n    end\n    --Hand zone scaling\n    --The button to enable this was disabled for technical reasons\n    if checkData.scale == true then\n        for _, pc in ipairs(ref_playerColor) do\n            if Player[pc].getHandCount() \u003e 0 then\n                scaleHandZone(Player[pc], width, depth)\n            end\n        end\n    end\n\n    --Resizing table elements\n    obj_side_top.setScale({width, 1, 1})\n    obj_side_bot.setScale({width, 1, 1})\n    obj_side_lef.setScale({depth, 1, 1})\n    obj_side_rig.setScale({depth, 1, 1})\n    obj_surface.setScale({width, 1, depth})\n\n    --Moving table elements to accomodate new scale\n    obj_side_lef.setPosition({-width2pos,tableHeightOffset,0})\n    obj_side_rig.setPosition({ width2pos,tableHeightOffset,0})\n    obj_side_top.setPosition({0,tableHeightOffset, depth2pos})\n    obj_side_bot.setPosition({0,tableHeightOffset,-depth2pos})\n    obj_leg1.setPosition({-width2pos,tableHeightOffset-0.5,-depth2pos})\n    obj_leg2.setPosition({-width2pos,tableHeightOffset-0.5, depth2pos})\n    obj_leg3.setPosition({ width2pos,tableHeightOffset-0.5, depth2pos})\n    obj_leg4.setPosition({ width2pos,tableHeightOffset-0.5,-depth2pos})\n    self.setPosition(obj_leg4.positionToWorld({-22.12, 8.74,-19.16}))\n    --Only enabled when changing tableHeightOffset\n    obj_surface.setPosition({0,tableHeightOffset,0})\nend\n\n--Move hand zone, p=player reference, facts are scaling factors\nfunction moveHandZone(p, width2pos, depth2pos)\n    local widthX = obj_side_rig.getPosition().x\n    local depthZ = obj_side_top.getPosition().z\n    for i=1, p.getHandCount() do\n        local handT = p.getHandTransform()\n        local pos = handT.position\n        local y = handT.rotation.y\n\n        if y\u003c45 or y\u003e320 or y\u003e135 and y\u003c225 then\n            if pos.z \u003e 0 then\n                pos.z = pos.z + depth2pos - depthZ\n            else\n                pos.z = pos.z - depth2pos + depthZ\n            end\n        else\n            if pos.x \u003e 0 then\n                pos.x = pos.x + width2pos - widthX\n            else\n                pos.x = pos.x - width2pos + widthX\n            end\n        end\n\n        --Only enabled when changing tableHeightOffset\n        --pos.y = tableHeightOffset + 14\n\n        handT.position = pos\n        p.setHandTransform(handT, i)\n    end\nend\n\n\n---Scales hand zones, p=player reference, facts are scaling factors\nfunction scaleHandZone(p, width, depth)\n    local widthFact = width / obj_side_top.getScale().x\n    local depthFact = depth / obj_side_lef.getScale().x\n    for i=1, p.getHandCount() do\n        local handT = p.getHandTransform()\n        local scale = handT.scale\n        local y = handT.rotation.y\n        if y\u003c45 or y\u003e320 or y\u003e135 and y\u003c225 then\n            scale.x = scale.x * widthFact\n        else\n            scale.x = scale.x * depthFact\n        end\n        handT.scale = scale\n        p.setHandTransform(handT, i)\n    end\nend\n\n\n\n--Information gathering\n\n\n\n--Checks if a color is promoted or host\nfunction permissionCheck(color)\n    if Player[color].host==true or Player[color].promoted==true then\n        return true\n    else\n        return false\n    end\nend\n\n--Locates a string saved within memory file\nfunction findInImageDataIndex(...)\n    for _, str in ipairs({...}) do\n        for i, v in ipairs(tableImageData) do\n            if v.url == str or v.name == str then\n                return i\n            end\n        end\n    end\n    return nil\nend\n\n--Round number (num) to the Nth decimal (dec)\nfunction round(num, dec)\n  local mult = 10^(dec or 0)\n  return math.floor(num * mult + 0.5) / mult\nend\n\n--Locates a button with a helper function\nfunction findButton(obj, func)\n    if func==nil then error(\"No func supplied to findButton\") end\n    for _, v in ipairs(obj.getButtons()) do\n        if func(v) then\n            return v\n        end\n    end\n    return nil\nend\n\n\n\n--Creation of buttons/inputs\n\n\n\nfunction createOpenCloseButton()\n    local tooltip = \"Open Table Control Panel\"\n    if controlActive then\n        tooltip = \"Close Table Control Panel\"\n    end\n    self.createButton({\n        click_function=\"click_toggleControl\", function_owner=self,\n        position={0,0,0}, rotation={-45,0,0}, height=400, width=400,\n        color={1,1,1,0}, tooltip=tooltip\n    })\nend\n\nfunction createSurfaceInput()\n    local currentURL = obj_surface.getCustomObject().diffuse\n    local nickname = \"\"\n    if findInImageDataIndex(currentURL) ~= nil then\n        nickname = tableImageData[findInImageDataIndex(currentURL)].name\n    end\n    self.createInput({\n        label=\"Nickname\", input_function=\"none\", function_owner=self,\n        alignment=3, position={0,0,2}, height=224, width=4000,\n        font_size=200, tooltip=\"Enter nickname for table image (only used for save)\",\n        value=nickname\n    })\n    self.createInput({\n        label=\"URL\", input_function=\"none\", function_owner=self,\n        alignment=3, position={0,0,3}, height=224, width=4000,\n        font_size=200, tooltip=\"Enter URL for tabletop image\",\n        value=currentURL\n    })\nend\n\nfunction createSurfaceButtons()\n    --Label\n    self.createButton({\n        label=\"Tabletop Surface Image\", click_function=\"none\",\n        position={0,0,1}, height=0, width=0, font_size=300, font_color={1,1,1}\n    })\n    --Functional\n    self.createButton({\n        label=\"Apply Image\\nTo Table\", click_function=\"click_applySurface\",\n        function_owner=self, tooltip=\"Apply URL as table image\",\n        position={2,0,4}, height=440, width=1400, font_size=200,\n    })\n    self.createButton({\n        label=\"Save Image\\nTo Memory\", click_function=\"click_saveSurface\",\n        function_owner=self, tooltip=\"Record URL into memory (requires nickname)\",\n        position={-2,0,4}, height=440, width=1400, font_size=200,\n    })\n    --Label\n    self.createButton({\n        label=\"Load From Memory\", click_function=\"none\",\n        position={0,0,5.5}, height=0, width=0, font_size=300, font_color={1,1,1}\n    })\n    --Saves, created dynamically from memory file\n    for i, memoryEntry in ipairs(tableImageData) do\n        --Load\n        local funcName = i..\"loadMemory\"\n        local func = function(x,y) click_loadMemory(x,y,i) end\n        self.setVar(funcName, func)\n        self.createButton({\n            label=memoryEntry.name, click_function=funcName,\n            function_owner=self, tooltip=memoryEntry.url, font_size=200,\n            position={-0.6,0,6.5+0.5*(i-1)}, height=240, width=3300,\n        })\n        --Delete\n        local funcName = i..\"deleteMemory\"\n        local func = function(x,y) click_deleteMemory(x,y,i) end\n        self.setVar(funcName, func)\n        self.createButton({\n            label=\"DELETE\", click_function=funcName,\n            function_owner=self, tooltip=\"\",\n            position={3.6,0,6.5+0.5*(i-1)}, height=240, width=600,\n            font_size=160, font_color={1,0,0}, color={0.8,0.8,0.8}\n        })\n    end\nend\n\nfunction createScaleInput()\n    self.createInput({\n        label=string.char(8644), input_function=\"none\", function_owner=self,\n        alignment=3, position={-8.5,0,2}, height=224, width=400,\n        font_size=200, tooltip=\"Table Width\",\n        value=round(obj_side_top.getScale().x, 1)\n    })\n    self.createInput({\n        label=string.char(8645), input_function=\"none\", function_owner=self,\n        alignment=3, position={-7.5,0,2}, height=224, width=400,\n        font_size=200, tooltip=\"Table Depth\",\n        value=round(obj_side_lef.getScale().x, 1)\n    })\nend\n\nfunction createScaleButtons()\n    --Labels\n    self.createButton({\n        label=\"Table Scale\", click_function=\"none\",\n        position={-8,0,1}, height=0, width=0, font_size=300, font_color={1,1,1}\n    })\n    self.createButton({\n        label=string.char(8644)..\"            \"..string.char(8645),\n        click_function=\"none\",\n        position={-8,0,2}, height=0, width=0, font_size=300, font_color={1,1,1}\n    })\n    self.createButton({\n        label=\"Move Hands:\", click_function=\"none\",\n        position={-8.3,0,3}, height=0, width=0, font_size=200, font_color={1,1,1}\n    })\n    --Disabled due to me removing the feature for technical reasons\n    --[[\n    self.createButton({\n        label=\"Scale Hands:\", click_function=\"none\",\n        position={-8.3,0,4}, height=0, width=0, font_size=200, font_color={1,1,1}\n    })\n    ]]\n    --Checkboxes\n    local label = \"\"\n    if checkData.move == true then label = string.char(10008) end\n    self.createButton({\n        label=label, click_function=\"click_checkMove\",\n        function_owner=self, tooltip=\"Check to move hands when table is rescaled\",\n        position={-6.8,0,3}, height=224, width=224, font_size=200,\n    })\n    --[[\n    local label = \"\"\n    if checkData.scale == true then label = string.char(10008) end\n    self.createButton({\n        label=label, click_function=\"click_checkScale\",\n        function_owner=self, tooltip=\"Check to scale the width of hands when table is rescaled\",\n        position={-6.8,0,4}, height=224, width=224, font_size=200,\n    })\n    ]]\n    --Apply button\n    self.createButton({\n        label=\"Apply Scale\", click_function=\"click_applyScale\",\n        function_owner=self, tooltip=\"Apply width/depth to table\",\n        position={-8,0,4}, height=440, width=1400, font_size=200,\n    })\nend\n\n\n\n\n\n--Data tables\n\n\n\n\nref_noninteractable = {\n    \"afc863\",\"c8edca\",\"393bf7\",\"12c65e\",\"f938a2\",\"9f95fd\",\"35b95f\",\n    \"5af8f2\",\"4ee1f2\",\"bd69bd\"\n}\n\nref_playerColor = {\n    \"White\", \"Brown\", \"Red\", \"Orange\", \"Yellow\",\n    \"Green\", \"Teal\", \"Blue\", \"Purple\", \"Pink\", \"Black\"\n}\n\n--Dummy function, absorbs unwanted triggers\nfunction none() end",
      "LuaScriptState": "{\n  \"cd\": {\n    \"move\": false,\n    \"scale\": false\n  },\n  \"tid\": [\n    {\n      \"name\": \"Felt - Green\",\n      \"url\": \"https://steamusercontent-a.akamaihd.net/ugc/1020573844624825793/FF91D48AB5415E01B8E9EFF7E2421C05AE05ACD2/\"\n    },\n    {\n      \"name\": \"Felt - Gray\",\n      \"url\": \"https://steamusercontent-a.akamaihd.net/ugc/1836902512978660357/7A32A39FD692F3CEE69729A5B7E2C6AF1D00970E/\"\n    },\n    {\n      \"name\": \"Felt - Red\",\n      \"url\": \"https://steamusercontent-a.akamaihd.net/ugc/5107676531851159442/76366CE0E933214A24710553DB94CEEDB3A4F629/\"\n    },\n    {\n      \"name\": \"Wood\",\n      \"url\": \"https://steamusercontent-a.akamaihd.net/ugc/2424696374426875952/D29E3D7C506F513B6FE089DF3029FD8D9F5636EE/\"\n    }\n  ]\n}",
      "MaterialIndex": 1,
      "MeasureMovement": false,
      "Name": "Chinese_Checkers_Piece",
      "Nickname": "Flex Table Control",
      "Snap": true,
      "Sticky": true,
      "Tooltip": false,
      "Transform": {
        "posX": 51.56,
        "posY": -1.26,
        "posZ": -72.52,
        "rotX": 0,
        "rotY": 180,
        "rotZ": 0,
        "scaleX": 1.65,
        "scaleY": 1.65,
        "scaleZ": 1.65
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomAssetbundle": {
        "AssetbundleSecondaryURL": "",
        "AssetbundleURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978796471/14ED0DBD593370733A0309B0950004F33EB9FACA/",
        "LoopingEffectIndex": 0,
        "MaterialIndex": 1,
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "f938a2",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Assetbundle",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 0,
        "posY": -9.5,
        "posZ": -50.4,
        "rotX": 0,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 2.8,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomAssetbundle": {
        "AssetbundleSecondaryURL": "",
        "AssetbundleURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978796471/14ED0DBD593370733A0309B0950004F33EB9FACA/",
        "LoopingEffectIndex": 0,
        "MaterialIndex": 1,
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "9f95fd",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Assetbundle",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -32.4,
        "posY": -9.5,
        "posZ": 0,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 3.8,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomAssetbundle": {
        "AssetbundleSecondaryURL": "",
        "AssetbundleURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978796471/14ED0DBD593370733A0309B0950004F33EB9FACA/",
        "LoopingEffectIndex": 0,
        "MaterialIndex": 1,
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "35b95f",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Assetbundle",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 0,
        "posY": -9.5,
        "posZ": 50.4,
        "rotX": 0,
        "rotY": 180,
        "rotZ": 0,
        "scaleX": 2.8,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomAssetbundle": {
        "AssetbundleSecondaryURL": "",
        "AssetbundleURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978796471/14ED0DBD593370733A0309B0950004F33EB9FACA/",
        "LoopingEffectIndex": 0,
        "MaterialIndex": 1,
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "5af8f2",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Assetbundle",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 32.4,
        "posY": -9.5,
        "posZ": 0,
        "rotX": 0,
        "rotY": 270,
        "rotZ": 0,
        "scaleX": 3.8,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "CustomMesh": {
        "CastShadows": true,
        "ColliderURL": "",
        "Convex": true,
        "CustomShader": {
          "FresnelStrength": 0,
          "SpecularColor": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "SpecularIntensity": 0,
          "SpecularSharpness": 2
        },
        "DiffuseURL": "https://steamusercontent-a.akamaihd.net/ugc/1836902512978660357/7A32A39FD692F3CEE69729A5B7E2C6AF1D00970E/",
        "MaterialIndex": 1,
        "MeshURL": "https://steamusercontent-a.akamaihd.net/ugc/879750610978796176/4A5A65543B98BCFBF57E910D06EC984208223D38/",
        "NormalURL": "",
        "TypeIndex": 4
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "4ee1f2",
      "Grid": true,
      "GridProjection": true,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "Custom_Model",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 0,
        "posY": -9.5,
        "posZ": 0,
        "rotX": 0,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 2.8,
        "scaleY": 1,
        "scaleZ": 3.8
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": false,
      "Bag": {
        "Order": 0
      },
      "ColorDiffuse": {
        "b": 0.2,
        "g": 0.2,
        "r": 0.2
      },
      "ContainedObjects": [
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "AttachedSnapPoints": [
            {
              "Position": {
                "x": 1.156,
                "y": 0.1,
                "z": -0.607
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.683,
                "y": 0.1,
                "z": -0.301
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.682,
                "y": 0.1,
                "z": 0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.151,
                "y": 0.1,
                "z": 0.005
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.154,
                "y": 0.1,
                "z": 0.61
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.628,
                "y": 0.1,
                "z": 0.31
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.627,
                "y": 0.1,
                "z": -0.302
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.348,
                "y": 0.1,
                "z": -0.634
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Status"
              ]
            },
            {
              "Position": {
                "x": 0.176,
                "y": 0.1,
                "z": -0.034
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": 0.013,
                "y": 0.1,
                "z": -0.279
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.141,
                "y": 0.1,
                "z": -0.515
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.284,
                "y": 0.1,
                "z": -0.764
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -1.868,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.649,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.43,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.211,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.991,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.772,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.553,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.334,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": 1.419,
                "y": 0.1,
                "z": -0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.581,
                "y": 0.1,
                "z": -0.007
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.42,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.034,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.878,
                "y": 0.1,
                "z": -0.001
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.029,
                "y": 0.1,
                "z": -0.313
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            }
          ],
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.1,
              "Type": 0
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/3267074b-4f61-457c-b406-12ccf43d068a/guardian_myrtle_image_mat.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "5dc322",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "Myrtle",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Playermat"
          ],
          "Tooltip": false,
          "Transform": {
            "posX": 30,
            "posY": 0.981,
            "posZ": -22.3,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 9.5,
            "scaleY": 1,
            "scaleZ": 9.5
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "AttachedSnapPoints": [
            {
              "Position": {
                "x": 1.156,
                "y": 0.1,
                "z": -0.607
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.683,
                "y": 0.1,
                "z": -0.301
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.682,
                "y": 0.1,
                "z": 0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.151,
                "y": 0.1,
                "z": 0.005
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.154,
                "y": 0.1,
                "z": 0.61
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.628,
                "y": 0.1,
                "z": 0.31
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.627,
                "y": 0.1,
                "z": -0.302
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.348,
                "y": 0.1,
                "z": -0.634
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Status"
              ]
            },
            {
              "Position": {
                "x": 0.176,
                "y": 0.1,
                "z": -0.034
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": 0.013,
                "y": 0.1,
                "z": -0.279
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.141,
                "y": 0.1,
                "z": -0.515
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.284,
                "y": 0.1,
                "z": -0.764
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -1.868,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.649,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.43,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.211,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.991,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.772,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.553,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.334,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": 1.419,
                "y": 0.1,
                "z": -0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.581,
                "y": 0.1,
                "z": -0.007
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.42,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.034,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.878,
                "y": 0.1,
                "z": -0.001
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.029,
                "y": 0.1,
                "z": -0.313
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            }
          ],
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.1,
              "Type": 0
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/8ce23995-bb31-4be8-8fd6-fda19d1f430a/guardian_pixia_image_mat.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "a4e207",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "Pixia",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Playermat"
          ],
          "Tooltip": false,
          "Transform": {
            "posX": 0,
            "posY": 0.981,
            "posZ": -47.299,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 9.5,
            "scaleY": 1,
            "scaleZ": 9.5
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "AttachedSnapPoints": [
            {
              "Position": {
                "x": 1.156,
                "y": 0.1,
                "z": -0.607
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.683,
                "y": 0.1,
                "z": -0.301
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.682,
                "y": 0.1,
                "z": 0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.151,
                "y": 0.1,
                "z": 0.005
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.154,
                "y": 0.1,
                "z": 0.61
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.628,
                "y": 0.1,
                "z": 0.31
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.627,
                "y": 0.1,
                "z": -0.302
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.348,
                "y": 0.1,
                "z": -0.634
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Status"
              ]
            },
            {
              "Position": {
                "x": 0.176,
                "y": 0.1,
                "z": -0.034
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": 0.013,
                "y": 0.1,
                "z": -0.279
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.141,
                "y": 0.1,
                "z": -0.515
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.284,
                "y": 0.1,
                "z": -0.764
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -1.868,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.649,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.43,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.211,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.991,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.772,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.553,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.334,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.868,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.649,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.43,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.211,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.991,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.772,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.553,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.334,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": 1.419,
                "y": 0.1,
                "z": -0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.581,
                "y": 0.1,
                "z": -0.007
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.42,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.034,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.878,
                "y": 0.1,
                "z": -0.001
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.029,
                "y": 0.1,
                "z": -0.313
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            }
          ],
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.1,
              "Type": 0
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/20112149-c8df-48b6-b508-5e9c39e87fc2/guardian_embers_image_mat.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "535e42",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "Embers",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Playermat"
          ],
          "Tooltip": false,
          "Transform": {
            "posX": -30,
            "posY": 0.981,
            "posZ": 17.5,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 9.5,
            "scaleY": 1,
            "scaleZ": 9.5
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "AttachedSnapPoints": [
            {
              "Position": {
                "x": 1.156,
                "y": 0.1,
                "z": -0.607
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.683,
                "y": 0.1,
                "z": -0.301
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.682,
                "y": 0.1,
                "z": 0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.151,
                "y": 0.1,
                "z": 0.005
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.154,
                "y": 0.1,
                "z": 0.61
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.628,
                "y": 0.1,
                "z": 0.31
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.627,
                "y": 0.1,
                "z": -0.302
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.348,
                "y": 0.1,
                "z": -0.634
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Status"
              ]
            },
            {
              "Position": {
                "x": 0.176,
                "y": 0.1,
                "z": -0.034
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": 0.013,
                "y": 0.1,
                "z": -0.279
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.141,
                "y": 0.1,
                "z": -0.515
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.284,
                "y": 0.1,
                "z": -0.764
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -1.868,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.649,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.43,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.211,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.991,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.772,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.553,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.334,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": 1.419,
                "y": 0.1,
                "z": -0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.581,
                "y": 0.1,
                "z": -0.007
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.42,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.034,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.878,
                "y": 0.1,
                "z": -0.001
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.029,
                "y": 0.1,
                "z": -0.313
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            }
          ],
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.1,
              "Type": 0
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/fd8557f7-1cdc-4dde-9941-42b171992432/guardian_bubblepop_image_mat.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "fbf3fe",
          "Grid": false,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "Bubblepop",
          "Snap": false,
          "Sticky": true,
          "Tags": [
            "Playermat"
          ],
          "Tooltip": false,
          "Transform": {
            "posX": -30,
            "posY": 0.981,
            "posZ": -22.3,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 9.5,
            "scaleY": 1,
            "scaleZ": 9.5
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "AttachedSnapPoints": [
            {
              "Position": {
                "x": 1.156,
                "y": 0.1,
                "z": -0.607
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.683,
                "y": 0.1,
                "z": -0.301
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.682,
                "y": 0.1,
                "z": 0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.151,
                "y": 0.1,
                "z": 0.005
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.154,
                "y": 0.1,
                "z": 0.61
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.628,
                "y": 0.1,
                "z": 0.31
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.627,
                "y": 0.1,
                "z": -0.302
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "HexSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.348,
                "y": 0.1,
                "z": -0.634
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Status"
              ]
            },
            {
              "Position": {
                "x": 0.176,
                "y": 0.1,
                "z": -0.034
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": 0.013,
                "y": 0.1,
                "z": -0.279
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.141,
                "y": 0.1,
                "z": -0.515
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -0.284,
                "y": 0.1,
                "z": -0.764
              },
              "Rotation": {
                "x": 0,
                "y": 315,
                "z": 0
              },
              "Tags": [
                "Rune"
              ]
            },
            {
              "Position": {
                "x": -1.868,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.649,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.43,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -1.211,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.991,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.772,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.553,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": -0.334,
                "y": 0.1,
                "z": 0.857
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "Barrier"
              ]
            },
            {
              "Position": {
                "x": 1.419,
                "y": 0.1,
                "z": -0.309
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.581,
                "y": 0.1,
                "z": -0.007
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.42,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.034,
                "y": 0.1,
                "z": 0.308
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 0.878,
                "y": 0.1,
                "z": -0.001
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            },
            {
              "Position": {
                "x": 1.029,
                "y": 0.1,
                "z": -0.313
              },
              "Rotation": {
                "x": 0,
                "y": 0,
                "z": 0
              },
              "Tags": [
                "SpecialSpirit"
              ]
            }
          ],
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.1,
              "Type": 0
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/guardians/20ec3d5d-3fd8-4b5b-b75b-127acb325fff/guardian_lumina_image_mat.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "389509",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "Lumina",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Playermat"
          ],
          "Tooltip": false,
          "Transform": {
            "posX": 30,
            "posY": 0.981,
            "posZ": 17.5,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 9.5,
            "scaleY": 1,
            "scaleZ": 9.5
          },
          "Value": 0,
          "XmlUI": ""
        }
      ],
      "Description": "Contains character playermats for spawning during character selection",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "reserve1",
      "Grid": false,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MaterialIndex": -1,
      "MeasureMovement": false,
      "MeshIndex": -1,
      "Name": "Bag",
      "Nickname": "PlayermatReserve",
      "Snap": false,
      "Sticky": true,
      "Tooltip": false,
      "Transform": {
        "posX": 0,
        "posY": -5,
        "posZ": 0,
        "rotX": 0,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 1,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": false,
      "Bag": {
        "Order": 0
      },
      "ColorDiffuse": {
        "b": 0.2,
        "g": 0.2,
        "r": 0.2
      },
      "ContainedObjects": [
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/637861c1-f870-42b1-addc-3d4bfeafbd26/status_4_fallen.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "81a87a",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Fallen",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -3.306,
            "posY": 1.181,
            "posZ": -41.276,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/637861c1-f870-42b1-addc-3d4bfeafbd26/status_4_fallen.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "d76ce8",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Fallen",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 23.977,
            "posY": 1.181,
            "posZ": -25.606,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/637861c1-f870-42b1-addc-3d4bfeafbd26/status_4_fallen.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "03a1dc",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Fallen",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 23.979,
            "posY": 1.181,
            "posZ": 14.193,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/637861c1-f870-42b1-addc-3d4bfeafbd26/status_4_fallen.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "2cd04b",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Fallen",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -23.977,
            "posY": 1.181,
            "posZ": 20.806,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/637861c1-f870-42b1-addc-3d4bfeafbd26/status_4_fallen.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "b51d31",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": true,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Fallen",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -23.977,
            "posY": 1.181,
            "posZ": -18.994,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/fdf1beb2-fd13-438a-a6dc-b1fe02e95475/status_3_corrupt.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "bb6792",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Corrupt",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -3.306,
            "posY": 1.381,
            "posZ": -41.276,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/fdf1beb2-fd13-438a-a6dc-b1fe02e95475/status_3_corrupt.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "0f528a",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Corrupt",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 23.977,
            "posY": 1.381,
            "posZ": -25.606,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/fdf1beb2-fd13-438a-a6dc-b1fe02e95475/status_3_corrupt.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "0c7fa1",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Corrupt",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 23.976,
            "posY": 1.381,
            "posZ": 14.195,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/fdf1beb2-fd13-438a-a6dc-b1fe02e95475/status_3_corrupt.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "1b24b9",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Corrupt",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -23.978,
            "posY": 1.381,
            "posZ": 20.805,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/fdf1beb2-fd13-438a-a6dc-b1fe02e95475/status_3_corrupt.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "c6429f",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Corrupt",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -23.984,
            "posY": 1.381,
            "posZ": -18.996,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/a45579c5-93f6-4dde-98d0-b2c3f12e2ef1/status_2_tainted.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "19072a",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Status",
            "Tainted"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -3.304,
            "posY": 1.581,
            "posZ": -41.285,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/a45579c5-93f6-4dde-98d0-b2c3f12e2ef1/status_2_tainted.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "791f60",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Status",
            "Tainted"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 23.977,
            "posY": 1.581,
            "posZ": -25.608,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/a45579c5-93f6-4dde-98d0-b2c3f12e2ef1/status_2_tainted.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "1339e8",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Status",
            "Tainted"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 23.977,
            "posY": 1.581,
            "posZ": 14.187,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/a45579c5-93f6-4dde-98d0-b2c3f12e2ef1/status_2_tainted.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "a198d3",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Status",
            "Tainted"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -23.978,
            "posY": 1.581,
            "posZ": 20.805,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/a45579c5-93f6-4dde-98d0-b2c3f12e2ef1/status_2_tainted.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "75a851",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Status",
            "Tainted"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -23.977,
            "posY": 1.581,
            "posZ": -18.995,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/7593615c-83f0-4a25-9f27-a396ebfa5e6d/status_1_purified.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "927810",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Purified",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -3.306,
            "posY": 1.781,
            "posZ": -41.276,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/7593615c-83f0-4a25-9f27-a396ebfa5e6d/status_1_purified.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "7dee9c",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Purified",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 23.977,
            "posY": 1.781,
            "posZ": -25.606,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/7593615c-83f0-4a25-9f27-a396ebfa5e6d/status_1_purified.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "f707d2",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Purified",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 23.979,
            "posY": 1.781,
            "posZ": 14.198,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/7593615c-83f0-4a25-9f27-a396ebfa5e6d/status_1_purified.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "7d436f",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Purified",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -23.977,
            "posY": 1.781,
            "posZ": 20.806,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 1,
            "g": 1,
            "r": 1
          },
          "CustomImage": {
            "CustomToken": {
              "MergeDistancePixels": 25,
              "Stackable": false,
              "StandUp": false,
              "Thickness": 0.2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/misc_assets/7593615c-83f0-4a25-9f27-a396ebfa5e6d/status_1_purified.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "a99fe0",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Token",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Purified",
            "Status"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -23.978,
            "posY": 1.781,
            "posZ": -18.992,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 2.35,
            "scaleY": 1,
            "scaleZ": 2.35
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "2ed8fa",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": -40.046,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "9af91a",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": -37.966,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "204aed",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": -35.885,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "92c046",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": -33.805,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "604297",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": -29.634,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "ee3248",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": -31.715,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "7b9ec6",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": -0.246,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "665b49",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": 1.834,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "ac1ed6",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": 3.915,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "6fdea5",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": 5.995,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "15a86d",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": 8.085,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "0c8061",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": -38.142,
            "posY": 1.081,
            "posZ": 10.166,
            "rotX": 0,
            "rotY": 270,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "5d2708",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 17.746,
            "posY": 1.081,
            "posZ": -55.441,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "9532dc",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 15.666,
            "posY": 1.081,
            "posZ": -55.441,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "9d4ed1",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 13.585,
            "posY": 1.081,
            "posZ": -55.441,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "e21270",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 11.504,
            "posY": 1.081,
            "posZ": -55.441,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "a464cd",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 9.414,
            "posY": 1.081,
            "posZ": -55.441,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "4bc984",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 7.334,
            "posY": 1.081,
            "posZ": -55.441,
            "rotX": 0,
            "rotY": 180,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "6411ae",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": -4.554,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "9cf354",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": -6.634,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "1a70a6",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": -8.715,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "f772a6",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": -10.795,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "636f9c",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": -12.885,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "cf29f6",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": -14.966,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "48ee2b",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": 35.246,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "11a2a8",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": 33.166,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "72ee93",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": 31.085,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "595363",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": 29.005,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "fbcf08",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": 26.915,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        },
        {
          "AltLookAngle": {
            "x": 0,
            "y": 0,
            "z": 0
          },
          "Autoraise": true,
          "ColorDiffuse": {
            "b": 0,
            "g": 0,
            "r": 0
          },
          "CustomImage": {
            "CustomTile": {
              "Stackable": false,
              "Stretch": true,
              "Thickness": 0.2,
              "Type": 2
            },
            "ImageScalar": 1,
            "ImageSecondaryURL": "",
            "ImageURL": "https://gvxfokbptelmvvlxbigh.supabase.co/storage/v1/render/image/public/game_assets/extra_components/53bcf283-70d6-45a0-880a-fd31d9eea77b/extra_avatar_barrier.png?quality=80",
            "WidthScale": 0
          },
          "Description": "",
          "DragSelectable": true,
          "GMNotes": "",
          "GUID": "901f8a",
          "Grid": true,
          "GridProjection": false,
          "Hands": false,
          "HideWhenFaceDown": false,
          "IgnoreFoW": false,
          "LayoutGroupSortIndex": 0,
          "Locked": false,
          "LuaScript": "",
          "LuaScriptState": "",
          "MeasureMovement": false,
          "Name": "Custom_Tile",
          "Nickname": "",
          "Snap": true,
          "Sticky": true,
          "Tags": [
            "Barrier"
          ],
          "Tooltip": true,
          "Transform": {
            "posX": 38.142,
            "posY": 1.081,
            "posZ": 24.834,
            "rotX": 0,
            "rotY": 90,
            "rotZ": 0,
            "scaleX": 1,
            "scaleY": 1,
            "scaleZ": 1
          },
          "Value": 0,
          "XmlUI": ""
        }
      ],
      "Description": "Contains status and barrier tokens for spawning with playermats",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "tokenrv",
      "Grid": false,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MaterialIndex": -1,
      "MeasureMovement": false,
      "MeshIndex": -1,
      "Name": "Bag",
      "Nickname": "TokenReserve",
      "Snap": false,
      "Sticky": true,
      "Tooltip": false,
      "Transform": {
        "posX": 5,
        "posY": -5,
        "posZ": 0,
        "rotX": 0,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 1,
        "scaleY": 1,
        "scaleZ": 1
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "fcf68b",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -27.261,
        "posY": 2.081,
        "posZ": -27,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "cce386",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -27.26,
        "posY": 2.081,
        "posZ": -41.727,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "906112",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -34.116,
        "posY": 2.08,
        "posZ": -34.3,
        "rotX": 0,
        "rotY": 180,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7.5
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "94dade",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 4.75,
        "posY": 2.08,
        "posZ": -44.636,
        "rotX": 0,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "e762f9",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 12,
        "posY": 2.079,
        "posZ": -51.492,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7.5
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "27ebee",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 19.434,
        "posY": 2.075,
        "posZ": -44.636,
        "rotX": 0,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "5dd474",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -27.321,
        "posY": 2.079,
        "posZ": 13,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "fe6a6b",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -34.177,
        "posY": 2.079,
        "posZ": 5.5,
        "rotX": 0,
        "rotY": 180,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7.5
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "002a6c",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": -27.321,
        "posY": 2.079,
        "posZ": -1.973,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "102655",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 34.173,
        "posY": 2.08,
        "posZ": -10.39,
        "rotX": 0,
        "rotY": 180,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7.5
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "78009e",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 27.336,
        "posY": 2.08,
        "posZ": -2.925,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "6018dc",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 27.336,
        "posY": 2.08,
        "posZ": -17.7,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20392,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "01f810",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 27.43,
        "posY": 2.08,
        "posZ": 22,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "27b491",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 34.267,
        "posY": 2.08,
        "posZ": 29.47,
        "rotX": 0,
        "rotY": 180,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7.5
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "a": 0,
        "b": 0.82353,
        "g": 0.20157,
        "r": 0
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "e29621",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "BlockRectangle",
      "Nickname": "Wall",
      "Snap": true,
      "Sticky": true,
      "Tooltip": true,
      "Transform": {
        "posX": 27.43,
        "posY": 2.08,
        "posZ": 36.84,
        "rotX": 0,
        "rotY": 90,
        "rotZ": 0,
        "scaleX": 0.25,
        "scaleY": 2,
        "scaleZ": 7
      },
      "Value": 0,
      "XmlUI": ""
    },
    {
      "AltLookAngle": {
        "x": 0,
        "y": 0,
        "z": 0
      },
      "Autoraise": true,
      "ColorDiffuse": {
        "b": 1,
        "g": 1,
        "r": 1
      },
      "Description": "",
      "DragSelectable": true,
      "GMNotes": "",
      "GUID": "8e7d0a",
      "Grid": true,
      "GridProjection": false,
      "Hands": false,
      "HideWhenFaceDown": false,
      "IgnoreFoW": false,
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "LuaScript": "",
      "LuaScriptState": "",
      "MeasureMovement": false,
      "Name": "3DText",
      "Nickname": "",
      "Snap": true,
      "Sticky": true,
      "Text": {
        "Text": "Arc Spirits",
        "colorstate": {
          "b": 0.709059358,
          "g": 0,
          "r": 0.6339826
        },
        "fontSize": 256
      },
      "Tooltip": true,
      "Transform": {
        "posX": 0,
        "posY": 1,
        "posZ": 65,
        "rotX": 90,
        "rotY": 0,
        "rotZ": 0,
        "scaleX": 2.2,
        "scaleY": 2.2,
        "scaleZ": 2.2
      },
      "Value": 0,
      "XmlUI": ""
    }
  ],
  "PlayArea": 0.5,
  "SaveName": "Arc Spirits",
  "Sky": "Sky_Museum",
  "SnapPoints": [
    {
      "Position": {
        "x": -31.253,
        "y": 1.181,
        "z": 46.378
      },
      "Rotation": {
        "x": 0,
        "y": 180,
        "z": 0
      },
      "Tags": [
        "HexSpirit"
      ]
    },
    {
      "Position": {
        "x": -21.84,
        "y": 1.181,
        "z": 46.18
      },
      "Rotation": {
        "x": 0,
        "y": 180,
        "z": 0
      },
      "Tags": [
        "HexSpirit"
      ]
    },
    {
      "Position": {
        "x": -12.349,
        "y": 1.181,
        "z": 46.192
      },
      "Rotation": {
        "x": 0,
        "y": 180,
        "z": 0
      },
      "Tags": [
        "HexSpirit"
      ]
    },
    {
      "Position": {
        "x": -2.73,
        "y": 1.181,
        "z": 46.173
      },
      "Rotation": {
        "x": 0,
        "y": 180,
        "z": 0
      },
      "Tags": [
        "HexSpirit"
      ]
    },
    {
      "Position": {
        "x": 6.716,
        "y": 1.181,
        "z": 46.15
      },
      "Rotation": {
        "x": 0,
        "y": 180,
        "z": 0
      },
      "Tags": [
        "HexSpirit"
      ]
    }
  ],
  "TabStates": {
    "0": {
      "body": "",
      "color": "Grey",
      "id": 0,
      "title": "Rules",
      "visibleColor": {
        "b": 0.5,
        "g": 0.5,
        "r": 0.5
      }
    },
    "1": {
      "body": "",
      "color": "White",
      "id": 1,
      "title": "White",
      "visibleColor": {
        "b": 1,
        "g": 1,
        "r": 1
      }
    },
    "10": {
      "body": "",
      "color": "Pink",
      "id": 10,
      "title": "Pink",
      "visibleColor": {
        "b": 0.807,
        "g": 0.439,
        "r": 0.96
      }
    },
    "11": {
      "body": "",
      "color": "Black",
      "id": 11,
      "title": "Black",
      "visibleColor": {
        "b": 0.25,
        "g": 0.25,
        "r": 0.25
      }
    },
    "2": {
      "body": "",
      "color": "Brown",
      "id": 2,
      "title": "Brown",
      "visibleColor": {
        "b": 0.09,
        "g": 0.231,
        "r": 0.443
      }
    },
    "3": {
      "body": "",
      "color": "Red",
      "id": 3,
      "title": "Red",
      "visibleColor": {
        "b": 0.094,
        "g": 0.1,
        "r": 0.856
      }
    },
    "4": {
      "body": "",
      "color": "Orange",
      "id": 4,
      "title": "Orange",
      "visibleColor": {
        "b": 0.113,
        "g": 0.392,
        "r": 0.956
      }
    },
    "5": {
      "body": "",
      "color": "Yellow",
      "id": 5,
      "title": "Yellow",
      "visibleColor": {
        "b": 0.172,
        "g": 0.898,
        "r": 0.905
      }
    },
    "6": {
      "body": "",
      "color": "Green",
      "id": 6,
      "title": "Green",
      "visibleColor": {
        "b": 0.168,
        "g": 0.701,
        "r": 0.192
      }
    },
    "7": {
      "body": "",
      "color": "Blue",
      "id": 7,
      "title": "Blue",
      "visibleColor": {
        "b": 1,
        "g": 0.53,
        "r": 0.118
      }
    },
    "8": {
      "body": "",
      "color": "Teal",
      "id": 8,
      "title": "Teal",
      "visibleColor": {
        "b": 0.607,
        "g": 0.694,
        "r": 0.129
      }
    },
    "9": {
      "body": "",
      "color": "Purple",
      "id": 9,
      "title": "Purple",
      "visibleColor": {
        "b": 0.941,
        "g": 0.125,
        "r": 0.627
      }
    }
  },
  "Table": "Table_None",
  "Tags": [],
  "Turns": {
    "DisableInteractions": false,
    "Enable": false,
    "PassTurns": true,
    "Reverse": false,
    "SkipEmpty": false,
    "TurnColor": "",
    "TurnOrder": [],
    "Type": 0
  },
  "VersionNumber": "v13.3",
  "XmlUI": "\u003c!-- Xml UI. See documentation: https://api.tabletopsimulator.com/ui/introUI/ --\u003e"
}
